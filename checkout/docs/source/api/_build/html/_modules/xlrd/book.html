<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xlrd.book &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="xlrd" href="../xlrd.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xlrd.book</h1><div class="highlight"><pre>
<span class="c"># Copyright (c) 2005-2012 Stephen John Machin, Lingfo Pty Ltd</span>
<span class="c"># This module is part of the xlrd package, which is released under a</span>
<span class="c"># BSD-style licence.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">.timemachine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.biffh</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">struct</span><span class="p">;</span> <span class="n">unpack</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sheet</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">compdoc</span>
<span class="kn">from</span> <span class="nn">.formula</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">formatting</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;IronPython&quot;</span><span class="p">):</span>
    <span class="c"># print &gt;&gt; sys.stderr, &quot;...importing encodings&quot;</span>
    <span class="kn">import</span> <span class="nn">encodings</span>

<span class="n">empty_cell</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">empty_cell</span> <span class="c"># for exposure to the world ...</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">USE_FANCY_CD</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">TOGGLE_GC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="c"># gc.set_debug(gc.DEBUG_STATS)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mmap</span>
    <span class="n">MMAP_AVAILABLE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">MMAP_AVAILABLE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">USE_MMAP</span> <span class="o">=</span> <span class="n">MMAP_AVAILABLE</span>

<span class="n">MY_EOF</span> <span class="o">=</span> <span class="mh">0xF00BAAA</span> <span class="c"># not a 16-bit number</span>

<span class="n">SUPBOOK_UNK</span><span class="p">,</span> <span class="n">SUPBOOK_INTERNAL</span><span class="p">,</span> <span class="n">SUPBOOK_EXTERNAL</span><span class="p">,</span> <span class="n">SUPBOOK_ADDIN</span><span class="p">,</span> <span class="n">SUPBOOK_DDEOLE</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">SUPPORTED_VERSIONS</span> <span class="o">=</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">_code_from_builtin_name</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;Consolidate_Area&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Auto_Open&quot;</span><span class="p">:</span>        <span class="s">&quot;</span><span class="se">\x01</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Auto_Close&quot;</span><span class="p">:</span>       <span class="s">&quot;</span><span class="se">\x02</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Extract&quot;</span><span class="p">:</span>          <span class="s">&quot;</span><span class="se">\x03</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Database&quot;</span><span class="p">:</span>         <span class="s">&quot;</span><span class="se">\x04</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Criteria&quot;</span><span class="p">:</span>         <span class="s">&quot;</span><span class="se">\x05</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Print_Area&quot;</span><span class="p">:</span>       <span class="s">&quot;</span><span class="se">\x06</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Print_Titles&quot;</span><span class="p">:</span>     <span class="s">&quot;</span><span class="se">\x07</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Recorder&quot;</span><span class="p">:</span>         <span class="s">&quot;</span><span class="se">\x08</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Data_Form&quot;</span><span class="p">:</span>        <span class="s">&quot;</span><span class="se">\x09</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Auto_Activate&quot;</span><span class="p">:</span>    <span class="s">&quot;</span><span class="se">\x0A</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Auto_Deactivate&quot;</span><span class="p">:</span>  <span class="s">&quot;</span><span class="se">\x0B</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;Sheet_Title&quot;</span><span class="p">:</span>      <span class="s">&quot;</span><span class="se">\x0C</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="s">&quot;_FilterDatabase&quot;</span><span class="p">:</span>  <span class="s">&quot;</span><span class="se">\x0D</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="n">builtin_name_from_code</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">code_from_builtin_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">_bin</span><span class="p">,</span> <span class="n">_bic</span> <span class="ow">in</span> <span class="n">_code_from_builtin_name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">_bin</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="n">_bin</span><span class="p">)</span>
    <span class="n">_bic</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="n">_bic</span><span class="p">)</span>
    <span class="n">code_from_builtin_name</span><span class="p">[</span><span class="n">_bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">_bic</span>
    <span class="n">builtin_name_from_code</span><span class="p">[</span><span class="n">_bic</span><span class="p">]</span> <span class="o">=</span> <span class="n">_bin</span>
<span class="k">del</span> <span class="n">_bin</span><span class="p">,</span> <span class="n">_bic</span><span class="p">,</span> <span class="n">_code_from_builtin_name</span>

<div class="viewcode-block" id="open_workbook_xls"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.open_workbook_xls">[docs]</a><span class="k">def</span> <span class="nf">open_workbook_xls</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">logfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_mmap</span><span class="o">=</span><span class="n">USE_MMAP</span><span class="p">,</span>
    <span class="n">file_contents</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">encoding_override</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">formatting_info</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">on_demand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ragged_rows</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">TOGGLE_GC</span><span class="p">:</span>
        <span class="n">orig_gc_enabled</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">isenabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">orig_gc_enabled</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">bk</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">biff2_8_load</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_contents</span><span class="o">=</span><span class="n">file_contents</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">use_mmap</span><span class="o">=</span><span class="n">use_mmap</span><span class="p">,</span>
            <span class="n">encoding_override</span><span class="o">=</span><span class="n">encoding_override</span><span class="p">,</span>
            <span class="n">formatting_info</span><span class="o">=</span><span class="n">formatting_info</span><span class="p">,</span>
            <span class="n">on_demand</span><span class="o">=</span><span class="n">on_demand</span><span class="p">,</span>
            <span class="n">ragged_rows</span><span class="o">=</span><span class="n">ragged_rows</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">load_time_stage_1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
        <span class="n">biff_version</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">getbof</span><span class="p">(</span><span class="n">XL_WORKBOOK_GLOBALS</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">biff_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Can&#39;t determine file&#39;s BIFF version&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">biff_version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_VERSIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span>
                <span class="s">&quot;BIFF version </span><span class="si">%s</span><span class="s"> is not supported&quot;</span>
                <span class="o">%</span> <span class="n">biff_text_from_num</span><span class="p">[</span><span class="n">biff_version</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">=</span> <span class="n">biff_version</span>
        <span class="k">if</span> <span class="n">biff_version</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="c"># no workbook globals, only 1 worksheet</span>
            <span class="k">if</span> <span class="n">on_demand</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;*** WARNING: on_demand is not supported for this Excel version.</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="s">&quot;*** Setting on_demand to False.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">bk</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="n">on_demand</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">bk</span><span class="o">.</span><span class="n">fake_globals_get_sheet</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">biff_version</span> <span class="o">==</span> <span class="mi">45</span><span class="p">:</span>
            <span class="c"># worksheet(s) embedded in global stream</span>
            <span class="n">bk</span><span class="o">.</span><span class="n">parse_globals</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">on_demand</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** WARNING: on_demand is not supported for this Excel version.</span><span class="se">\n</span><span class="s">&quot;</span>
                                    <span class="s">&quot;*** Setting on_demand to False.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">bk</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="n">on_demand</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bk</span><span class="o">.</span><span class="n">parse_globals</span><span class="p">()</span>
            <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">on_demand</span><span class="p">:</span>
                <span class="n">bk</span><span class="o">.</span><span class="n">get_sheets</span><span class="p">()</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">biff_version</span> <span class="o">==</span> <span class="mi">45</span> <span class="ow">and</span> <span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;*** WARNING: Excel 4.0 workbook (.XLW) file contains </span><span class="si">%d</span><span class="s"> worksheets.</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;*** Book-level data will be that of the last worksheet.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">TOGGLE_GC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">orig_gc_enabled</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">load_time_stage_2</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">release_resources</span><span class="p">()</span>
        <span class="k">raise</span>
    <span class="c"># normal exit</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">on_demand</span><span class="p">:</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">release_resources</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">bk</span>

<span class="c">##</span>
<span class="c"># For debugging: dump the file&#39;s BIFF records in char &amp; hex.</span>
<span class="c"># @param filename The path to the file to be dumped.</span>
<span class="c"># @param outfile An open file, to which the dump is written.</span>
<span class="c"># @param unnumbered If true, omit offsets (for meaningful diffs).</span>
</div>
<div class="viewcode-block" id="dump"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.dump">[docs]</a><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">unnumbered</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">bk</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">biff2_8_load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">biff_dump</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">mem</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">stream_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">unnumbered</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># For debugging and analysis: summarise the file&#39;s BIFF records.</span>
<span class="c"># I.e. produce a sorted file of (record_name, count).</span>
<span class="c"># @param filename The path to the file to be summarised.</span>
<span class="c"># @param outfile An open file, to which the summary is written.</span>
</div>
<div class="viewcode-block" id="count_records"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.count_records">[docs]</a><span class="k">def</span> <span class="nf">count_records</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="n">bk</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">biff2_8_load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">biff_count_records</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">mem</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">stream_len</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Information relating to a named reference, formula, macro, etc.</span>
<span class="c"># &lt;br /&gt;  -- New in version 0.6.0</span>
<span class="c"># &lt;br /&gt;  -- &lt;i&gt;Name information is &lt;b&gt;not&lt;/b&gt; extracted from files older than</span>
<span class="c"># Excel 5.0 (Book.biff_version &lt; 50)&lt;/i&gt;</span>
</div>
<div class="viewcode-block" id="Name"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Name">[docs]</a><span class="k">class</span> <span class="nc">Name</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>

    <span class="n">_repr_these</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;stack&#39;</span><span class="p">]</span>
    <span class="n">book</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># parent</span>

    <span class="c">##</span>
    <span class="c"># 0 = Visible; 1 = Hidden</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = Command macro; 1 = Function macro. Relevant only if macro == 1</span>
    <span class="n">func</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = Sheet macro; 1 = VisualBasic macro. Relevant only if macro == 1</span>
    <span class="n">vbasic</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = Standard name; 1 = Macro name</span>
    <span class="n">macro</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = Simple formula; 1 = Complex formula (array formula or user defined)&lt;br /&gt;</span>
    <span class="c"># &lt;i&gt;No examples have been sighted.&lt;/i&gt;</span>
    <span class="nb">complex</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = User-defined name; 1 = Built-in name</span>
    <span class="c"># (common examples: Print_Area, Print_Titles; see OOo docs for full list)</span>
    <span class="n">builtin</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Function group. Relevant only if macro == 1; see OOo docs for values.</span>
    <span class="n">funcgroup</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># 0 = Formula definition; 1 = Binary data&lt;br /&gt;  &lt;i&gt;No examples have been sighted.&lt;/i&gt;</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># The index of this object in book.name_obj_list</span>
    <span class="n">name_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># A Unicode string. If builtin, decoded as per OOo docs.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># An 8-bit string.</span>
    <span class="n">raw_formula</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>

    <span class="c">##</span>
    <span class="c"># -1: The name is global (visible in all calculation sheets).&lt;br /&gt;</span>
    <span class="c"># -2: The name belongs to a macro sheet or VBA sheet.&lt;br /&gt;</span>
    <span class="c"># -3: The name is invalid.&lt;br /&gt;</span>
    <span class="c"># 0 &lt;= scope &lt; book.nsheets: The name is local to the sheet whose index is scope.</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c">##</span>
    <span class="c"># The result of evaluating the formula, if any.</span>
    <span class="c"># If no formula, or evaluation of the formula encountered problems,</span>
    <span class="c"># the result is None. Otherwise the result is a single instance of the</span>
    <span class="c"># Operand class.</span>
    <span class="c">#</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># This is a convenience method for the frequent use case where the name</span>
    <span class="c"># refers to a single cell.</span>
    <span class="c"># @return An instance of the Cell class.</span>
    <span class="c"># @throws XLRDError The name is not a constant absolute reference</span>
    <span class="c"># to a single cell.</span>
<div class="viewcode-block" id="Name.cell"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Name.cell">[docs]</a>    <span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="c"># result should be an instance of the Operand class</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">kind</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">shtxlo</span> <span class="o">==</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">shtxhi</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="ow">and</span>      <span class="n">ref3d</span><span class="o">.</span><span class="n">rowxlo</span> <span class="o">==</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">rowxhi</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="ow">and</span>      <span class="n">ref3d</span><span class="o">.</span><span class="n">colxlo</span> <span class="o">==</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">colxhi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">shtxlo</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">sh</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">rowxlo</span><span class="p">,</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">colxlo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== Dump of Name object ===&quot;</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="s">&quot;======= End of dump =======&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Not a constant absolute reference to a single cell&quot;</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># This is a convenience method for the use case where the name</span>
    <span class="c"># refers to one rectangular area in one worksheet.</span>
    <span class="c"># @param clipped If true (the default), the returned rectangle is clipped</span>
    <span class="c"># to fit in (0, sheet.nrows, 0, sheet.ncols) -- it is guaranteed that</span>
    <span class="c"># 0 &lt;= rowxlo &lt;= rowxhi &lt;= sheet.nrows and that the number of usable rows</span>
    <span class="c"># in the area (which may be zero) is rowxhi - rowxlo; likewise for columns.</span>
    <span class="c"># @return a tuple (sheet_object, rowxlo, rowxhi, colxlo, colxhi).</span>
    <span class="c"># @throws XLRDError The name is not a constant absolute reference</span>
    <span class="c"># to a single area in a single sheet.</span></div>
<div class="viewcode-block" id="Name.area2d"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Name.area2d">[docs]</a>    <span class="k">def</span> <span class="nf">area2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clipped</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="c"># result should be an instance of the Operand class</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">kind</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># only 1 reference</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">shtxlo</span> <span class="o">==</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">shtxhi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># only 1 usable sheet</span>
                    <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">shtxlo</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">clipped</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sh</span><span class="p">,</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">rowxlo</span><span class="p">,</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">rowxhi</span><span class="p">,</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">colxlo</span><span class="p">,</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">colxhi</span>
                    <span class="n">rowxlo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">rowxlo</span><span class="p">,</span> <span class="n">sh</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>
                    <span class="n">rowxhi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rowxlo</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">rowxhi</span><span class="p">,</span> <span class="n">sh</span><span class="o">.</span><span class="n">nrows</span><span class="p">))</span>
                    <span class="n">colxlo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">colxlo</span><span class="p">,</span> <span class="n">sh</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
                    <span class="n">colxhi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">colxlo</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ref3d</span><span class="o">.</span><span class="n">colxhi</span><span class="p">,</span> <span class="n">sh</span><span class="o">.</span><span class="n">ncols</span><span class="p">))</span>
                    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rowxlo</span> <span class="o">&lt;=</span> <span class="n">rowxhi</span> <span class="o">&lt;=</span> <span class="n">sh</span><span class="o">.</span><span class="n">nrows</span>
                    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">colxlo</span> <span class="o">&lt;=</span> <span class="n">colxhi</span> <span class="o">&lt;=</span> <span class="n">sh</span><span class="o">.</span><span class="n">ncols</span>
                    <span class="k">return</span> <span class="n">sh</span><span class="p">,</span> <span class="n">rowxlo</span><span class="p">,</span> <span class="n">rowxhi</span><span class="p">,</span> <span class="n">colxlo</span><span class="p">,</span> <span class="n">colxhi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== Dump of Name object ===&quot;</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="s">&quot;======= End of dump =======&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Not a constant absolute reference to a single area in a single sheet&quot;</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Contents of a &quot;workbook&quot;.</span>
<span class="c"># &lt;p&gt;WARNING: You don&#39;t call this class yourself. You use the Book object that</span>
<span class="c"># was returned when you called xlrd.open_workbook(&quot;myfile.xls&quot;).&lt;/p&gt;</span>
</div></div>
<div class="viewcode-block" id="Book"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book">[docs]</a><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># The number of worksheets present in the workbook file.</span>
    <span class="c"># This information is available even when no sheets have yet been loaded.</span>
    <span class="n">nsheets</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Which date system was in force when this file was last saved.&lt;br /&gt;</span>
    <span class="c">#    0 =&gt; 1900 system (the Excel for Windows default).&lt;br /&gt;</span>
    <span class="c">#    1 =&gt; 1904 system (the Excel for Macintosh default).&lt;br /&gt;</span>
    <span class="n">datemode</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># In case it&#39;s not specified in the file.</span>

    <span class="c">##</span>
    <span class="c"># Version of BIFF (Binary Interchange File Format) used to create the file.</span>
    <span class="c"># Latest is 8.0 (represented here as 80), introduced with Excel 97.</span>
    <span class="c"># Earliest supported by this module: 2.0 (represented as 20).</span>
    <span class="n">biff_version</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># List containing a Name object for each NAME record in the workbook.</span>
    <span class="c"># &lt;br /&gt;  -- New in version 0.6.0</span>
    <span class="n">name_obj_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># An integer denoting the character set used for strings in this file.</span>
    <span class="c"># For BIFF 8 and later, this will be 1200, meaning Unicode; more precisely, UTF_16_LE.</span>
    <span class="c"># For earlier versions, this is used to derive the appropriate Python encoding</span>
    <span class="c"># to be used to convert to Unicode.</span>
    <span class="c"># Examples: 1252 -&gt; &#39;cp1252&#39;, 10000 -&gt; &#39;mac_roman&#39;</span>
    <span class="n">codepage</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># The encoding that was derived from the codepage.</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># A tuple containing the (telephone system) country code for:&lt;br /&gt;</span>
    <span class="c">#    [0]: the user-interface setting when the file was created.&lt;br /&gt;</span>
    <span class="c">#    [1]: the regional settings.&lt;br /&gt;</span>
    <span class="c"># Example: (1, 61) meaning (USA, Australia).</span>
    <span class="c"># This information may give a clue to the correct encoding for an unknown codepage.</span>
    <span class="c"># For a long list of observed values, refer to the OpenOffice.org documentation for</span>
    <span class="c"># the COUNTRY record.</span>
    <span class="n">countries</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># What (if anything) is recorded as the name of the last user to save the file.</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># A list of Font class instances, each corresponding to a FONT record.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">font_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># A list of XF class instances, each corresponding to an XF record.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">xf_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># A list of Format objects, each corresponding to a FORMAT record, in</span>
    <span class="c"># the order that they appear in the input file.</span>
    <span class="c"># It does &lt;i&gt;not&lt;/i&gt; contain builtin formats.</span>
    <span class="c"># If you are creating an output file using (for example) pyExcelerator,</span>
    <span class="c"># use this list.</span>
    <span class="c"># The collection to be used for all visual rendering purposes is format_map.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">format_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># The mapping from XF.format_key to Format object.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">format_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># This provides access via name to the extended format information for</span>
    <span class="c"># both built-in styles and user-defined styles.&lt;br /&gt;</span>
    <span class="c"># It maps &lt;i&gt;name&lt;/i&gt; to (&lt;i&gt;built_in&lt;/i&gt;, &lt;i&gt;xf_index&lt;/i&gt;), where:&lt;br /&gt;</span>
    <span class="c"># &lt;i&gt;name&lt;/i&gt; is either the name of a user-defined style,</span>
    <span class="c"># or the name of one of the built-in styles. Known built-in names are</span>
    <span class="c"># Normal, RowLevel_1 to RowLevel_7,</span>
    <span class="c"># ColLevel_1 to ColLevel_7, Comma, Currency, Percent, &quot;Comma [0]&quot;,</span>
    <span class="c"># &quot;Currency [0]&quot;, Hyperlink, and &quot;Followed Hyperlink&quot;.&lt;br /&gt;</span>
    <span class="c"># &lt;i&gt;built_in&lt;/i&gt; 1 = built-in style, 0 = user-defined&lt;br /&gt;</span>
    <span class="c"># &lt;i&gt;xf_index&lt;/i&gt; is an index into Book.xf_list.&lt;br /&gt;</span>
    <span class="c"># References: OOo docs s6.99 (STYLE record); Excel UI Format/Style</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1; since 0.7.4, extracted only if</span>
    <span class="c"># open_workbook(..., formatting_info=True)</span>
    <span class="n">style_name_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># This provides definitions for colour indexes. Please refer to the</span>
    <span class="c"># above section &quot;The Palette; Colour Indexes&quot; for an explanation</span>
    <span class="c"># of how colours are represented in Excel.&lt;br /&gt;</span>
    <span class="c"># Colour indexes into the palette map into (red, green, blue) tuples.</span>
    <span class="c"># &quot;Magic&quot; indexes e.g. 0x7FFF map to None.</span>
    <span class="c"># &lt;i&gt;colour_map&lt;/i&gt; is what you need if you want to render cells on screen or in a PDF</span>
    <span class="c"># file. If you are writing an output XLS file, use &lt;i&gt;palette_record&lt;/i&gt;.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1. Extracted only if open_workbook(..., formatting_info=True)</span>
    <span class="n">colour_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># If the user has changed any of the colours in the standard palette, the XLS</span>
    <span class="c"># file will contain a PALETTE record with 56 (16 for Excel 4.0 and earlier)</span>
    <span class="c"># RGB values in it, and this list will be e.g. [(r0, b0, g0), ..., (r55, b55, g55)].</span>
    <span class="c"># Otherwise this list will be empty. This is what you need if you are</span>
    <span class="c"># writing an output XLS file. If you want to render cells on screen or in a PDF</span>
    <span class="c"># file, use colour_map.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1. Extracted only if open_workbook(..., formatting_info=True)</span>
    <span class="n">palette_record</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># Time in seconds to extract the XLS image as a contiguous string (or mmap equivalent).</span>
    <span class="n">load_time_stage_1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="c">##</span>
    <span class="c"># Time in seconds to parse the data from the contiguous string (or mmap equivalent).</span>
    <span class="n">load_time_stage_2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="c">##</span>
    <span class="c"># @return A list of all sheets in the book.</span>
    <span class="c"># All sheets not already loaded will be loaded.</span>
<div class="viewcode-block" id="Book.sheets"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.sheets">[docs]</a>    <span class="k">def</span> <span class="nf">sheets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sheetx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsheets</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sheetx</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheetx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[:]</span>

    <span class="c">##</span>
    <span class="c"># @param sheetx Sheet index in range(nsheets)</span>
    <span class="c"># @return An object of the Sheet class</span></div>
<div class="viewcode-block" id="Book.sheet_by_index"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.sheet_by_index">[docs]</a>    <span class="k">def</span> <span class="nf">sheet_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheetx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sheetx</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheetx</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># @param sheet_name Name of sheet required</span>
    <span class="c"># @return An object of the Sheet class</span></div>
<div class="viewcode-block" id="Book.sheet_by_name"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.sheet_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">sheet_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sheetx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;No sheet named &lt;</span><span class="si">%r</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">sheet_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheetx</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># @return A list of the names of all the worksheets in the workbook file.</span>
    <span class="c"># This information is available even when no sheets have yet been loaded.</span></div>
<div class="viewcode-block" id="Book.sheet_names"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.sheet_names">[docs]</a>    <span class="k">def</span> <span class="nf">sheet_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[:]</span>

    <span class="c">##</span>
    <span class="c"># @param sheet_name_or_index Name or index of sheet enquired upon</span>
    <span class="c"># @return true if sheet is loaded, false otherwise</span>
    <span class="c"># &lt;br /&gt;  -- New in version 0.7.1</span></div>
<div class="viewcode-block" id="Book.sheet_loaded"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.sheet_loaded">[docs]</a>    <span class="k">def</span> <span class="nf">sheet_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet_name_or_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sheet_name_or_index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">sheetx</span> <span class="o">=</span> <span class="n">sheet_name_or_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sheetx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sheet_name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;No sheet named &lt;</span><span class="si">%r</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">sheet_name_or_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sheetx</span><span class="p">])</span>

    <span class="c">##</span>
    <span class="c"># @param sheet_name_or_index Name or index of sheet to be unloaded.</span>
    <span class="c"># &lt;br /&gt;  -- New in version 0.7.1</span></div>
<div class="viewcode-block" id="Book.unload_sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.unload_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">unload_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet_name_or_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sheet_name_or_index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">sheetx</span> <span class="o">=</span> <span class="n">sheet_name_or_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sheetx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sheet_name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;No sheet named &lt;</span><span class="si">%r</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">sheet_name_or_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sheetx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="c">##</span>
    <span class="c"># This method has a dual purpose. You can call it to release</span>
    <span class="c"># memory-consuming objects and (possibly) a memory-mapped file</span>
    <span class="c"># (mmap.mmap object) when you have finished loading sheets in</span>
    <span class="c"># on_demand mode, but still require the Book object to examine the</span>
    <span class="c"># loaded sheets. It is also called automatically (a) when open_workbook</span>
    <span class="c"># raises an exception and (b) if you are using a &quot;with&quot; statement, when </span>
    <span class="c"># the &quot;with&quot; block is exited. Calling this method multiple times on the </span>
    <span class="c"># same object has no ill effect.</span></div>
<div class="viewcode-block" id="Book.release_resources"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.release_resources">[docs]</a>    <span class="k">def</span> <span class="nf">release_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources_released</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">,</span> <span class="s">&quot;close&quot;</span><span class="p">):</span>
            <span class="c"># must be a mmap.mmap object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mem</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">,</span> <span class="s">&quot;close&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sharedstrings</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rich_text_runlist_map</span> <span class="o">=</span> <span class="bp">None</span>
    </div>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
        
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release_resources</span><span class="p">()</span>
        <span class="c"># return false        </span>

    <span class="c">##</span>
    <span class="c"># A mapping from (lower_case_name, scope) to a single Name object.</span>
    <span class="c"># &lt;br /&gt;  -- New in version 0.6.0</span>
    <span class="n">name_and_scope_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># A mapping from lower_case_name to a list of Name objects. The list is</span>
    <span class="c"># sorted in scope order. Typically there will be one item (of global scope)</span>
    <span class="c"># in the list.</span>
    <span class="c"># &lt;br /&gt;  -- New in version 0.6.0</span>
    <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_visibility</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># from BOUNDSHEET record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsheets</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># sheet&#39;s absolute position in the stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sharedstrings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rich_text_runlist_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_name</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheethdr_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># BIFF 4W only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builtinfmtcount</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># unknown as yet. BIFF 3, 4S, 4W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_format_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># includes macro &amp; VBA sheets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_locals_inx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_addins_inx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># maps an all_sheets index to a calc-sheets index (or -1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_externsheet_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_externsheet_type_b57</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_name_from_num</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_num_from_name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources_released</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addin_func_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colour_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette_record</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_name_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mem</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>

<div class="viewcode-block" id="Book.biff2_8_load"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.biff2_8_load">[docs]</a>    <span class="k">def</span> <span class="nf">biff2_8_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">file_contents</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_mmap</span><span class="o">=</span><span class="n">USE_MMAP</span><span class="p">,</span>
        <span class="n">encoding_override</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">formatting_info</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">on_demand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">ragged_rows</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="c"># DEBUG = 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_mmap</span> <span class="o">=</span> <span class="n">use_mmap</span> <span class="ow">and</span> <span class="n">MMAP_AVAILABLE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding_override</span> <span class="o">=</span> <span class="n">encoding_override</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span> <span class="o">=</span> <span class="n">formatting_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="n">on_demand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ragged_rows</span> <span class="o">=</span> <span class="n">ragged_rows</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_contents</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># EOF</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c"># BOF</span>
                <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;File size is 0 bytes&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_mmap</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="n">mmap</span><span class="o">.</span><span class="n">ACCESS_READ</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span> <span class="o">=</span> <span class="n">size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">file_contents</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="n">compdoc</span><span class="o">.</span><span class="n">SIGNATURE</span><span class="p">:</span>
            <span class="c"># got this one at the antique store</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">compdoc</span><span class="o">.</span><span class="n">CompDoc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">USE_FANCY_CD</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">qname</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Workbook&#39;</span><span class="p">,</span> <span class="s">&#39;Book&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span> <span class="o">=</span> \
                                <span class="n">cd</span><span class="o">.</span><span class="n">locate_named_stream</span><span class="p">(</span><span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="n">qname</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">:</span> <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Can&#39;t find workbook in OLE2 compound document&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">qname</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Workbook&#39;</span><span class="p">,</span> <span class="s">&#39;Book&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mem</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">get_named_stream</span><span class="p">(</span><span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="n">qname</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">:</span> <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Can&#39;t find workbook in OLE2 compound document&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">cd</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">,</span> <span class="s">&quot;close&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;mem: </span><span class="si">%s</span><span class="s">, base: </span><span class="si">%d</span><span class="s">, len: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_len</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.initialise_format_info"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.initialise_format_info">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_format_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># needs to be done once per sheet for BIFF 4W :-(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xfcount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actualfmtcount</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># number of FORMAT records seen so far</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_epilogue_done</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_list</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Book.get2bytes"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.get2bytes">[docs]</a>    <span class="k">def</span> <span class="nf">get2bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">buff_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">lenbuff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buff_two</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">+=</span> <span class="n">lenbuff</span>
        <span class="k">if</span> <span class="n">lenbuff</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MY_EOF</span>
        <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">buff_two</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">lo</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.get_record_parts"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.get_record_parts">[docs]</a>    <span class="k">def</span> <span class="nf">get_record_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span>
        <span class="n">code</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">length</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">length</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.get_record_parts_conditional"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.get_record_parts_conditional">[docs]</a>    <span class="k">def</span> <span class="nf">get_record_parts_conditional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reqd_record</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span>
        <span class="n">code</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="n">reqd_record</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">length</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">length</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.get_sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.get_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">get_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh_number</span><span class="p">,</span> <span class="n">update_pos</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources_released</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Can&#39;t load sheets after releasing resources.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update_pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span><span class="p">[</span><span class="n">sh_number</span><span class="p">]</span>
        <span class="n">_unused_biff_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getbof</span><span class="p">(</span><span class="n">XL_WORKSHEET</span><span class="p">)</span>
        <span class="c"># assert biff_version == self.biff_version ### FAILS</span>
        <span class="c"># Have an example where book is v7 but sheet reports v8!!!</span>
        <span class="c"># It appears to work OK if the sheet version is ignored.</span>
        <span class="c"># Confirmed by Daniel Rentz: happens when Excel does &quot;save as&quot;</span>
        <span class="c"># creating an old version file; ignore version details on sheet BOF.</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">Sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">sh_number</span><span class="p">],</span>
                <span class="n">sh_number</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sh_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span>
        <span class="k">return</span> <span class="n">sh</span>
</div>
<div class="viewcode-block" id="Book.get_sheets"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.get_sheets">[docs]</a>    <span class="k">def</span> <span class="nf">get_sheets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># DEBUG = 0</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;GET_SHEETS:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sheetno</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;GET_SHEETS: sheetno =&quot;</span><span class="p">,</span> <span class="n">sheetno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheetno</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.fake_globals_get_sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.fake_globals_get_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">fake_globals_get_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># for BIFF 4.0 and earlier</span>
        <span class="n">formatting</span><span class="o">.</span><span class="n">initialise_book</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fake_sheet_name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;Sheet 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fake_sheet_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_visibility</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># one sheet, visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># get_sheet updates _sheet_list but needs a None beforehand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_sheets</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Book.handle_boundsheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_boundsheet">[docs]</a>    <span class="k">def</span> <span class="nf">handle_boundsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DEBUG = 1</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;BOUNDSHEET: bv=</span><span class="si">%d</span><span class="s"> data </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">==</span> <span class="mi">45</span><span class="p">:</span> <span class="c"># BIFF4W</span>
            <span class="c">#### Not documented in OOo docs ...</span>
            <span class="c"># In fact, the *only* data is the name of the sheet.</span>
            <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">visibility</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sheet_type</span> <span class="o">=</span> <span class="n">XL_BOUNDSHEET_WORKSHEET</span> <span class="c"># guess, patch later</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">abs_posn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheetsoffset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span>
                <span class="c"># Note (a) this won&#39;t be used</span>
                <span class="c"># (b) it&#39;s the position of the SHEETHDR record</span>
                <span class="c"># (c) add 11 to get to the worksheet BOF record</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">abs_posn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># unknown</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">visibility</span><span class="p">,</span> <span class="n">sheet_type</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;iBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">abs_posn</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="c"># because global BOF is always at posn 0 in the stream</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="n">BIFF_FIRST_UNICODE</span><span class="p">:</span>
                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;BOUNDSHEET: inx=</span><span class="si">%d</span><span class="s"> vis=</span><span class="si">%r</span><span class="s"> sheet_name=</span><span class="si">%r</span><span class="s"> abs_posn=</span><span class="si">%d</span><span class="s"> sheet_type=0x</span><span class="si">%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_count</span><span class="p">,</span> <span class="n">visibility</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">abs_posn</span><span class="p">,</span> <span class="n">sheet_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sheet_type</span> <span class="o">!=</span> <span class="n">XL_BOUNDSHEET_WORKSHEET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Macro sheet&#39;</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Chart&#39;</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Visual Basic module&#39;</span><span class="p">,</span>
                <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sheet_type</span><span class="p">,</span> <span class="s">&#39;UNKNOWN&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;NOTE *** Ignoring non-worksheet data named </span><span class="si">%r</span><span class="s"> (type 0x</span><span class="si">%02x</span><span class="s"> = </span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="n">sheet_name</span><span class="p">,</span> <span class="n">sheet_type</span><span class="p">,</span> <span class="n">descr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sh_abs_posn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abs_posn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_visibility</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">visibility</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_num_from_name</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">snum</span>
</div>
<div class="viewcode-block" id="Book.handle_builtinfmtcount"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_builtinfmtcount">[docs]</a>    <span class="k">def</span> <span class="nf">handle_builtinfmtcount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c">### N.B. This count appears to be utterly useless.</span>
        <span class="c"># DEBUG = 1</span>
        <span class="n">builtinfmtcount</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;BUILTINFMTCOUNT: </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">builtinfmtcount</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builtinfmtcount</span> <span class="o">=</span> <span class="n">builtinfmtcount</span>
</div>
<div class="viewcode-block" id="Book.derive_encoding"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.derive_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">derive_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding_override</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding_override</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;*** No CODEPAGE record, no encoding_override: will use &#39;ascii&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;ascii&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span> <span class="o">=</span> <span class="mi">1200</span> <span class="c"># utf16le</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** No CODEPAGE record; assuming 1200 (utf_16_le)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">codepage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span>
            <span class="k">if</span> <span class="n">codepage</span> <span class="ow">in</span> <span class="n">encoding_from_codepage</span><span class="p">:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding_from_codepage</span><span class="p">[</span><span class="n">codepage</span><span class="p">]</span>
            <span class="k">elif</span> <span class="mi">300</span> <span class="o">&lt;=</span> <span class="n">codepage</span> <span class="o">&lt;=</span> <span class="mi">1999</span><span class="p">:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;cp&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">codepage</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;unknown_codepage_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">codepage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">and</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;CODEPAGE: codepage </span><span class="si">%r</span><span class="s"> -&gt; encoding </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codepage</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span> <span class="o">!=</span> <span class="mi">1200</span><span class="p">:</span> <span class="c"># utf_16_le</span>
            <span class="c"># If we don&#39;t have a codec that can decode ASCII into Unicode,</span>
            <span class="c"># we&#39;re well &amp; truly stuffed -- let the punter know ASAP.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_unused</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;trial&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;ERROR *** codepage </span><span class="si">%r</span><span class="s"> -&gt; encoding </span><span class="si">%r</span><span class="s"> -&gt; </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_name</span><span class="p">:</span>
            <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">strg</span> <span class="o">=</span> <span class="n">strg</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="c"># if DEBUG:</span>
            <span class="c">#     print &quot;CODEPAGE: user name decoded from %r to %r&quot; % (self.user_name, strg)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">strg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_name</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
</div>
<div class="viewcode-block" id="Book.handle_codepage"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_codepage">[docs]</a>    <span class="k">def</span> <span class="nf">handle_codepage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DEBUG = 0</span>
        <span class="n">codepage</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codepage</span> <span class="o">=</span> <span class="n">codepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Book.handle_country"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_country">[docs]</a>    <span class="k">def</span> <span class="nf">handle_country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Countries:&quot;</span><span class="p">,</span> <span class="n">countries</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="c"># Note: in BIFF7 and earlier, country record was put (redundantly?) in each worksheet.</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span> <span class="o">==</span> <span class="n">countries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span>
</div>
<div class="viewcode-block" id="Book.handle_datemode"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_datemode">[docs]</a>    <span class="k">def</span> <span class="nf">handle_datemode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">datemode</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;DATEMODE: datemode </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">datemode</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">datemode</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datemode</span> <span class="o">=</span> <span class="n">datemode</span>
</div>
<div class="viewcode-block" id="Book.handle_externname"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_externname">[docs]</a>    <span class="k">def</span> <span class="nf">handle_externname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">option_flags</span><span class="p">,</span> <span class="n">other_info</span> <span class="o">=</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HI&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">SUPBOOK_ADDIN</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addin_func_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;EXTERNNAME: sbktype=</span><span class="si">%d</span><span class="s"> oflags=0x</span><span class="si">%04x</span><span class="s"> oinfo=0x</span><span class="si">%08x</span><span class="s"> name=</span><span class="si">%r</span><span class="s"> extra=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">option_flags</span><span class="p">,</span> <span class="n">other_info</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.handle_externsheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_externsheet">[docs]</a>    <span class="k">def</span> <span class="nf">handle_externsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span> <span class="c"># in case CODEPAGE record missing/out of order/wrong</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># for use as a 1-based index</span>
        <span class="n">blah1</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="n">blah2</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">num_refs</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bytes_reqd</span> <span class="o">=</span> <span class="n">num_refs</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bytes_reqd</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;INFO: EXTERNSHEET needs </span><span class="si">%d</span><span class="s"> bytes, have </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">bytes_reqd</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                        <span class="p">)</span>
                <span class="n">code2</span><span class="p">,</span> <span class="n">length2</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">code2</span> <span class="o">!=</span> <span class="n">XL_CONTINUE</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Missing CONTINUE after EXTERNSHEET record&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">data2</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">num_refs</span><span class="p">):</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">ref_recordx</span><span class="p">,</span> <span class="n">ref_first_sheetx</span><span class="p">,</span> <span class="n">ref_last_sheetx</span> <span class="o">=</span> <span class="n">info</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_externsheet_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">6</span>
                <span class="k">if</span> <span class="n">blah2</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;EXTERNSHEET(b8): k = </span><span class="si">%2d</span><span class="s">, record = </span><span class="si">%2d</span><span class="s">, first_sheet = </span><span class="si">%5d</span><span class="s">, last sheet = </span><span class="si">%5d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">k</span><span class="p">,</span> <span class="n">ref_recordx</span><span class="p">,</span> <span class="n">ref_first_sheetx</span><span class="p">,</span> <span class="n">ref_last_sheetx</span><span class="p">,</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nc</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">blah2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;EXTERNSHEET(b7-):&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;Encoded URL&quot;</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">:</span> <span class="s">&quot;Current sheet!!&quot;</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">:</span> <span class="s">&quot;Specific sheet in own doc&#39;t&quot;</span><span class="p">,</span>
                    <span class="mi">4</span><span class="p">:</span> <span class="s">&quot;Nonspecific sheet in own doc&#39;t!!&quot;</span><span class="p">,</span>
                    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ty</span><span class="p">,</span> <span class="s">&quot;Not encoded&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   </span><span class="si">%3d</span><span class="s"> chars, type is </span><span class="si">%d</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">msg</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ty</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">sheet_name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">nc</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_name_from_num</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet_name</span>
                <span class="k">if</span> <span class="n">blah2</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_name_from_num</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">ty</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">ty</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_externsheet_type_b57</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.handle_filepass"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_filepass">[docs]</a>    <span class="k">def</span> <span class="nf">handle_filepass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">logf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">logf</span><span class="p">,</span> <span class="s">&quot;FILEPASS:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="n">logf</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">kind1</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">kind1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># weak XOR encryption</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">hash_value</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="n">logf</span><span class="p">,</span>
                        <span class="s">&#39;weak XOR: key=0x</span><span class="si">%04x</span><span class="s"> hash=0x</span><span class="si">%04x</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
                        <span class="n">key</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">kind1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kind2</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kind2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># BIFF8 standard encryption</span>
                        <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;BIFF8 std&quot;</span>
                    <span class="k">elif</span> <span class="n">kind2</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;BIFF8 strong&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;** UNKNOWN ENCRYPTION METHOD **&quot;</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="n">logf</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">caption</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Workbook is encrypted&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.handle_name"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_name">[docs]</a>    <span class="k">def</span> <span class="nf">handle_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
        <span class="c"># print</span>
        <span class="c"># hex_char_dump(data, 0, len(data), fout=self.logfile)</span>
        <span class="p">(</span>
        <span class="n">option_flags</span><span class="p">,</span> <span class="n">kb_shortcut</span><span class="p">,</span> <span class="n">name_len</span><span class="p">,</span> <span class="n">fmla_len</span><span class="p">,</span> <span class="n">extsht_index</span><span class="p">,</span> <span class="n">sheet_index</span><span class="p">,</span>
        <span class="n">menu_text_len</span><span class="p">,</span> <span class="n">description_text_len</span><span class="p">,</span> <span class="n">help_topic_text_len</span><span class="p">,</span> <span class="n">status_bar_text_len</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HBBHHH4B&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">])</span>
        <span class="n">nobj</span> <span class="o">=</span> <span class="n">Name</span><span class="p">()</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="bp">self</span> <span class="c">### CIRCULAR ###</span>
        <span class="n">name_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">name_index</span> <span class="o">=</span> <span class="n">name_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nobj</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">option_flags</span> <span class="o">=</span> <span class="n">option_flags</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">nshift</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;hidden&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;func&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;vbasic&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;macro&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;complex&#39;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;builtin&#39;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;funcgroup&#39;</span><span class="p">,</span> <span class="mh">0xFC0</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;binary&#39;</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
            <span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">nobj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">nshift</span><span class="p">)</span>

        <span class="n">macro_flag</span> <span class="o">=</span> <span class="s">&quot; M&quot;</span><span class="p">[</span><span class="n">nobj</span><span class="o">.</span><span class="n">macro</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">internal_name</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_string_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">known_len</span><span class="o">=</span><span class="n">name_len</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">internal_name</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">known_len</span><span class="o">=</span><span class="n">name_len</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">extn_sheet_num</span> <span class="o">=</span> <span class="n">extsht_index</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">excel_sheet_index</span> <span class="o">=</span> <span class="n">sheet_index</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># patched up in the names_epilogue() method</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;NAME[</span><span class="si">%d</span><span class="s">]:</span><span class="si">%s</span><span class="s"> oflags=</span><span class="si">%d</span><span class="s">, name_len=</span><span class="si">%d</span><span class="s">, fmla_len=</span><span class="si">%d</span><span class="s">, extsht_index=</span><span class="si">%d</span><span class="s">, sheet_index=</span><span class="si">%d</span><span class="s">, name=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">name_index</span><span class="p">,</span> <span class="n">macro_flag</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="n">name_len</span><span class="p">,</span>
                <span class="n">fmla_len</span><span class="p">,</span> <span class="n">extsht_index</span><span class="p">,</span> <span class="n">sheet_index</span><span class="p">,</span> <span class="n">internal_name</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">internal_name</span>
        <span class="k">if</span> <span class="n">nobj</span><span class="o">.</span><span class="n">builtin</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">builtin_name_from_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;??Unknown??&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;    builtin: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">raw_formula</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">basic_formula_len</span> <span class="o">=</span> <span class="n">fmla_len</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="n">nobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- handle_name: name[</span><span class="si">%d</span><span class="s">] ---&quot;</span> <span class="o">%</span> <span class="n">name_index</span><span class="p">,</span>
                <span class="n">footer</span><span class="o">=</span><span class="s">&quot;-------------------&quot;</span><span class="p">,</span>
                <span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.names_epilogue"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.names_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">names_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;+++++ names_epilogue +++++&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;_all_sheets_map&quot;</span><span class="p">,</span> <span class="n">REPR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;_extnsht_name_from_num&quot;</span><span class="p">,</span> <span class="n">REPR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_name_from_num</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;_sheet_num_from_name&quot;</span><span class="p">,</span> <span class="n">REPR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_num_from_name</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="n">num_names</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">namex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
            <span class="n">nobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">namex</span><span class="p">]</span>
            <span class="c"># Convert from excel_sheet_index to scope.</span>
            <span class="c"># This is done here because in BIFF7 and earlier, the</span>
            <span class="c"># BOUNDSHEET records (from which _all_sheets_map is derived)</span>
            <span class="c"># come after the NAME records.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">sheet_index</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">excel_sheet_index</span>
                <span class="k">if</span> <span class="n">sheet_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># global</span>
                <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">sheet_index</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">):</span>
                    <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">[</span><span class="n">sheet_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">intl_sheet_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c"># maps to a macro or VBA sheet</span>
                        <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="c"># valid sheet reference but not useful</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># huh?</span>
                    <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="c"># invalid</span>
            <span class="k">elif</span> <span class="mi">50</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">sheet_index</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">extn_sheet_num</span>
                <span class="k">if</span> <span class="n">sheet_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># global</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sheet_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extnsht_name_from_num</span><span class="p">[</span><span class="n">sheet_index</span><span class="p">]</span>
                    <span class="n">intl_sheet_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_num_from_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="n">intl_sheet_index</span>

        <span class="k">for</span> <span class="n">namex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
            <span class="n">nobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">namex</span><span class="p">]</span>
            <span class="c"># Parse the formula ...</span>
            <span class="k">if</span> <span class="n">nobj</span><span class="o">.</span><span class="n">macro</span> <span class="ow">or</span> <span class="n">nobj</span><span class="o">.</span><span class="n">binary</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">nobj</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">evaluate_name_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nobj</span><span class="p">,</span> <span class="n">namex</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="n">blah</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;---------- name object dump ----------&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">namex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
                <span class="n">nobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">namex</span><span class="p">]</span>
                <span class="n">nobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- name[</span><span class="si">%d</span><span class="s">] ---&quot;</span> <span class="o">%</span> <span class="n">namex</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;--------------------------------------&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Build some dicts for access to the name objects</span>
        <span class="c">#</span>
        <span class="n">name_and_scope_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># (name.lower(), scope): Name_object</span>
        <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>           <span class="c"># name.lower() : list of Name_objects (sorted in scope order)</span>
        <span class="k">for</span> <span class="n">namex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
            <span class="n">nobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">namex</span><span class="p">]</span>
            <span class="n">name_lcase</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">name_lcase</span><span class="p">,</span> <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">name_and_scope_map</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;Duplicate entry </span><span class="si">%r</span><span class="s"> in name_and_scope_map</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">name_and_scope_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobj</span>
            <span class="n">sort_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">nobj</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="n">namex</span><span class="p">,</span> <span class="n">nobj</span><span class="p">)</span>
            <span class="c"># namex (a temp unique ID) ensures the Name objects will not</span>
            <span class="c"># be compared (fatal in py3)</span>
            <span class="k">if</span> <span class="n">name_lcase</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
                <span class="n">name_map</span><span class="p">[</span><span class="n">name_lcase</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sort_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name_map</span><span class="p">[</span><span class="n">name_lcase</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sort_data</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">name_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">alist</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">alist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">name_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_and_scope_map</span> <span class="o">=</span> <span class="n">name_and_scope_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_map</span> <span class="o">=</span> <span class="n">name_map</span>
</div>
<div class="viewcode-block" id="Book.handle_obj"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_obj">[docs]</a>    <span class="k">def</span> <span class="nf">handle_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># Not doing much handling at all.</span>
        <span class="c"># Worrying about embedded (BOF ... EOF) substreams is done elsewhere.</span>
        <span class="c"># DEBUG = 1</span>
        <span class="n">obj_type</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HI&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
        <span class="c"># if DEBUG: print &quot;---&gt; handle_obj type=%d id=0x%08x&quot; % (obj_type, obj_id)</span>
</div>
<div class="viewcode-block" id="Book.handle_supbook"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_supbook">[docs]</a>    <span class="k">def</span> <span class="nf">handle_supbook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># aka EXTERNALBOOK in OOo docs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUPBOOK:&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">num_sheets</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;num_sheets = </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">num_sheets</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">sbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x01\x04</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SUPBOOK_INTERNAL</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_locals_inx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_count</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUPBOOK[</span><span class="si">%d</span><span class="s">]: internal 3D refs; </span><span class="si">%d</span><span class="s"> sheets&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sbn</span><span class="p">,</span> <span class="n">num_sheets</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;    _all_sheets_map&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x01\x00\x01\x3A</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SUPBOOK_ADDIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_addins_inx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_count</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUPBOOK[</span><span class="si">%d</span><span class="s">]: add-in functions&quot;</span> <span class="o">%</span> <span class="n">sbn</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_sheets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SUPBOOK_DDEOLE</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;SUPBOOK[</span><span class="si">%d</span><span class="s">]: DDE/OLE document = </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sbn</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supbook_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SUPBOOK_EXTERNAL</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;SUPBOOK[</span><span class="si">%d</span><span class="s">]: url = </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sbn</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">sheet_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sheets</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shname</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="c"># #### FIX ME ####</span>
                <span class="c"># Should implement handling of CONTINUE record(s) ...</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">((</span>
                        <span class="s">&quot;*** WARNING: unpack failure in sheet </span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s"> in SUPBOOK record for file </span><span class="si">%r</span><span class="s">&quot;</span> 
                        <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_sheets</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                        <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">sheet_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;  sheetx=</span><span class="si">%d</span><span class="s"> namelen=</span><span class="si">%d</span><span class="s"> name=</span><span class="si">%r</span><span class="s"> (next pos=</span><span class="si">%d</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shname</span><span class="p">),</span> <span class="n">shname</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.handle_sheethdr"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_sheethdr">[docs]</a>    <span class="k">def</span> <span class="nf">handle_sheethdr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># This a BIFF 4W special.</span>
        <span class="c"># The SHEETHDR record is followed by a (BOF ... EOF) substream containing</span>
        <span class="c"># a worksheet.</span>
        <span class="c"># DEBUG = 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
        <span class="n">sheet_len</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sheetno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheethdr_count</span>
        <span class="k">assert</span> <span class="n">sheet_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">sheetno</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheethdr_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">BOF_posn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">posn</span> <span class="o">=</span> <span class="n">BOF_posn</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&#39;SHEETHDR </span><span class="si">%d</span><span class="s"> at posn </span><span class="si">%d</span><span class="s">: len=</span><span class="si">%d</span><span class="s"> name=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">sheetno</span><span class="p">,</span> <span class="n">posn</span><span class="p">,</span> <span class="n">sheet_len</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_format_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;SHEETHDR: xf epilogue flag is </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xf_epilogue_done</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># get_sheet updates _sheet_list but needs a None beforehand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheetno</span><span class="p">,</span> <span class="n">update_pos</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;SHEETHDR: posn after get_sheet() =&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">BOF_posn</span> <span class="o">+</span> <span class="n">sheet_len</span>
</div>
<div class="viewcode-block" id="Book.handle_sheetsoffset"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_sheetsoffset">[docs]</a>    <span class="k">def</span> <span class="nf">handle_sheetsoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DEBUG = 0</span>
        <span class="n">posn</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;SHEETSOFFSET:&#39;</span><span class="p">,</span> <span class="n">posn</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheetsoffset</span> <span class="o">=</span> <span class="n">posn</span>
</div>
<div class="viewcode-block" id="Book.handle_sst"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_sst">[docs]</a>    <span class="k">def</span> <span class="nf">handle_sst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DEBUG = 1</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;SST Processing&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">nbt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">strlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
        <span class="n">uniquestrings</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">DEBUG</span>  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;SST: unique strings: </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">uniquestrings</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">code</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record_parts_conditional</span><span class="p">(</span><span class="n">XL_CONTINUE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">nbt</span> <span class="o">+=</span> <span class="n">nb</span>
            <span class="k">if</span> <span class="n">DEBUG</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;CONTINUE: adding </span><span class="si">%d</span><span class="s"> bytes to SST -&gt; </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">nbt</span><span class="p">)</span>
            <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sharedstrings</span><span class="p">,</span> <span class="n">rt_runlist</span> <span class="o">=</span> <span class="n">unpack_SST_table</span><span class="p">(</span><span class="n">strlist</span><span class="p">,</span> <span class="n">uniquestrings</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rich_text_runlist_map</span> <span class="o">=</span> <span class="n">rt_runlist</span>        
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;SST processing took </span><span class="si">%.2f</span><span class="s"> seconds&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Book.handle_writeaccess"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.handle_writeaccess">[docs]</a>    <span class="k">def</span> <span class="nf">handle_writeaccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_name</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">return</span>
            <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;WRITEACCESS: </span><span class="si">%d</span><span class="s"> bytes; raw=</span><span class="si">%s</span><span class="s"> </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_name</span><span class="p">,</span> <span class="n">strg</span><span class="p">)</span>
        <span class="n">strg</span> <span class="o">=</span> <span class="n">strg</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">strg</span>
</div>
<div class="viewcode-block" id="Book.parse_globals"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.parse_globals">[docs]</a>    <span class="k">def</span> <span class="nf">parse_globals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># DEBUG = 0</span>
        <span class="c"># no need to position, just start reading (after the BOF)</span>
        <span class="n">formatting</span><span class="o">.</span><span class="n">initialise_book</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;parse_globals: record code is 0x</span><span class="si">%04x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rc</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SST</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_sst</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FONT</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FONT_B3B4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_font</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FORMAT</span><span class="p">:</span> <span class="c"># XL_FORMAT2 is BIFF &lt;= 3.0, can&#39;t appear in globals</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_XF</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_xf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span>  <span class="n">XL_BOUNDSHEET</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_boundsheet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DATEMODE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_datemode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_CODEPAGE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_codepage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_COUNTRY</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_country</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_EXTERNNAME</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_externname</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_EXTERNSHEET</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_externsheet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FILEPASS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_filepass</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_WRITEACCESS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_writeaccess</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SHEETSOFFSET</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_sheetsoffset</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SHEETHDR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_sheethdr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SUPBOOK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_supbook</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_NAME</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_name</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_PALETTE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_palette</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_STYLE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_style</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** Unexpected BOF at posn </span><span class="si">%d</span><span class="s">: 0x</span><span class="si">%04x</span><span class="s"> len=</span><span class="si">%d</span><span class="s"> data=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">-</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span>  <span class="n">XL_EOF</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xf_epilogue</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">names_epilogue</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">palette_epilogue</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">==</span> <span class="mi">45</span><span class="p">:</span>
                    <span class="c"># DEBUG = 0</span>
                    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;global EOF: position&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="c"># if DEBUG:</span>
                    <span class="c">#     pos = self._position - 4</span>
                    <span class="c">#     print repr(self.mem[pos:pos+40])</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># if DEBUG:</span>
                <span class="c">#     print &gt;&gt; self.logfile, &quot;parse_globals: ignoring record code 0x%04x&quot; % rc</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Book.read"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">length</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="Book.getbof"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.Book.getbof">[docs]</a>    <span class="k">def</span> <span class="nf">getbof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rqd_stream</span><span class="p">):</span>
        <span class="c"># DEBUG = 1</span>
        <span class="c"># if DEBUG: print &gt;&gt; self.logfile, &quot;getbof(): position&quot;, self._position</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;reqd: 0x</span><span class="si">%04x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rqd_stream</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">bof_error</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;Unsupported format, or corrupt file: &#39;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">savpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2bytes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">MY_EOF</span><span class="p">:</span>
            <span class="n">bof_error</span><span class="p">(</span><span class="s">&#39;Expected BOF record; met end of file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bofcodes</span><span class="p">:</span>
            <span class="n">bof_error</span><span class="p">(</span><span class="s">&#39;Expected BOF record; found </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem</span><span class="p">[</span><span class="n">savpos</span><span class="p">:</span><span class="n">savpos</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2bytes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="n">MY_EOF</span><span class="p">:</span>
            <span class="n">bof_error</span><span class="p">(</span><span class="s">&#39;Incomplete BOF record[1]; met end of file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;=</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">):</span>
            <span class="n">bof_error</span><span class="p">(</span>
                <span class="s">&#39;Invalid length (</span><span class="si">%d</span><span class="s">) for BOF record type 0x</span><span class="si">%04x</span><span class="s">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">opcode</span><span class="p">))</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">boflen</span><span class="p">[</span><span class="n">opcode</span><span class="p">]</span> <span class="o">-</span> <span class="n">length</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">getbof(): data=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">bof_error</span><span class="p">(</span><span class="s">&#39;Incomplete BOF record[2]; met end of file&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="n">padding</span>
        <span class="n">version1</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
        <span class="n">version2</span><span class="p">,</span> <span class="n">streamtype</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;getbof(): op=0x</span><span class="si">%04x</span><span class="s"> version2=0x</span><span class="si">%04x</span><span class="s"> streamtype=0x</span><span class="si">%04x</span><span class="s">&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">version2</span><span class="p">,</span> <span class="n">streamtype</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">bof_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;getbof(): BOF found at offset </span><span class="si">%d</span><span class="s">; savpos=</span><span class="si">%d</span><span class="s">&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">bof_offset</span><span class="p">,</span> <span class="n">savpos</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">build</span> <span class="o">=</span> <span class="n">year</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">version1</span> <span class="o">==</span> <span class="mh">0x08</span><span class="p">:</span>
            <span class="n">build</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">version2</span> <span class="o">==</span> <span class="mh">0x0600</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="mi">80</span>
            <span class="k">elif</span> <span class="n">version2</span> <span class="o">==</span> <span class="mh">0x0500</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1994</span> <span class="ow">or</span> <span class="n">build</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2412</span><span class="p">,</span> <span class="mi">3218</span><span class="p">,</span> <span class="mi">3321</span><span class="p">):</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="mi">50</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="mi">70</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># dodgy one, created by a 3rd-party tool</span>
                <span class="n">version</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="mh">0x0000</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                    <span class="mh">0x0007</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                    <span class="mh">0x0200</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                    <span class="mh">0x0300</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="mh">0x0400</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
                    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">version2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">version1</span> <span class="ow">in</span> <span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">):</span>
            <span class="n">version</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">:</span> <span class="mi">21</span><span class="p">}[</span><span class="n">version1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">40</span> <span class="ow">and</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="n">XL_WORKBOOK_GLOBALS_4W</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">45</span> <span class="c"># i.e. 4W</span>

        <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;BOF: op=0x</span><span class="si">%04x</span><span class="s"> vers=0x</span><span class="si">%04x</span><span class="s"> stream=0x</span><span class="si">%04x</span><span class="s"> buildid=</span><span class="si">%d</span><span class="s"> buildyr=</span><span class="si">%d</span><span class="s"> -&gt; BIFF</span><span class="si">%d</span><span class="s">&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">version2</span><span class="p">,</span> <span class="n">streamtype</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">got_globals</span> <span class="o">=</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="n">XL_WORKBOOK_GLOBALS</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">version</span> <span class="o">==</span> <span class="mi">45</span> <span class="ow">and</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="n">XL_WORKBOOK_GLOBALS_4W</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rqd_stream</span> <span class="o">==</span> <span class="n">XL_WORKBOOK_GLOBALS</span> <span class="ow">and</span> <span class="n">got_globals</span><span class="p">)</span> <span class="ow">or</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="n">rqd_stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="n">XL_WORKSHEET</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">streamtype</span> <span class="o">==</span> <span class="mh">0x0100</span><span class="p">:</span>
            <span class="n">bof_error</span><span class="p">(</span><span class="s">&quot;Workspace file -- no spreadsheet data&quot;</span><span class="p">)</span>
        <span class="n">bof_error</span><span class="p">(</span>
            <span class="s">&#39;BOF not workbook/worksheet: op=0x</span><span class="si">%04x</span><span class="s"> vers=0x</span><span class="si">%04x</span><span class="s"> strm=0x</span><span class="si">%04x</span><span class="s"> build=</span><span class="si">%d</span><span class="s"> year=</span><span class="si">%d</span><span class="s"> -&gt; BIFF</span><span class="si">%d</span><span class="s">&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">version2</span><span class="p">,</span> <span class="n">streamtype</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
            <span class="p">)</span>

<span class="c"># === helper functions</span>
</div></div>
<div class="viewcode-block" id="expand_cell_address"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.expand_cell_address">[docs]</a><span class="k">def</span> <span class="nf">expand_cell_address</span><span class="p">(</span><span class="n">inrow</span><span class="p">,</span> <span class="n">incol</span><span class="p">):</span>
    <span class="c"># Ref : OOo docs, &quot;4.3.4 Cell Addresses in BIFF8&quot;</span>
    <span class="n">outrow</span> <span class="o">=</span> <span class="n">inrow</span>
    <span class="k">if</span> <span class="n">incol</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">outrow</span> <span class="o">&gt;=</span> <span class="mi">32768</span><span class="p">:</span>
            <span class="n">outrow</span> <span class="o">-=</span> <span class="mi">65536</span>
        <span class="n">relrow</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">relrow</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">outcol</span> <span class="o">=</span> <span class="n">incol</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="k">if</span> <span class="n">incol</span> <span class="o">&amp;</span> <span class="mh">0x4000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">outcol</span> <span class="o">&gt;=</span> <span class="mi">128</span><span class="p">:</span>
            <span class="n">outcol</span> <span class="o">-=</span> <span class="mi">256</span>
        <span class="n">relcol</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">relcol</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">outrow</span><span class="p">,</span> <span class="n">outcol</span><span class="p">,</span> <span class="n">relrow</span><span class="p">,</span> <span class="n">relcol</span>
</div>
<div class="viewcode-block" id="colname"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.colname">[docs]</a><span class="k">def</span> <span class="nf">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="n">_A2Z</span><span class="o">=</span><span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">colx</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">quot</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_A2Z</span><span class="p">[</span><span class="n">rem</span><span class="p">]</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quot</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="n">colx</span> <span class="o">=</span> <span class="n">quot</span> <span class="o">-</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="display_cell_address"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.display_cell_address">[docs]</a><span class="k">def</span> <span class="nf">display_cell_address</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">relrow</span><span class="p">,</span> <span class="n">relcol</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">relrow</span><span class="p">:</span>
        <span class="n">rowpart</span> <span class="o">=</span> <span class="s">&quot;(*</span><span class="si">%s%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;+-&quot;</span><span class="p">[</span><span class="n">rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rowx</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rowpart</span> <span class="o">=</span> <span class="s">&quot;$</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">relcol</span><span class="p">:</span>
        <span class="n">colpart</span> <span class="o">=</span> <span class="s">&quot;(*</span><span class="si">%s%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;+-&quot;</span><span class="p">[</span><span class="n">colx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">colx</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colpart</span> <span class="o">=</span> <span class="s">&quot;$&quot;</span> <span class="o">+</span> <span class="n">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colpart</span> <span class="o">+</span> <span class="n">rowpart</span>
</div>
<div class="viewcode-block" id="unpack_SST_table"><a class="viewcode-back" href="../../xlrd.html#xlrd.book.unpack_SST_table">[docs]</a><span class="k">def</span> <span class="nf">unpack_SST_table</span><span class="p">(</span><span class="n">datatab</span><span class="p">,</span> <span class="n">nstrings</span><span class="p">):</span>
    <span class="s">&quot;Return list of strings&quot;</span>
    <span class="n">datainx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ndatas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">datatab</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">datatab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">datalen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">strappend</span> <span class="o">=</span> <span class="n">strings</span><span class="o">.</span><span class="n">append</span>
    <span class="n">richtext_runs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">local_unpack</span> <span class="o">=</span> <span class="n">unpack</span>
    <span class="n">local_min</span> <span class="o">=</span> <span class="nb">min</span>
    <span class="n">local_BYTES_ORD</span> <span class="o">=</span> <span class="n">BYTES_ORD</span>
    <span class="n">latin_1</span> <span class="o">=</span> <span class="s">&quot;latin_1&quot;</span>
    <span class="k">for</span> <span class="n">_unused_i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nstrings</span><span class="p">):</span>
        <span class="n">nchars</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">local_BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">rtcount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">phosz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">:</span> <span class="c"># richtext</span>
            <span class="n">rtcount</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># phonetic</span>
            <span class="n">phosz</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">accstrg</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">charsgot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">charsneed</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">-</span> <span class="n">charsgot</span>
            <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">:</span>
                <span class="c"># Uncompressed UTF-16</span>
                <span class="n">charsavail</span> <span class="o">=</span> <span class="n">local_min</span><span class="p">((</span><span class="n">datalen</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">charsneed</span><span class="p">)</span>
                <span class="n">rawstrg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">charsavail</span><span class="p">]</span>
                <span class="c"># if DEBUG: print &quot;SST U16: nchars=%d pos=%d rawstrg=%r&quot; % (nchars, pos, rawstrg)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">accstrg</span> <span class="o">+=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">rawstrg</span><span class="p">,</span> <span class="s">&quot;utf_16_le&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c"># print &quot;SST U16: nchars=%d pos=%d rawstrg=%r&quot; % (nchars, pos, rawstrg)</span>
                    <span class="c"># Probable cause: dodgy data e.g. unfinished surrogate pair.</span>
                    <span class="c"># E.g. file unicode2.xls in pyExcelerator&#39;s examples has cells containing</span>
                    <span class="c"># unichr(i) for i in range(0x100000)</span>
                    <span class="c"># so this will include 0xD800 etc</span>
                    <span class="k">raise</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">charsavail</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Note: this is COMPRESSED (not ASCII!) encoding!!!</span>
                <span class="n">charsavail</span> <span class="o">=</span> <span class="n">local_min</span><span class="p">(</span><span class="n">datalen</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="n">charsneed</span><span class="p">)</span>
                <span class="n">rawstrg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">charsavail</span><span class="p">]</span>
                <span class="c"># if DEBUG: print &quot;SST CMPRSD: nchars=%d pos=%d rawstrg=%r&quot; % (nchars, pos, rawstrg)</span>
                <span class="n">accstrg</span> <span class="o">+=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">rawstrg</span><span class="p">,</span> <span class="n">latin_1</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="n">charsavail</span>
            <span class="n">charsgot</span> <span class="o">+=</span> <span class="n">charsavail</span>
            <span class="k">if</span> <span class="n">charsgot</span> <span class="o">==</span> <span class="n">nchars</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">datainx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">datatab</span><span class="p">[</span><span class="n">datainx</span><span class="p">]</span>
            <span class="n">datalen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">local_BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">rtcount</span><span class="p">:</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">runindex</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">rtcount</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">datalen</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">datainx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datatab</span><span class="p">[</span><span class="n">datainx</span><span class="p">]</span>
                    <span class="n">datalen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="n">richtext_runs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)]</span> <span class="o">=</span> <span class="n">runs</span>
                
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">phosz</span> <span class="c"># size of the phonetic stuff to skip</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="n">datalen</span><span class="p">:</span>
            <span class="c"># adjust to correct position in next record</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">datalen</span>
            <span class="n">datainx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">datainx</span> <span class="o">&lt;</span> <span class="n">ndatas</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">datatab</span><span class="p">[</span><span class="n">datainx</span><span class="p">]</span>
                <span class="n">datalen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">_unused_i</span> <span class="o">==</span> <span class="n">nstrings</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">strappend</span><span class="p">(</span><span class="n">accstrg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">strings</span><span class="p">,</span> <span class="n">richtext_runs</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../xlrd.html">xlrd</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>