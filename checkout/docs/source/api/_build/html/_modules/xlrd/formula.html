<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xlrd.formula &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="xlrd" href="../xlrd.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xlrd.formula</h1><div class="highlight"><pre>
<span class="c"># -*- coding: cp1252 -*-</span>

<span class="c">##</span>
<span class="c"># Module for parsing/evaluating Microsoft Excel formulas.</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;Copyright Â© 2005-2012 Stephen John Machin, Lingfo Pty Ltd&lt;/p&gt;</span>
<span class="c"># &lt;p&gt;This module is part of the xlrd package, which is released under</span>
<span class="c"># a BSD-style licence.&lt;/p&gt;</span>
<span class="c">##</span>

<span class="c"># No part of the content of this file was derived from the works of David Giffin.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span> 
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">unpack</span>
<span class="kn">from</span> <span class="nn">.timemachine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.biffh</span> <span class="kn">import</span> <span class="n">unpack_unicode_update_pos</span><span class="p">,</span> <span class="n">unpack_string_update_pos</span><span class="p">,</span> \
    <span class="n">XLRDError</span><span class="p">,</span> <span class="n">hex_char_dump</span><span class="p">,</span> <span class="n">error_text_from_code</span><span class="p">,</span> <span class="n">BaseObject</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;oBOOL&#39;</span><span class="p">,</span> <span class="s">&#39;oERR&#39;</span><span class="p">,</span> <span class="s">&#39;oNUM&#39;</span><span class="p">,</span> <span class="s">&#39;oREF&#39;</span><span class="p">,</span> <span class="s">&#39;oREL&#39;</span><span class="p">,</span> <span class="s">&#39;oSTRG&#39;</span><span class="p">,</span> <span class="s">&#39;oUNK&#39;</span><span class="p">,</span>
    <span class="s">&#39;decompile_formula&#39;</span><span class="p">,</span>
    <span class="s">&#39;dump_formula&#39;</span><span class="p">,</span>
    <span class="s">&#39;evaluate_name_formula&#39;</span><span class="p">,</span>
    <span class="s">&#39;okind_dict&#39;</span><span class="p">,</span>
    <span class="s">&#39;rangename3d&#39;</span><span class="p">,</span> <span class="s">&#39;rangename3drel&#39;</span><span class="p">,</span> <span class="s">&#39;cellname&#39;</span><span class="p">,</span> <span class="s">&#39;cellnameabs&#39;</span><span class="p">,</span> <span class="s">&#39;colname&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_CELL&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_SHARED&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_ARRAY&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_COND_FMT&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_DATA_VAL&#39;</span><span class="p">,</span>
    <span class="s">&#39;FMLA_TYPE_NAME&#39;</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">FMLA_TYPE_CELL</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">FMLA_TYPE_SHARED</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">FMLA_TYPE_ARRAY</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">FMLA_TYPE_DATA_VAL</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">FMLA_TYPE_NAME</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">ALL_FMLA_TYPES</span> <span class="o">=</span> <span class="mi">63</span>


<span class="n">FMLA_TYPEDESCR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span> <span class="p">:</span> <span class="s">&#39;CELL&#39;</span><span class="p">,</span>
    <span class="mi">2</span> <span class="p">:</span> <span class="s">&#39;SHARED&#39;</span><span class="p">,</span>
    <span class="mi">4</span> <span class="p">:</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">,</span>
    <span class="mi">8</span> <span class="p">:</span> <span class="s">&#39;COND-FMT&#39;</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;DATA-VAL&#39;</span><span class="p">,</span>
    <span class="mi">32</span><span class="p">:</span> <span class="s">&#39;NAME&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">_TOKEN_NOT_ALLOWED</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x01</span><span class="p">:</span>   <span class="n">ALL_FMLA_TYPES</span> <span class="o">-</span> <span class="n">FMLA_TYPE_CELL</span><span class="p">,</span> <span class="c"># tExp</span>
    <span class="mh">0x02</span><span class="p">:</span>   <span class="n">ALL_FMLA_TYPES</span> <span class="o">-</span> <span class="n">FMLA_TYPE_CELL</span><span class="p">,</span> <span class="c"># tTbl</span>
    <span class="mh">0x0F</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tIsect</span>
    <span class="mh">0x10</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tUnion/List</span>
    <span class="mh">0x11</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tRange</span>
    <span class="mh">0x20</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tArray</span>
    <span class="mh">0x23</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span><span class="p">,</span> <span class="c"># tName</span>
    <span class="mh">0x39</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tNameX</span>
    <span class="mh">0x3A</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tRef3d</span>
    <span class="mh">0x3B</span><span class="p">:</span>   <span class="n">FMLA_TYPE_SHARED</span> <span class="o">+</span> <span class="n">FMLA_TYPE_COND_FMT</span> <span class="o">+</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">,</span> <span class="c"># tArea3d</span>
    <span class="mh">0x2C</span><span class="p">:</span>   <span class="n">FMLA_TYPE_CELL</span> <span class="o">+</span> <span class="n">FMLA_TYPE_ARRAY</span><span class="p">,</span> <span class="c"># tRefN</span>
    <span class="mh">0x2D</span><span class="p">:</span>   <span class="n">FMLA_TYPE_CELL</span> <span class="o">+</span> <span class="n">FMLA_TYPE_ARRAY</span><span class="p">,</span> <span class="c"># tAreaN</span>
    <span class="c"># plus weird stuff like tMem*</span>
    <span class="p">}</span><span class="o">.</span><span class="n">get</span>

<span class="n">oBOOL</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">oERR</span> <span class="o">=</span>  <span class="mi">4</span>
<span class="n">oMSNG</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># tMissArg</span>
<span class="n">oNUM</span> <span class="o">=</span>  <span class="mi">2</span>
<span class="n">oREF</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">oREL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">oSTRG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">oUNK</span> <span class="o">=</span>  <span class="mi">0</span>

<span class="n">okind_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s">&quot;oREL&quot;</span><span class="p">,</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s">&quot;oREF&quot;</span><span class="p">,</span>
    <span class="mi">0</span> <span class="p">:</span> <span class="s">&quot;oUNK&quot;</span><span class="p">,</span>
    <span class="mi">1</span> <span class="p">:</span> <span class="s">&quot;oSTRG&quot;</span><span class="p">,</span>
    <span class="mi">2</span> <span class="p">:</span> <span class="s">&quot;oNUM&quot;</span><span class="p">,</span>
    <span class="mi">3</span> <span class="p">:</span> <span class="s">&quot;oBOOL&quot;</span><span class="p">,</span>
    <span class="mi">4</span> <span class="p">:</span> <span class="s">&quot;oERR&quot;</span><span class="p">,</span>
    <span class="mi">5</span> <span class="p">:</span> <span class="s">&quot;oMSNG&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">listsep</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span> <span class="c">#### probably should depend on locale</span>


<span class="c"># sztabN[opcode] -&gt; the number of bytes to consume.</span>
<span class="c"># -1 means variable</span>
<span class="c"># -2 means this opcode not implemented in this version.</span>
<span class="c"># Which N to use? Depends on biff_version; see szdict.</span>
<span class="n">sztab0</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sztab1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sztab2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sztab3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sztab4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>

<span class="n">szdict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">20</span> <span class="p">:</span> <span class="n">sztab0</span><span class="p">,</span>
    <span class="mi">21</span> <span class="p">:</span> <span class="n">sztab0</span><span class="p">,</span>
    <span class="mi">30</span> <span class="p">:</span> <span class="n">sztab1</span><span class="p">,</span>
    <span class="mi">40</span> <span class="p">:</span> <span class="n">sztab2</span><span class="p">,</span>
    <span class="mi">45</span> <span class="p">:</span> <span class="n">sztab2</span><span class="p">,</span>
    <span class="mi">50</span> <span class="p">:</span> <span class="n">sztab3</span><span class="p">,</span>
    <span class="mi">70</span> <span class="p">:</span> <span class="n">sztab3</span><span class="p">,</span>
    <span class="mi">80</span> <span class="p">:</span> <span class="n">sztab4</span><span class="p">,</span>
    <span class="p">}</span>

<span class="c"># For debugging purposes ... the name for each opcode</span>
<span class="c"># (without the prefix &quot;t&quot; used on OOo docs)</span>
<span class="n">onames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Unk00&#39;</span><span class="p">,</span> <span class="s">&#39;Exp&#39;</span><span class="p">,</span> <span class="s">&#39;Tbl&#39;</span><span class="p">,</span> <span class="s">&#39;Add&#39;</span><span class="p">,</span> <span class="s">&#39;Sub&#39;</span><span class="p">,</span> <span class="s">&#39;Mul&#39;</span><span class="p">,</span> <span class="s">&#39;Div&#39;</span><span class="p">,</span> <span class="s">&#39;Power&#39;</span><span class="p">,</span> <span class="s">&#39;Concat&#39;</span><span class="p">,</span> <span class="s">&#39;LT&#39;</span><span class="p">,</span> <span class="s">&#39;LE&#39;</span><span class="p">,</span> <span class="s">&#39;EQ&#39;</span><span class="p">,</span> <span class="s">&#39;GE&#39;</span><span class="p">,</span> <span class="s">&#39;GT&#39;</span><span class="p">,</span> <span class="s">&#39;NE&#39;</span><span class="p">,</span> <span class="s">&#39;Isect&#39;</span><span class="p">,</span> <span class="s">&#39;List&#39;</span><span class="p">,</span> <span class="s">&#39;Range&#39;</span><span class="p">,</span> <span class="s">&#39;Uplus&#39;</span><span class="p">,</span> <span class="s">&#39;Uminus&#39;</span><span class="p">,</span> <span class="s">&#39;Percent&#39;</span><span class="p">,</span> <span class="s">&#39;Paren&#39;</span><span class="p">,</span> <span class="s">&#39;MissArg&#39;</span><span class="p">,</span> <span class="s">&#39;Str&#39;</span><span class="p">,</span> <span class="s">&#39;Extended&#39;</span><span class="p">,</span> <span class="s">&#39;Attr&#39;</span><span class="p">,</span> <span class="s">&#39;Sheet&#39;</span><span class="p">,</span> <span class="s">&#39;EndSheet&#39;</span><span class="p">,</span> <span class="s">&#39;Err&#39;</span><span class="p">,</span> <span class="s">&#39;Bool&#39;</span><span class="p">,</span> <span class="s">&#39;Int&#39;</span><span class="p">,</span> <span class="s">&#39;Num&#39;</span><span class="p">,</span> <span class="s">&#39;Array&#39;</span><span class="p">,</span> <span class="s">&#39;Func&#39;</span><span class="p">,</span> <span class="s">&#39;FuncVar&#39;</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;Ref&#39;</span><span class="p">,</span> <span class="s">&#39;Area&#39;</span><span class="p">,</span> <span class="s">&#39;MemArea&#39;</span><span class="p">,</span> <span class="s">&#39;MemErr&#39;</span><span class="p">,</span> <span class="s">&#39;MemNoMem&#39;</span><span class="p">,</span> <span class="s">&#39;MemFunc&#39;</span><span class="p">,</span> <span class="s">&#39;RefErr&#39;</span><span class="p">,</span> <span class="s">&#39;AreaErr&#39;</span><span class="p">,</span> <span class="s">&#39;RefN&#39;</span><span class="p">,</span> <span class="s">&#39;AreaN&#39;</span><span class="p">,</span> <span class="s">&#39;MemAreaN&#39;</span><span class="p">,</span> <span class="s">&#39;MemNoMemN&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;FuncCE&#39;</span><span class="p">,</span> <span class="s">&#39;NameX&#39;</span><span class="p">,</span> <span class="s">&#39;Ref3d&#39;</span><span class="p">,</span> <span class="s">&#39;Area3d&#39;</span><span class="p">,</span> <span class="s">&#39;RefErr3d&#39;</span><span class="p">,</span> <span class="s">&#39;AreaErr3d&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]</span>

<span class="n">func_defs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c"># index: (name, min#args, max#args, flags, #known_args, return_type, kargs)</span>
    <span class="mi">0</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;COUNT&#39;</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">1</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;IF&#39;</span><span class="p">,</span>               <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VRR&#39;</span><span class="p">),</span>
    <span class="mi">2</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISNA&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">3</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISERROR&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">4</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUM&#39;</span><span class="p">,</span>              <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">5</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;AVERAGE&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">6</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MIN&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">7</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MAX&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">8</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROW&#39;</span><span class="p">,</span>              <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">9</span>  <span class="p">:</span> <span class="p">(</span><span class="s">&#39;COLUMN&#39;</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">10</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;NA&#39;</span><span class="p">,</span>               <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">11</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;NPV&#39;</span><span class="p">,</span>              <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VR&#39;</span><span class="p">),</span>
    <span class="mi">12</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;STDEV&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">13</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DOLLAR&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">14</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;FIXED&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">15</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SIN&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">16</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;COS&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">17</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TAN&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">18</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ATAN&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">19</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;PI&#39;</span><span class="p">,</span>               <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">20</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SQRT&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">21</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;EXP&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">22</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LN&#39;</span><span class="p">,</span>               <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">23</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOG10&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">24</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ABS&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">25</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;INT&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">26</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SIGN&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">27</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROUND&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">28</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOOKUP&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VR&#39;</span><span class="p">),</span>
    <span class="mi">29</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;INDEX&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;RVVV&#39;</span><span class="p">),</span>
    <span class="mi">30</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;REPT&#39;</span><span class="p">,</span>             <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">31</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MID&#39;</span><span class="p">,</span>              <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">32</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LEN&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">33</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;VALUE&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">34</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TRUE&#39;</span><span class="p">,</span>             <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">35</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;FALSE&#39;</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">36</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;AND&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">37</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;OR&#39;</span><span class="p">,</span>               <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">38</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;NOT&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">39</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MOD&#39;</span><span class="p">,</span>              <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">40</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DCOUNT&#39;</span><span class="p">,</span>           <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">41</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DSUM&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">42</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DAVERAGE&#39;</span><span class="p">,</span>         <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">43</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DMIN&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">44</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DMAX&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">45</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DSTDEV&#39;</span><span class="p">,</span>           <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">46</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;VAR&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">47</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DVAR&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">48</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TEXT&#39;</span><span class="p">,</span>             <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">49</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LINEST&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;RRVV&#39;</span><span class="p">),</span>
    <span class="mi">50</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TREND&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;RRRV&#39;</span><span class="p">),</span>
    <span class="mi">51</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOGEST&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;RRVV&#39;</span><span class="p">),</span>
    <span class="mi">52</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;GROWTH&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;RRRV&#39;</span><span class="p">),</span>
    <span class="mi">56</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;PV&#39;</span><span class="p">,</span>               <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">57</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;FV&#39;</span><span class="p">,</span>               <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">58</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;NPER&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">59</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;PMT&#39;</span><span class="p">,</span>              <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">60</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;RATE&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVVV&#39;</span><span class="p">),</span>
    <span class="mi">61</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MIRR&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RVV&#39;</span><span class="p">),</span>
    <span class="mi">62</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;IRR&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">63</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;RAND&#39;</span><span class="p">,</span>             <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">64</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MATCH&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VRR&#39;</span><span class="p">),</span>
    <span class="mi">65</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DATE&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">66</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TIME&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">67</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;DAY&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">68</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MONTH&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">69</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;YEAR&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">70</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;WEEKDAY&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">71</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;HOUR&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">72</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;MINUTE&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">73</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SECOND&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">74</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;NOW&#39;</span><span class="p">,</span>              <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">75</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;AREAS&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">76</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROWS&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">77</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">78</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;OFFSET&#39;</span><span class="p">,</span>           <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;RVVVV&#39;</span><span class="p">),</span>
    <span class="mi">82</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SEARCH&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">83</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TRANSPOSE&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span>
    <span class="mi">86</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;TYPE&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">92</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;SERIESSUM&#39;</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVA&#39;</span><span class="p">),</span>
    <span class="mi">97</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ATAN2&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">98</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ASIN&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">99</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;ACOS&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">100</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CHOOSE&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VR&#39;</span><span class="p">),</span>
    <span class="mi">101</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;HLOOKUP&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VRRV&#39;</span><span class="p">),</span>
    <span class="mi">102</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;VLOOKUP&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VRRV&#39;</span><span class="p">),</span>
    <span class="mi">105</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISREF&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">109</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOG&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">111</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CHAR&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">112</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOWER&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">113</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;UPPER&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">114</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PROPER&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">115</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LEFT&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">116</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RIGHT&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">117</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;EXACT&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">118</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TRIM&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">119</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;REPLACE&#39;</span><span class="p">,</span>          <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">120</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUBSTITUTE&#39;</span><span class="p">,</span>       <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">121</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CODE&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">124</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FIND&#39;</span><span class="p">,</span>             <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">125</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CELL&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VR&#39;</span><span class="p">),</span>
    <span class="mi">126</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISERR&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">127</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISTEXT&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">128</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISNUMBER&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">129</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISBLANK&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">130</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span>                <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">131</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span>                <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">140</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DATEVALUE&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">141</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TIMEVALUE&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">142</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SLN&#39;</span><span class="p">,</span>              <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">143</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SYD&#39;</span><span class="p">,</span>              <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">144</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DDB&#39;</span><span class="p">,</span>              <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">148</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;INDIRECT&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">162</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CLEAN&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">163</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MDETERM&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span>
    <span class="mi">164</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MINVERSE&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span>
    <span class="mi">165</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MMULT&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">167</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;IPMT&#39;</span><span class="p">,</span>             <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVVV&#39;</span><span class="p">),</span>
    <span class="mi">168</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PPMT&#39;</span><span class="p">,</span>             <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVVV&#39;</span><span class="p">),</span>
    <span class="mi">169</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COUNTA&#39;</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">183</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PRODUCT&#39;</span><span class="p">,</span>          <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">184</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FACT&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">189</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DPRODUCT&#39;</span><span class="p">,</span>         <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">190</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISNONTEXT&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">193</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;STDEVP&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">194</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;VARP&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">195</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DSTDEVP&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">196</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DVARP&#39;</span><span class="p">,</span>            <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">197</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TRUNC&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">198</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISLOGICAL&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">199</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DCOUNTA&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">204</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;USDOLLAR&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">205</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FINDB&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">206</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SEARCHB&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">207</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;REPLACEB&#39;</span><span class="p">,</span>         <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">208</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LEFTB&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">209</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RIGHTB&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">210</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MIDB&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">211</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LENB&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">212</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROUNDUP&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">213</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROUNDDOWN&#39;</span><span class="p">,</span>        <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">214</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ASC&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">215</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DBCS&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">216</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RANK&#39;</span><span class="p">,</span>             <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VRV&#39;</span><span class="p">),</span>
    <span class="mi">219</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ADDRESS&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">220</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DAYS360&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">221</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TODAY&#39;</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="mi">222</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;VDB&#39;</span><span class="p">,</span>              <span class="mi">5</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVVVV&#39;</span><span class="p">),</span>
    <span class="mi">227</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MEDIAN&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">228</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMPRODUCT&#39;</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span>
    <span class="mi">229</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SINH&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">230</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COSH&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">231</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TANH&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">232</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ASINH&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">233</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ACOSH&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">234</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ATANH&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">235</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DGET&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RRR&#39;</span><span class="p">),</span>
    <span class="mi">244</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;INFO&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">247</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DB&#39;</span><span class="p">,</span>               <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVVV&#39;</span><span class="p">),</span>
    <span class="mi">252</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FREQUENCY&#39;</span><span class="p">,</span>        <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;RR&#39;</span><span class="p">),</span>
    <span class="mi">261</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ERROR.TYPE&#39;</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">269</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AVEDEV&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">270</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BETADIST&#39;</span><span class="p">,</span>         <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">271</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GAMMALN&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">272</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BETAINV&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">273</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BINOMDIST&#39;</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">274</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CHIDIST&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">275</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CHIINV&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">276</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COMBIN&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">277</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CONFIDENCE&#39;</span><span class="p">,</span>       <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">278</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CRITBINOM&#39;</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">279</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;EVEN&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">280</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;EXPONDIST&#39;</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">281</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FDIST&#39;</span><span class="p">,</span>            <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">282</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FINV&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">283</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FISHER&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">284</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FISHERINV&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">285</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FLOOR&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">286</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GAMMADIST&#39;</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">287</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GAMMAINV&#39;</span><span class="p">,</span>         <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">288</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CEILING&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">289</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;HYPGEOMDIST&#39;</span><span class="p">,</span>      <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">290</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOGNORMDIST&#39;</span><span class="p">,</span>      <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">291</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LOGINV&#39;</span><span class="p">,</span>           <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">292</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NEGBINOMDIST&#39;</span><span class="p">,</span>     <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">293</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NORMDIST&#39;</span><span class="p">,</span>         <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">294</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NORMSDIST&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">295</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NORMINV&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">296</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NORMSINV&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">297</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;STANDARDIZE&#39;</span><span class="p">,</span>      <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">298</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ODD&#39;</span><span class="p">,</span>              <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">299</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PERMUT&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">300</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;POISSON&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">301</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TDIST&#39;</span><span class="p">,</span>            <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">302</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WEIBULL&#39;</span><span class="p">,</span>          <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">303</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMXMY2&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">304</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMX2MY2&#39;</span><span class="p">,</span>         <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">305</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMX2PY2&#39;</span><span class="p">,</span>         <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">306</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CHITEST&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">307</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CORREL&#39;</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">308</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COVAR&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">309</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FORECAST&#39;</span><span class="p">,</span>         <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VAA&#39;</span><span class="p">),</span>
    <span class="mi">310</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FTEST&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">311</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;INTERCEPT&#39;</span><span class="p">,</span>        <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">312</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PEARSON&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">313</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RSQ&#39;</span><span class="p">,</span>              <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">314</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;STEYX&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">315</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SLOPE&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AA&#39;</span><span class="p">),</span>
    <span class="mi">316</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TTEST&#39;</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AAVV&#39;</span><span class="p">),</span>
    <span class="mi">317</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PROB&#39;</span><span class="p">,</span>             <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;AAV&#39;</span><span class="p">),</span>
    <span class="mi">318</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DEVSQ&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">319</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GEOMEAN&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">320</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;HARMEAN&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">321</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMSQ&#39;</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">322</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;KURT&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">323</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SKEW&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">324</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ZTEST&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">325</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LARGE&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">326</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SMALL&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">327</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;QUARTILE&#39;</span><span class="p">,</span>         <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">328</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PERCENTILE&#39;</span><span class="p">,</span>       <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">329</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PERCENTRANK&#39;</span><span class="p">,</span>      <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">330</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MODE&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span>
    <span class="mi">331</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TRIMMEAN&#39;</span><span class="p">,</span>         <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">332</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TINV&#39;</span><span class="p">,</span>             <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">336</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CONCATENATE&#39;</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">337</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;POWER&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">342</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RADIANS&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">343</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">344</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUBTOTAL&#39;</span><span class="p">,</span>         <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VR&#39;</span><span class="p">),</span>
    <span class="mi">345</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SUMIF&#39;</span><span class="p">,</span>            <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RVR&#39;</span><span class="p">),</span>
    <span class="mi">346</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COUNTIF&#39;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">347</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;COUNTBLANK&#39;</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">350</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISPMT&#39;</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVVV&#39;</span><span class="p">),</span>
    <span class="mi">351</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DATEDIF&#39;</span><span class="p">,</span>          <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VVV&#39;</span><span class="p">),</span>
    <span class="mi">352</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DATESTRING&#39;</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">353</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NUMBERSTRING&#39;</span><span class="p">,</span>     <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">354</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROMAN&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">358</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GETPIVOTDATA&#39;</span><span class="p">,</span>     <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;RV&#39;</span><span class="p">),</span>
    <span class="mi">359</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;HYPERLINK&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;VV&#39;</span><span class="p">),</span>
    <span class="mi">360</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PHONETIC&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">361</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AVERAGEA&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">362</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MAXA&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">363</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MINA&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">364</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;STDEVPA&#39;</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">365</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;VARPA&#39;</span><span class="p">,</span>            <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">366</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;STDEVA&#39;</span><span class="p">,</span>           <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">367</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;VARA&#39;</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
    <span class="mi">368</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BAHTTEXT&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">369</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAIDAYOFWEEK&#39;</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">370</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAIDIGIT&#39;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">371</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAIMONTHOFYEAR&#39;</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">372</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAINUMSOUND&#39;</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">373</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAINUMSTRING&#39;</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">374</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAISTRINGLENGTH&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">375</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISTHAIDIGIT&#39;</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">376</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROUNDBAHTDOWN&#39;</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">377</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ROUNDBAHTUP&#39;</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">378</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;THAIYEAR&#39;</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="mi">379</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RTD&#39;</span><span class="p">,</span>              <span class="mi">2</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<span class="n">tAttrNames</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x00</span><span class="p">:</span> <span class="s">&quot;Skip??&quot;</span><span class="p">,</span> <span class="c"># seen in SAMPLES.XLS which shipped with Excel 5.0</span>
    <span class="mh">0x01</span><span class="p">:</span> <span class="s">&quot;Volatile&quot;</span><span class="p">,</span>
    <span class="mh">0x02</span><span class="p">:</span> <span class="s">&quot;If&quot;</span><span class="p">,</span>
    <span class="mh">0x04</span><span class="p">:</span> <span class="s">&quot;Choose&quot;</span><span class="p">,</span>
    <span class="mh">0x08</span><span class="p">:</span> <span class="s">&quot;Skip&quot;</span><span class="p">,</span>
    <span class="mh">0x10</span><span class="p">:</span> <span class="s">&quot;Sum&quot;</span><span class="p">,</span>
    <span class="mh">0x20</span><span class="p">:</span> <span class="s">&quot;Assign&quot;</span><span class="p">,</span>
    <span class="mh">0x40</span><span class="p">:</span> <span class="s">&quot;Space&quot;</span><span class="p">,</span>
    <span class="mh">0x41</span><span class="p">:</span> <span class="s">&quot;SpaceVolatile&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">error_opcodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">])</span>

<span class="n">tRangeFuncs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
<span class="n">tIsectFuncs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">do_box_funcs</span><span class="p">(</span><span class="n">box_funcs</span><span class="p">,</span> <span class="n">boxa</span><span class="p">,</span> <span class="n">boxb</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span>
        <span class="n">func</span><span class="p">(</span><span class="n">numa</span><span class="p">,</span> <span class="n">numb</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">numa</span><span class="p">,</span> <span class="n">numb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">box_funcs</span><span class="p">,</span> <span class="n">boxa</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">boxb</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="p">])</span>

<span class="k">def</span> <span class="nf">adjust_cell_addr_biff8</span><span class="p">(</span><span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">row_rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">colval</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">col_rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">colval</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">rowx</span> <span class="o">=</span> <span class="n">rowval</span>
    <span class="n">colx</span> <span class="o">=</span> <span class="n">colval</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="k">if</span> <span class="n">reldelta</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row_rel</span> <span class="ow">and</span> <span class="n">rowx</span> <span class="o">&gt;=</span> <span class="mi">32768</span><span class="p">:</span>
            <span class="n">rowx</span> <span class="o">-=</span> <span class="mi">65536</span>
        <span class="k">if</span> <span class="n">col_rel</span> <span class="ow">and</span> <span class="n">colx</span> <span class="o">&gt;=</span> <span class="mi">128</span><span class="p">:</span>
            <span class="n">colx</span> <span class="o">-=</span> <span class="mi">256</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row_rel</span><span class="p">:</span>
            <span class="n">rowx</span> <span class="o">-=</span> <span class="n">browx</span>
        <span class="k">if</span> <span class="n">col_rel</span><span class="p">:</span>
            <span class="n">colx</span> <span class="o">-=</span> <span class="n">bcolx</span>
    <span class="k">return</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span>

<span class="k">def</span> <span class="nf">adjust_cell_addr_biff_le7</span><span class="p">(</span>
        <span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">row_rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowval</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">col_rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowval</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">rowx</span> <span class="o">=</span> <span class="n">rowval</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span>
    <span class="n">colx</span> <span class="o">=</span> <span class="n">colval</span>
    <span class="k">if</span> <span class="n">reldelta</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row_rel</span> <span class="ow">and</span> <span class="n">rowx</span> <span class="o">&gt;=</span> <span class="mi">8192</span><span class="p">:</span>
            <span class="n">rowx</span> <span class="o">-=</span> <span class="mi">16384</span>
        <span class="k">if</span> <span class="n">col_rel</span> <span class="ow">and</span> <span class="n">colx</span> <span class="o">&gt;=</span> <span class="mi">128</span><span class="p">:</span>
            <span class="n">colx</span> <span class="o">-=</span> <span class="mi">256</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row_rel</span><span class="p">:</span>
            <span class="n">rowx</span> <span class="o">-=</span> <span class="n">browx</span>
        <span class="k">if</span> <span class="n">col_rel</span><span class="p">:</span>
            <span class="n">colx</span> <span class="o">-=</span> <span class="n">bcolx</span>
    <span class="k">return</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span>

<span class="k">def</span> <span class="nf">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (rowval, colval)</span>
        <span class="k">return</span> <span class="n">adjust_cell_addr_biff8</span><span class="p">(</span><span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (rowval, colval)</span>
        <span class="k">return</span> <span class="n">adjust_cell_addr_biff_le7</span><span class="p">(</span>
                    <span class="n">rowval</span><span class="p">,</span> <span class="n">colval</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">row1val</span><span class="p">,</span> <span class="n">row2val</span><span class="p">,</span> <span class="n">col1val</span><span class="p">,</span> <span class="n">col2val</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (row1val, col1val)</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (row2val, col2val)</span>
        <span class="n">res1</span> <span class="o">=</span> <span class="n">adjust_cell_addr_biff8</span><span class="p">(</span><span class="n">row1val</span><span class="p">,</span> <span class="n">col1val</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="n">adjust_cell_addr_biff8</span><span class="p">(</span><span class="n">row2val</span><span class="p">,</span> <span class="n">col2val</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">row1val</span><span class="p">,</span> <span class="n">row2val</span><span class="p">,</span> <span class="n">col1val</span><span class="p">,</span> <span class="n">col2val</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHBB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (row1val, col1val)</span>
        <span class="c"># print &quot;    rv=%04xh cv=%04xh&quot; % (row2val, col2val)</span>
        <span class="n">res1</span> <span class="o">=</span> <span class="n">adjust_cell_addr_biff_le7</span><span class="p">(</span>
                    <span class="n">row1val</span><span class="p">,</span> <span class="n">col1val</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="n">adjust_cell_addr_biff_le7</span><span class="p">(</span>
                    <span class="n">row2val</span><span class="p">,</span> <span class="n">col2val</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span>

<span class="k">def</span> <span class="nf">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_externsheet_info</span><span class="p">[</span><span class="n">refx</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;!!! get_externsheet_local_range: refx=</span><span class="si">%d</span><span class="s">, not in range(</span><span class="si">%d</span><span class="s">)&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_externsheet_info</span><span class="p">)),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">101</span><span class="p">,</span> <span class="o">-</span><span class="mi">101</span><span class="p">)</span>
    <span class="n">ref_recordx</span><span class="p">,</span> <span class="n">ref_first_sheetx</span><span class="p">,</span> <span class="n">ref_last_sheetx</span> <span class="o">=</span> <span class="n">info</span>
    <span class="k">if</span> <span class="n">ref_recordx</span> <span class="o">==</span> <span class="n">bk</span><span class="o">.</span><span class="n">_supbook_addins_inx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range(refx=</span><span class="si">%d</span><span class="s">) -&gt; addins </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">info</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ref_first_sheetx</span> <span class="o">==</span> <span class="mh">0xFFFE</span> <span class="o">==</span> <span class="n">ref_last_sheetx</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_recordx</span> <span class="o">!=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_supbook_locals_inx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range(refx=</span><span class="si">%d</span><span class="s">) -&gt; external </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">info</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c"># external reference</span>
    <span class="k">if</span> <span class="n">ref_first_sheetx</span> <span class="o">==</span> <span class="mh">0xFFFE</span> <span class="o">==</span> <span class="n">ref_last_sheetx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range(refx=</span><span class="si">%d</span><span class="s">) -&gt; unspecified sheet </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">info</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># internal reference, any sheet</span>
    <span class="k">if</span> <span class="n">ref_first_sheetx</span> <span class="o">==</span> <span class="mh">0xFFFF</span> <span class="o">==</span> <span class="n">ref_last_sheetx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range(refx=</span><span class="si">%d</span><span class="s">) -&gt; deleted sheet(s)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c"># internal reference, deleted sheet(s)</span>
    <span class="n">nsheets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ref_first_sheetx</span> <span class="o">&lt;=</span> <span class="n">ref_last_sheetx</span> <span class="o">&lt;</span> <span class="n">nsheets</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range(refx=</span><span class="si">%d</span><span class="s">) -&gt; </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">info</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;--- first/last sheet not in range(</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">nsheets</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">102</span><span class="p">,</span> <span class="o">-</span><span class="mi">102</span><span class="p">)</span> <span class="c"># stuffed up somewhere :-(</span>
    <span class="n">xlrd_sheetx1</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">[</span><span class="n">ref_first_sheetx</span><span class="p">]</span>
    <span class="n">xlrd_sheetx2</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">[</span><span class="n">ref_last_sheetx</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">xlrd_sheetx1</span> <span class="o">&lt;=</span> <span class="n">xlrd_sheetx2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="c"># internal reference, but to a macro sheet</span>
    <span class="k">return</span> <span class="n">xlrd_sheetx1</span><span class="p">,</span> <span class="n">xlrd_sheetx2</span>

<span class="k">def</span> <span class="nf">get_externsheet_local_range_b57</span><span class="p">(</span>
        <span class="n">bk</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">ref_first_sheetx</span><span class="p">,</span> <span class="n">ref_last_sheetx</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">raw_extshtx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range_b57(raw_extshtx=</span><span class="si">%d</span><span class="s">) -&gt; external&quot;</span> <span class="o">%</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c"># external reference</span>
    <span class="k">if</span> <span class="n">ref_first_sheetx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ref_last_sheetx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c"># internal reference, deleted sheet(s)</span>
    <span class="n">nsheets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ref_first_sheetx</span> <span class="o">&lt;=</span> <span class="n">ref_last_sheetx</span> <span class="o">&lt;</span> <span class="n">nsheets</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;/// get_externsheet_local_range_b57(</span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">) -&gt; ???&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">ref_first_sheetx</span><span class="p">,</span> <span class="n">ref_last_sheetx</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;--- first/last sheet not in range(</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">nsheets</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">103</span><span class="p">,</span> <span class="o">-</span><span class="mi">103</span><span class="p">)</span> <span class="c"># stuffed up somewhere :-(</span>
    <span class="n">xlrd_sheetx1</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">[</span><span class="n">ref_first_sheetx</span><span class="p">]</span>
    <span class="n">xlrd_sheetx2</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_all_sheets_map</span><span class="p">[</span><span class="n">ref_last_sheetx</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">xlrd_sheetx1</span> <span class="o">&lt;=</span> <span class="n">xlrd_sheetx2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="c"># internal reference, but to a macro sheet</span>
    <span class="k">return</span> <span class="n">xlrd_sheetx1</span><span class="p">,</span> <span class="n">xlrd_sheetx2</span>

<span class="k">class</span> <span class="nc">FormulaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="c">##</span>
<span class="c"># Used in evaluating formulas.</span>
<span class="c"># The following table describes the kinds and how their values</span>
<span class="c"># are represented.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;table border=&quot;1&quot; cellpadding=&quot;7&quot;&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;th&gt;Kind symbol&lt;/th&gt;</span>
<span class="c"># &lt;th&gt;Kind number&lt;/th&gt;</span>
<span class="c"># &lt;th&gt;Value representation&lt;/th&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oBOOL&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;integer: 0 =&gt; False; 1 =&gt; True&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oERR&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;None, or an int error code (same as XL_CELL_ERROR in the Cell class).</span>
<span class="c"># &lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oMSNG&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;5&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;Used by Excel as a placeholder for a missing (not supplied) function</span>
<span class="c"># argument. Should *not* appear as a final formula result. Value is None.&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oNUM&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;A float. Note that there is no way of distinguishing dates.&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oREF&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;-1&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;The value is either None or a non-empty list of</span>
<span class="c"># absolute Ref3D instances.&lt;br&gt;</span>
<span class="c"># &lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oREL&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;-2&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;The value is None or a non-empty list of</span>
<span class="c"># fully or partially relative Ref3D instances.</span>
<span class="c"># &lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oSTRG&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;A Unicode string.&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;oUNK&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;The kind is unknown or ambiguous. The value is None&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;/table&gt;</span>
<span class="c">#&lt;p&gt;&lt;/p&gt;</span>

<span class="k">class</span> <span class="nc">Operand</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># None means that the actual value of the operand is a variable</span>
    <span class="c"># (depends on cell data), not a constant.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># oUNK means that the kind of operand is not known unambiguously.</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">oUNK</span>
    <span class="c">##</span>
    <span class="c"># The reconstituted text of the original formula. Function names will be</span>
    <span class="c"># in English irrespective of the original language, which doesn&#39;t seem</span>
    <span class="c"># to be recorded anywhere. The separator is &quot;,&quot;, not &quot;;&quot; or whatever else</span>
    <span class="c"># might be more appropriate for the end-user&#39;s locale; patches welcome.</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">akind</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avalue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">arank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atext</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">akind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">akind</span>
        <span class="k">if</span> <span class="n">avalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">avalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">arank</span>
        <span class="c"># rank is an internal gizmo (operator precedence);</span>
        <span class="c"># it&#39;s used in reconstructing formula text.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">atext</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kind_text</span> <span class="o">=</span> <span class="n">okind_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="s">&quot;?Unknown kind?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;Operand(kind=</span><span class="si">%s</span><span class="s">, value=</span><span class="si">%r</span><span class="s">, text=</span><span class="si">%r</span><span class="s">)&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">kind_text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;Represents an absolute or relative 3-dimensional reference to a box</span>
<span class="c"># of one or more cells.&lt;br /&gt;</span>
<span class="c"># -- New in version 0.6.0</span>
<span class="c"># &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;The &lt;i&gt;coords&lt;/i&gt; attribute is a tuple of the form:&lt;br /&gt;</span>
<span class="c"># (shtxlo, shtxhi, rowxlo, rowxhi, colxlo, colxhi)&lt;br /&gt;</span>
<span class="c"># where 0 &lt;= thingxlo &lt;= thingx &lt; thingxhi.&lt;br /&gt;</span>
<span class="c"># Note that it is quite possible to have thingx &gt; nthings; for example</span>
<span class="c"># Print_Titles could have colxhi == 256 and/or rowxhi == 65536</span>
<span class="c"># irrespective of how many columns/rows are actually used in the worksheet.</span>
<span class="c"># The caller will need to decide how to handle this situation.</span>
<span class="c"># Keyword: IndexError :-)</span>
<span class="c"># &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;The components of the coords attribute are also available as individual</span>
<span class="c"># attributes: shtxlo, shtxhi, rowxlo, rowxhi, colxlo, and colxhi.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;The &lt;i&gt;relflags&lt;/i&gt; attribute is a 6-tuple of flags which indicate whether</span>
<span class="c"># the corresponding (sheet|row|col)(lo|hi) is relative (1) or absolute (0).&lt;br&gt;</span>
<span class="c"># Note that there is necessarily no information available as to what cell(s)</span>
<span class="c"># the reference could possibly be relative to. The caller must decide what if</span>
<span class="c"># any use to make of oREL operands. Note also that a partially relative</span>
<span class="c"># reference may well be a typo.</span>
<span class="c"># For example, define name A1Z10 as $a$1:$z10 (missing $ after z)</span>
<span class="c"># while the cursor is on cell Sheet3!A27.&lt;br&gt;</span>
<span class="c"># The resulting Ref3D instance will have coords = (2, 3, 0, -16, 0, 26)</span>
<span class="c"># and relflags = (0, 0, 0, 1, 0, 0).&lt;br&gt;</span>
<span class="c"># So far, only one possibility of a sheet-relative component in</span>
<span class="c"># a reference has been noticed: a 2D reference located in the &quot;current sheet&quot;.</span>
<span class="c"># &lt;br /&gt; This will appear as coords = (0, 1, ...) and relflags = (1, 1, ...).</span>

<span class="k">class</span> <span class="nc">Ref3D</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atuple</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">atuple</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span> <span class="o">=</span> <span class="n">atuple</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shtxlo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtxhi</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowxlo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowxhi</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colxlo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colxhi</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Ref3D(coords=</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;Ref3D(coords=</span><span class="si">%r</span><span class="s">, relflags=</span><span class="si">%r</span><span class="s">)&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">relflags</span><span class="p">)</span>

<span class="n">tAdd</span> <span class="o">=</span> <span class="mh">0x03</span>
<span class="n">tSub</span> <span class="o">=</span> <span class="mh">0x04</span>
<span class="n">tMul</span> <span class="o">=</span> <span class="mh">0x05</span>
<span class="n">tDiv</span> <span class="o">=</span> <span class="mh">0x06</span>
<span class="n">tPower</span> <span class="o">=</span> <span class="mh">0x07</span>
<span class="n">tConcat</span> <span class="o">=</span> <span class="mh">0x08</span>
<span class="n">tLT</span><span class="p">,</span> <span class="n">tLE</span><span class="p">,</span> <span class="n">tEQ</span><span class="p">,</span> <span class="n">tGE</span><span class="p">,</span> <span class="n">tGT</span><span class="p">,</span> <span class="n">tNE</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">operator</span> <span class="kn">as</span> <span class="nn">opr</span>

<span class="k">def</span> <span class="nf">nop</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">_opr_pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">_opr_lt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span>  <span class="n">y</span>
<span class="k">def</span> <span class="nf">_opr_le</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span>
<span class="k">def</span> <span class="nf">_opr_eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>
<span class="k">def</span> <span class="nf">_opr_ge</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span>
<span class="k">def</span> <span class="nf">_opr_gt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;</span>  <span class="n">y</span>
<span class="k">def</span> <span class="nf">_opr_ne</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">num2strg</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Attempt to emulate Excel&#39;s default conversion</span>
<span class="sd">       from number to string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.0&quot;</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="n">_arith_argdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">oNUM</span><span class="p">:</span> <span class="n">nop</span><span class="p">,</span>     <span class="n">oSTRG</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>
<span class="n">_cmp_argdict</span> <span class="o">=</span>   <span class="p">{</span><span class="n">oNUM</span><span class="p">:</span> <span class="n">nop</span><span class="p">,</span>     <span class="n">oSTRG</span><span class="p">:</span> <span class="n">nop</span><span class="p">}</span>
<span class="c"># Seems no conversions done on relops; in Excel, &quot;1&quot; &gt; 9 produces TRUE.</span>
<span class="n">_strg_argdict</span> <span class="o">=</span>  <span class="p">{</span><span class="n">oNUM</span><span class="p">:</span><span class="n">num2strg</span><span class="p">,</span> <span class="n">oSTRG</span><span class="p">:</span><span class="n">nop</span><span class="p">}</span>
<span class="n">binop_rules</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">tAdd</span><span class="p">:</span>   <span class="p">(</span><span class="n">_arith_argdict</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">opr</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">),</span>
    <span class="n">tSub</span><span class="p">:</span>   <span class="p">(</span><span class="n">_arith_argdict</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">opr</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">),</span>
    <span class="n">tMul</span><span class="p">:</span>   <span class="p">(</span><span class="n">_arith_argdict</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">opr</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span>
    <span class="n">tDiv</span><span class="p">:</span>   <span class="p">(</span><span class="n">_arith_argdict</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">opr</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">),</span>
    <span class="n">tPower</span><span class="p">:</span> <span class="p">(</span><span class="n">_arith_argdict</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">_opr_pow</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&#39;^&#39;</span><span class="p">,),</span>
    <span class="n">tConcat</span><span class="p">:(</span><span class="n">_strg_argdict</span><span class="p">,</span> <span class="n">oSTRG</span><span class="p">,</span> <span class="n">opr</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>  <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span>
    <span class="n">tLT</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_lt</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">),</span>
    <span class="n">tLE</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_le</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">),</span>
    <span class="n">tEQ</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_eq</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">),</span>
    <span class="n">tGE</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_ge</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">),</span>
    <span class="n">tGT</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_gt</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">),</span>
    <span class="n">tNE</span><span class="p">:</span>    <span class="p">(</span><span class="n">_cmp_argdict</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">_opr_ne</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;&lt;&gt;&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<span class="n">unop_rules</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x13</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span>        <span class="mi">70</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="c"># unary minus</span>
    <span class="mh">0x12</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>         <span class="mi">70</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="c"># unary plus</span>
    <span class="mh">0x14</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>  <span class="s">&#39;%&#39;</span><span class="p">),</span><span class="c"># percent</span>
    <span class="p">}</span>

<span class="n">LEAF_RANK</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">FUNC_RANK</span> <span class="o">=</span> <span class="mi">90</span>

<span class="n">STACK_ALARM_LEVEL</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">STACK_PANIC_LEVEL</span> <span class="o">=</span> <span class="mi">10</span>

<div class="viewcode-block" id="evaluate_name_formula"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.evaluate_name_formula">[docs]</a><span class="k">def</span> <span class="nf">evaluate_name_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">nobj</span><span class="p">,</span> <span class="n">namex</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">STACK_ALARM_LEVEL</span><span class="p">:</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">raw_formula</span>
    <span class="n">fmlalen</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">basic_formula_len</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="n">reldelta</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># All defined name formulas use &quot;Method B&quot; [OOo docs]</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;::: evaluate_name_formula </span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%r</span><span class="s"> level=</span><span class="si">%d</span><span class="s">&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">namex</span><span class="p">,</span> <span class="n">nobj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">STACK_PANIC_LEVEL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Excessive indirect references in NAME formula&quot;</span><span class="p">)</span>
    <span class="n">sztab</span> <span class="o">=</span> <span class="n">szdict</span><span class="p">[</span><span class="n">bv</span><span class="p">]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">any_err</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">any_external</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">unk_opnd</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">error_opnd</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oERR</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">spush</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span>

    <span class="k">def</span> <span class="nf">do_binop</span><span class="p">(</span><span class="n">opcd</span><span class="p">,</span> <span class="n">stk</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">bop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">aop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">argdict</span><span class="p">,</span> <span class="n">result_kind</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">binop_rules</span><span class="p">[</span><span class="n">opcd</span><span class="p">]</span>
        <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">sym</span><span class="p">,</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="p">])</span>
        <span class="n">resop</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">result_kind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bconv</span> <span class="o">=</span> <span class="n">argdict</span><span class="p">[</span><span class="n">bop</span><span class="o">.</span><span class="n">kind</span><span class="p">]</span>
            <span class="n">aconv</span> <span class="o">=</span> <span class="n">argdict</span><span class="p">[</span><span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resop</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resop</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">bval</span> <span class="o">=</span> <span class="n">bconv</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">aval</span> <span class="o">=</span> <span class="n">aconv</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">aval</span><span class="p">,</span> <span class="n">bval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result_kind</span> <span class="o">==</span> <span class="n">oBOOL</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">resop</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_unaryop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">result_kind</span><span class="p">,</span> <span class="n">stk</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="n">aop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">sym2</span> <span class="o">=</span> <span class="n">unop_rules</span><span class="p">[</span><span class="n">opcode</span><span class="p">]</span>
        <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="n">sym1</span><span class="p">,</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">sym2</span><span class="p">,</span>
            <span class="p">])</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">result_kind</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">not_in_name_formula</span><span class="p">(</span><span class="n">op_arg</span><span class="p">,</span> <span class="n">oname_arg</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ERROR *** Token 0x</span><span class="si">%02x</span><span class="s"> (</span><span class="si">%s</span><span class="s">) found in NAME formula&quot;</span> \
              <span class="o">%</span> <span class="p">(</span><span class="n">op_arg</span><span class="p">,</span> <span class="n">oname_arg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fmlalen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">unk_opnd</span><span class="p">]</span>

    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">fmlalen</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
        <span class="n">optype</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">optype</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">+</span> <span class="mi">32</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span>
        <span class="n">oname</span> <span class="o">=</span> <span class="n">onames</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span> <span class="c"># + [&quot; RVA&quot;][optype]</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="n">sztab</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Pos:</span><span class="si">%d</span><span class="s"> Op:0x</span><span class="si">%02x</span><span class="s"> Name:t</span><span class="si">%s</span><span class="s"> Sz:</span><span class="si">%d</span><span class="s"> opcode:</span><span class="si">%02x</span><span class="s">h optype:</span><span class="si">%02x</span><span class="s">h&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">optype</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Stack =&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;ERROR *** Unexpected token 0x</span><span class="si">%02x</span><span class="s"> (&quot;</span><span class="si">%s</span><span class="s">&quot;); biff_version=</span><span class="si">%d</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">bv</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">optype</span><span class="p">:</span>
            <span class="k">if</span> <span class="mh">0x00</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c"># unk_opnd, tExp, tTbl</span>
                <span class="n">not_in_name_formula</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x03</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x0E</span><span class="p">:</span>
                <span class="c"># Add, Sub, Mul, Div, Power</span>
                <span class="c"># tConcat</span>
                <span class="c"># tLT, ..., tNE</span>
                <span class="n">do_binop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0F</span><span class="p">:</span> <span class="c"># tIsect</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">otext</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oUNK</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oUNK</span><span class="p">:</span>
                    <span class="c"># This can happen with undefined</span>
                    <span class="c"># (go search in the current sheet) labels.</span>
                    <span class="c"># For example =Bob Sales</span>
                    <span class="c"># Each label gets a NAME record with an empty formula (!)</span>
                    <span class="c"># Evaluation of the tName token classifies it as oUNK</span>
                    <span class="c"># res.kind = oREF</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span>
                            <span class="n">tIsectFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span>
                            <span class="n">tIsectFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">relfa</span> <span class="o">=</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relflags</span>
                        <span class="n">relfb</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relflags</span>
                        <span class="k">if</span> <span class="n">relfa</span> <span class="o">==</span> <span class="n">relfb</span><span class="p">:</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relfa</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># tList</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tList pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="n">oREL</span><span class="p">)</span> <span class="ow">and</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="n">oREL</span><span class="p">):</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span> <span class="ow">or</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span><span class="p">:</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tList post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">:</span> <span class="c"># tRange</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span>
                            <span class="n">tRangeFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span>
                            <span class="n">tRangeFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">relfa</span> <span class="o">=</span> <span class="n">aop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relflags</span>
                        <span class="n">relfb</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relflags</span>
                        <span class="k">if</span> <span class="n">relfa</span> <span class="o">==</span> <span class="n">relfb</span><span class="p">:</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relfa</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x12</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x14</span><span class="p">:</span> <span class="c"># tUplus, tUminus, tPercent</span>
                <span class="n">do_unaryop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x15</span><span class="p">:</span> <span class="c"># tParen</span>
                <span class="c"># source cosmetics</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x16</span><span class="p">:</span> <span class="c"># tMissArg</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">oMSNG</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x17</span><span class="p">:</span> <span class="c"># tStr</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="n">unpack_string_update_pos</span><span class="p">(</span>
                                        <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span>
                                        <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">sz</span> <span class="o">=</span> <span class="n">newpos</span> <span class="o">-</span> <span class="n">pos</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   sz=</span><span class="si">%d</span><span class="s"> strg=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">strg</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">strg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">oSTRG</span><span class="p">,</span> <span class="n">strg</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x18</span><span class="p">:</span> <span class="c"># tExtended</span>
                <span class="c"># new with BIFF 8</span>
                <span class="k">assert</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span>
                <span class="c"># not in OOo docs</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;tExtended token not implemented&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tAttr</span>
                <span class="n">subop</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">subname</span> <span class="o">=</span> <span class="n">tAttrNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="s">&quot;??Unknown??&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subop</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># Choose</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span>
                <span class="k">elif</span> <span class="n">subop</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># Sum (single arg)</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tAttrSum&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
                    <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;SUM(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">aop</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oNUM</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   subop=</span><span class="si">%02x</span><span class="s">h subname=t</span><span class="si">%s</span><span class="s"> sz=</span><span class="si">%d</span><span class="s"> nc=</span><span class="si">%02x</span><span class="s">h&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x1A</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x1B</span><span class="p">:</span> <span class="c"># tSheet, tEndSheet</span>
                <span class="k">assert</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">50</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;tSheet &amp; tEndsheet tokens not implemented&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x1C</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x1F</span><span class="p">:</span> <span class="c"># tErr, tBool, tInt, tNum</span>
                <span class="n">inx</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">-</span> <span class="mh">0x1C</span>
                <span class="n">nb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">][</span><span class="n">inx</span><span class="p">]</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="p">[</span><span class="n">oERR</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">][</span><span class="n">inx</span><span class="p">]</span>
                <span class="n">value</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot;BBHd&quot;</span><span class="p">[</span><span class="n">inx</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># tInt</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c"># tNum</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># tBool</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;FALSE&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)[</span><span class="n">value</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span><span class="n">error_text_from_code</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Unhandled opcode: 0x</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Size not set for opcode 0x</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span> <span class="c"># tArray</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c"># tFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nb</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">func_attrs</span> <span class="o">=</span> <span class="n">func_defs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_attrs</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** formula/tFunc unknown FuncID:</span><span class="si">%d</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="n">funcx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">func_name</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">func_attrs</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    FuncID=</span><span class="si">%d</span><span class="s"> name=</span><span class="si">%s</span><span class="s"> nargs=</span><span class="si">%d</span><span class="s">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">nargs</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="k">if</span> <span class="n">nargs</span><span class="p">:</span>
                    <span class="n">argtext</span> <span class="o">=</span> <span class="n">listsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">arg</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]])</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">argtext</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="n">func_name</span> <span class="o">+</span> <span class="s">&quot;()&quot;</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c">#tFuncVar</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">nargs</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;B&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
            <span class="n">prompt</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">nargs</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="mi">32768</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   FuncID=</span><span class="si">%d</span><span class="s"> nargs=</span><span class="si">%d</span><span class="s"> macro=</span><span class="si">%d</span><span class="s"> prompt=</span><span class="si">%d</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">func_attrs</span> <span class="o">=</span> <span class="n">func_defs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_attrs</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** formula/tFuncVar unknown FuncID:</span><span class="si">%d</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="n">funcx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">func_name</span><span class="p">,</span> <span class="n">minargs</span><span class="p">,</span> <span class="n">maxargs</span> <span class="o">=</span> <span class="n">func_attrs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    name: </span><span class="si">%r</span><span class="s">, min~max args: </span><span class="si">%d</span><span class="s">~</span><span class="si">%d</span><span class="s">&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">minargs</span><span class="p">,</span> <span class="n">maxargs</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">minargs</span> <span class="o">&lt;=</span> <span class="n">nargs</span> <span class="o">&lt;=</span> <span class="n">maxargs</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="n">argtext</span> <span class="o">=</span> <span class="n">listsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">arg</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]])</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">argtext</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">funcx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># IF</span>
                    <span class="n">testarg</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">testarg</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oNUM</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">blah</span> <span class="ow">and</span> <span class="n">testarg</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="n">oUNK</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&quot;IF testarg kind?&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">testarg</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">blah</span> <span class="ow">and</span> <span class="n">testarg</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&quot;IF testarg value?&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">testarg</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                            <span class="c"># IF(FALSE, tv) =&gt; FALSE</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">respos</span> <span class="o">=</span> <span class="o">-</span><span class="n">nargs</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">testarg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                            <span class="n">chosen</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">respos</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">chosen</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oMSNG</span><span class="p">:</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">oNUM</span><span class="p">,</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">chosen</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">chosen</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&quot;$$$$$$ IF =&gt; constant&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">funcx</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span> <span class="c"># CHOOSE</span>
                    <span class="n">testarg</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">testarg</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oNUM</span><span class="p">:</span>
                        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">testarg</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">nargs</span><span class="p">:</span>
                            <span class="n">chosen</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">testarg</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
                            <span class="k">if</span> <span class="n">chosen</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oMSNG</span><span class="p">:</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">oNUM</span><span class="p">,</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">chosen</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">chosen</span><span class="o">.</span><span class="n">value</span>
                <span class="k">del</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c">#tName</span>
            <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c"># Only change with BIFF version is number of trailing UNUSED bytes!</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   tgtnamex=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">tgtobj</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">tgtnamex</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
                <span class="c">### recursive ###</span>
                <span class="n">evaluate_name_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">tgtobj</span><span class="p">,</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="n">blah</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">macro</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">binary</span> \
            <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="n">tgtobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                        <span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="n">header</span><span class="o">=</span><span class="s">&quot;!!! tgtobj has problems!!!&quot;</span><span class="p">,</span>
                        <span class="n">footer</span><span class="o">=</span><span class="s">&quot;-----------       --------&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">any_err</span> <span class="o">=</span> <span class="n">any_err</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">macro</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_err</span>
                <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_rel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
            <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> \
                           <span class="o">%</span> <span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span><span class="p">],</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;    tName: setting text to&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># tRef</span>
            <span class="c"># not_in_name_formula(op, oname)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">shx1</span> <span class="o">=</span> <span class="n">shx2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">####### N.B. relative to the CURRENT SHEET</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">colx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREL</span><span class="p">,</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)])</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">:</span> <span class="c"># tArea</span>
            <span class="c"># not_in_name_formula(op, oname)</span>
            <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">shx1</span> <span class="o">=</span> <span class="n">shx2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">####### N.B. relative to the CURRENT SHEET</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel1</span><span class="p">,</span> <span class="n">col_rel2</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREL</span><span class="p">,</span> <span class="p">[</span><span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)])</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x06</span><span class="p">:</span> <span class="c"># tMemArea</span>
            <span class="n">not_in_name_formula</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">:</span> <span class="c"># tMemFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%d</span><span class="s"> bytes of cell ref formula&quot;</span> <span class="o">%</span> <span class="n">nb</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="c"># no effect on stack</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0C</span><span class="p">:</span> <span class="c">#tRefN</span>
            <span class="n">not_in_name_formula</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
            <span class="c"># res = get_cell_addr(data, pos+1, bv, reldelta=1)</span>
            <span class="c"># # note *ALL* tRefN usage has signed offset for relative addresses</span>
            <span class="c"># any_rel = 1</span>
            <span class="c"># if blah: print &gt;&gt; bk.logfile, &quot;   &quot;, res</span>
            <span class="c"># spush(res)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0D</span><span class="p">:</span> <span class="c">#tAreaN</span>
            <span class="n">not_in_name_formula</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
            <span class="c"># res = get_cell_range_addr(data, pos+1, bv, reldelta=1)</span>
            <span class="c"># # note *ALL* tAreaN usage has signed offset for relative addresses</span>
            <span class="c"># any_rel = 1</span>
            <span class="c"># if blah: print &gt;&gt; bk.logfile, &quot;   &quot;, res</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1A</span><span class="p">:</span> <span class="c"># tRef3d</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span> <span class="o">=</span> \
                             <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxhh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRef3d&quot;</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range_b57</span><span class="p">(</span>
                                <span class="n">bk</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel</span> <span class="ow">or</span> <span class="n">col_rel</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">is_rel</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">colx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">)</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3drel</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3d</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref3d</span><span class="p">]</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1B</span><span class="p">:</span> <span class="c"># tArea3d</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span> <span class="o">=</span> \
                             <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxhh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;tArea3d&quot;</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range_b57</span><span class="p">(</span>
                                <span class="n">bk</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel1</span> <span class="ow">or</span> <span class="n">col_rel1</span> <span class="ow">or</span> <span class="n">row_rel2</span> <span class="ow">or</span> <span class="n">col_rel2</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">is_rel</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel1</span><span class="p">,</span> <span class="n">col_rel2</span><span class="p">)</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3drel</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3d</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref3d</span><span class="p">]</span>

            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tNameX</span>
            <span class="n">dodgy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">tgtnamex</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">origrefx</span> <span class="o">=</span> <span class="n">refx</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">tgtnamex</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">origrefx</span> <span class="o">=</span> <span class="n">refx</span>
                <span class="k">if</span> <span class="n">refx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">refx</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">refx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">refx</span> <span class="o">=</span> <span class="o">-</span><span class="n">refx</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dodgy</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   origrefx=</span><span class="si">%d</span><span class="s"> refx=</span><span class="si">%d</span><span class="s"> tgtnamex=</span><span class="si">%d</span><span class="s"> dodgy=</span><span class="si">%d</span><span class="s">&quot;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">origrefx</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="n">dodgy</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tgtnamex</span> <span class="o">==</span> <span class="n">namex</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;!!!! Self-referential !!!!&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">dodgy</span> <span class="o">=</span> <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dodgy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">origrefx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c"># external ref</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exty</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_externsheet_type_b57</span><span class="p">[</span><span class="n">refx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">exty</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c"># non-specific sheet in own doc&#39;t</span>
                        <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># internal, any sheet</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">666</span><span class="p">,</span> <span class="o">-</span><span class="mi">666</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dodgy</span> <span class="ow">or</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;&lt;&lt;Name #</span><span class="si">%d</span><span class="s"> in external(?) file #</span><span class="si">%d</span><span class="s">&gt;&gt;&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">tgtnamex</span><span class="p">,</span> <span class="n">origrefx</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tgtobj</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">tgtnamex</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
                    <span class="c">### recursive ###</span>
                    <span class="n">evaluate_name_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">tgtobj</span><span class="p">,</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="n">blah</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">macro</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">binary</span> \
                <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                        <span class="n">tgtobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                            <span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="n">header</span><span class="o">=</span><span class="s">&quot;!!! bad tgtobj !!!&quot;</span><span class="p">,</span>
                            <span class="n">footer</span><span class="o">=</span><span class="s">&quot;------------------&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="n">any_err</span> <span class="o">=</span> <span class="n">any_err</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">macro</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_err</span>
                    <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">any_rel</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
                <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> \
                               <span class="o">%</span> <span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span><span class="p">],</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    tNameX: setting text to&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">error_opcodes</span><span class="p">:</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">error_opnd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;FORMULA: /// Not handled yet: t&quot;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Fatal: token size is not positive&quot;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
    <span class="n">any_rel</span> <span class="o">=</span> <span class="ow">not</span> <span class="ow">not</span> <span class="n">any_rel</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;End of formula. level=</span><span class="si">%d</span><span class="s"> any_rel=</span><span class="si">%d</span><span class="s"> any_err=</span><span class="si">%d</span><span class="s"> stack=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="p">,</span> <span class="ow">not</span> <span class="ow">not</span> <span class="n">any_rel</span><span class="p">,</span> <span class="n">any_err</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** Stack has unprocessed args&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">nobj</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nobj</span><span class="o">.</span><span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span>
    <span class="n">nobj</span><span class="o">.</span><span class="n">any_err</span> <span class="o">=</span> <span class="n">any_err</span>
    <span class="n">nobj</span><span class="o">.</span><span class="n">any_external</span> <span class="o">=</span> <span class="n">any_external</span>
    <span class="n">nobj</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c">#### under construction #############################################################################</span></div>
<div class="viewcode-block" id="decompile_formula"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.decompile_formula">[docs]</a><span class="k">def</span> <span class="nf">decompile_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">fmla</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span>
    <span class="n">fmlatype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">blah</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">STACK_ALARM_LEVEL</span><span class="p">:</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">reldelta</span> <span class="o">=</span> <span class="n">fmlatype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FMLA_TYPE_SHARED</span><span class="p">,</span> <span class="n">FMLA_TYPE_NAME</span><span class="p">,</span> <span class="n">FMLA_TYPE_COND_FMT</span><span class="p">,</span> <span class="n">FMLA_TYPE_DATA_VAL</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fmla</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;::: decompile_formula len=</span><span class="si">%d</span><span class="s"> fmlatype=</span><span class="si">%r</span><span class="s"> browx=</span><span class="si">%r</span><span class="s"> bcolx=</span><span class="si">%r</span><span class="s"> reldelta=</span><span class="si">%d</span><span class="s"> </span><span class="si">%r</span><span class="s"> level=</span><span class="si">%d</span><span class="s">&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">fmlalen</span><span class="p">,</span> <span class="n">fmlatype</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">STACK_PANIC_LEVEL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Excessive indirect references in formula&quot;</span><span class="p">)</span>
    <span class="n">sztab</span> <span class="o">=</span> <span class="n">szdict</span><span class="p">[</span><span class="n">bv</span><span class="p">]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">any_err</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">any_external</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">unk_opnd</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">error_opnd</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oERR</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">spush</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span>

    <span class="k">def</span> <span class="nf">do_binop</span><span class="p">(</span><span class="n">opcd</span><span class="p">,</span> <span class="n">stk</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">bop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">aop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">argdict</span><span class="p">,</span> <span class="n">result_kind</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">binop_rules</span><span class="p">[</span><span class="n">opcd</span><span class="p">]</span>
        <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">sym</span><span class="p">,</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="p">])</span>
        <span class="n">resop</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">result_kind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
        <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_unaryop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">result_kind</span><span class="p">,</span> <span class="n">stk</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="n">aop</span> <span class="o">=</span> <span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">sym2</span> <span class="o">=</span> <span class="n">unop_rules</span><span class="p">[</span><span class="n">opcode</span><span class="p">]</span>
        <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="n">sym1</span><span class="p">,</span>
            <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
            <span class="n">sym2</span><span class="p">,</span>
            <span class="p">])</span>
        <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">result_kind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">unexpected_opcode</span><span class="p">(</span><span class="n">op_arg</span><span class="p">,</span> <span class="n">oname_arg</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ERROR *** Unexpected token 0x</span><span class="si">%02x</span><span class="s"> (</span><span class="si">%s</span><span class="s">) found in formula type </span><span class="si">%s</span><span class="s">&quot;</span> \
              <span class="o">%</span> <span class="p">(</span><span class="n">op_arg</span><span class="p">,</span> <span class="n">oname_arg</span><span class="p">,</span> <span class="n">FMLA_TYPEDESCR_MAP</span><span class="p">[</span><span class="n">fmlatype</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="c"># raise FormulaError(msg)</span>

    <span class="k">if</span> <span class="n">fmlalen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">unk_opnd</span><span class="p">]</span>

    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">fmlalen</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
        <span class="n">optype</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">optype</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">+</span> <span class="mi">32</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span>
        <span class="n">oname</span> <span class="o">=</span> <span class="n">onames</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span> <span class="c"># + [&quot; RVA&quot;][optype]</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="n">sztab</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Pos:</span><span class="si">%d</span><span class="s"> Op:0x</span><span class="si">%02x</span><span class="s"> opname:t</span><span class="si">%s</span><span class="s"> Sz:</span><span class="si">%d</span><span class="s"> opcode:</span><span class="si">%02x</span><span class="s">h optype:</span><span class="si">%02x</span><span class="s">h&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">optype</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Stack =&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;ERROR *** Unexpected token 0x</span><span class="si">%02x</span><span class="s"> (&quot;</span><span class="si">%s</span><span class="s">&quot;); biff_version=</span><span class="si">%d</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">bv</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_TOKEN_NOT_ALLOWED</span><span class="p">(</span><span class="n">opx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">fmlatype</span><span class="p">:</span>
            <span class="n">unexpected_opcode</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">optype</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c"># tExp</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;x2H&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;xHB&#39;</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fmlalen</span> <span class="o">==</span> <span class="n">sz</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stack</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;SHARED FMLA at rowx=</span><span class="si">%d</span><span class="s"> colx=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmlatype</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FMLA_TYPE_CELL</span> <span class="o">|</span> <span class="n">FMLA_TYPE_ARRAY</span><span class="p">):</span>
                    <span class="n">unexpected_opcode</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x03</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x0E</span><span class="p">:</span>
                <span class="c"># Add, Sub, Mul, Div, Power</span>
                <span class="c"># tConcat</span>
                <span class="c"># tLT, ..., tNE</span>
                <span class="n">do_binop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0F</span><span class="p">:</span> <span class="c"># tIsect</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">otext</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oUNK</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oUNK</span><span class="p">:</span>
                    <span class="c"># This can happen with undefined</span>
                    <span class="c"># (go search in the current sheet) labels.</span>
                    <span class="c"># For example =Bob Sales</span>
                    <span class="c"># Each label gets a NAME record with an empty formula (!)</span>
                    <span class="c"># Evaluation of the tName token classifies it as oUNK</span>
                    <span class="c"># res.kind = oREF</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># tList</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tList pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="n">oREL</span><span class="p">)</span> <span class="ow">and</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="n">oREL</span><span class="p">):</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                    <span class="k">if</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span> <span class="ow">or</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREL</span><span class="p">:</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tList post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">:</span> <span class="c"># tRange</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="mi">80</span> <span class="c">########## check #######</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">aop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">aop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">sym</span><span class="p">,</span>
                    <span class="s">&#39;(&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="n">bop</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="s">&#39;)&#39;</span><span class="p">[:</span><span class="n">bop</span><span class="o">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">rank</span><span class="p">],</span>
                    <span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oREF</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span> <span class="ow">or</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oERR</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">oERR</span>
                <span class="k">elif</span> <span class="n">bop</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">oREF</span> <span class="o">==</span> <span class="n">aop</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x12</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x14</span><span class="p">:</span> <span class="c"># tUplus, tUminus, tPercent</span>
                <span class="n">do_unaryop</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x15</span><span class="p">:</span> <span class="c"># tParen</span>
                <span class="c"># source cosmetics</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x16</span><span class="p">:</span> <span class="c"># tMissArg</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">oMSNG</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x17</span><span class="p">:</span> <span class="c"># tStr</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="n">unpack_string_update_pos</span><span class="p">(</span>
                                        <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span>
                                        <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">sz</span> <span class="o">=</span> <span class="n">newpos</span> <span class="o">-</span> <span class="n">pos</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   sz=</span><span class="si">%d</span><span class="s"> strg=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">strg</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">strg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">oSTRG</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x18</span><span class="p">:</span> <span class="c"># tExtended</span>
                <span class="c"># new with BIFF 8</span>
                <span class="k">assert</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span>
                <span class="c"># not in OOo docs, don&#39;t even know how to determine its length</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;tExtended token not implemented&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tAttr</span>
                <span class="n">subop</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">subname</span> <span class="o">=</span> <span class="n">tAttrNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="s">&quot;??Unknown??&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subop</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># Choose</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span>
                <span class="k">elif</span> <span class="n">subop</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># Sum (single arg)</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tAttrSum&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
                    <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;SUM(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">aop</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oNUM</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   subop=</span><span class="si">%02x</span><span class="s">h subname=t</span><span class="si">%s</span><span class="s"> sz=</span><span class="si">%d</span><span class="s"> nc=</span><span class="si">%02x</span><span class="s">h&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x1A</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x1B</span><span class="p">:</span> <span class="c"># tSheet, tEndSheet</span>
                <span class="k">assert</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">50</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;tSheet &amp; tEndsheet tokens not implemented&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mh">0x1C</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x1F</span><span class="p">:</span> <span class="c"># tErr, tBool, tInt, tNum</span>
                <span class="n">inx</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">-</span> <span class="mh">0x1C</span>
                <span class="n">nb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">][</span><span class="n">inx</span><span class="p">]</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="p">[</span><span class="n">oERR</span><span class="p">,</span> <span class="n">oBOOL</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">,</span> <span class="n">oNUM</span><span class="p">][</span><span class="n">inx</span><span class="p">]</span>
                <span class="n">value</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot;BBHd&quot;</span><span class="p">[</span><span class="n">inx</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># tInt</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c"># tNum</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># tBool</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;FALSE&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">)[</span><span class="n">value</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span><span class="n">error_text_from_code</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">Operand</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Unhandled opcode: 0x</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Size not set for opcode 0x</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span> <span class="c"># tArray</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c"># tFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nb</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">func_attrs</span> <span class="o">=</span> <span class="n">func_defs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_attrs</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** formula/tFunc unknown FuncID:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">funcx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">func_name</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">func_attrs</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    FuncID=</span><span class="si">%d</span><span class="s"> name=</span><span class="si">%s</span><span class="s"> nargs=</span><span class="si">%d</span><span class="s">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">nargs</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="k">if</span> <span class="n">nargs</span><span class="p">:</span>
                    <span class="n">argtext</span> <span class="o">=</span> <span class="n">listsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">arg</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]])</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">argtext</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="n">func_name</span> <span class="o">+</span> <span class="s">&quot;()&quot;</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c">#tFuncVar</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">nargs</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;B&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
            <span class="n">prompt</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">nargs</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="mi">32768</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   FuncID=</span><span class="si">%d</span><span class="s"> nargs=</span><span class="si">%d</span><span class="s"> macro=</span><span class="si">%d</span><span class="s"> prompt=</span><span class="si">%d</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="c">#### TODO #### if funcx == 255: # call add-in function</span>
            <span class="k">if</span> <span class="n">funcx</span> <span class="o">==</span> <span class="mi">255</span><span class="p">:</span>
                <span class="n">func_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;CALL_ADDIN&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">func_attrs</span> <span class="o">=</span> <span class="n">func_defs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_attrs</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** formula/tFuncVar unknown FuncID:</span><span class="si">%d</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="n">funcx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">unk_opnd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">func_name</span><span class="p">,</span> <span class="n">minargs</span><span class="p">,</span> <span class="n">maxargs</span> <span class="o">=</span> <span class="n">func_attrs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    name: </span><span class="si">%r</span><span class="s">, min~max args: </span><span class="si">%d</span><span class="s">~</span><span class="si">%d</span><span class="s">&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">minargs</span><span class="p">,</span> <span class="n">maxargs</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">minargs</span> <span class="o">&lt;=</span> <span class="n">nargs</span> <span class="o">&lt;=</span> <span class="n">maxargs</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nargs</span>
                <span class="n">argtext</span> <span class="o">=</span> <span class="n">listsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">arg</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]])</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">argtext</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">FUNC_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="n">nargs</span><span class="p">:]</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c">#tName</span>
            <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c"># Only change with BIFF version is number of trailing UNUSED bytes!</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   tgtnamex=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">tgtobj</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">tgtnamex</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span><span class="p">],</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;    tName: setting text to&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">otext</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># tRef</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel</span> <span class="ow">or</span> <span class="n">col_rel</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREF</span>
            <span class="n">otext</span> <span class="o">=</span> <span class="n">cellnamerel</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">okind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">:</span> <span class="c"># tArea</span>
            <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span>
                            <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_rel1</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel1</span><span class="p">,</span> <span class="n">col_rel2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">relflags</span><span class="p">):</span>  <span class="c"># relative</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREF</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">relflags</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">otext</span> <span class="o">=</span> <span class="n">rangename2drel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">relflags</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">okind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x06</span><span class="p">:</span> <span class="c"># tMemArea</span>
            <span class="n">not_in_name_formula</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">:</span> <span class="c"># tMemFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%d</span><span class="s"> bytes of cell ref formula&quot;</span> <span class="o">%</span> <span class="n">nb</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="c"># no effect on stack</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0C</span><span class="p">:</span> <span class="c">#tRefN</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
            <span class="c"># note *ALL* tRefN usage has signed offset for relative addresses</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel</span> <span class="ow">or</span> <span class="n">col_rel</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREF</span>
            <span class="n">otext</span> <span class="o">=</span> <span class="n">cellnamerel</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">okind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0D</span><span class="p">:</span> <span class="c">#tAreaN</span>
            <span class="c"># res = get_cell_range_addr(data, pos+1, bv, reldelta, browx, bcolx)</span>
            <span class="c"># # note *ALL* tAreaN usage has signed offset for relative addresses</span>
            <span class="c"># any_rel = 1</span>
            <span class="c"># if blah: print &gt;&gt; bk.logfile, &quot;   &quot;, res</span>
            <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span>
                            <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_rel1</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel1</span><span class="p">,</span> <span class="n">col_rel2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">relflags</span><span class="p">):</span>  <span class="c"># relative</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oREF</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">relflags</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">otext</span> <span class="o">=</span> <span class="n">rangename2drel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">relflags</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">okind</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1A</span><span class="p">:</span> <span class="c"># tRef3d</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
                <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">)</span>
                <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span> <span class="o">=</span> \
                             <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxhh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRef3d&quot;</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range_b57</span><span class="p">(</span>
                                <span class="n">bk</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel</span> <span class="ow">or</span> <span class="n">col_rel</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">is_rel</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">colx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">,</span> <span class="n">col_rel</span><span class="p">)</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3drel</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3d</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
            <span class="n">res</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1B</span><span class="p">:</span> <span class="c"># tArea3d</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
                <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span> <span class="o">=</span> \
                             <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxhh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">15</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;tArea3d&quot;</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range_b57</span><span class="p">(</span>
                                <span class="n">bk</span><span class="p">,</span> <span class="n">raw_extshtx</span><span class="p">,</span> <span class="n">raw_shx1</span><span class="p">,</span> <span class="n">raw_shx2</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">is_rel</span> <span class="o">=</span> <span class="n">row_rel1</span> <span class="ow">or</span> <span class="n">col_rel1</span> <span class="ow">or</span> <span class="n">row_rel2</span> <span class="ow">or</span> <span class="n">col_rel2</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">is_rel</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_rel</span><span class="p">:</span>
                <span class="n">relflags</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel1</span><span class="p">,</span> <span class="n">col_rel2</span><span class="p">)</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span> <span class="o">+</span> <span class="n">relflags</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREL</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3drel</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref3d</span> <span class="o">=</span> <span class="n">Ref3D</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">oREF</span>
                <span class="n">res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rangename3d</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">LEAF_RANK</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tNameX</span>
            <span class="n">dodgy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">oUNK</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">tgtnamex</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">origrefx</span> <span class="o">=</span> <span class="n">refx</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;hxxxxxxxxH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">tgtnamex</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">origrefx</span> <span class="o">=</span> <span class="n">refx</span>
                <span class="k">if</span> <span class="n">refx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">refx</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">refx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">refx</span> <span class="o">=</span> <span class="o">-</span><span class="n">refx</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dodgy</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   origrefx=</span><span class="si">%d</span><span class="s"> refx=</span><span class="si">%d</span><span class="s"> tgtnamex=</span><span class="si">%d</span><span class="s"> dodgy=</span><span class="si">%d</span><span class="s">&quot;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">origrefx</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">tgtnamex</span><span class="p">,</span> <span class="n">dodgy</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="c"># if tgtnamex == namex:</span>
            <span class="c">#     if blah: print &gt;&gt; bk.logfile, &quot;!!!! Self-referential !!!!&quot;</span>
            <span class="c">#     dodgy = any_err = 1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dodgy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">origrefx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c"># external ref</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exty</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_externsheet_type_b57</span><span class="p">[</span><span class="n">refx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">exty</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c"># non-specific sheet in own doc&#39;t</span>
                        <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># internal, any sheet</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">666</span><span class="p">,</span> <span class="o">-</span><span class="mi">666</span><span class="p">)</span>
            <span class="n">okind</span> <span class="o">=</span> <span class="n">oUNK</span>
            <span class="n">ovalue</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">shx1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span> <span class="c"># addin func name</span>
                <span class="n">okind</span> <span class="o">=</span> <span class="n">oSTRG</span>
                <span class="n">ovalue</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">addin_func_names</span><span class="p">[</span><span class="n">tgtnamex</span><span class="p">]</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">ovalue</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
            <span class="k">elif</span> <span class="n">dodgy</span> <span class="ow">or</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;&lt;&lt;Name #</span><span class="si">%d</span><span class="s"> in external(?) file #</span><span class="si">%d</span><span class="s">&gt;&gt;&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">tgtnamex</span><span class="p">,</span> <span class="n">origrefx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tgtobj</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">tgtnamex</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="p">[</span><span class="n">tgtobj</span><span class="o">.</span><span class="n">scope</span><span class="p">],</span> <span class="n">tgtobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;    tNameX: setting text to&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">Operand</span><span class="p">(</span><span class="n">okind</span><span class="p">,</span> <span class="n">ovalue</span><span class="p">,</span> <span class="n">LEAF_RANK</span><span class="p">,</span> <span class="n">otext</span><span class="p">)</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">error_opcodes</span><span class="p">:</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">spush</span><span class="p">(</span><span class="n">error_opnd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;FORMULA: /// Not handled yet: t&quot;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormulaError</span><span class="p">(</span><span class="s">&quot;Fatal: token size is not positive&quot;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
    <span class="n">any_rel</span> <span class="o">=</span> <span class="ow">not</span> <span class="ow">not</span> <span class="n">any_rel</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;End of formula. level=</span><span class="si">%d</span><span class="s"> any_rel=</span><span class="si">%d</span><span class="s"> any_err=</span><span class="si">%d</span><span class="s"> stack=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="ow">not</span> <span class="ow">not</span> <span class="n">any_rel</span><span class="p">,</span> <span class="n">any_err</span><span class="p">,</span> <span class="n">stack</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** Stack has unprocessed args&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c">#### under deconstruction ###</span></div>
<div class="viewcode-block" id="dump_formula"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.dump_formula">[docs]</a><span class="k">def</span> <span class="nf">dump_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">isname</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;dump_formula&quot;</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="c">#### this function needs updating ####</span>
    <span class="n">sztab</span> <span class="o">=</span> <span class="n">szdict</span><span class="p">[</span><span class="n">bv</span><span class="p">]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">any_err</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">spush</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">append</span>
    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">fmlalen</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
        <span class="n">optype</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">optype</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">+</span> <span class="mi">32</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opx</span> <span class="o">=</span> <span class="n">opcode</span>
        <span class="n">oname</span> <span class="o">=</span> <span class="n">onames</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span> <span class="c"># + [&quot; RVA&quot;][optype]</span>

        <span class="n">sz</span> <span class="o">=</span> <span class="n">sztab</span><span class="p">[</span><span class="n">opx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Pos:</span><span class="si">%d</span><span class="s"> Op:0x</span><span class="si">%02x</span><span class="s"> Name:t</span><span class="si">%s</span><span class="s"> Sz:</span><span class="si">%d</span><span class="s"> opcode:</span><span class="si">%02x</span><span class="s">h optype:</span><span class="si">%02x</span><span class="s">h&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">optype</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">optype</span><span class="p">:</span>
            <span class="k">if</span> <span class="mh">0x01</span> <span class="o">&lt;=</span> <span class="n">opcode</span> <span class="o">&lt;=</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c"># tExp, tTbl</span>
                <span class="c"># reference to a shared formula or table record</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># tList</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tList pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">aop</span> <span class="o">+</span> <span class="n">bop</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tlist post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">:</span> <span class="c"># tRange</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span><span class="n">tRangeFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tRange post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0F</span><span class="p">:</span> <span class="c"># tIsect</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect pre&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">bop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">aop</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">do_box_funcs</span><span class="p">(</span><span class="n">tIsectFuncs</span><span class="p">,</span> <span class="n">aop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">spush</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;tIsect post&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tAttr</span>
                <span class="n">subop</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">subname</span> <span class="o">=</span> <span class="n">tAttrNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="s">&quot;??Unknown??&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subop</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># Choose</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   subop=</span><span class="si">%02x</span><span class="s">h subname=t</span><span class="si">%s</span><span class="s"> sz=</span><span class="si">%d</span><span class="s"> nc=</span><span class="si">%02x</span><span class="s">h&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subop</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x17</span><span class="p">:</span> <span class="c"># tStr</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">strg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">nc</span><span class="p">]</span> <span class="c"># left in 8-bit encoding</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">sz</span> <span class="o">=</span> <span class="n">newpos</span> <span class="o">-</span> <span class="n">pos</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   sz=</span><span class="si">%d</span><span class="s"> strg=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">strg</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;**** Dud size; exiting ****&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span> <span class="c"># tArray</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c"># tFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   FuncID=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">funcx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c">#tFuncVar</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">nargs</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;B&quot;</span> <span class="o">+</span> <span class="s">&quot; BH&quot;</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">nb</span><span class="p">])</span>
            <span class="n">prompt</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">nargs</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">funcx</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="mi">32768</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   FuncID=</span><span class="si">%d</span><span class="s"> nargs=</span><span class="si">%d</span><span class="s"> macro=</span><span class="si">%d</span><span class="s"> prompt=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">funcx</span><span class="p">,</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c">#tName</span>
            <span class="n">namex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
            <span class="c"># Only change with BIFF version is the number of trailing UNUSED bytes!!!</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   namex=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">namex</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">:</span> <span class="c"># tRef</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">:</span> <span class="c"># tArea</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">:</span> <span class="c"># tMemFunc</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%d</span><span class="s"> bytes of cell ref formula&quot;</span> <span class="o">%</span> <span class="n">nb</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0C</span><span class="p">:</span> <span class="c">#tRefN</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c"># note *ALL* tRefN usage has signed offset for relative addresses</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x0D</span><span class="p">:</span> <span class="c">#tAreaN</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c"># note *ALL* tAreaN usage has signed offset for relative addresses</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1A</span><span class="p">:</span> <span class="c"># tRef3d</span>
            <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">get_cell_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">row_rel</span><span class="p">,</span> <span class="n">col_rel</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">row_rel</span> <span class="ow">or</span> <span class="n">col_rel</span>
            <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">colx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">spush</span><span class="p">([</span><span class="n">coords</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x1B</span><span class="p">:</span> <span class="c"># tArea3d</span>
            <span class="n">refx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">get_cell_range_addr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">rowx1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">row_rel1</span><span class="p">,</span> <span class="n">col_rel1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">rowx2</span><span class="p">,</span> <span class="n">colx2</span><span class="p">,</span> <span class="n">row_rel2</span><span class="p">,</span> <span class="n">col_rel2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">any_rel</span> <span class="o">=</span> <span class="n">any_rel</span> <span class="ow">or</span> <span class="n">row_rel1</span> <span class="ow">or</span> <span class="n">col_rel1</span> <span class="ow">or</span> <span class="n">row_rel2</span> <span class="ow">or</span> <span class="n">col_rel2</span>
            <span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span> <span class="o">=</span> <span class="n">get_externsheet_local_range</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">refx</span><span class="p">,</span> <span class="n">blah</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">|=</span> <span class="n">shx1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">shx1</span><span class="p">,</span> <span class="n">shx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowx1</span><span class="p">,</span> <span class="n">rowx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx1</span><span class="p">,</span> <span class="n">colx2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">spush</span><span class="p">([</span><span class="n">coords</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mh">0x19</span><span class="p">:</span> <span class="c"># tNameX</span>
            <span class="n">refx</span><span class="p">,</span> <span class="n">namex</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;   refx=</span><span class="si">%d</span><span class="s"> namex=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">namex</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">error_opcodes</span><span class="p">:</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blah</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;FORMULA: /// Not handled yet: t&quot;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">any_err</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;**** Dud size; exiting ****&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;End of formula. any_rel=</span><span class="si">%d</span><span class="s"> any_err=</span><span class="si">%d</span><span class="s"> stack=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="ow">not</span> <span class="ow">not</span> <span class="n">any_rel</span><span class="p">,</span> <span class="n">any_err</span><span class="p">,</span> <span class="n">stack</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** Stack has unprocessed args&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

<span class="c"># === Some helper functions for displaying cell references ===</span>

<span class="c"># I&#39;m aware of only one possibility of a sheet-relative component in</span>
<span class="c"># a reference: a 2D reference located in the &quot;current sheet&quot;.</span>
<span class="c"># xlrd stores this internally with bounds of (0, 1, ...) and</span>
<span class="c"># relative flags of (1, 1, ...). These functions display the</span>
<span class="c"># sheet component as empty, just like Excel etc.</span>
</div>
<span class="k">def</span> <span class="nf">rownamerel</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">rowxrel</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c"># if no base rowx is provided, we have to return r1c1</span>
    <span class="k">if</span> <span class="n">browx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rowxrel</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;R</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;$</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rowx</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;R[</span><span class="si">%d</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="n">rowx</span>
        <span class="k">return</span> <span class="s">&quot;R&quot;</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">browx</span> <span class="o">+</span> <span class="n">rowx</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65536</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">colnamerel</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="n">colxrel</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c"># if no base colx is provided, we have to return r1c1</span>
    <span class="k">if</span> <span class="n">bcolx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colxrel</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;C</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;$&quot;</span> <span class="o">+</span> <span class="n">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colx</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;C[</span><span class="si">%d</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="n">colx</span>
        <span class="k">return</span> <span class="s">&quot;C&quot;</span>
    <span class="k">return</span> <span class="n">colname</span><span class="p">((</span><span class="n">bcolx</span> <span class="o">+</span> <span class="n">colx</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Utility function: (5, 7) =&gt; &#39;H6&#39;</span>
<div class="viewcode-block" id="cellname"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.cellname">[docs]</a><span class="k">def</span> <span class="nf">cellname</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; (5, 7) =&gt; &#39;H6&#39; &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">),</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Utility function: (5, 7) =&gt; &#39;$H$6&#39;</span></div>
<div class="viewcode-block" id="cellnameabs"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.cellnameabs">[docs]</a><span class="k">def</span> <span class="nf">cellnameabs</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; (5, 7) =&gt; &#39;$H$6&#39; or &#39;R8C6&#39;&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;R</span><span class="si">%d</span><span class="s">C</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;$</span><span class="si">%s</span><span class="s">$</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">),</span> <span class="n">rowx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">cellnamerel</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">rowxrel</span><span class="p">,</span> <span class="n">colxrel</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rowxrel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">colxrel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cellnameabs</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rowxrel</span> <span class="ow">and</span> <span class="n">browx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">colxrel</span> <span class="ow">and</span> <span class="n">bcolx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c"># must flip the whole cell into R1C1 mode</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">colnamerel</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="n">colxrel</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rownamerel</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">rowxrel</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">r</span>

<span class="c">##</span>
<span class="c"># Utility function: 7 =&gt; &#39;H&#39;, 27 =&gt; &#39;AB&#39;</span>
<div class="viewcode-block" id="colname"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.colname">[docs]</a><span class="k">def</span> <span class="nf">colname</span><span class="p">(</span><span class="n">colx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 7 =&gt; &#39;H&#39;, 27 =&gt; &#39;AB&#39; &quot;&quot;&quot;</span>
    <span class="n">alphabet</span> <span class="o">=</span> <span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    <span class="k">if</span> <span class="n">colx</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xdiv26</span><span class="p">,</span> <span class="n">xmod26</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">xdiv26</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">xmod26</span><span class="p">]</span>
</div>
<span class="k">def</span> <span class="nf">rangename2d</span><span class="p">(</span><span class="n">rlo</span><span class="p">,</span> <span class="n">rhi</span><span class="p">,</span> <span class="n">clo</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; (5, 20, 7, 10) =&gt; &#39;$H$6:$J$20&#39; &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">r1c1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">rhi</span> <span class="o">==</span> <span class="n">rlo</span><span class="o">+</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">==</span> <span class="n">clo</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cellnameabs</span><span class="p">(</span><span class="n">rlo</span><span class="p">,</span> <span class="n">clo</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cellnameabs</span><span class="p">(</span><span class="n">rlo</span><span class="p">,</span> <span class="n">clo</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">),</span> <span class="n">cellnameabs</span><span class="p">(</span><span class="n">rhi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">chi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">rangename2drel</span><span class="p">(</span><span class="n">rlo_rhi_clo_chi</span><span class="p">,</span> <span class="n">rlorel_rhirel_clorel_chirel</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">rlo</span><span class="p">,</span> <span class="n">rhi</span><span class="p">,</span> <span class="n">clo</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">rlo_rhi_clo_chi</span>
    <span class="n">rlorel</span><span class="p">,</span> <span class="n">rhirel</span><span class="p">,</span> <span class="n">clorel</span><span class="p">,</span> <span class="n">chirel</span> <span class="o">=</span> <span class="n">rlorel_rhirel_clorel_chirel</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rlorel</span> <span class="ow">or</span> <span class="n">rhirel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">browx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clorel</span> <span class="ow">or</span> <span class="n">chirel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bcolx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">cellnamerel</span><span class="p">(</span><span class="n">rlo</span><span class="p">,</span>   <span class="n">clo</span><span class="p">,</span>   <span class="n">rlorel</span><span class="p">,</span> <span class="n">clorel</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">),</span>
        <span class="n">cellnamerel</span><span class="p">(</span><span class="n">rhi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">chi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rhirel</span><span class="p">,</span> <span class="n">chirel</span><span class="p">,</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
        <span class="p">)</span>
<span class="c">##</span>
<span class="c"># Utility function:</span>
<span class="c"># &lt;br /&gt; Ref3D((1, 4, 5, 20, 7, 10)) =&gt; &#39;Sheet2:Sheet3!$H$6:$J$20&#39;</span>
<div class="viewcode-block" id="rangename3d"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.rangename3d">[docs]</a><span class="k">def</span> <span class="nf">rangename3d</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ref3D(1, 4, 5, 20, 7, 10) =&gt; &#39;Sheet2:Sheet3!$H$6:$J$20&#39;</span>
<span class="sd">        (assuming Excel&#39;s default sheetnames) &quot;&quot;&quot;</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">coords</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">sheetrange</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="o">*</span><span class="n">coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">rangename2d</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>

<span class="c">##</span>
<span class="c"># Utility function:</span>
<span class="c"># &lt;br /&gt; Ref3D(coords=(0, 1, -32, -22, -13, 13), relflags=(0, 0, 1, 1, 1, 1))</span>
<span class="c"># R1C1 mode =&gt; &#39;Sheet1!R[-32]C[-13]:R[-23]C[12]&#39;</span>
<span class="c"># A1 mode =&gt; depends on base cell (browx, bcolx)</span></div>
<div class="viewcode-block" id="rangename3drel"><a class="viewcode-back" href="../../xlrd.html#xlrd.formula.rangename3drel">[docs]</a><span class="k">def</span> <span class="nf">rangename3drel</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">ref3d</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">coords</span>
    <span class="n">relflags</span> <span class="o">=</span> <span class="n">ref3d</span><span class="o">.</span><span class="n">relflags</span>
    <span class="n">shdesc</span> <span class="o">=</span> <span class="n">sheetrangerel</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">relflags</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">rngdesc</span> <span class="o">=</span> <span class="n">rangename2drel</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">relflags</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">browx</span><span class="p">,</span> <span class="n">bcolx</span><span class="p">,</span> <span class="n">r1c1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shdesc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rngdesc</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">!</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">shdesc</span><span class="p">,</span> <span class="n">rngdesc</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">quotedsheetname</span><span class="p">(</span><span class="n">shnames</span><span class="p">,</span> <span class="n">shx</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">shx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shname</span> <span class="o">=</span> <span class="n">shnames</span><span class="p">[</span><span class="n">shx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shname</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s">&quot;?internal; any sheet?&quot;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s">&quot;internal; deleted sheet&quot;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="s">&quot;internal; macro sheet&quot;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="s">&quot;&lt;&lt;external&gt;&gt;&quot;</span><span class="p">,</span>
            <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shx</span><span class="p">,</span> <span class="s">&quot;?error </span><span class="si">%d</span><span class="s">?&quot;</span> <span class="o">%</span> <span class="n">shx</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">shname</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">shname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
    <span class="k">if</span> <span class="s">&quot; &quot;</span> <span class="ow">in</span> <span class="n">shname</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">shname</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
    <span class="k">return</span> <span class="n">shname</span>

<span class="k">def</span> <span class="nf">sheetrange</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">slo</span><span class="p">,</span> <span class="n">shi</span><span class="p">):</span>
    <span class="n">shnames</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">()</span>
    <span class="n">shdesc</span> <span class="o">=</span> <span class="n">quotedsheetname</span><span class="p">(</span><span class="n">shnames</span><span class="p">,</span> <span class="n">slo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">slo</span> <span class="o">!=</span> <span class="n">shi</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">shdesc</span> <span class="o">+=</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">quotedsheetname</span><span class="p">(</span><span class="n">shnames</span><span class="p">,</span> <span class="n">shi</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shdesc</span>

<span class="k">def</span> <span class="nf">sheetrangerel</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">srange</span><span class="p">,</span> <span class="n">srangerel</span><span class="p">):</span>
    <span class="n">slo</span><span class="p">,</span> <span class="n">shi</span> <span class="o">=</span> <span class="n">srange</span>
    <span class="n">slorel</span><span class="p">,</span> <span class="n">shirel</span> <span class="o">=</span> <span class="n">srangerel</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">slorel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">shirel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sheetrange</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">slo</span><span class="p">,</span> <span class="n">shi</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">slo</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">shi</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">slorel</span> <span class="ow">and</span> <span class="n">shirel</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span>

<span class="c"># ==============================================================</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../xlrd.html">xlrd</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>