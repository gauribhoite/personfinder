<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xlrd.sheet &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="xlrd" href="../xlrd.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xlrd.sheet</h1><div class="highlight"><pre>
<span class="c"># -*- coding: cp1252 -*-</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt; Portions copyright Â© 2005-2013 Stephen John Machin, Lingfo Pty Ltd&lt;/p&gt;</span>
<span class="c"># &lt;p&gt;This module is part of the xlrd package, which is released under a BSD-style licence.&lt;/p&gt;</span>
<span class="c">##</span>

<span class="c"># 2010-04-25 SJM fix zoom factors cooking logic</span>
<span class="c"># 2010-04-15 CW  r4253 fix zoom factors cooking logic</span>
<span class="c"># 2010-04-09 CW  r4248 add a flag so xlutils knows whether or not to write a PANE record</span>
<span class="c"># 2010-03-29 SJM Fixed bug in adding new empty rows in put_cell_ragged</span>
<span class="c"># 2010-03-28 SJM Tailored put_cell method for each of ragged_rows=False (fixed speed regression) and =True (faster)</span>
<span class="c"># 2010-03-25 CW  r4236 Slight refactoring to remove method calls</span>
<span class="c"># 2010-03-25 CW  r4235 Collapse expand_cells into put_cell and enhance the raggedness. This should save even more memory!</span>
<span class="c"># 2010-03-25 CW  r4234 remove duplicate chunks for extend_cells; refactor to remove put_number_cell and put_blank_cell which essentially duplicated the code of put_cell</span>
<span class="c"># 2010-03-10 SJM r4222 Added reading of the PANE record.</span>
<span class="c"># 2010-03-10 SJM r4221 Preliminary work on &quot;cooked&quot; mag factors; use at own peril</span>
<span class="c"># 2010-03-01 SJM Reading SCL record</span>
<span class="c"># 2010-03-01 SJM Added ragged_rows functionality</span>
<span class="c"># 2009-08-23 SJM Reduced CPU time taken by parsing MULBLANK records.</span>
<span class="c"># 2009-08-18 SJM Used __slots__ and sharing to reduce memory consumed by Rowinfo instances</span>
<span class="c"># 2009-05-31 SJM Fixed problem with no CODEPAGE record on extremely minimal BIFF2.x 3rd-party file</span>
<span class="c"># 2009-04-27 SJM Integrated on_demand patch by Armando Serrano Lombillo</span>
<span class="c"># 2008-02-09 SJM Excel 2.0: build XFs on the fly from cell attributes</span>
<span class="c"># 2007-12-04 SJM Added support for Excel 2.x (BIFF2) files.</span>
<span class="c"># 2007-10-11 SJM Added missing entry for blank cell type to ctype_text</span>
<span class="c"># 2007-07-11 SJM Allow for BIFF2/3-style FORMAT record in BIFF4/8 file</span>
<span class="c"># 2007-04-22 SJM Remove experimental &quot;trimming&quot; facility.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">unpack</span><span class="p">,</span> <span class="n">calcsize</span>
<span class="kn">from</span> <span class="nn">.biffh</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.timemachine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.formula</span> <span class="kn">import</span> <span class="n">dump_formula</span><span class="p">,</span> <span class="n">decompile_formula</span><span class="p">,</span> <span class="n">rangename2d</span><span class="p">,</span> <span class="n">FMLA_TYPE_CELL</span><span class="p">,</span> <span class="n">FMLA_TYPE_SHARED</span>
<span class="kn">from</span> <span class="nn">.formatting</span> <span class="kn">import</span> <span class="n">nearest_colour_index</span><span class="p">,</span> <span class="n">Format</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">OBJ_MSO_DEBUG</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">_WINDOW2_options</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># Attribute names and initial values to use in case</span>
    <span class="c"># a WINDOW2 record is not written.</span>
    <span class="p">(</span><span class="s">&quot;show_formulas&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;show_grid_lines&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;show_sheet_headers&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;panes_are_frozen&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;show_zero_values&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;automatic_grid_line_colour&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;columns_from_right_to_left&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;show_outline_symbols&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;remove_splits_if_pane_freeze_is_removed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="c"># Multiple sheets can be selected, but only one can be active</span>
    <span class="c"># (hold down Ctrl and click multiple tabs in the file in OOo)</span>
    <span class="p">(</span><span class="s">&quot;sheet_selected&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="c"># &quot;sheet_visible&quot; should really be called &quot;sheet_active&quot;</span>
    <span class="c"># and is 1 when this sheet is the sheet displayed when the file</span>
    <span class="c"># is open. More than likely only one sheet should ever be set as</span>
    <span class="c"># visible.</span>
    <span class="c"># This would correspond to the Book&#39;s sheet_active attribute, but</span>
    <span class="c"># that doesn&#39;t exist as WINDOW1 records aren&#39;t currently processed.</span>
    <span class="c"># The real thing is the visibility attribute from the BOUNDSHEET record.</span>
    <span class="p">(</span><span class="s">&quot;sheet_visible&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;show_in_page_break_preview&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;Contains the data for one worksheet.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;In the cell access functions, &quot;rowx&quot; is a row index, counting from zero, and &quot;colx&quot; is a</span>
<span class="c"># column index, counting from zero.</span>
<span class="c"># Negative values for row/column indexes and slice positions are supported in the expected fashion.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;For information about cell types and cell values, refer to the documentation of the {@link #Cell} class.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;WARNING: You don&#39;t call this class yourself. You access Sheet objects via the Book object that</span>
<span class="c"># was returned when you called xlrd.open_workbook(&quot;myfile.xls&quot;).&lt;/p&gt;</span>


<div class="viewcode-block" id="Sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet">[docs]</a><span class="k">class</span> <span class="nc">Sheet</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># Name of sheet.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c">##</span>
    <span class="c"># A reference to the Book object to which this sheet belongs.</span>
    <span class="c"># Example usage: some_sheet.book.datemode</span>
    <span class="n">book</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c">##</span>
    <span class="c"># Number of rows in sheet. A row index is in range(thesheet.nrows).</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Nominal number of columns in sheet. It is 1 + the maximum column index</span>
    <span class="c"># found, ignoring trailing empty cells. See also open_workbook(ragged_rows=?)</span>
    <span class="c"># and Sheet.{@link #Sheet.row_len}(row_index).</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># The map from a column index to a {@link #Colinfo} object. Often there is an entry</span>
    <span class="c"># in COLINFO records for all column indexes in range(257).</span>
    <span class="c"># Note that xlrd ignores the entry for the non-existent</span>
    <span class="c"># 257th column. On the other hand, there may be no entry for unused columns.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1. Populated only if open_workbook(formatting_info=True).</span>
    <span class="n">colinfo_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># The map from a row index to a {@link #Rowinfo} object. Note that it is possible</span>
    <span class="c"># to have missing entries -- at least one source of XLS files doesn&#39;t</span>
    <span class="c"># bother writing ROW records.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1. Populated only if open_workbook(formatting_info=True).</span>
    <span class="n">rowinfo_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># List of address ranges of cells containing column labels.</span>
    <span class="c"># These are set up in Excel by Insert &gt; Name &gt; Labels &gt; Columns.</span>
    <span class="c"># &lt;br&gt; -- New in version 0.6.0</span>
    <span class="c"># &lt;br&gt;How to deconstruct the list:</span>
    <span class="c"># &lt;pre&gt;</span>
    <span class="c"># for crange in thesheet.col_label_ranges:</span>
    <span class="c">#     rlo, rhi, clo, chi = crange</span>
    <span class="c">#     for rx in xrange(rlo, rhi):</span>
    <span class="c">#         for cx in xrange(clo, chi):</span>
    <span class="c">#             print &quot;Column label at (rowx=%d, colx=%d) is %r&quot; \</span>
    <span class="c">#                 (rx, cx, thesheet.cell_value(rx, cx))</span>
    <span class="c"># &lt;/pre&gt;</span>
    <span class="n">col_label_ranges</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># List of address ranges of cells containing row labels.</span>
    <span class="c"># For more details, see &lt;i&gt;col_label_ranges&lt;/i&gt; above.</span>
    <span class="c"># &lt;br&gt; -- New in version 0.6.0</span>
    <span class="n">row_label_ranges</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># List of address ranges of cells which have been merged.</span>
    <span class="c"># These are set up in Excel by Format &gt; Cells &gt; Alignment, then ticking</span>
    <span class="c"># the &quot;Merge cells&quot; box.</span>
    <span class="c"># &lt;br&gt; -- New in version 0.6.1. Extracted only if open_workbook(formatting_info=True).</span>
    <span class="c"># &lt;br&gt;How to deconstruct the list:</span>
    <span class="c"># &lt;pre&gt;</span>
    <span class="c"># for crange in thesheet.merged_cells:</span>
    <span class="c">#     rlo, rhi, clo, chi = crange</span>
    <span class="c">#     for rowx in xrange(rlo, rhi):</span>
    <span class="c">#         for colx in xrange(clo, chi):</span>
    <span class="c">#             # cell (rlo, clo) (the top left one) will carry the data</span>
    <span class="c">#             # and formatting info; the remainder will be recorded as</span>
    <span class="c">#             # blank cells, but a renderer will apply the formatting info</span>
    <span class="c">#             # for the top left cell (e.g. border, pattern) to all cells in</span>
    <span class="c">#             # the range.</span>
    <span class="c"># &lt;/pre&gt;</span>
    <span class="n">merged_cells</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c">##</span>
    <span class="c"># Mapping of (rowx, colx) to list of (offset, font_index) tuples. The offset</span>
    <span class="c"># defines where in the string the font begins to be used.</span>
    <span class="c"># Offsets are expected to be in ascending order.</span>
    <span class="c"># If the first offset is not zero, the meaning is that the cell&#39;s XF&#39;s font should</span>
    <span class="c"># be used from offset 0.</span>
    <span class="c"># &lt;br /&gt; This is a sparse mapping. There is no entry for cells that are not formatted with  </span>
    <span class="c"># rich text.</span>
    <span class="c"># &lt;br&gt;How to use:</span>
    <span class="c"># &lt;pre&gt;</span>
    <span class="c"># runlist = thesheet.rich_text_runlist_map.get((rowx, colx))</span>
    <span class="c"># if runlist:</span>
    <span class="c">#     for offset, font_index in runlist:</span>
    <span class="c">#         # do work here.</span>
    <span class="c">#         pass</span>
    <span class="c"># &lt;/pre&gt;</span>
    <span class="c"># Populated only if open_workbook(formatting_info=True).</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.7.2.</span>
    <span class="c"># &lt;br /&gt; &amp;nbsp;</span>
    <span class="n">rich_text_runlist_map</span> <span class="o">=</span> <span class="p">{}</span>    

    <span class="c">##</span>
    <span class="c"># Default column width from DEFCOLWIDTH record, else None.</span>
    <span class="c"># From the OOo docs:&lt;br /&gt;</span>
    <span class="c"># &quot;&quot;&quot;Column width in characters, using the width of the zero character</span>
    <span class="c"># from default font (first FONT record in the file). Excel adds some</span>
    <span class="c"># extra space to the default width, depending on the default font and</span>
    <span class="c"># default font size. The algorithm how to exactly calculate the resulting</span>
    <span class="c"># column width is not known.&lt;br /&gt;</span>
    <span class="c"># Example: The default width of 8 set in this record results in a column</span>
    <span class="c"># width of 8.43 using Arial font with a size of 10 points.&quot;&quot;&quot;&lt;br /&gt;</span>
    <span class="c"># For the default hierarchy, refer to the {@link #Colinfo} class.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">defcolwidth</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default column width from STANDARDWIDTH record, else None.</span>
    <span class="c"># From the OOo docs:&lt;br /&gt;</span>
    <span class="c"># &quot;&quot;&quot;Default width of the columns in 1/256 of the width of the zero</span>
    <span class="c"># character, using default font (first FONT record in the file).&quot;&quot;&quot;&lt;br /&gt;</span>
    <span class="c"># For the default hierarchy, refer to the {@link #Colinfo} class.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="n">standardwidth</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default value to be used for a row if there is</span>
    <span class="c"># no ROW record for that row.</span>
    <span class="c"># From the &lt;i&gt;optional&lt;/i&gt; DEFAULTROWHEIGHT record.</span>
    <span class="n">default_row_height</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default value to be used for a row if there is</span>
    <span class="c"># no ROW record for that row.</span>
    <span class="c"># From the &lt;i&gt;optional&lt;/i&gt; DEFAULTROWHEIGHT record.</span>
    <span class="n">default_row_height_mismatch</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default value to be used for a row if there is</span>
    <span class="c"># no ROW record for that row.</span>
    <span class="c"># From the &lt;i&gt;optional&lt;/i&gt; DEFAULTROWHEIGHT record.</span>
    <span class="n">default_row_hidden</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default value to be used for a row if there is</span>
    <span class="c"># no ROW record for that row.</span>
    <span class="c"># From the &lt;i&gt;optional&lt;/i&gt; DEFAULTROWHEIGHT record.</span>
    <span class="n">default_additional_space_above</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Default value to be used for a row if there is</span>
    <span class="c"># no ROW record for that row.</span>
    <span class="c"># From the &lt;i&gt;optional&lt;/i&gt; DEFAULTROWHEIGHT record.</span>
    <span class="n">default_additional_space_below</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##</span>
    <span class="c"># Visibility of the sheet. 0 = visible, 1 = hidden (can be unhidden</span>
    <span class="c"># by user -- Format/Sheet/Unhide), 2 = &quot;very hidden&quot; (can be unhidden</span>
    <span class="c"># only by VBA macro).</span>
    <span class="n">visibility</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># A 256-element tuple corresponding to the contents of the GCW record for this sheet.</span>
    <span class="c"># If no such record, treat as all bits zero.</span>
    <span class="c"># Applies to BIFF4-7 only. See docs of the {@link #Colinfo} class for discussion.</span>
    <span class="n">gcw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">256</span>

    <span class="c">##</span>
    <span class="c"># &lt;p&gt;A list of {@link #Hyperlink} objects corresponding to HLINK records found</span>
    <span class="c"># in the worksheet.&lt;br /&gt;-- New in version 0.7.2 &lt;/p&gt;</span>
    <span class="n">hyperlink_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># &lt;p&gt;A sparse mapping from (rowx, colx) to an item in {@link #Sheet.hyperlink_list}.</span>
    <span class="c"># Cells not covered by a hyperlink are not mapped.</span>
    <span class="c"># It is possible using the Excel UI to set up a hyperlink that </span>
    <span class="c"># covers a larger-than-1x1 rectangle of cells.</span>
    <span class="c"># Hyperlink rectangles may overlap (Excel doesn&#39;t check).</span>
    <span class="c"># When a multiply-covered cell is clicked on, the hyperlink that is activated</span>
    <span class="c"># (and the one that is mapped here) is the last in hyperlink_list.</span>
    <span class="c"># &lt;br /&gt;-- New in version 0.7.2 &lt;/p&gt;</span>
    <span class="n">hyperlink_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##</span>
    <span class="c"># &lt;p&gt;A sparse mapping from (rowx, colx) to a {@link #Note} object.</span>
    <span class="c"># Cells not containing a note (&quot;comment&quot;) are not mapped.</span>
    <span class="c"># &lt;br /&gt;-- New in version 0.7.2 &lt;/p&gt;</span>
    <span class="n">cell_note_map</span> <span class="o">=</span> <span class="p">{}</span>    
    
    <span class="c">##</span>
    <span class="c"># Number of columns in left pane (frozen panes; for split panes, see comments below in code)</span>
    <span class="n">vert_split_pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Number of rows in top pane (frozen panes; for split panes, see comments below in code)</span>
    <span class="n">horz_split_pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Index of first visible row in bottom frozen/split pane</span>
    <span class="n">horz_split_first_visible</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Index of first visible column in right frozen/split pane</span>
    <span class="n">vert_split_first_visible</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Frozen panes: ignore it. Split panes: explanation and diagrams in OOo docs.</span>
    <span class="n">split_active_pane</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># Boolean specifying if a PANE record was present, ignore unless you&#39;re xlutils.copy</span>
    <span class="n">has_pane_record</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">##</span>
    <span class="c"># A list of the horizontal page breaks in this sheet.</span>
    <span class="c"># Breaks are tuples in the form (index of row after break, start col index, end col index).</span>
    <span class="c"># Populated only if open_workbook(formatting_info=True).</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.7.2</span>
    <span class="n">horizontal_page_breaks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># A list of the vertical page breaks in this sheet.</span>
    <span class="c"># Breaks are tuples in the form (index of col after break, start row index, end row index).</span>
    <span class="c"># Populated only if open_workbook(formatting_info=True).</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.7.2</span>
    <span class="n">vertical_page_breaks</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">book</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">biff_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">XL_CELL_EMPTY</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bf</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ragged_rows</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">ragged_rows</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ragged_rows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put_cell_ragged</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put_cell_unragged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># actual, including possibly empty cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxdatarowx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># highest rowx containing a non-empty cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxdatacolx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># highest colx containing a non-empty cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dimnrows</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># as per DIMENSIONS record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dimncols</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defcolwidth</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_row_height</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_row_height_mismatch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_row_hidden</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_additional_space_above</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_additional_space_below</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowinfo_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_label_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_label_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rich_text_runlist_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_page_breaks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertical_page_breaks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_stats</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">_sheet_visibility</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="c"># from BOUNDSHEET record</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">defval</span> <span class="ow">in</span> <span class="n">_WINDOW2_options</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">defval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_rowx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_colx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_index</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_rgb</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># pre-BIFF8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_note_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Values calculated by xlrd to predict the mag factors that</span>
        <span class="c"># will actually be used by Excel to display your worksheet.</span>
        <span class="c"># Pass these values to xlwt when writing XLS files.</span>
        <span class="c"># Warning 1: Behaviour of OOo Calc and Gnumeric has been observed to differ from Excel&#39;s.</span>
        <span class="c"># Warning 2: A value of zero means almost exactly what it says. Your sheet will be</span>
        <span class="c"># displayed as a very tiny speck on the screen. xlwt will reject attempts to set</span>
        <span class="c"># a mag_factor that is not (10 &lt;= mag_factor &lt;= 400).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooked_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooked_normal_view_mag_factor</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="c"># Values (if any) actually stored on the XLS file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># from WINDOW2 record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># from WINDOW2 record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># from SCL record</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ixfe</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># BIFF2 only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_attr_to_xfx</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># BIFF2.0 only</span>

        <span class="c">#### Don&#39;t initialise this here, use class attribute initialisation.</span>
        <span class="c">#### self.gcw = (0, ) * 256 ####</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span> <span class="o">=</span> <span class="mi">65536</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span> <span class="o">=</span> <span class="mi">16384</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_cols</span> <span class="o">=</span> <span class="mi">256</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># self._put_cell_exceptions = 0</span>
        <span class="c"># self._put_cell_row_widenings = 0</span>
        <span class="c"># self._put_cell_rows_appended = 0</span>
        <span class="c"># self._put_cell_cells_appended = 0</span>


    <span class="c">##</span>
    <span class="c"># {@link #Cell} object in the given row and column.</span>
<div class="viewcode-block" id="Sheet.cell"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.cell">[docs]</a>    <span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
            <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_xf_index</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xfx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">Cell</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">],</span>
            <span class="n">xfx</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Value of the cell in the given row and column.</span></div>
<div class="viewcode-block" id="Sheet.cell_value"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.cell_value">[docs]</a>    <span class="k">def</span> <span class="nf">cell_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Type of the cell in the given row and column.</span>
    <span class="c"># Refer to the documentation of the {@link #Cell} class.</span></div>
<div class="viewcode-block" id="Sheet.cell_type"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.cell_type">[docs]</a>    <span class="k">def</span> <span class="nf">cell_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># XF index of the cell in the given row and column.</span>
    <span class="c"># This is an index into Book.{@link #Book.xf_list}.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span></div>
<div class="viewcode-block" id="Sheet.cell_xf_index"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.cell_xf_index">[docs]</a>    <span class="k">def</span> <span class="nf">cell_xf_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_fmt_info</span><span class="p">()</span>
        <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xfx</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">xfx</span>
        <span class="c"># Check for a row xf_index</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowinfo_map</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span><span class="o">.</span><span class="n">xf_index</span>
            <span class="k">if</span> <span class="n">xfx</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">xfx</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># Check for a column xf_index</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span><span class="o">.</span><span class="n">xf_index</span>
            <span class="k">if</span> <span class="n">xfx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">xfx</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">xfx</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c"># If all else fails, 15 is used as hardwired global default xf_index.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_stats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">15</span>

    <span class="c">##</span>
    <span class="c"># Returns the effective number of cells in the given row. For use with</span>
    <span class="c"># open_workbook(ragged_rows=True) which is likely to produce rows</span>
    <span class="c"># with fewer than {@link #Sheet.ncols} cells.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.7.2</span></div>
<div class="viewcode-block" id="Sheet.row_len"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.row_len">[docs]</a>    <span class="k">def</span> <span class="nf">row_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">])</span>

    <span class="c">##</span>
    <span class="c"># Returns a sequence of the {@link #Cell} objects in the given row.</span></div>
<div class="viewcode-block" id="Sheet.row"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.row">[docs]</a>    <span class="k">def</span> <span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">]))</span>
            <span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the types</span>
    <span class="c"># of the cells in the given row.</span></div>
<div class="viewcode-block" id="Sheet.row_types"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.row_types">[docs]</a>    <span class="k">def</span> <span class="nf">row_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">start_colx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_colx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">end_colx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">start_colx</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">start_colx</span><span class="p">:</span><span class="n">end_colx</span><span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the values</span>
    <span class="c"># of the cells in the given row.</span></div>
<div class="viewcode-block" id="Sheet.row_values"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.row_values">[docs]</a>    <span class="k">def</span> <span class="nf">row_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">start_colx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_colx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">end_colx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">start_colx</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">start_colx</span><span class="p">:</span><span class="n">end_colx</span><span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the {@link #Cell} objects in the given row.</span></div>
<div class="viewcode-block" id="Sheet.row_slice"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.row_slice">[docs]</a>    <span class="k">def</span> <span class="nf">row_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">start_colx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_colx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">start_colx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_colx</span> <span class="o">+=</span> <span class="n">nc</span>
            <span class="k">if</span> <span class="n">start_colx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start_colx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">end_colx</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">end_colx</span> <span class="o">&gt;</span> <span class="n">nc</span><span class="p">:</span>
            <span class="n">end_colx</span> <span class="o">=</span> <span class="n">nc</span>
        <span class="k">elif</span> <span class="n">end_colx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_colx</span> <span class="o">+=</span> <span class="n">nc</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start_colx</span><span class="p">,</span> <span class="n">end_colx</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the {@link #Cell} objects in the given column.</span></div>
<div class="viewcode-block" id="Sheet.col_slice"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.col_slice">[docs]</a>    <span class="k">def</span> <span class="nf">col_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">start_rowx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_rowx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
        <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
            <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start_rowx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">end_rowx</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">end_rowx</span> <span class="o">&gt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">=</span> <span class="n">nr</span>
        <span class="k">elif</span> <span class="n">end_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start_rowx</span><span class="p">,</span> <span class="n">end_rowx</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the values of the cells in the given column.</span></div>
<div class="viewcode-block" id="Sheet.col_values"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.col_values">[docs]</a>    <span class="k">def</span> <span class="nf">col_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">start_rowx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_rowx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
        <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
            <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start_rowx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">end_rowx</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">end_rowx</span> <span class="o">&gt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">=</span> <span class="n">nr</span>
        <span class="k">elif</span> <span class="n">end_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start_rowx</span><span class="p">,</span> <span class="n">end_rowx</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a slice of the types of the cells in the given column.</span></div>
<div class="viewcode-block" id="Sheet.col_types"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.col_types">[docs]</a>    <span class="k">def</span> <span class="nf">col_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">start_rowx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_rowx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
        <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
            <span class="k">if</span> <span class="n">start_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start_rowx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">end_rowx</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">end_rowx</span> <span class="o">&gt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">=</span> <span class="n">nr</span>
        <span class="k">elif</span> <span class="n">end_rowx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_rowx</span> <span class="o">+=</span> <span class="n">nr</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start_rowx</span><span class="p">,</span> <span class="n">end_rowx</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Returns a sequence of the {@link #Cell} objects in the given column.</span></div>
<div class="viewcode-block" id="Sheet.col"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.col">[docs]</a>    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_slice</span><span class="p">(</span><span class="n">colx</span><span class="p">)</span>
    <span class="c"># Above two lines just for the docs. Here&#39;s the real McCoy:</span></div>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col_slice</span>

    <span class="c"># === Following methods are used in building the worksheet.</span>
    <span class="c"># === They are not part of the API.</span>

<div class="viewcode-block" id="Sheet.tidy_dimensions"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.tidy_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">tidy_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;tidy_dimensions: nrows=</span><span class="si">%d</span><span class="s"> ncols=</span><span class="si">%d</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">umaxrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span>
            <span class="n">umaxcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_cols</span>
            <span class="k">for</span> <span class="n">crange</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span><span class="p">:</span>
                <span class="n">rlo</span><span class="p">,</span> <span class="n">rhi</span><span class="p">,</span> <span class="n">clo</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">crange</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rlo</span> <span class="o">&lt;</span> <span class="n">rhi</span> <span class="o">&lt;=</span> <span class="n">umaxrows</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">clo</span> <span class="o">&lt;</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="n">umaxcols</span><span class="p">):</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** WARNING: sheet #</span><span class="si">%d</span><span class="s"> (</span><span class="si">%r</span><span class="s">), MERGEDCELLS bad range </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">crange</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rhi</span> <span class="o">&gt;</span> <span class="n">nr</span><span class="p">:</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">rhi</span>
                <span class="k">if</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="n">nc</span><span class="p">:</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">chi</span>
            <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">nc</span>
            <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">:</span>
                <span class="c"># we put one empty cell at (nr-1,0) to make sure</span>
                <span class="c"># we have the right number of rows. The ragged rows</span>
                <span class="c"># will sort out the rest if needed.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">XL_CELL_EMPTY</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span> \
        <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimnrows</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimncols</span><span class="p">):</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;NOTE *** sheet </span><span class="si">%d</span><span class="s"> (</span><span class="si">%r</span><span class="s">): DIMENSIONS R,C = </span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s"> should be </span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dimnrows</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dimncols</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ragged_rows</span><span class="p">:</span>
            <span class="c"># fix ragged rows</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
            <span class="n">s_cell_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span>
            <span class="n">s_cell_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span>
            <span class="n">s_cell_xf_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span>
            <span class="n">s_fmt_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span>
            <span class="c"># for rowx in xrange(self.nrows):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">ubound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ubound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ubound</span><span class="p">):</span>
                <span class="n">trow</span> <span class="o">=</span> <span class="n">s_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span>
                <span class="n">rlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trow</span><span class="p">)</span>
                <span class="n">nextra</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">-</span> <span class="n">rlen</span>
                <span class="k">if</span> <span class="n">nextra</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">s_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">rlen</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nextra</span>
                    <span class="n">trow</span><span class="p">[</span><span class="n">rlen</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">*</span> <span class="n">nextra</span>
                    <span class="k">if</span> <span class="n">s_fmt_info</span><span class="p">:</span>
                        <span class="n">s_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">rlen</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bf</span> <span class="o">*</span> <span class="n">nextra</span>
</div>
<div class="viewcode-block" id="Sheet.put_cell_ragged"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.put_cell_ragged">[docs]</a>    <span class="k">def</span> <span class="nf">put_cell_ragged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># we have a number, so look up the cell type</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xf_index</span><span class="p">]</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">colx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_cols</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rowx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span>
        <span class="n">fmt_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">&lt;</span> <span class="n">nr</span><span class="p">:</span>

                <span class="n">scta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="o">.</span><span class="n">append</span>
                <span class="n">scva</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="o">.</span><span class="n">append</span>
                <span class="n">scxa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="o">.</span><span class="n">append</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span>
                <span class="n">bf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bf</span>
                <span class="k">for</span> <span class="n">_unused</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="n">nr</span><span class="p">):</span>
                    <span class="n">scta</span><span class="p">(</span><span class="n">bt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">scva</span><span class="p">([])</span>
                    <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                        <span class="n">scxa</span><span class="p">(</span><span class="n">bf</span> <span class="o">*</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">nr</span>

            <span class="n">types_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span>
            <span class="n">values_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                <span class="n">fmt_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span>
            <span class="n">ltr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types_row</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">num_empty</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">-</span> <span class="n">ltr</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">num_empty</span><span class="p">:</span>
                <span class="c"># most common case: colx == previous colx + 1</span>
                <span class="c"># self._put_cell_cells_appended += 1</span>
                <span class="n">types_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctype</span><span class="p">)</span>
                <span class="n">values_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                    <span class="n">fmt_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xf_index</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">num_empty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_empty</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c"># self._put_cell_row_widenings += 1</span>
                <span class="c"># types_row.extend(self.bt * num_empty)</span>
                <span class="c"># values_row.extend([&#39;&#39;] * num_empty)</span>
                <span class="c"># if fmt_info:</span>
                <span class="c">#     fmt_row.extend(self.bf * num_empty)</span>
                <span class="n">types_row</span><span class="p">[</span><span class="n">ltr</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">*</span> <span class="n">num_empty</span>
                <span class="n">values_row</span><span class="p">[</span><span class="n">ltr</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_empty</span>
                <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                    <span class="n">fmt_row</span><span class="p">[</span><span class="n">ltr</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bf</span> <span class="o">*</span> <span class="n">num_empty</span>
            <span class="n">types_row</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctype</span>
            <span class="n">values_row</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                <span class="n">fmt_row</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf_index</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;put_cell&quot;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">raise</span>
</div>
<div class="viewcode-block" id="Sheet.put_cell_unragged"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.put_cell_unragged">[docs]</a>    <span class="k">def</span> <span class="nf">put_cell_unragged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># we have a number, so look up the cell type</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xf_index</span><span class="p">]</span>
        <span class="c"># assert 0 &lt;= colx &lt; self.utter_max_cols</span>
        <span class="c"># assert 0 &lt;= rowx &lt; self.utter_max_rows</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf_index</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c"># print &gt;&gt; self.logfile, &quot;put_cell extending&quot;, rowx, colx</span>
            <span class="c"># self.extend_cells(rowx+1, colx+1)</span>
            <span class="c"># self._put_cell_exceptions += 1</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">nc</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_cols</span>
            <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">nr</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span>
            <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">nc</span>
                <span class="c"># The row self._first_full_rowx and all subsequent rows</span>
                <span class="c"># are guaranteed to have length == self.ncols. Thus the</span>
                <span class="c"># &quot;fix ragged rows&quot; section of the tidy_dimensions method</span>
                <span class="c"># doesn&#39;t need to examine them.</span>
                <span class="k">if</span> <span class="n">nr</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">:</span>
                    <span class="c"># cell data is not in non-descending row order *AND*</span>
                    <span class="c"># self.ncols has been bumped up.</span>
                    <span class="c"># This very rare case ruins this optmisation.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
                <span class="k">elif</span> <span class="n">rowx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_first_full_rowx</span> <span class="o">=</span> <span class="n">rowx</span>
            <span class="k">if</span> <span class="n">nr</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">:</span>
                <span class="c"># New cell is in an existing row, so extend that row (if necessary).</span>
                <span class="c"># Note that nr &lt; self.nrows means that the cell data</span>
                <span class="c"># is not in ascending row order!!</span>
                <span class="n">trow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span>
                <span class="n">nextra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">trow</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nextra</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># self._put_cell_row_widenings += 1</span>
                    <span class="n">trow</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">*</span> <span class="n">nextra</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bf</span> <span class="o">*</span> <span class="n">nextra</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nextra</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="o">.</span><span class="n">append</span>
                <span class="n">scva</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="o">.</span><span class="n">append</span>
                <span class="n">scxa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="o">.</span><span class="n">append</span>
                <span class="n">fmt_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span>
                <span class="n">bf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bf</span>
                <span class="k">for</span> <span class="n">_unused</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="n">nr</span><span class="p">):</span>
                    <span class="c"># self._put_cell_rows_appended += 1</span>
                    <span class="n">scta</span><span class="p">(</span><span class="n">bt</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span>
                    <span class="n">scva</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fmt_info</span><span class="p">:</span>
                        <span class="n">scxa</span><span class="p">(</span><span class="n">bf</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">nr</span>
            <span class="c"># === end of code from extend_cells()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_types</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctype</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_values</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cell_xf_indexes</span><span class="p">[</span><span class="n">rowx</span><span class="p">][</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf_index</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;put_cell&quot;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
           <span class="k">print</span><span class="p">(</span><span class="s">&quot;put_cell&quot;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
           <span class="k">raise</span>


    <span class="c"># === Methods after this line neither know nor care about how cells are stored.</span>
</div>
<div class="viewcode-block" id="Sheet.read"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bk</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">rc_stats</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">blah_rows</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">4</span>
        <span class="n">blah_formulas</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">blah</span>
        <span class="n">r1c1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">oldpos</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>
        <span class="n">XL_SHRFMLA_ETC_ETC</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">XL_SHRFMLA</span><span class="p">,</span> <span class="n">XL_ARRAY</span><span class="p">,</span> <span class="n">XL_TABLEOP</span><span class="p">,</span> <span class="n">XL_TABLEOP2</span><span class="p">,</span>
            <span class="n">XL_ARRAY2</span><span class="p">,</span> <span class="n">XL_TABLEOP_B2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">self_put_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put_cell</span>
        <span class="n">local_unpack</span> <span class="o">=</span> <span class="n">unpack</span>
        <span class="n">bk_get_record_parts</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">get_record_parts</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
        <span class="n">fmt_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span>
        <span class="n">do_sst_rich_text</span> <span class="o">=</span> <span class="n">fmt_info</span> <span class="ow">and</span> <span class="n">bk</span><span class="o">.</span><span class="n">_rich_text_runlist_map</span>
        <span class="n">rowinfo_sharing_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">txos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eof_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># if DEBUG: print &quot;SHEET.READ: about to read from position %d&quot; % bk._position</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bk_get_record_parts</span><span class="p">()</span>
            <span class="c"># if rc in rc_stats:</span>
            <span class="c">#     rc_stats[rc] += 1</span>
            <span class="c"># else:</span>
            <span class="c">#     rc_stats[rc] = 1</span>
            <span class="c"># if DEBUG: print &quot;SHEET.READ: op 0x%04x, %d bytes %r&quot; % (rc, data_len, data)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_NUMBER</span><span class="p">:</span>
                <span class="c"># [:14] in following stmt ignores extraneous rubbish at end of record.</span>
                <span class="c"># Sample file testEON-8.xls supplied by Jan Kraus.</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHHd&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
                <span class="c"># if xf_index == 0:</span>
                <span class="c">#     fprintf(self.logfile,</span>
                <span class="c">#         &quot;NUMBER: r=%d c=%d xfx=%d %f\n&quot;, rowx, colx, xf_index, d)</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_LABELSST</span><span class="p">:</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">sstindex</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHHi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="c"># print &quot;LABELSST&quot;, rowx, colx, sstindex, bk._sharedstrings[sstindex]</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">_sharedstrings</span><span class="p">[</span><span class="n">sstindex</span><span class="p">],</span> <span class="n">xf_index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">do_sst_rich_text</span><span class="p">:</span>
                    <span class="n">runlist</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_rich_text_runlist_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sstindex</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">runlist</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rich_text_runlist_map</span><span class="p">[(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">runlist</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_LABEL</span><span class="p">:</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="n">BIFF_FIRST_UNICODE</span><span class="p">:</span>
                    <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">bk</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">(),</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">strg</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_RSTRING</span><span class="p">:</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="n">BIFF_FIRST_UNICODE</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_string_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">bk</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">(),</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">nrt</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">runlist</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_unused</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nrt</span><span class="p">):</span>
                        <span class="n">runlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;BB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">nrt</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">runlist</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_unused</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nrt</span><span class="p">):</span>
                        <span class="n">runlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">]))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
                    <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">strg</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rich_text_runlist_map</span><span class="p">[(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">runlist</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_RK</span><span class="p">:</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">unpack_RK</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_MULRK</span><span class="p">:</span>
                <span class="n">mulrk_row</span><span class="p">,</span> <span class="n">mulrk_first</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">mulrk_last</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">mulrk_first</span><span class="p">,</span> <span class="n">mulrk_last</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">xf_index</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">unpack_RK</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">6</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">mulrk_row</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_ROW</span><span class="p">:</span>
                <span class="c"># Version 0.6.0a3: ROW records are just not worth using (for memory allocation).</span>
                <span class="c"># Version 0.6.1: now used for formatting info.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">bits1</span><span class="p">,</span> <span class="n">bits2</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H4xH4xi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rowx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** NOTE: ROW record has row index </span><span class="si">%d</span><span class="s">; &quot;</span> \
                        <span class="s">&quot;should have 0 &lt;= rowx &lt; </span><span class="si">%d</span><span class="s"> -- record ignored!&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits1</span><span class="p">,</span> <span class="n">bits2</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">rowinfo_sharing_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">rowinfo_sharing_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Rowinfo</span><span class="p">()</span>
                    <span class="c"># Using upkbits() is far too slow on a file</span>
                    <span class="c"># with 30 sheets each with 10K rows :-(</span>
                    <span class="c">#    upkbits(r, bits1, (</span>
                    <span class="c">#        ( 0, 0x7FFF, &#39;height&#39;),</span>
                    <span class="c">#        (15, 0x8000, &#39;has_default_height&#39;),</span>
                    <span class="c">#        ))</span>
                    <span class="c">#    upkbits(r, bits2, (</span>
                    <span class="c">#        ( 0, 0x00000007, &#39;outline_level&#39;),</span>
                    <span class="c">#        ( 4, 0x00000010, &#39;outline_group_starts_ends&#39;),</span>
                    <span class="c">#        ( 5, 0x00000020, &#39;hidden&#39;),</span>
                    <span class="c">#        ( 6, 0x00000040, &#39;height_mismatch&#39;),</span>
                    <span class="c">#        ( 7, 0x00000080, &#39;has_default_xf_index&#39;),</span>
                    <span class="c">#        (16, 0x0FFF0000, &#39;xf_index&#39;),</span>
                    <span class="c">#        (28, 0x10000000, &#39;additional_space_above&#39;),</span>
                    <span class="c">#        (29, 0x20000000, &#39;additional_space_below&#39;),</span>
                    <span class="c">#        ))</span>
                    <span class="c"># So:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">bits1</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">has_default_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits1</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">outline_level</span> <span class="o">=</span> <span class="n">bits2</span> <span class="o">&amp;</span> <span class="mi">7</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">outline_group_starts_ends</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">height_mismatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">has_default_xf_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfff</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">additional_space_above</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">additional_space_below</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&gt;&gt;</span> <span class="mi">29</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">has_default_xf_index</span><span class="p">:</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rowinfo_map</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;**ROW </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah_rows</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;ROW&#39;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">bits1</span><span class="p">,</span> <span class="n">bits2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- sh #</span><span class="si">%d</span><span class="s">, rowx=</span><span class="si">%d</span><span class="s"> ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">rowx</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="ow">in</span> <span class="n">XL_FORMULA_OPCODES</span><span class="p">:</span> <span class="c"># 06, 0206, 0406</span>
                <span class="c"># DEBUG = 1</span>
                <span class="c"># if DEBUG: print &quot;FORMULA: rc: 0x%04x data: %r&quot; % (rc, data)</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">result_str</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH8sH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
                    <span class="n">lenlen</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">tkarr_offset</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="k">elif</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">result_str</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH8sH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
                    <span class="n">lenlen</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">tkarr_offset</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="k">else</span><span class="p">:</span> <span class="c"># BIFF2</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span>  <span class="n">result_str</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3s8sB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
                    <span class="n">xf_index</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
                    <span class="n">lenlen</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">tkarr_offset</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="k">if</span> <span class="n">blah_formulas</span><span class="p">:</span> <span class="c"># testing formula dumper</span>
                    <span class="c">#### XXXX FIXME</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;FORMULA: rowx=</span><span class="si">%d</span><span class="s"> colx=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
                    <span class="n">fmlalen</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">decompile_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">22</span><span class="p">:],</span> <span class="n">fmlalen</span><span class="p">,</span> <span class="n">FMLA_TYPE_CELL</span><span class="p">,</span>
                        <span class="n">browx</span><span class="o">=</span><span class="n">rowx</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="n">colx</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="n">r1c1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result_str</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xFF\xFF</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">first_byte</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">result_str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">first_byte</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c"># need to read next record (STRING)</span>
                        <span class="n">gotstring</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="c"># if flags &amp; 8:</span>
                        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># &quot;flags &amp; 8&quot; applies only to SHRFMLA</span>
                            <span class="c"># actually there&#39;s an optional SHRFMLA or ARRAY etc record to skip over</span>
                            <span class="n">rc2</span><span class="p">,</span> <span class="n">data2_len</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_STRING</span> <span class="ow">or</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_STRING_B2</span><span class="p">:</span>
                                <span class="n">gotstring</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">elif</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_ARRAY</span><span class="p">:</span>
                                <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">,</span> <span class="n">tokslen</span> <span class="o">=</span> \
                                    <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHBBBxxxxxH&quot;</span><span class="p">,</span> <span class="n">data2</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">blah_formulas</span><span class="p">:</span>
                                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;ARRAY: </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                                        <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">)</span>
                                    <span class="c"># dump_formula(bk, data2[14:], tokslen, bv, reldelta=0, blah=1)</span>
                            <span class="k">elif</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_SHRFMLA</span><span class="p">:</span>
                                <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">nfmlas</span><span class="p">,</span> <span class="n">tokslen</span> <span class="o">=</span> \
                                    <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHBBxBH&quot;</span><span class="p">,</span> <span class="n">data2</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">blah_formulas</span><span class="p">:</span>
                                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;SHRFMLA (sub): </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                                        <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">nfmlas</span><span class="p">)</span>
                                    <span class="n">decompile_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">data2</span><span class="p">[</span><span class="mi">10</span><span class="p">:],</span> <span class="n">tokslen</span><span class="p">,</span> <span class="n">FMLA_TYPE_SHARED</span><span class="p">,</span>
                                        <span class="n">blah</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="n">rowx</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="n">colx</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="n">r1c1</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">rc2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">XL_SHRFMLA_ETC_ETC</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span>
                                    <span class="s">&quot;Expected SHRFMLA, ARRAY, TABLEOP* or STRING record; found 0x</span><span class="si">%04x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rc2</span><span class="p">)</span>
                            <span class="c"># if DEBUG: print &quot;gotstring:&quot;, gotstring</span>
                        <span class="c"># now for the STRING record</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">gotstring</span><span class="p">:</span>
                            <span class="n">rc2</span><span class="p">,</span> <span class="n">_unused_len</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">rc2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">XL_STRING</span><span class="p">,</span> <span class="n">XL_STRING_B2</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Expected STRING record; found 0x</span><span class="si">%04x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rc2</span><span class="p">)</span>
                        <span class="c"># if DEBUG: print &quot;STRING: data=%r BIFF=%d cp=%d&quot; % (data2, self.biff_version, bk.encoding)</span>
                        <span class="n">strg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_record_contents</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">strg</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                        <span class="c"># if DEBUG: print &quot;FORMULA strg %r&quot; % strg</span>
                    <span class="k">elif</span> <span class="n">first_byte</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c"># boolean formula result</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">result_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BOOLEAN</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">first_byte</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c"># Error in cell</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">result_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_ERROR</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">first_byte</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="c"># empty ... i.e. empty (zero-length) string, NOT an empty cell.</span>
                        <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;unexpected special case (0x</span><span class="si">%02x</span><span class="s">) in FORMULA&quot;</span> <span class="o">%</span> <span class="n">first_byte</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># it is a number</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;d&#39;</span><span class="p">,</span> <span class="n">result_str</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_BOOLERR</span><span class="p">:</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_err</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHHBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
                <span class="c"># Note OOo Calc 2.0 writes 9-byte BOOLERR records.</span>
                <span class="c"># OOo docs say 8. Excel writes 8.</span>
                <span class="n">cellty</span> <span class="o">=</span> <span class="p">(</span><span class="n">XL_CELL_BOOLEAN</span><span class="p">,</span> <span class="n">XL_CELL_ERROR</span><span class="p">)[</span><span class="n">is_err</span><span class="p">]</span>
                <span class="c"># if DEBUG: print &quot;XL_BOOLERR&quot;, rowx, colx, xf_index, value, is_err</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cellty</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_COLINFO</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Colinfo</span><span class="p">()</span>
                <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">flags</span> \
                    <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHHHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
                <span class="c">#### Colinfo.width is denominated in 256ths of a character,</span>
                <span class="c">#### *not* in characters.</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">first_colx</span> <span class="o">&lt;=</span> <span class="n">last_colx</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">):</span>
                    <span class="c"># Note: 256 instead of 255 is a common mistake.</span>
                    <span class="c"># We silently ignore the non-existing 257th column in that case.</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** NOTE: COLINFO record has first col index </span><span class="si">%d</span><span class="s">, last </span><span class="si">%d</span><span class="s">; &quot;</span> \
                        <span class="s">&quot;should have 0 &lt;= first &lt;= last &lt;= 255 -- record ignored!&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">c</span>
                    <span class="k">continue</span>
                <span class="n">upkbits</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="p">(</span>
                    <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">,</span> <span class="s">&#39;hidden&#39;</span><span class="p">),</span>
                    <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">,</span> <span class="s">&#39;bit1_flag&#39;</span><span class="p">),</span>
                    <span class="c"># *ALL* colinfos created by Excel in &quot;default&quot; cases are 0x0002!!</span>
                    <span class="c"># Maybe it&#39;s &quot;locked&quot; by analogy with XFProtection data.</span>
                    <span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x0700</span><span class="p">,</span> <span class="s">&#39;outline_level&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="s">&#39;collapsed&#39;</span><span class="p">),</span>
                    <span class="p">))</span>
                <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">colx</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span> <span class="k">break</span> <span class="c"># Excel does 0 to 256 inclusive</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="s">&quot;**COL </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">xf_index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;COLINFO sheet #</span><span class="si">%d</span><span class="s"> cols </span><span class="si">%d</span><span class="s">-</span><span class="si">%d</span><span class="s">: wid=</span><span class="si">%d</span><span class="s"> xf_index=</span><span class="si">%d</span><span class="s"> flags=0x</span><span class="si">%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;===&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DEFCOLWIDTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defcolwidth</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;DEFCOLWIDTH&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defcolwidth</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_STANDARDWIDTH</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_len</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*** ERROR *** STANDARDWIDTH&#39;</span><span class="p">,</span> <span class="n">data_len</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;STANDARDWIDTH&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_GCW</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span> <span class="c"># useless w/o COLINFO</span>
                <span class="k">assert</span> <span class="n">data_len</span> <span class="o">==</span> <span class="mi">34</span>
                <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x20\x00</span><span class="s">&quot;</span>
                <span class="n">iguff</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;8i&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">34</span><span class="p">])</span>
                <span class="n">gcw</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">iguff</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                        <span class="n">gcw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">bits</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gcw</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gcw</span><span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">showgcw</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&quot;F &quot;</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">gcw</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;GCW:&quot;</span><span class="p">,</span> <span class="n">showgcw</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_BLANK</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">xf_index</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
                <span class="c"># if 0: print &gt;&gt; self.logfile, &quot;BLANK&quot;, rowx, colx, xf_index</span>
                <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_MULBLANK</span><span class="p">:</span> <span class="c"># 00BE</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">nitems</span> <span class="o">=</span> <span class="n">data_len</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;</span><span class="si">%d</span><span class="s">H&quot;</span> <span class="o">%</span> <span class="n">nitems</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">rowx</span><span class="p">,</span> <span class="n">mul_first</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">mul_last</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># print &gt;&gt; self.logfile, &quot;MULBLANK&quot;, rowx, mul_first, mul_last, data_len, nitems, mul_last + 4 - mul_first</span>
                <span class="k">assert</span> <span class="n">nitems</span> <span class="o">==</span> <span class="n">mul_last</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">mul_first</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">mul_first</span><span class="p">,</span> <span class="n">mul_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DIMENSION</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DIMENSION2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># Four zero bytes after some other record. See github issue 64.</span>
                    <span class="k">continue</span>
                <span class="c"># if data_len == 10:</span>
                <span class="c"># Was crashing on BIFF 4.0 file w/o the two trailing unused bytes.</span>
                <span class="c"># Reported by Ralph Heimburger.</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">dim_tuple</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HxxH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dim_tuple</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;ixxH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dimnrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimncols</span> <span class="o">=</span> <span class="n">dim_tuple</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">xf_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">_xf_epilogue_done</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">xf_epilogue</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;sheet </span><span class="si">%d</span><span class="s">(</span><span class="si">%r</span><span class="s">) DIMENSIONS: ncols=</span><span class="si">%d</span><span class="s"> nrows=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimncols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimnrows</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_HLINK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_hlink</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_QUICKTIP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_quicktip</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_EOF</span><span class="p">:</span>
                <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;SHEET.READ: EOF&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">eof_found</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_OBJ</span><span class="p">:</span>
                <span class="c"># handle SHEET-level objects; note there&#39;s a separate Book.handle_obj</span>
                <span class="n">saved_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_obj</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">saved_obj</span><span class="p">:</span> <span class="n">saved_obj_id</span> <span class="o">=</span> <span class="n">saved_obj</span><span class="o">.</span><span class="n">id</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">saved_obj_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_MSO_DRAWING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_msodrawingetc</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_TXO</span><span class="p">:</span>
                <span class="n">txo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_txo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">txo</span> <span class="ow">and</span> <span class="n">saved_obj_id</span><span class="p">:</span>
                    <span class="n">txos</span><span class="p">[</span><span class="n">saved_obj_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">txo</span>
                    <span class="n">saved_obj_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_NOTE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_note</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">txos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FEAT11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_feat11</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="ow">in</span> <span class="n">bofcodes</span><span class="p">:</span> <span class="c">##### EMBEDDED BOF #####</span>
                <span class="n">version</span><span class="p">,</span> <span class="n">boftype</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">boftype</span> <span class="o">!=</span> <span class="mh">0x20</span><span class="p">:</span> <span class="c"># embedded chart</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** Unexpected embedded BOF (0x</span><span class="si">%04x</span><span class="s">) at offset </span><span class="si">%d</span><span class="s">: version=0x</span><span class="si">%04x</span><span class="s"> type=0x</span><span class="si">%04x</span><span class="s">&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">_position</span> <span class="o">-</span> <span class="n">data_len</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">boftype</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">code</span><span class="p">,</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="n">XL_EOF</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;---&gt; found EOF&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_COUNTRY</span><span class="p">:</span>
                <span class="n">bk</span><span class="o">.</span><span class="n">handle_country</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_LABELRANGES</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_cell_range_address_list_update_pos</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">row_label_ranges</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">addr_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_cell_range_address_list_update_pos</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">col_label_ranges</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">addr_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data_len</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_ARRAY</span><span class="p">:</span>
                <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">,</span> <span class="n">tokslen</span> <span class="o">=</span> \
                    <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHBBBxxxxxH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah_formulas</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;ARRAY:&quot;</span><span class="p">,</span> <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="c"># dump_formula(bk, data[14:], tokslen, bv, reldelta=0, blah=1)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SHRFMLA</span><span class="p">:</span>
                <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">nfmlas</span><span class="p">,</span> <span class="n">tokslen</span> <span class="o">=</span> \
                    <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHBBxBH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">blah_formulas</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;SHRFMLA (main):&quot;</span><span class="p">,</span> <span class="n">row1x</span><span class="p">,</span> <span class="n">rownx</span><span class="p">,</span> <span class="n">col1x</span><span class="p">,</span> <span class="n">colnx</span><span class="p">,</span> <span class="n">nfmlas</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="n">decompile_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:],</span> <span class="n">tokslen</span><span class="p">,</span> <span class="n">FMLA_TYPE_SHARED</span><span class="p">,</span>
                        <span class="n">blah</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">browx</span><span class="o">=</span><span class="n">rowx</span><span class="p">,</span> <span class="n">bcolx</span><span class="o">=</span><span class="n">colx</span><span class="p">,</span> <span class="n">r1c1</span><span class="o">=</span><span class="n">r1c1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_CONDFMT</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">assert</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span>
                <span class="n">num_CFs</span><span class="p">,</span> <span class="n">needs_recalc</span><span class="p">,</span> <span class="n">browx1</span><span class="p">,</span> <span class="n">browx2</span><span class="p">,</span> <span class="n">bcolx1</span><span class="p">,</span> <span class="n">bcolx2</span> <span class="o">=</span> \
                    <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;6H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;</span><span class="se">\n</span><span class="s">*** WARNING: Ignoring CONDFMT (conditional formatting) record</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** in Sheet </span><span class="si">%d</span><span class="s"> (</span><span class="si">%r</span><span class="s">).</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** </span><span class="si">%d</span><span class="s"> CF record(s); needs_recalc_or_redraw = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** Bounding box is </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">num_CFs</span><span class="p">,</span> <span class="n">needs_recalc</span><span class="p">,</span>
                        <span class="n">rangename2d</span><span class="p">(</span><span class="n">browx1</span><span class="p">,</span> <span class="n">browx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bcolx1</span><span class="p">,</span> <span class="n">bcolx2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                        <span class="p">)</span>
                <span class="n">olist</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># updated by the function</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_cell_range_address_list_update_pos</span><span class="p">(</span>
                    <span class="n">olist</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">addr_size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                <span class="c"># print &gt;&gt; self.logfile, repr(result), len(result)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** </span><span class="si">%d</span><span class="s"> individual range(s):</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">olist</span><span class="p">),</span>
                        <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">rangename2d</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">olist</span><span class="p">]),</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_CF</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">cf_type</span><span class="p">,</span> <span class="n">cmp_op</span><span class="p">,</span> <span class="n">sz1</span><span class="p">,</span> <span class="n">sz2</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BBHHi&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
                <span class="n">font_block</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="n">bord_block</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&gt;&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="n">patt_block</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&gt;&gt;</span> <span class="mi">29</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;</span><span class="se">\n</span><span class="s">*** WARNING: Ignoring CF (conditional formatting) sub-record.</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** cf_type=</span><span class="si">%d</span><span class="s">, cmp_op=</span><span class="si">%d</span><span class="s">, sz1=</span><span class="si">%d</span><span class="s">, sz2=</span><span class="si">%d</span><span class="s">, flags=0x</span><span class="si">%08x</span><span class="se">\n</span><span class="s">&quot;</span> \
                        <span class="s">&quot;*** optional data blocks: font=</span><span class="si">%d</span><span class="s">, border=</span><span class="si">%d</span><span class="s">, pattern=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">cf_type</span><span class="p">,</span> <span class="n">cmp_op</span><span class="p">,</span> <span class="n">sz1</span><span class="p">,</span> <span class="n">sz2</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span>
                        <span class="n">font_block</span><span class="p">,</span> <span class="n">bord_block</span><span class="p">,</span> <span class="n">patt_block</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="c"># hex_char_dump(data, 0, data_len, fout=self.logfile)</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">12</span>
                <span class="k">if</span> <span class="n">font_block</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">font_height</span><span class="p">,</span> <span class="n">font_options</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">escapement</span><span class="p">,</span> <span class="n">underline</span><span class="p">,</span>
                    <span class="n">font_colour_index</span><span class="p">,</span> <span class="n">two_bits</span><span class="p">,</span> <span class="n">font_esc</span><span class="p">,</span> <span class="n">font_underl</span><span class="p">)</span> <span class="o">=</span> \
                    <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;64x i i H H B 3x i 4x i i i 18x&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">118</span><span class="p">])</span>
                    <span class="n">font_style</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_bits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">posture</span> <span class="o">=</span> <span class="p">(</span><span class="n">font_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">font_canc</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_bits</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="n">cancellation</span> <span class="o">=</span> <span class="p">(</span><span class="n">font_options</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="s">&quot;*** Font info: height=</span><span class="si">%d</span><span class="s">, weight=</span><span class="si">%d</span><span class="s">, escapement=</span><span class="si">%d</span><span class="s">,</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;*** underline=</span><span class="si">%d</span><span class="s">, colour_index=</span><span class="si">%d</span><span class="s">, esc=</span><span class="si">%d</span><span class="s">, underl=</span><span class="si">%d</span><span class="s">,</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;*** style=</span><span class="si">%d</span><span class="s">, posture=</span><span class="si">%d</span><span class="s">, canc=</span><span class="si">%d</span><span class="s">, cancellation=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                            <span class="n">font_height</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">escapement</span><span class="p">,</span> <span class="n">underline</span><span class="p">,</span>
                            <span class="n">font_colour_index</span><span class="p">,</span> <span class="n">font_esc</span><span class="p">,</span> <span class="n">font_underl</span><span class="p">,</span>
                            <span class="n">font_style</span><span class="p">,</span> <span class="n">posture</span><span class="p">,</span> <span class="n">font_canc</span><span class="p">,</span> <span class="n">cancellation</span><span class="p">,</span>
                            <span class="p">)</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">118</span>
                <span class="k">if</span> <span class="n">bord_block</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">patt_block</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="n">fmla1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">sz1</span><span class="p">]</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz1</span>
                <span class="k">if</span> <span class="n">blah</span> <span class="ow">and</span> <span class="n">sz1</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** formula 1:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">dump_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">fmla1</span><span class="p">,</span> <span class="n">sz1</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fmla2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">sz2</span><span class="p">]</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="n">sz2</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data_len</span>
                <span class="k">if</span> <span class="n">blah</span> <span class="ow">and</span> <span class="n">sz2</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** formula 2:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">dump_formula</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">fmla2</span><span class="p">,</span> <span class="n">sz2</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">reldelta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blah</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DEFAULTROWHEIGHT</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_len</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">bits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_row_height</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">data_len</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">default_row_height</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** WARNING: DEFAULTROWHEIGHT record len is 2, &quot;</span> \
                        <span class="s">&quot;should be 4; assuming BIFF2 format</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;*** WARNING: DEFAULTROWHEIGHT record len is </span><span class="si">%d</span><span class="s">, &quot;</span> \
                        <span class="s">&quot;should be 4; ignoring this record</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">data_len</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_row_height_mismatch</span> <span class="o">=</span> <span class="n">bits</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_row_hidden</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_additional_space_above</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_additional_space_below</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_MERGEDCELLS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">unpack_cell_range_address_list_update_pos</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bv</span><span class="p">,</span> <span class="n">addr_size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;MERGEDCELLS: </span><span class="si">%d</span><span class="s"> ranges</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data_len</span><span class="p">,</span> \
                    <span class="s">&quot;MERGEDCELLS: pos=</span><span class="si">%d</span><span class="s"> data_len=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_WINDOW2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">data_len</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_rowx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_colx</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_index</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHHHxxHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">14</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">30</span> <span class="c"># BIFF3-7</span>
                    <span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_rowx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_colx</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_rgb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BBB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_index</span> <span class="o">=</span> <span class="n">nearest_colour_index</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_rgb</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># default (60%)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># default (100%)</span>
                <span class="c"># options -- Bit, Mask, Contents:</span>
                <span class="c"># 0 0001H 0 = Show formula results 1 = Show formulas</span>
                <span class="c"># 1 0002H 0 = Do not show grid lines 1 = Show grid lines</span>
                <span class="c"># 2 0004H 0 = Do not show sheet headers 1 = Show sheet headers</span>
                <span class="c"># 3 0008H 0 = Panes are not frozen 1 = Panes are frozen (freeze)</span>
                <span class="c"># 4 0010H 0 = Show zero values as empty cells 1 = Show zero values</span>
                <span class="c"># 5 0020H 0 = Manual grid line colour 1 = Automatic grid line colour</span>
                <span class="c"># 6 0040H 0 = Columns from left to right 1 = Columns from right to left</span>
                <span class="c"># 7 0080H 0 = Do not show outline symbols 1 = Show outline symbols</span>
                <span class="c"># 8 0100H 0 = Keep splits if pane freeze is removed 1 = Remove splits if pane freeze is removed</span>
                <span class="c"># 9 0200H 0 = Sheet not selected 1 = Sheet selected (BIFF5-BIFF8)</span>
                <span class="c"># 10 0400H 0 = Sheet not visible 1 = Sheet visible (BIFF5-BIFF8)</span>
                <span class="c"># 11 0800H 0 = Show in normal view 1 = Show in page break preview (BIFF8)</span>
                <span class="c"># The freeze flag specifies, if a following PANE record (6.71) describes unfrozen or frozen panes.</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">_unused_defval</span> <span class="ow">in</span> <span class="n">_WINDOW2_options</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">options</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_SCL</span><span class="p">:</span>
                <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">den</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">//</span> <span class="n">den</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">((</span>
                            <span class="s">&quot;WARNING *** SCL rcd sheet </span><span class="si">%d</span><span class="s">: should have 0.1 &lt;= num/den &lt;= 4; got </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s">&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
                            <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_PANE</span><span class="p">:</span>
                <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vert_split_pos</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">horz_split_pos</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">horz_split_first_visible</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vert_split_first_visible</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">split_active_pane</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHHHB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_pane_record</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_HORIZONTALPAGEBREAKS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">num_breaks</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">assert</span> <span class="n">num_breaks</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">data_len</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">6</span><span class="p">]))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">6</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_VERTICALPAGEBREAKS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">num_breaks</span><span class="p">,</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">assert</span> <span class="n">num_breaks</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">data_len</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vertical_page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">65535</span><span class="p">))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vertical_page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">6</span><span class="p">]))</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">6</span>
            <span class="c">#### all of the following are for BIFF &lt;= 4W</span>
            <span class="k">elif</span> <span class="n">bv</span> <span class="o">&lt;=</span> <span class="mi">45</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FORMAT</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FORMAT2</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_format</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FONT</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FONT_B3B4</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_font</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_STYLE</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">_xf_epilogue_done</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">xf_epilogue</span><span class="p">()</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_style</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_PALETTE</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_palette</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_BUILTINFMTCOUNT</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_builtinfmtcount</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_XF4</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_XF3</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_XF2</span><span class="p">:</span> <span class="c">#### N.B. not XL_XF</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_xf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_DATEMODE</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_datemode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_CODEPAGE</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_codepage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_FILEPASS</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_filepass</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_WRITEACCESS</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_writeaccess</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_IXFE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ixfe</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_NUMBER_B2</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3sd&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_INTEGER</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3sH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_LABEL_B2</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
                    <span class="n">strg</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">bk</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">(),</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">strg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_BOOLERR_B2</span><span class="p">:</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_err</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3sBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">cellty</span> <span class="o">=</span> <span class="p">(</span><span class="n">XL_CELL_BOOLEAN</span><span class="p">,</span> <span class="n">XL_CELL_ERROR</span><span class="p">)[</span><span class="n">is_err</span><span class="p">]</span>
                    <span class="c"># if DEBUG: print &quot;XL_BOOLERR_B2&quot;, rowx, colx, cell_attr, value, is_err</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cellty</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_BLANK_B2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">cell_attr</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH3s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span>
                    <span class="n">self_put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_EFONT</span><span class="p">:</span>
                    <span class="n">bk</span><span class="o">.</span><span class="n">handle_efont</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_ROW_B2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">rowx</span><span class="p">,</span> <span class="n">bits1</span><span class="p">,</span> <span class="n">bits2</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H4xH2xB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rowx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** NOTE: ROW_B2 record has row index </span><span class="si">%d</span><span class="s">; &quot;</span> \
                            <span class="s">&quot;should have 0 &lt;= rowx &lt; </span><span class="si">%d</span><span class="s"> -- record ignored!&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_max_rows</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">bits2</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">):</span>  <span class="c"># has_default_xf_index is false</span>
                        <span class="n">xf_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">data_len</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
                        <span class="c"># Seems the XF index in the cell_attr is dodgy</span>
                         <span class="n">xfx</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                         <span class="n">xf_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rowx</span><span class="o">=</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">true_xfx</span><span class="o">=</span><span class="n">xfx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cell_attr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span>
                        <span class="n">xf_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits1</span><span class="p">,</span> <span class="n">bits2</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">rowinfo_sharing_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">rowinfo_sharing_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Rowinfo</span><span class="p">()</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">bits1</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">has_default_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits1</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">has_default_xf_index</span> <span class="o">=</span> <span class="n">bits2</span> <span class="o">&amp;</span> <span class="mi">1</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="n">xf_index</span>
                        <span class="c"># r.outline_level = 0             # set in __init__</span>
                        <span class="c"># r.outline_group_starts_ends = 0 # set in __init__</span>
                        <span class="c"># r.hidden = 0                    # set in __init__</span>
                        <span class="c"># r.height_mismatch = 0           # set in __init__</span>
                        <span class="c"># r.additional_space_above = 0    # set in __init__</span>
                        <span class="c"># r.additional_space_below = 0    # set in __init__</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rowinfo_map</span><span class="p">[</span><span class="n">rowx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="s">&quot;**ROW </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">xf_index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">blah_rows</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;ROW_B2&#39;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">bits1</span><span class="p">,</span> <span class="n">has_defaults</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- sh #</span><span class="si">%d</span><span class="s">, rowx=</span><span class="si">%d</span><span class="s"> ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">rowx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_COLWIDTH</span><span class="p">:</span> <span class="c"># BIFF2 only</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">,</span> <span class="n">width</span>\
                        <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;BBH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">first_colx</span> <span class="o">&lt;=</span> <span class="n">last_colx</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** NOTE: COLWIDTH record has first col index </span><span class="si">%d</span><span class="s">, last </span><span class="si">%d</span><span class="s">; &quot;</span> \
                            <span class="s">&quot;should have first &lt;= last -- record ignored!&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">colx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="n">Colinfo</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
                    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                        <span class="n">fprintf</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="s">&quot;COLWIDTH sheet #</span><span class="si">%d</span><span class="s"> cols </span><span class="si">%d</span><span class="s">-</span><span class="si">%d</span><span class="s">: wid=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">,</span> <span class="n">width</span>
                            <span class="p">)</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_COLUMNDEFAULT</span><span class="p">:</span> <span class="c"># BIFF2 only</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt_info</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span> <span class="o">=</span> <span class="n">local_unpack</span><span class="p">(</span><span class="s">&quot;&lt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
                    <span class="c">#### Warning OOo docs wrong; first_colx &lt;= colx &lt; last_colx</span>
                    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                        <span class="n">fprintf</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                            <span class="s">&quot;COLUMNDEFAULT sheet #</span><span class="si">%d</span><span class="s"> cols in range(</span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">first_colx</span> <span class="o">&lt;</span> <span class="n">last_colx</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** NOTE: COLUMNDEFAULT record has first col index </span><span class="si">%d</span><span class="s">, last </span><span class="si">%d</span><span class="s">; &quot;</span> \
                            <span class="s">&quot;should have 0 &lt;= first &lt; last &lt;= 256&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                        <span class="n">last_colx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">last_colx</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span><span class="p">):</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">colx</span> <span class="o">-</span> <span class="n">first_colx</span><span class="p">)</span>
                        <span class="n">cell_attr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">xf_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">colx</span><span class="o">=</span><span class="n">colx</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">colx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">c</span> <span class="o">=</span> <span class="n">Colinfo</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="p">[</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="n">xf_index</span>
                <span class="k">elif</span> <span class="n">rc</span> <span class="o">==</span> <span class="n">XL_WINDOW2_B2</span><span class="p">:</span> <span class="c"># BIFF 2 only</span>
                    <span class="n">attr_names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;show_formulas&quot;</span><span class="p">,</span> <span class="s">&quot;show_grid_lines&quot;</span><span class="p">,</span> <span class="s">&quot;show_sheet_headers&quot;</span><span class="p">,</span>
                        <span class="s">&quot;panes_are_frozen&quot;</span><span class="p">,</span> <span class="s">&quot;show_zero_values&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">char</span> <span class="o">!=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">))</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_visible_rowx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_visible_colx</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">automatic_grid_line_colour</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;HHB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_rgb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;BBB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_index</span> <span class="o">=</span> <span class="n">nearest_colour_index</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridline_colour_rgb</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># default (60%)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># default (100%)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># if DEBUG: print &quot;SHEET.READ: Unhandled record type %02x %d bytes %r&quot; % (rc, data_len, data)</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eof_found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Sheet </span><span class="si">%d</span><span class="s"> (</span><span class="si">%r</span><span class="s">) missing EOF record&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tidy_dimensions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cooked_mag_factors</span><span class="p">()</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">oldpos</span>
        <span class="k">return</span> <span class="mi">1</span>
    </div>
<div class="viewcode-block" id="Sheet.string_record_contents"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.string_record_contents">[docs]</a>    <span class="k">def</span> <span class="nf">string_record_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
        <span class="n">bk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span>
        <span class="n">lenlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nchars_expected</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s">&quot;BH&quot;</span><span class="p">[</span><span class="n">lenlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:</span><span class="n">lenlen</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">lenlen</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">bk</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
        <span class="n">nchars_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="n">enc</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;latin_1&quot;</span><span class="p">,</span> <span class="s">&quot;utf_16_le&quot;</span><span class="p">)[</span><span class="n">flag</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="n">enc</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">chunk</span>
            <span class="n">nchars_found</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nchars_found</span> <span class="o">==</span> <span class="n">nchars_expected</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">nchars_found</span> <span class="o">&gt;</span> <span class="n">nchars_expected</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;STRING/CONTINUE: expected </span><span class="si">%d</span><span class="s"> chars, found </span><span class="si">%d</span><span class="s">&quot;</span> 
                    <span class="o">%</span> <span class="p">(</span><span class="n">nchars_expected</span><span class="p">,</span> <span class="n">nchars_found</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">_unused_len</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="n">XL_CONTINUE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span>
                    <span class="s">&quot;Expected CONTINUE record; found record-type 0x</span><span class="si">%04X</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rc</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Sheet.update_cooked_mag_factors"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.update_cooked_mag_factors">[docs]</a>    <span class="k">def</span> <span class="nf">update_cooked_mag_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Cached values are used ONLY for the non-active view mode.</span>
        <span class="c"># When the user switches to the non-active view mode,</span>
        <span class="c"># if the cached value for that mode is not valid,</span>
        <span class="c"># Excel pops up a window which says:</span>
        <span class="c"># &quot;The number must be between 10 and 400. Try again by entering a number in this range.&quot;</span>
        <span class="c"># When the user hits OK, it drops into the non-active view mode</span>
        <span class="c"># but uses the magn from the active mode.</span>
        <span class="c"># NOTE: definition of &quot;valid&quot; depends on mode ... see below</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_in_page_break_preview</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># no SCL record</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cooked_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="mi">100</span> <span class="c"># Yes, 100, not 60, NOT a typo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cooked_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span>
            <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">zoom</span> <span class="o">&lt;=</span><span class="mi">400</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">((</span>
                        <span class="s">&quot;WARNING *** WINDOW2 rcd sheet </span><span class="si">%d</span><span class="s">: Bad cached_normal_view_mag_factor: </span><span class="si">%d</span><span class="s">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_normal_view_mag_factor</span><span class="p">)</span>
                        <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooked_page_break_preview_mag_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cooked_normal_view_mag_factor</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># normal view mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># no SCL record</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cooked_normal_view_mag_factor</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cooked_normal_view_mag_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scl_mag_factor</span>
            <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span>
            <span class="k">if</span> <span class="n">zoom</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># VALID, defaults to 60</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="mi">60</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">zoom</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">((</span>
                        <span class="s">&quot;WARNING *** WINDOW2 rcd sheet </span><span class="si">%r</span><span class="s">: Bad cached_page_break_preview_mag_factor: </span><span class="si">%r</span><span class="s">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_page_break_preview_mag_factor</span><span class="p">)</span>
                        <span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooked_normal_view_mag_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cooked_page_break_preview_mag_factor</span> <span class="o">=</span> <span class="n">zoom</span>
</div>
<div class="viewcode-block" id="Sheet.fixed_BIFF2_xfindex"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.fixed_BIFF2_xfindex">[docs]</a>    <span class="k">def</span> <span class="nf">fixed_BIFF2_xfindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">true_xfx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">xf_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">true_xfx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">xfx</span> <span class="o">=</span> <span class="n">true_xfx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xfx</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
                <span class="k">if</span> <span class="n">xfx</span> <span class="o">==</span> <span class="mh">0x3F</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ixfe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;BIFF2 cell record has XF index 63 but no preceding IXFE record.&quot;</span><span class="p">)</span>
                    <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ixfe</span>
                    <span class="c"># OOo docs are capable of interpretation that each</span>
                    <span class="c"># cell record is preceded immediately by its own IXFE record.</span>
                    <span class="c"># Empirical evidence is that (sensibly) an IXFE record applies to all</span>
                    <span class="c"># following cell records until another IXFE comes along.</span>
                <span class="k">return</span> <span class="n">xfx</span>
            <span class="c"># Have either Excel 2.0, or broken 2.1 w/o XF records -- same effect.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="c">#### check that XF slot in cell_attr is zero</span>
        <span class="n">xfx_slot</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
        <span class="k">assert</span> <span class="n">xfx_slot</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_attr_to_xfx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xfx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xfx</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;New cell_attr </span><span class="si">%r</span><span class="s"> at (</span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">xf_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xfx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_new_BIFF20_xf</span><span class="p">(</span><span class="n">cell_attr</span><span class="o">=</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x40\x00\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">xfx</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_new_BIFF20_xf</span><span class="p">(</span><span class="n">cell_attr</span><span class="o">=</span><span class="n">cell_attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xfx</span>
</div>
<div class="viewcode-block" id="Sheet.insert_new_BIFF20_xf"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.insert_new_BIFF20_xf">[docs]</a>    <span class="k">def</span> <span class="nf">insert_new_BIFF20_xf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="n">book</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span>
        <span class="n">xfx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">xf_list</span><span class="p">)</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fake_XF_from_BIFF20_cell_attr</span><span class="p">(</span><span class="n">cell_attr</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="n">xfx</span>
        <span class="n">book</span><span class="o">.</span><span class="n">xf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="n">xf</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== Faked XF </span><span class="si">%d</span><span class="s"> ===&quot;</span> <span class="o">%</span> <span class="n">xfx</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="s">&quot;======&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">format_map</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ERROR *** XF[</span><span class="si">%d</span><span class="s">] unknown format key (</span><span class="si">%d</span><span class="s">, 0x</span><span class="si">%04x</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">Format</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">FUN</span><span class="p">,</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&quot;General&quot;</span><span class="p">))</span>
            <span class="n">book</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="n">book</span><span class="o">.</span><span class="n">format_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">cellty_from_fmtty</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">FNU</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
            <span class="n">FUN</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
            <span class="n">FGE</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
            <span class="n">FDT</span><span class="p">:</span> <span class="n">XL_CELL_DATE</span><span class="p">,</span>
            <span class="n">FTX</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span> <span class="c"># Yes, a number can be formatted as text.</span>
            <span class="p">}</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span>
        <span class="n">cellty</span> <span class="o">=</span> <span class="n">cellty_from_fmtty</span><span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cellty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_attr_to_xfx</span><span class="p">[</span><span class="n">cell_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">xfx</span>
        <span class="k">return</span> <span class="n">xfx</span>
</div>
<div class="viewcode-block" id="Sheet.fake_XF_from_BIFF20_cell_attr"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.fake_XF_from_BIFF20_cell_attr">[docs]</a>    <span class="k">def</span> <span class="nf">fake_XF_from_BIFF20_cell_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.formatting</span> <span class="kn">import</span> <span class="n">XF</span><span class="p">,</span> <span class="n">XFAlignment</span><span class="p">,</span> <span class="n">XFBorder</span><span class="p">,</span> <span class="n">XFBackground</span><span class="p">,</span> <span class="n">XFProtection</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">XF</span><span class="p">()</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">XFAlignment</span><span class="p">()</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">shrink_to_fit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">text_direction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">XFBorder</span><span class="p">()</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_down</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_line_style</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># no line</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">XFBackground</span><span class="p">()</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">protection</span> <span class="o">=</span> <span class="n">XFProtection</span><span class="p">()</span>
        <span class="p">(</span><span class="n">prot_bits</span><span class="p">,</span> <span class="n">font_and_format</span><span class="p">,</span> <span class="n">halign_etc</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;BBB&#39;</span><span class="p">,</span> <span class="n">cell_attr</span><span class="p">)</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="n">font_and_format</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">font_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">font_and_format</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">prot_bits</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">hor_align</span> <span class="o">=</span> <span class="n">halign_etc</span> <span class="o">&amp;</span> <span class="mh">0x07</span>
        <span class="k">for</span> <span class="n">mask</span><span class="p">,</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">((</span><span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">halign_etc</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">:</span>
                <span class="n">colour_index</span><span class="p">,</span> <span class="n">line_style</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span> <span class="c"># black, thin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colour_index</span><span class="p">,</span> <span class="n">line_style</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="c"># none, none</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">side</span> <span class="o">+</span> <span class="s">&#39;_colour_index&#39;</span><span class="p">,</span> <span class="n">colour_index</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">side</span> <span class="o">+</span> <span class="s">&#39;_line_style&#39;</span><span class="p">,</span> <span class="n">line_style</span><span class="p">)</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">xf</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="n">halign_etc</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">:</span>
            <span class="n">bg</span><span class="o">.</span><span class="n">fill_pattern</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bg</span><span class="o">.</span><span class="n">fill_pattern</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bg</span><span class="o">.</span><span class="n">background_colour_index</span> <span class="o">=</span> <span class="mi">9</span> <span class="c"># white</span>
        <span class="n">bg</span><span class="o">.</span><span class="n">pattern_colour_index</span> <span class="o">=</span> <span class="mi">8</span> <span class="c"># black</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x0FFF</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="n">style</span><span class="p">]</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">vert_align</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># bottom</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xf</span>
</div>
<div class="viewcode-block" id="Sheet.req_fmt_info"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.req_fmt_info">[docs]</a>    <span class="k">def</span> <span class="nf">req_fmt_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Feature requires open_workbook(..., formatting_info=True)&quot;</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Determine column display width.</span>
    <span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
    <span class="c"># &lt;br /&gt;</span>
    <span class="c"># @param colx Index of the queried column, range 0 to 255.</span>
    <span class="c"># Note that it is possible to find out the width that will be used to display</span>
    <span class="c"># columns with no cell information e.g. column IV (colx=255).</span>
    <span class="c"># @return The column width that will be used for displaying</span>
    <span class="c"># the given column by Excel, in units of 1/256th of the width of a</span>
    <span class="c"># standard character (the digit zero in the first font).</span>
</div>
<div class="viewcode-block" id="Sheet.computed_column_width"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.computed_column_width">[docs]</a>    <span class="k">def</span> <span class="nf">computed_column_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_fmt_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">colinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">colinfo</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcw</span><span class="p">[</span><span class="n">colx</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardwidth</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">colinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">colinfo</span><span class="o">.</span><span class="n">width</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">colinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colinfo_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">colinfo</span><span class="o">.</span><span class="n">width</span>
        <span class="c"># All roads lead to Rome and the DEFCOLWIDTH ...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defcolwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defcolwidth</span> <span class="o">*</span> <span class="mi">256</span>
        <span class="k">return</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">256</span> <span class="c"># 8 is what Excel puts in a DEFCOLWIDTH record</span>
</div>
<div class="viewcode-block" id="Sheet.handle_hlink"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_hlink">[docs]</a>    <span class="k">def</span> <span class="nf">handle_hlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DEBUG = 1</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">=== hyperlink ===&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">record_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Hyperlink</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">frowx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lrowx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">fcolx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lcolx</span><span class="p">,</span> <span class="n">guid0</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHHH16s4si&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">32</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">guid0</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xD0\xC9\xEA\x79\xF9\xBA\xCE\x11\x8C\x82\x00\xAA\x00\x4B\xA9\x0B</span><span class="s">&quot;</span>
        <span class="k">assert</span> <span class="n">dummy</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x02\x00\x00\x00</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;options: </span><span class="si">%08X</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="k">def</span> <span class="nf">get_nul_terminated_unicode</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">ofs</span><span class="p">):</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="n">ofs</span><span class="p">:</span><span class="n">ofs</span><span class="o">+</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">ofs</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="n">uc</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">ofs</span><span class="p">:</span><span class="n">ofs</span><span class="o">+</span><span class="n">nb</span><span class="p">],</span> <span class="s">&#39;UTF-16le&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ofs</span> <span class="o">+=</span> <span class="n">nb</span>
            <span class="k">return</span> <span class="n">uc</span><span class="p">,</span> <span class="n">ofs</span>

        <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x14</span><span class="p">:</span> <span class="c"># has a description</span>
            <span class="n">h</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">get_nul_terminated_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">:</span> <span class="c"># has a target</span>
            <span class="n">h</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">get_nul_terminated_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">):</span> <span class="c"># HasMoniker and not MonikerSavedAsString</span>
            <span class="c"># an OLEMoniker structure</span>
            <span class="n">clsid</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;16s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">16</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;clsid=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>  <span class="n">clsid</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">16</span>
            <span class="k">if</span> <span class="n">clsid</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xE0\xC9\xEA\x79\xF9\xBA\xCE\x11\x8C\x82\x00\xAA\x00\x4B\xA9\x0B</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="c">#          E0H C9H EAH 79H F9H BAH CEH 11H 8CH 82H 00H AAH 00H 4BH A9H 0BH</span>
                <span class="c"># URL Moniker</span>
                <span class="n">h</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">)</span>
                <span class="n">nbytes</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">nbytes</span><span class="p">],</span> <span class="s">&#39;UTF-16le&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;initial url=</span><span class="si">%r</span><span class="s"> len=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="p">))</span>
                <span class="n">endpos</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;endpos=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">endpos</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="p">[:</span><span class="n">endpos</span><span class="p">]</span>
                <span class="n">true_nbytes</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">endpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">true_nbytes</span>
                <span class="n">extra_nbytes</span> <span class="o">=</span> <span class="n">nbytes</span> <span class="o">-</span> <span class="n">true_nbytes</span>
                <span class="n">extra_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">extra_nbytes</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">extra_nbytes</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> 
                    <span class="n">fprintf</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;url=</span><span class="si">%r</span><span class="se">\n</span><span class="s">extra=</span><span class="si">%r</span><span class="se">\n</span><span class="s">nbytes=</span><span class="si">%d</span><span class="s"> true_nbytes=</span><span class="si">%d</span><span class="s"> extra_nbytes=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="p">,</span> <span class="n">extra_data</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">,</span> <span class="n">true_nbytes</span><span class="p">,</span> <span class="n">extra_nbytes</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">assert</span> <span class="n">extra_nbytes</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clsid</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x03\x03\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00\x46</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="c"># file moniker</span>
                <span class="n">h</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;local file&#39;</span><span class="p">)</span>
                <span class="n">uplevels</span><span class="p">,</span> <span class="n">nbytes</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;Hi&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">])</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">6</span>
                <span class="n">shortpath</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;..</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">*</span> <span class="n">uplevels</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">nbytes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c">#### BYTES, not unicode</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;uplevels=</span><span class="si">%d</span><span class="s"> shortpath=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">uplevels</span><span class="p">,</span> <span class="n">shortpath</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">nbytes</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">24</span> <span class="c"># OOo: &quot;unknown byte sequence&quot;</span>
                <span class="c"># above is version 0xDEAD + 20 reserved zero bytes</span>
                <span class="n">sz</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;sz=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sz</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">sz</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">2</span> <span class="c"># &quot;unknown byte sequence&quot; MS: 0x0003</span>
                    <span class="n">extended_path</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">xl</span><span class="p">],</span> <span class="s">&#39;UTF-16le&#39;</span><span class="p">)</span> <span class="c"># not zero-terminated</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">xl</span>
                    <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span> <span class="o">=</span> <span class="n">extended_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span> <span class="o">=</span> <span class="n">shortpath</span>
                    <span class="c">#### MS KLUDGE WARNING ####</span>
                    <span class="c"># The &quot;shortpath&quot; is bytes encoded in the **UNKNOWN** creator&#39;s &quot;ANSI&quot; encoding.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** unknown clsid </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">clsid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x163</span> <span class="o">==</span> <span class="mh">0x103</span><span class="p">:</span> <span class="c"># UNC</span>
            <span class="n">h</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;unc&#39;</span><span class="p">)</span>
            <span class="n">h</span><span class="o">.</span><span class="n">url_or_path</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">get_nul_terminated_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x16B</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;workbook&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;unknown&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">options</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">:</span> <span class="c"># has textmark</span>
            <span class="n">h</span><span class="o">.</span><span class="n">textmark</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">get_nul_terminated_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&quot;... object dump ...&quot;</span><span class="p">)</span> 
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;offset=</span><span class="si">%d</span><span class="s"> record_size=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">record_size</span><span class="p">))</span>
            
        <span class="n">extra_nbytes</span> <span class="o">=</span> <span class="n">record_size</span> <span class="o">-</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">extra_nbytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;*** WARNING: hyperlink at r=</span><span class="si">%d</span><span class="s"> c=</span><span class="si">%d</span><span class="s"> has </span><span class="si">%d</span><span class="s"> extra data bytes: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">h</span><span class="o">.</span><span class="n">frowx</span><span class="p">,</span>
                <span class="n">h</span><span class="o">.</span><span class="n">fcolx</span><span class="p">,</span>
                <span class="n">extra_nbytes</span><span class="p">,</span>
                <span class="n">REPR</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">extra_nbytes</span><span class="p">:])</span>
                <span class="p">)</span>
            <span class="c"># Seen: b&quot;\x00\x00&quot; also b&quot;A\x00&quot;, b&quot;V\x00&quot;</span>
        <span class="k">elif</span> <span class="n">extra_nbytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>        
            <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&quot;Bug or corrupt file, send copy of input file for debugging&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">frowx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lrowx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">fcolx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lcolx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_map</span><span class="p">[</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
                </div>
<div class="viewcode-block" id="Sheet.handle_quicktip"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_quicktip">[docs]</a>    <span class="k">def</span> <span class="nf">handle_quicktip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">rcx</span><span class="p">,</span> <span class="n">frowx</span><span class="p">,</span> <span class="n">lrowx</span><span class="p">,</span> <span class="n">fcolx</span><span class="p">,</span> <span class="n">lcolx</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;5H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">rcx</span> <span class="o">==</span> <span class="n">XL_QUICKTIP</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_list</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperlink_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">frowx</span><span class="p">,</span> <span class="n">lrowx</span><span class="p">,</span> <span class="n">fcolx</span><span class="p">,</span> <span class="n">lcolx</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">frowx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lrowx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">fcolx</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">lcolx</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>
        <span class="n">h</span><span class="o">.</span><span class="n">quicktip</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;utf_16_le&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sheet.handle_msodrawingetc"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_msodrawingetc">[docs]</a>    <span class="k">def</span> <span class="nf">handle_msodrawingetc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recid</span><span class="p">,</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">MSODrawing</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">,</span> <span class="n">fbt</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHI&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span>
            <span class="k">if</span> <span class="n">ver</span> <span class="o">==</span> <span class="mh">0xF</span><span class="p">:</span>
                <span class="n">ndb</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># container</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndb</span> <span class="o">=</span> <span class="n">cb</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ndb</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;fbt:0x</span><span class="si">%04X</span><span class="s">  inst:</span><span class="si">%d</span><span class="s">  ver:0x</span><span class="si">%X</span><span class="s">  cb:</span><span class="si">%d</span><span class="s"> (0x</span><span class="si">%04X</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="n">fbt</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">ver</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fbt</span> <span class="o">==</span> <span class="mh">0xF010</span><span class="p">:</span> <span class="c"># Client Anchor</span>
                <span class="k">assert</span> <span class="n">ndb</span> <span class="o">==</span> <span class="mi">18</span>
                <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">anchor_unk</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">anchor_colx_lo</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">anchor_rowx_lo</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">anchor_colx_hi</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">anchor_rowx_hi</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;Hiiii&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="n">ndb</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">fbt</span> <span class="o">==</span> <span class="mh">0xF011</span><span class="p">:</span> <span class="c"># Client Data</span>
                <span class="c"># must be followed by an OBJ record</span>
                <span class="k">assert</span> <span class="n">cb</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">==</span> <span class="n">data_len</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">ndb</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># didn&#39;t break out of while loop</span>
            <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data_len</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== MSODrawing ===&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Sheet.handle_obj"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_obj">[docs]</a>    <span class="k">def</span> <span class="nf">handle_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">MSObj</span><span class="p">()</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;... OBJ record len=</span><span class="si">%d</span><span class="s">...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">data_len</span><span class="p">:</span>
            <span class="n">ft</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;pos=</span><span class="si">%d</span><span class="s"> ft=0x</span><span class="si">%04X</span><span class="s"> cb=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
                <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">cb</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ft</span> <span class="o">==</span> <span class="mh">0x15</span> <span class="ow">and</span> <span class="n">cb</span> <span class="o">==</span> <span class="mi">18</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** WARNING Ignoring antique or corrupt OBJECT record</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">ft</span> <span class="o">==</span> <span class="mh">0x15</span><span class="p">:</span> <span class="c"># ftCmo ... s/b first</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">o</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">option_flags</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span>
                <span class="n">upkbits</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="p">(</span>
                    <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">,</span> <span class="s">&#39;locked&#39;</span><span class="p">),</span>
                    <span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0010</span><span class="p">,</span> <span class="s">&#39;printable&#39;</span><span class="p">),</span>
                    <span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x0100</span><span class="p">,</span> <span class="s">&#39;autofilter&#39;</span><span class="p">),</span> <span class="c"># not documented in Excel 97 dev kit</span>
                    <span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">,</span> <span class="s">&#39;scrollbar_flag&#39;</span><span class="p">),</span> <span class="c"># not documented in Excel 97 dev kit</span>
                    <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">,</span> <span class="s">&#39;autofill&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="s">&#39;autoline&#39;</span><span class="p">),</span>
                    <span class="p">))</span>
            <span class="k">elif</span> <span class="n">ft</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">data_len</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_len</span> <span class="o">-</span> <span class="n">pos</span><span class="p">):</span>
                    <span class="c"># ignore &quot;optional reserved&quot; data at end of record</span>
                    <span class="k">break</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Unexpected data at end of OBJECT record&quot;</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** ERROR </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">data_len</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ft</span> <span class="o">==</span> <span class="mh">0x0C</span><span class="p">:</span> <span class="c"># Scrollbar</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;5H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">18</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">,</span> <span class="s">&#39;inc&#39;</span><span class="p">,</span> <span class="s">&#39;page&#39;</span><span class="p">)):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&#39;scrollbar_&#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ft</span> <span class="o">==</span> <span class="mh">0x0D</span><span class="p">:</span> <span class="c"># &quot;Notes structure&quot; [used for cell comments]</span>
                <span class="c"># not documented in Excel 97 dev kit</span>
                <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span> <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** OBJ record has ft==0x0D &#39;notes&#39; structure</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ft</span> <span class="o">==</span> <span class="mh">0x13</span><span class="p">:</span> <span class="c"># list box data</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">autofilter</span><span class="p">:</span> <span class="c"># non standard exit. NOT documented</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">cb</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># didn&#39;t break out of while loop</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== MSOBj ===&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span>
</div>
<div class="viewcode-block" id="Sheet.handle_note"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_note">[docs]</a>    <span class="k">def</span> <span class="nf">handle_note</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">txos</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&#39;... NOTE record ...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">colx</span><span class="p">,</span> <span class="n">expected_bytes</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">6</span>
            <span class="k">assert</span> <span class="n">nb</span> <span class="o">&lt;=</span> <span class="n">expected_bytes</span>
            <span class="n">pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:]]</span>
            <span class="n">expected_bytes</span> <span class="o">-=</span> <span class="n">nb</span>
            <span class="k">while</span> <span class="n">expected_bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rc2</span><span class="p">,</span> <span class="n">data2_len</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_NOTE</span>
                <span class="n">dummy_rowx</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H2xH&#39;</span><span class="p">,</span> <span class="n">data2</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">assert</span> <span class="n">dummy_rowx</span> <span class="o">==</span> <span class="mh">0xFFFF</span>
                <span class="k">assert</span> <span class="n">nb</span> <span class="o">==</span> <span class="n">data2_len</span> <span class="o">-</span> <span class="mi">6</span>
                <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data2</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
                <span class="n">expected_bytes</span> <span class="o">-=</span> <span class="n">nb</span>
            <span class="k">assert</span> <span class="n">expected_bytes</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
            <span class="n">o</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">),</span> <span class="n">enc</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">o</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">o</span><span class="o">.</span><span class="n">row_hidden</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">o</span><span class="o">.</span><span class="n">col_hidden</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">o</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">_object_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_note_map</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>        
            <span class="k">return</span>
        <span class="c"># Excel 8.0+</span>
        <span class="n">o</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">colx</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">_object_id</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;4H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">o</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">o</span><span class="o">.</span><span class="n">row_hidden</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">o</span><span class="o">.</span><span class="n">col_hidden</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="c"># XL97 dev kit book says NULL [sic] bytes padding between string count and string data</span>
        <span class="c"># to ensure that string is word-aligned. Appears to be nonsense.</span>
        <span class="n">o</span><span class="o">.</span><span class="n">author</span><span class="p">,</span> <span class="n">endpos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c"># There is a random/undefined byte after the author string (not counted in the</span>
        <span class="c"># string length).</span>
        <span class="c"># Issue 4 on github: Google Spreadsheet doesn&#39;t write the undefined byte.</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">data_len</span> <span class="o">-</span> <span class="n">endpos</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== Note ===&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
        <span class="n">txo</span> <span class="o">=</span> <span class="n">txos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">_object_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">txo</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">txo</span><span class="o">.</span><span class="n">text</span>
            <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span> <span class="o">=</span> <span class="n">txo</span><span class="o">.</span><span class="n">rich_text_runlist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_note_map</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">colx</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>        
</div>
<div class="viewcode-block" id="Sheet.handle_txo"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_txo">[docs]</a>    <span class="k">def</span> <span class="nf">handle_txo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">MSTxo</span><span class="p">()</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;HH6sHHH&#39;</span>
        <span class="n">fmtsize</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">option_flags</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="n">controlInfo</span><span class="p">,</span> <span class="n">cchText</span><span class="p">,</span> <span class="n">cbRuns</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">ifntEmpty</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="n">fmtsize</span><span class="p">])</span>
        <span class="n">o</span><span class="o">.</span><span class="n">fmla</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">fmtsize</span><span class="p">:]</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x000E</span><span class="p">,</span> <span class="s">&#39;horz_align&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x0070</span><span class="p">,</span> <span class="s">&#39;vert_align&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">,</span> <span class="s">&#39;lock_text&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="s">&#39;just_last&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="s">&#39;secret_edit&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">totchars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">o</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">totchars</span> <span class="o">&lt;</span> <span class="n">cchText</span><span class="p">:</span>
            <span class="n">rc2</span><span class="p">,</span> <span class="n">data2_len</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">rc2</span> <span class="o">==</span> <span class="n">XL_CONTINUE</span>
            <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
                <span class="n">hex_char_dump</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data2_len</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">data2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c"># 0 means latin1, 1 means utf_16_le</span>
            <span class="n">nchars</span> <span class="o">=</span> <span class="n">data2_len</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">nb</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">nchars</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">nchars</span> <span class="o">//=</span> <span class="mi">2</span>
            <span class="n">utext</span><span class="p">,</span> <span class="n">endpos</span> <span class="o">=</span> <span class="n">unpack_unicode_update_pos</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">known_len</span><span class="o">=</span><span class="n">nchars</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">endpos</span> <span class="o">==</span> <span class="n">data2_len</span>
            <span class="n">o</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">utext</span>
            <span class="n">totchars</span> <span class="o">+=</span> <span class="n">nchars</span>
        <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">totruns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">totruns</span> <span class="o">&lt;</span> <span class="n">cbRuns</span><span class="p">:</span> <span class="c"># counts of BYTES, not runs</span>
            <span class="n">rc3</span><span class="p">,</span> <span class="n">data3_len</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">get_record_parts</span><span class="p">()</span>
            <span class="c"># print totruns, cbRuns, rc3, data3_len, repr(data3)</span>
            <span class="k">assert</span> <span class="n">rc3</span> <span class="o">==</span> <span class="n">XL_CONTINUE</span>
            <span class="k">assert</span> <span class="n">data3_len</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data3_len</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                <span class="n">run</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH4x&#39;</span><span class="p">,</span> <span class="n">data3</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
                <span class="n">totruns</span> <span class="o">+=</span> <span class="mi">8</span>
        <span class="c"># remove trailing entries that point to the end of the string</span>
        <span class="k">while</span> <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cchText</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&quot;=== MSTxo ===&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">rich_text_runlist</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span>
</div>
<div class="viewcode-block" id="Sheet.handle_feat11"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Sheet.handle_feat11">[docs]</a>    <span class="k">def</span> <span class="nf">handle_feat11</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OBJ_MSO_DEBUG</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># rt: Record type; this matches the BIFF rt in the first two bytes of the record; =0872h</span>
        <span class="c"># grbitFrt: FRT cell reference flag (see table below for details)</span>
        <span class="c"># Ref0: Range reference to a worksheet cell region if grbitFrt=1 (bitFrtRef). Otherwise blank.</span>
        <span class="c"># isf: Shared feature type index =5 for Table</span>
        <span class="c"># fHdr: =0 since this is for feat not feat header</span>
        <span class="c"># reserved0: Reserved for future use =0 for Table</span>
        <span class="c"># cref: Count of ref ranges this feature is on</span>
        <span class="c"># cbFeatData: Count of byte for the current feature data.</span>
        <span class="c"># reserved1: =0 currently not used</span>
        <span class="c"># Ref1: Repeat of Ref0. UNDOCUMENTED</span>
        <span class="n">rt</span><span class="p">,</span> <span class="n">grbitFrt</span><span class="p">,</span> <span class="n">Ref0</span><span class="p">,</span> <span class="n">isf</span><span class="p">,</span> <span class="n">fHdr</span><span class="p">,</span> <span class="n">reserved0</span><span class="p">,</span> <span class="n">cref</span><span class="p">,</span> <span class="n">cbFeatData</span><span class="p">,</span> <span class="n">reserved1</span><span class="p">,</span> <span class="n">Ref1</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH8sHBiHiH8s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">35</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">reserved0</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">reserved1</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">isf</span> <span class="o">==</span> <span class="mi">5</span>
        <span class="k">assert</span> <span class="n">rt</span> <span class="o">==</span> <span class="mh">0x872</span>
        <span class="k">assert</span> <span class="n">fHdr</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">Ref1</span> <span class="o">==</span> <span class="n">Ref0</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;FEAT11: grbitFrt=</span><span class="si">%d</span><span class="s">  Ref0=</span><span class="si">%r</span><span class="s"> cref=</span><span class="si">%d</span><span class="s"> cbFeatData=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">grbitFrt</span><span class="p">,</span> <span class="n">Ref0</span><span class="p">,</span> <span class="n">cref</span><span class="p">,</span> <span class="n">cbFeatData</span><span class="p">)</span>
        <span class="c"># lt: Table data source type:</span>
        <span class="c">#   =0 for Excel Worksheet Table =1 for read-write SharePoint linked List</span>
        <span class="c">#   =2 for XML mapper Table =3 for Query Table</span>
        <span class="c"># idList: The ID of the Table (unique per worksheet)</span>
        <span class="c"># crwHeader: How many header/title rows the Table has at the top</span>
        <span class="c"># crwTotals: How many total rows the Table has at the bottom</span>
        <span class="c"># idFieldNext: Next id to try when assigning a unique id to a new field</span>
        <span class="c"># cbFSData: The size of the Fixed Data portion of the Table data structure.</span>
        <span class="c"># rupBuild: the rupBuild that generated the record</span>
        <span class="c"># unusedShort: UNUSED short that can be used later. The value is reserved during round-tripping.</span>
        <span class="c"># listFlags: Collection of bit flags: (see listFlags&#39; bit setting table below for detail.)</span>
        <span class="c"># lPosStmCache: Table data stream position of cached data</span>
        <span class="c"># cbStmCache: Count of bytes of cached data</span>
        <span class="c"># cchStmCache: Count of characters of uncompressed cached data in the stream</span>
        <span class="c"># lem: Table edit mode (see List (Table) Editing Mode (lem) setting table below for details.)</span>
        <span class="c"># rgbHashParam: Hash value for SharePoint Table</span>
        <span class="c"># cchName: Count of characters in the Table name string rgbName</span>
        <span class="p">(</span><span class="n">lt</span><span class="p">,</span> <span class="n">idList</span><span class="p">,</span> <span class="n">crwHeader</span><span class="p">,</span> <span class="n">crwTotals</span><span class="p">,</span> <span class="n">idFieldNext</span><span class="p">,</span> <span class="n">cbFSData</span><span class="p">,</span>
        <span class="n">rupBuild</span><span class="p">,</span> <span class="n">unusedShort</span><span class="p">,</span> <span class="n">listFlags</span><span class="p">,</span> <span class="n">lPosStmCache</span><span class="p">,</span> <span class="n">cbStmCache</span><span class="p">,</span>
        <span class="n">cchStmCache</span><span class="p">,</span> <span class="n">lem</span><span class="p">,</span> <span class="n">rgbHashParam</span><span class="p">,</span> <span class="n">cchName</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;iiiiiiHHiiiii16sH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">35</span><span class="p">:</span><span class="mi">35</span><span class="o">+</span><span class="mi">66</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;lt=</span><span class="si">%d</span><span class="s">  idList=</span><span class="si">%d</span><span class="s"> crwHeader=</span><span class="si">%d</span><span class="s">  crwTotals=</span><span class="si">%d</span><span class="s">  idFieldNext=</span><span class="si">%d</span><span class="s"> cbFSData=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span>\
            <span class="s">&quot;rupBuild=</span><span class="si">%d</span><span class="s">  unusedShort=</span><span class="si">%d</span><span class="s"> listFlags=</span><span class="si">%04X</span><span class="s">  lPosStmCache=</span><span class="si">%d</span><span class="s">  cbStmCache=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span>\
            <span class="s">&quot;cchStmCache=</span><span class="si">%d</span><span class="s">  lem=</span><span class="si">%d</span><span class="s">  rgbHashParam=</span><span class="si">%r</span><span class="s">  cchName=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">lt</span><span class="p">,</span> <span class="n">idList</span><span class="p">,</span> <span class="n">crwHeader</span><span class="p">,</span> <span class="n">crwTotals</span><span class="p">,</span> <span class="n">idFieldNext</span><span class="p">,</span> <span class="n">cbFSData</span><span class="p">,</span>
            <span class="n">rupBuild</span><span class="p">,</span> <span class="n">unusedShort</span><span class="p">,</span><span class="n">listFlags</span><span class="p">,</span> <span class="n">lPosStmCache</span><span class="p">,</span> <span class="n">cbStmCache</span><span class="p">,</span>
            <span class="n">cchStmCache</span><span class="p">,</span> <span class="n">lem</span><span class="p">,</span> <span class="n">rgbHashParam</span><span class="p">,</span> <span class="n">cchName</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MSODrawing"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.MSODrawing">[docs]</a><span class="k">class</span> <span class="nc">MSODrawing</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="MSObj"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.MSObj">[docs]</a><span class="k">class</span> <span class="nc">MSObj</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="MSTxo"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.MSTxo">[docs]</a><span class="k">class</span> <span class="nc">MSTxo</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c">##    </span>
<span class="c"># &lt;p&gt; Represents a user &quot;comment&quot; or &quot;note&quot;.</span>
<span class="c"># Note objects are accessible through Sheet.{@link #Sheet.cell_note_map}.</span>
<span class="c"># &lt;br /&gt;-- New in version 0.7.2  </span>
<span class="c"># &lt;/p&gt;</span></div>
<div class="viewcode-block" id="Note"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Note">[docs]</a><span class="k">class</span> <span class="nc">Note</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># Author of note</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">##</span>
    <span class="c"># True if the containing column is hidden</span>
    <span class="n">col_hidden</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="c">##</span>
    <span class="c"># Column index</span>
    <span class="n">colx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># List of (offset_in_string, font_index) tuples.</span>
    <span class="c"># Unlike Sheet.{@link #Sheet.rich_text_runlist_map}, the first offset should always be 0.</span>
    <span class="n">rich_text_runlist</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># True if the containing row is hidden</span>
    <span class="n">row_hidden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Row index</span>
    <span class="n">rowx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># True if note is always shown</span>
    <span class="n">show</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Text of the note</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;Contains the attributes of a hyperlink.</span>
<span class="c"># Hyperlink objects are accessible through Sheet.{@link #Sheet.hyperlink_list}</span>
<span class="c"># and Sheet.{@link #Sheet.hyperlink_map}.</span>
<span class="c"># &lt;br /&gt;-- New in version 0.7.2</span>
<span class="c"># &lt;/p&gt;   </span></div>
<div class="viewcode-block" id="Hyperlink"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Hyperlink">[docs]</a><span class="k">class</span> <span class="nc">Hyperlink</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># Index of first row</span>
    <span class="n">frowx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Index of last row</span>
    <span class="n">lrowx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Index of first column</span>
    <span class="n">fcolx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Index of last column</span>
    <span class="n">lcolx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Type of hyperlink. Unicode string, one of &#39;url&#39;, &#39;unc&#39;,</span>
    <span class="c"># &#39;local file&#39;, &#39;workbook&#39;, &#39;unknown&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># The URL or file-path, depending in the type. Unicode string, except </span>
    <span class="c"># in the rare case of a local but non-existent file with non-ASCII</span>
    <span class="c"># characters in the name, in which case only the &quot;8.3&quot; filename is available,</span>
    <span class="c"># as a bytes (3.x) or str (2.x) string, &lt;i&gt;with unknown encoding.&lt;/i&gt;</span>
    <span class="n">url_or_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Description ... this is displayed in the cell,</span>
    <span class="c"># and should be identical to the cell value. Unicode string, or None. It seems</span>
    <span class="c"># impossible NOT to have a description created by the Excel UI.</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># Target frame. Unicode string. Note: I have not seen a case of this.</span>
    <span class="c"># It seems impossible to create one in the Excel UI.</span>
    <span class="n">target</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># &quot;Textmark&quot;: the piece after the &quot;#&quot; in </span>
    <span class="c"># &quot;http://docs.python.org/library#struct_module&quot;, or the Sheet1!A1:Z99</span>
    <span class="c"># part when type is &quot;workbook&quot;.</span>
    <span class="n">textmark</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># The text of the &quot;quick tip&quot; displayed when the cursor</span>
    <span class="c"># hovers over the hyperlink.</span>
    <span class="n">quicktip</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c"># === helpers ===</span>
</div>
<div class="viewcode-block" id="unpack_RK"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.unpack_RK">[docs]</a><span class="k">def</span> <span class="nf">unpack_RK</span><span class="p">(</span><span class="n">rk_str</span><span class="p">):</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">BYTES_ORD</span><span class="p">(</span><span class="n">rk_str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c"># There&#39;s a SIGNED 30-bit integer in there!</span>
        <span class="n">i</span><span class="p">,</span>  <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">rk_str</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span> <span class="c"># div by 4 to drop the 2 flag bits</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># It&#39;s the most significant 30 bits of an IEEE 754 64-bit FP number</span>
        <span class="n">d</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;d&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\0\0\0\0</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">BYTES_LITERAL</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">252</span><span class="p">))</span> <span class="o">+</span> <span class="n">rk_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="k">return</span> <span class="n">d</span>

<span class="c">##### =============== Cell ======================================== #####</span>
</div>
<span class="n">cellty_from_fmtty</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">FNU</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FUN</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FGE</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FDT</span><span class="p">:</span> <span class="n">XL_CELL_DATE</span><span class="p">,</span>
    <span class="n">FTX</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span> <span class="c"># Yes, a number can be formatted as text.</span>
    <span class="p">}</span>

<span class="n">ctype_text</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">XL_CELL_EMPTY</span><span class="p">:</span> <span class="s">&#39;empty&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_TEXT</span><span class="p">:</span> <span class="s">&#39;text&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_NUMBER</span><span class="p">:</span> <span class="s">&#39;number&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_DATE</span><span class="p">:</span> <span class="s">&#39;xldate&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_BOOLEAN</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_ERROR</span><span class="p">:</span> <span class="s">&#39;error&#39;</span><span class="p">,</span>
    <span class="n">XL_CELL_BLANK</span><span class="p">:</span> <span class="s">&#39;blank&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;Contains the data for one cell.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;WARNING: You don&#39;t call this class yourself. You access Cell objects</span>
<span class="c"># via methods of the {@link #Sheet} object(s) that you found in the {@link #Book} object that</span>
<span class="c"># was returned when you called xlrd.open_workbook(&quot;myfile.xls&quot;).&lt;/p&gt;</span>
<span class="c"># &lt;p&gt; Cell objects have three attributes: &lt;i&gt;ctype&lt;/i&gt; is an int, &lt;i&gt;value&lt;/i&gt;</span>
<span class="c"># (which depends on &lt;i&gt;ctype&lt;/i&gt;) and &lt;i&gt;xf_index&lt;/i&gt;.</span>
<span class="c"># If &quot;formatting_info&quot; is not enabled when the workbook is opened, xf_index will be None.</span>
<span class="c"># The following table describes the types of cells and how their values</span>
<span class="c"># are represented in Python.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;table border=&quot;1&quot; cellpadding=&quot;7&quot;&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;th&gt;Type symbol&lt;/th&gt;</span>
<span class="c"># &lt;th&gt;Type number&lt;/th&gt;</span>
<span class="c"># &lt;th&gt;Python value&lt;/th&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_EMPTY&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;empty string u&#39;&#39;&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_TEXT&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;a Unicode string&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_NUMBER&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;float&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_DATE&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;float&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_BOOLEAN&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;int; 1 means TRUE, 0 means FALSE&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_ERROR&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;5&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;int representing internal Excel codes; for a text representation,</span>
<span class="c"># refer to the supplied dictionary error_text_from_code&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;tr&gt;</span>
<span class="c"># &lt;td&gt;XL_CELL_BLANK&lt;/td&gt;</span>
<span class="c"># &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;</span>
<span class="c"># &lt;td&gt;empty string u&#39;&#39;. Note: this type will appear only when</span>
<span class="c"># open_workbook(..., formatting_info=True) is used.&lt;/td&gt;</span>
<span class="c"># &lt;/tr&gt;</span>
<span class="c"># &lt;/table&gt;</span>
<span class="c">#&lt;p&gt;&lt;/p&gt;</span>

<div class="viewcode-block" id="Cell"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Cell">[docs]</a><span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ctype&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;xf_index&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctype</span> <span class="o">=</span> <span class="n">ctype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="n">xf_index</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ctype_text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctype</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%r</span><span class="s"> (XF:</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ctype_text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctype</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># There is one and only one instance of an empty cell -- it&#39;s a singleton. This is it.</span>
<span class="c"># You may use a test like &quot;acell is empty_cell&quot;.</span></div>
<span class="n">empty_cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">XL_CELL_EMPTY</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="c">##### =============== Colinfo and Rowinfo ============================== #####</span>

<span class="c">##</span>
<span class="c"># Width and default formatting information that applies to one or</span>
<span class="c"># more columns in a sheet. Derived from COLINFO records.</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt; Here is the default hierarchy for width, according to the OOo docs:</span>
<span class="c">#</span>
<span class="c"># &lt;br /&gt;&quot;&quot;&quot;In BIFF3, if a COLINFO record is missing for a column,</span>
<span class="c"># the width specified in the record DEFCOLWIDTH is used instead.</span>
<span class="c">#</span>
<span class="c"># &lt;br /&gt;In BIFF4-BIFF7, the width set in this [COLINFO] record is only used,</span>
<span class="c"># if the corresponding bit for this column is cleared in the GCW</span>
<span class="c"># record, otherwise the column width set in the DEFCOLWIDTH record</span>
<span class="c"># is used (the STANDARDWIDTH record is always ignored in this case [see footnote!]).</span>
<span class="c">#</span>
<span class="c"># &lt;br /&gt;In BIFF8, if a COLINFO record is missing for a column,</span>
<span class="c"># the width specified in the record STANDARDWIDTH is used.</span>
<span class="c"># If this [STANDARDWIDTH] record is also missing,</span>
<span class="c"># the column width of the record DEFCOLWIDTH is used instead.&quot;&quot;&quot;</span>
<span class="c"># &lt;br /&gt;</span>
<span class="c">#</span>
<span class="c"># Footnote:  The docs on the GCW record say this:</span>
<span class="c"># &quot;&quot;&quot;&lt;br /&gt;</span>
<span class="c"># If a bit is set, the corresponding column uses the width set in the STANDARDWIDTH</span>
<span class="c"># record. If a bit is cleared, the corresponding column uses the width set in the</span>
<span class="c"># COLINFO record for this column.</span>
<span class="c"># &lt;br /&gt;If a bit is set, and the worksheet does not contain the STANDARDWIDTH record, or if</span>
<span class="c"># the bit is cleared, and the worksheet does not contain the COLINFO record, the DEFCOLWIDTH</span>
<span class="c"># record of the worksheet will be used instead.</span>
<span class="c"># &lt;br /&gt;&quot;&quot;&quot;&lt;br /&gt;</span>
<span class="c"># At the moment (2007-01-17) xlrd is going with the GCW version of the story.</span>
<span class="c"># Reference to the source may be useful: see the computed_column_width(colx) method</span>
<span class="c"># of the Sheet class.</span>
<span class="c"># &lt;br /&gt;-- New in version 0.6.1</span>
<span class="c"># &lt;/p&gt;</span>

<div class="viewcode-block" id="Colinfo"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Colinfo">[docs]</a><span class="k">class</span> <span class="nc">Colinfo</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># Width of the column in 1/256 of the width of the zero character,</span>
    <span class="c"># using default font (first FONT record in the file).</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># XF index to be used for formatting empty cells.</span>
    <span class="n">xf_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c">##</span>
    <span class="c"># 1 = column is hidden</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Value of a 1-bit flag whose purpose is unknown</span>
    <span class="c"># but is often seen set to 1</span>
    <span class="n">bit1_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Outline level of the column, in range(7).</span>
    <span class="c"># (0 = no outline)</span>
    <span class="n">outline_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = column is collapsed</span>
    <span class="n">collapsed</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<span class="n">_USE_SLOTS</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;Height and default formatting information that applies to a row in a sheet.</span>
<span class="c"># Derived from ROW records.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;height&lt;/b&gt;: Height of the row, in twips. One twip == 1/20 of a point.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;has_default_height&lt;/b&gt;: 0 = Row has custom height; 1 = Row has default height.&lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;outline_level&lt;/b&gt;: Outline level of the row (0 to 7) &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;outline_group_starts_ends&lt;/b&gt;: 1 = Outline group starts or ends here (depending on where the</span>
<span class="c"># outline buttons are located, see WSBOOL record [TODO ??]),</span>
<span class="c"># &lt;i&gt;and&lt;/i&gt; is collapsed &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;hidden&lt;/b&gt;: 1 = Row is hidden (manually, or by a filter or outline group) &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;height_mismatch&lt;/b&gt;: 1 = Row height and default font height do not match &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;has_default_xf_index&lt;/b&gt;: 1 = the xf_index attribute is usable; 0 = ignore it &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;xf_index&lt;/b&gt;: Index to default XF record for empty cells in this row.</span>
<span class="c"># Don&#39;t use this if has_default_xf_index == 0. &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;additional_space_above&lt;/b&gt;: This flag is set, if the upper border of at least one cell in this row</span>
<span class="c"># or if the lower border of at least one cell in the row above is</span>
<span class="c"># formatted with a thick line style. Thin and medium line styles are not</span>
<span class="c"># taken into account. &lt;/p&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;&lt;b&gt;additional_space_below&lt;/b&gt;: This flag is set, if the lower border of at least one cell in this row</span>
<span class="c"># or if the upper border of at least one cell in the row below is</span>
<span class="c"># formatted with a medium or thick line style. Thin line styles are not</span>
<span class="c"># taken into account. &lt;/p&gt;</span>

<div class="viewcode-block" id="Rowinfo"><a class="viewcode-back" href="../../xlrd.html#xlrd.sheet.Rowinfo">[docs]</a><span class="k">class</span> <span class="nc">Rowinfo</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">_USE_SLOTS</span><span class="p">:</span>
        <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;height&quot;</span><span class="p">,</span>
            <span class="s">&quot;has_default_height&quot;</span><span class="p">,</span>
            <span class="s">&quot;outline_level&quot;</span><span class="p">,</span>
            <span class="s">&quot;outline_group_starts_ends&quot;</span><span class="p">,</span>
            <span class="s">&quot;hidden&quot;</span><span class="p">,</span>
            <span class="s">&quot;height_mismatch&quot;</span><span class="p">,</span>
            <span class="s">&quot;has_default_xf_index&quot;</span><span class="p">,</span>
            <span class="s">&quot;xf_index&quot;</span><span class="p">,</span>
            <span class="s">&quot;additional_space_above&quot;</span><span class="p">,</span>
            <span class="s">&quot;additional_space_below&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_default_height</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outline_level</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outline_group_starts_ends</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_mismatch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_default_xf_index</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_above</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_below</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_default_height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_level</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_group_starts_ends</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height_mismatch</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_default_xf_index</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_above</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_below</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_default_height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_level</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_group_starts_ends</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height_mismatch</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_default_xf_index</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_above</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">additional_space_below</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">state</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../xlrd.html">xlrd</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>