<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>babel.messages.catalog &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for babel.messages.catalog</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    babel.messages.catalog</span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">    Data structures for message catalogs.</span>

<span class="sd">    :copyright: (c) 2013 by the Babel Team.</span>
<span class="sd">    :license: BSD, see LICENSE for more details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">cgi</span> <span class="kn">import</span> <span class="n">parse_header</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span> <span class="k">as</span> <span class="n">time_</span>
<span class="kn">from</span> <span class="nn">difflib</span> <span class="kn">import</span> <span class="n">get_close_matches</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">message_from_string</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">babel</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">VERSION</span>
<span class="kn">from</span> <span class="nn">babel.core</span> <span class="kn">import</span> <span class="n">Locale</span>
<span class="kn">from</span> <span class="nn">babel.dates</span> <span class="kn">import</span> <span class="n">format_datetime</span>
<span class="kn">from</span> <span class="nn">babel.messages.plurals</span> <span class="kn">import</span> <span class="n">get_plural</span>
<span class="kn">from</span> <span class="nn">babel.util</span> <span class="kn">import</span> <span class="n">odict</span><span class="p">,</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">LOCALTZ</span><span class="p">,</span> <span class="n">FixedOffsetTimezone</span>
<span class="kn">from</span> <span class="nn">babel._compat</span> <span class="kn">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">number_types</span><span class="p">,</span> <span class="n">PY2</span><span class="p">,</span> <span class="nb">cmp</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Message&#39;</span><span class="p">,</span> <span class="s">&#39;Catalog&#39;</span><span class="p">,</span> <span class="s">&#39;TranslationError&#39;</span><span class="p">]</span>


<span class="n">PYTHON_FORMAT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;(?x)</span>
<span class="s">    \%</span>
<span class="s">        (?:\(([\w]*)\))?</span>
<span class="s">        (</span>
<span class="s">            [-#0\ +]?(?:\*|[\d]+)?</span>
<span class="s">            (?:\.(?:\*|[\d]+))?</span>
<span class="s">            [hlL]?</span>
<span class="s">        )</span>
<span class="s">        ([diouxXeEfFgGcrs%])</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_parse_datetime_header</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;datetime&gt;.*?)(?P&lt;tzoffset&gt;[+-]\d{4})?$&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;datetime&#39;</span><span class="p">),</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M&#39;</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="c"># Separate the offset into a sign component, hours, and # minutes</span>
    <span class="n">tzoffset</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;tzoffset&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tzoffset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plus_minus_s</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">tzoffset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tzoffset</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">hours_offset_s</span><span class="p">,</span> <span class="n">mins_offset_s</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">rest</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="c"># Make them all integers</span>
        <span class="n">plus_minus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plus_minus_s</span> <span class="o">+</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">hours_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hours_offset_s</span><span class="p">)</span>
        <span class="n">mins_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mins_offset_s</span><span class="p">)</span>

        <span class="c"># Calculate net offset</span>
        <span class="n">net_mins_offset</span> <span class="o">=</span> <span class="n">hours_offset</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="n">net_mins_offset</span> <span class="o">+=</span> <span class="n">mins_offset</span>
        <span class="n">net_mins_offset</span> <span class="o">*=</span> <span class="n">plus_minus</span>

        <span class="c"># Create an offset object</span>
        <span class="n">tzoffset</span> <span class="o">=</span> <span class="n">FixedOffsetTimezone</span><span class="p">(</span><span class="n">net_mins_offset</span><span class="p">)</span>

        <span class="c"># Store the offset in a datetime object</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">tzoffset</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dt</span>


<div class="viewcode-block" id="Message"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Message">[docs]</a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Representation of a single message in a catalog.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">u&#39;&#39;</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="p">(),</span> <span class="n">flags</span><span class="o">=</span><span class="p">(),</span> <span class="n">auto_comments</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">user_comments</span><span class="o">=</span><span class="p">(),</span> <span class="n">previous_id</span><span class="o">=</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the message object.</span>

<span class="sd">        :param id: the message ID, or a ``(singular, plural)`` tuple for</span>
<span class="sd">                   pluralizable messages</span>
<span class="sd">        :param string: the translated message string, or a</span>
<span class="sd">                       ``(singular, plural)`` tuple for pluralizable messages</span>
<span class="sd">        :param locations: a sequence of ``(filenname, lineno)`` tuples</span>
<span class="sd">        :param flags: a set or sequence of flags</span>
<span class="sd">        :param auto_comments: a sequence of automatic comments for the message</span>
<span class="sd">        :param user_comments: a sequence of user comments for the message</span>
<span class="sd">        :param previous_id: the previous message ID, or a ``(singular, plural)``</span>
<span class="sd">                            tuple for pluralizable messages</span>
<span class="sd">        :param lineno: the line number on which the msgid line was found in the</span>
<span class="sd">                       PO file, if any</span>
<span class="sd">        :param context: the message context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span> <span class="c">#: The message ID</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluralizable</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">,</span> <span class="s">u&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span> <span class="c">#: The message translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">locations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;python-format&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s">&#39;python-format&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_comments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">auto_comments</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_comments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">user_comments</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_id</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">previous_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%r</span><span class="s"> (flags: </span><span class="si">%r</span><span class="s">)&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare Messages, taking into account plural ids&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">values_to_compare</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Message</span><span class="p">):</span>
                <span class="n">plural</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluralizable</span>
                <span class="n">obj_plural</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pluralizable</span>
                <span class="k">if</span> <span class="n">plural</span> <span class="ow">and</span> <span class="n">obj_plural</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">plural</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span>
                <span class="k">elif</span> <span class="n">obj_plural</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span>
        <span class="n">this</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">values_to_compare</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Message.clone"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Message.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_comments</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">user_comments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_id</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="Message.check"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Message.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run various validation checks on the message.  Some validations</span>
<span class="sd">        are only performed if the catalog is provided.  This method returns</span>
<span class="sd">        a sequence of `TranslationError` objects.</span>

<span class="sd">        :rtype: ``iterator``</span>
<span class="sd">        :param catalog: A catalog instance that is passed to the checkers</span>
<span class="sd">        :see: `Catalog.check` for a way to perform checks for all messages</span>
<span class="sd">              in a catalog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">babel.messages.checkers</span> <span class="kn">import</span> <span class="n">checkers</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">checker</span> <span class="ow">in</span> <span class="n">checkers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">checker</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TranslationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">errors</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fuzzy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether the translation is fuzzy.</span>

<span class="sd">        &gt;&gt;&gt; Message(&#39;foo&#39;).fuzzy</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; msg = Message(&#39;foo&#39;, &#39;foo&#39;, flags=[&#39;fuzzy&#39;])</span>
<span class="sd">        &gt;&gt;&gt; msg.fuzzy</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; msg</span>
<span class="sd">        &lt;Message &#39;foo&#39; (flags: [&#39;fuzzy&#39;])&gt;</span>

<span class="sd">        :type:  `bool`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;fuzzy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pluralizable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether the message is plurizable.</span>

<span class="sd">        &gt;&gt;&gt; Message(&#39;foo&#39;).pluralizable</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; Message((&#39;foo&#39;, &#39;bar&#39;)).pluralizable</span>
<span class="sd">        True</span>

<span class="sd">        :type:  `bool`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">python_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether the message contains Python-style parameters.</span>

<span class="sd">        &gt;&gt;&gt; Message(&#39;foo %(name)s bar&#39;).python_format</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; Message((&#39;foo %(name)s&#39;, &#39;foo %(name)s&#39;)).python_format</span>
<span class="sd">        True</span>

<span class="sd">        :type:  `bool`&quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">PYTHON_FORMAT</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TranslationError"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.TranslationError">[docs]</a><span class="k">class</span> <span class="nc">TranslationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception thrown by translation checkers when invalid message</span>
<span class="sd">    translations are encountered.&quot;&quot;&quot;</span>

</div>
<span class="n">DEFAULT_HEADER</span> <span class="o">=</span> <span class="s">u&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s"># Translations template for PROJECT.</span>
<span class="s"># Copyright (C) YEAR ORGANIZATION</span>
<span class="s"># This file is distributed under the same license as the PROJECT project.</span>
<span class="s"># FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.</span>
<span class="s">#&quot;&quot;&quot;</span>


<span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_parse_header</span><span class="p">(</span><span class="n">header_string</span><span class="p">):</span>
        <span class="c"># message_from_string only works for str, not for unicode</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">message_from_string</span><span class="p">(</span><span class="n">header_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>
        <span class="n">decoded_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="n">decoded_headers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">decoded_headers</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">_parse_header</span> <span class="o">=</span> <span class="n">message_from_string</span>


<div class="viewcode-block" id="Catalog"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog">[docs]</a><span class="k">class</span> <span class="nc">Catalog</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Representation of a message catalog.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">header_comment</span><span class="o">=</span><span class="n">DEFAULT_HEADER</span><span class="p">,</span>
                 <span class="n">project</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">copyright_holder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">msgid_bugs_address</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">creation_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">revision_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">last_translator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">language_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">charset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the catalog object.</span>

<span class="sd">        :param locale: the locale identifier or `Locale` object, or `None`</span>
<span class="sd">                       if the catalog is not bound to a locale (which basically</span>
<span class="sd">                       means it&#39;s a template)</span>
<span class="sd">        :param domain: the message domain</span>
<span class="sd">        :param header_comment: the header comment as string, or `None` for the</span>
<span class="sd">                               default header</span>
<span class="sd">        :param project: the project&#39;s name</span>
<span class="sd">        :param version: the project&#39;s version</span>
<span class="sd">        :param copyright_holder: the copyright holder of the catalog</span>
<span class="sd">        :param msgid_bugs_address: the email address or URL to submit bug</span>
<span class="sd">                                   reports to</span>
<span class="sd">        :param creation_date: the date the catalog was created</span>
<span class="sd">        :param revision_date: the date the catalog was revised</span>
<span class="sd">        :param last_translator: the name and email of the last translator</span>
<span class="sd">        :param language_team: the name and email of the language team</span>
<span class="sd">        :param charset: the encoding to use in the output (defaults to utf-8)</span>
<span class="sd">        :param fuzzy: the fuzzy bit on the catalog header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="c">#: The message domain</span>
        <span class="k">if</span> <span class="n">locale</span><span class="p">:</span>
            <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span> <span class="c">#: The locale or `None`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header_comment</span> <span class="o">=</span> <span class="n">header_comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">=</span> <span class="n">odict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span> <span class="ow">or</span> <span class="s">&#39;PROJECT&#39;</span> <span class="c">#: The project name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="ow">or</span> <span class="s">&#39;VERSION&#39;</span> <span class="c">#: The project version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyright_holder</span> <span class="o">=</span> <span class="n">copyright_holder</span> <span class="ow">or</span> <span class="s">&#39;ORGANIZATION&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msgid_bugs_address</span> <span class="o">=</span> <span class="n">msgid_bugs_address</span> <span class="ow">or</span> <span class="s">&#39;EMAIL@ADDRESS&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_translator</span> <span class="o">=</span> <span class="n">last_translator</span> <span class="ow">or</span> <span class="s">&#39;FULL NAME &lt;EMAIL@ADDRESS&gt;&#39;</span>
        <span class="sd">&quot;&quot;&quot;Name and email address of the last translator.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_team</span> <span class="o">=</span> <span class="n">language_team</span> <span class="ow">or</span> <span class="s">&#39;LANGUAGE &lt;LL@li.org&gt;&#39;</span>
        <span class="sd">&quot;&quot;&quot;Name and email address of the language team.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">charset</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span>

        <span class="k">if</span> <span class="n">creation_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">creation_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">LOCALTZ</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">creation_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">creation_date</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">:</span>
            <span class="n">creation_date</span> <span class="o">=</span> <span class="n">creation_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">LOCALTZ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span> <span class="o">=</span> <span class="n">creation_date</span> <span class="c">#: Creation date of the template</span>
        <span class="k">if</span> <span class="n">revision_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">revision_date</span> <span class="o">=</span> <span class="s">&#39;YEAR-MO-DA HO:MI+ZONE&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">revision_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">revision_date</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">:</span>
            <span class="n">revision_date</span> <span class="o">=</span> <span class="n">revision_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">LOCALTZ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span> <span class="o">=</span> <span class="n">revision_date</span> <span class="c">#: Last revision date of the catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzy</span> <span class="o">=</span> <span class="n">fuzzy</span> <span class="c">#: Catalog header fuzzy bit (`True` or `False`)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obsolete</span> <span class="o">=</span> <span class="n">odict</span><span class="p">()</span> <span class="c">#: Dictionary of obsolete messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_plurals</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plural_expr</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_get_header_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header_comment</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">LOCALTZ</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span><span class="p">,</span> <span class="s">&#39;strftime&#39;</span><span class="p">):</span>
            <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;PROJECT&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;VERSION&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;YEAR&#39;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ORGANIZATION&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyright_holder</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">:</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;Translations template&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> translations&#39;</span>
                                      <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="o">.</span><span class="n">english_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">comment</span>

    <span class="k">def</span> <span class="nf">_set_header_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header_comment</span> <span class="o">=</span> <span class="n">string</span>

    <span class="n">header_comment</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_header_comment</span><span class="p">,</span> <span class="n">_set_header_comment</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    The header comment for the catalog.</span>

<span class="s">    &gt;&gt;&gt; catalog = Catalog(project=&#39;Foobar&#39;, version=&#39;1.0&#39;,</span>
<span class="s">    ...                   copyright_holder=&#39;Foo Company&#39;)</span>
<span class="s">    &gt;&gt;&gt; print catalog.header_comment #doctest: +ELLIPSIS</span>
<span class="s">    # Translations template for Foobar.</span>
<span class="s">    # Copyright (C) ... Foo Company</span>
<span class="s">    # This file is distributed under the same license as the Foobar project.</span>
<span class="s">    # FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, ....</span>
<span class="s">    #</span>

<span class="s">    The header can also be set from a string. Any known upper-case variables</span>
<span class="s">    will be replaced when the header is retrieved again:</span>

<span class="s">    &gt;&gt;&gt; catalog = Catalog(project=&#39;Foobar&#39;, version=&#39;1.0&#39;,</span>
<span class="s">    ...                   copyright_holder=&#39;Foo Company&#39;)</span>
<span class="s">    &gt;&gt;&gt; catalog.header_comment = &#39;&#39;&#39;</span><span class="se">\\</span><span class="s"></span>
<span class="s">    ... # The POT for my really cool PROJECT project.</span>
<span class="s">    ... # Copyright (C) 1990-2003 ORGANIZATION</span>
<span class="s">    ... # This file is distributed under the same license as the PROJECT</span>
<span class="s">    ... # project.</span>
<span class="s">    ... #&#39;&#39;&#39;</span>
<span class="s">    &gt;&gt;&gt; print catalog.header_comment</span>
<span class="s">    # The POT for my really cool Foobar project.</span>
<span class="s">    # Copyright (C) 1990-2003 Foo Company</span>
<span class="s">    # This file is distributed under the same license as the Foobar</span>
<span class="s">    # project.</span>
<span class="s">    #</span>

<span class="s">    :type: `unicode`</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_mime_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Project-Id-Version&#39;</span><span class="p">,</span>
                        <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Report-Msgid-Bugs-To&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msgid_bugs_address</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;POT-Creation-Date&#39;</span><span class="p">,</span>
                        <span class="n">format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span><span class="p">,</span> <span class="s">&#39;yyyy-MM-dd HH:mmZ&#39;</span><span class="p">,</span>
                                        <span class="n">locale</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">time_</span><span class="p">)</span> <span class="o">+</span> <span class="n">number_types</span><span class="p">):</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;PO-Revision-Date&#39;</span><span class="p">,</span>
                            <span class="n">format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span><span class="p">,</span>
                                            <span class="s">&#39;yyyy-MM-dd HH:mmZ&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;PO-Revision-Date&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Last-Translator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_translator</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;LANGUAGE&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_team</span><span class="p">):</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Language-Team&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">language_team</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;LANGUAGE&#39;</span><span class="p">,</span>
                                                      <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Language-Team&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_team</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Plural-Forms&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plural_forms</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;MIME-Version&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span>
                        <span class="s">&#39;text/plain; charset=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">,</span> <span class="s">&#39;8bit&#39;</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Generated-By&#39;</span><span class="p">,</span> <span class="s">&#39;Babel </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">VERSION</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">headers</span>

    <span class="k">def</span> <span class="nf">_set_mime_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;project-id-version&#39;</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="s">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;report-msgid-bugs-to&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msgid_bugs_address</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;last-translator&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_translator</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;language-team&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">language_team</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;content-type&#39;</span><span class="p">:</span>
                <span class="n">mimetype</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;charset&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;charset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;plural-forms&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="s">&#39; ;&#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_plurals</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nplurals&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plural_expr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;plural&#39;</span><span class="p">,</span> <span class="s">&#39;(n != 1)&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;pot-creation-date&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span> <span class="o">=</span> <span class="n">_parse_datetime_header</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;po-revision-date&#39;</span><span class="p">:</span>
                <span class="c"># Keep the value if it&#39;s not the default one</span>
                <span class="k">if</span> <span class="s">&#39;YEAR&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">revision_date</span> <span class="o">=</span> <span class="n">_parse_datetime_header</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">mime_headers</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_mime_headers</span><span class="p">,</span> <span class="n">_set_mime_headers</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    The MIME headers of the catalog, used for the special ``msgid &quot;&quot;`` entry.</span>

<span class="s">    The behavior of this property changes slightly depending on whether a locale</span>
<span class="s">    is set or not, the latter indicating that the catalog is actually a template</span>
<span class="s">    for actual translations.</span>

<span class="s">    Here&#39;s an example of the output for such a catalog template:</span>

<span class="s">    &gt;&gt;&gt; from babel.dates import UTC</span>
<span class="s">    &gt;&gt;&gt; created = datetime(1990, 4, 1, 15, 30, tzinfo=UTC)</span>
<span class="s">    &gt;&gt;&gt; catalog = Catalog(project=&#39;Foobar&#39;, version=&#39;1.0&#39;,</span>
<span class="s">    ...                   creation_date=created)</span>
<span class="s">    &gt;&gt;&gt; for name, value in catalog.mime_headers:</span>
<span class="s">    ...     print &#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39; % (name, value)</span>
<span class="s">    Project-Id-Version: Foobar 1.0</span>
<span class="s">    Report-Msgid-Bugs-To: EMAIL@ADDRESS</span>
<span class="s">    POT-Creation-Date: 1990-04-01 15:30+0000</span>
<span class="s">    PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE</span>
<span class="s">    Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;</span>
<span class="s">    Language-Team: LANGUAGE &lt;LL@li.org&gt;</span>
<span class="s">    MIME-Version: 1.0</span>
<span class="s">    Content-Type: text/plain; charset=utf-8</span>
<span class="s">    Content-Transfer-Encoding: 8bit</span>
<span class="s">    Generated-By: Babel ...</span>

<span class="s">    And here&#39;s an example of the output when the locale is set:</span>

<span class="s">    &gt;&gt;&gt; revised = datetime(1990, 8, 3, 12, 0, tzinfo=UTC)</span>
<span class="s">    &gt;&gt;&gt; catalog = Catalog(locale=&#39;de_DE&#39;, project=&#39;Foobar&#39;, version=&#39;1.0&#39;,</span>
<span class="s">    ...                   creation_date=created, revision_date=revised,</span>
<span class="s">    ...                   last_translator=&#39;John Doe &lt;jd@example.com&gt;&#39;,</span>
<span class="s">    ...                   language_team=&#39;de_DE &lt;de@example.com&gt;&#39;)</span>
<span class="s">    &gt;&gt;&gt; for name, value in catalog.mime_headers:</span>
<span class="s">    ...     print &#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39; % (name, value)</span>
<span class="s">    Project-Id-Version: Foobar 1.0</span>
<span class="s">    Report-Msgid-Bugs-To: EMAIL@ADDRESS</span>
<span class="s">    POT-Creation-Date: 1990-04-01 15:30+0000</span>
<span class="s">    PO-Revision-Date: 1990-08-03 12:00+0000</span>
<span class="s">    Last-Translator: John Doe &lt;jd@example.com&gt;</span>
<span class="s">    Language-Team: de_DE &lt;de@example.com&gt;</span>
<span class="s">    Plural-Forms: nplurals=2; plural=(n != 1)</span>
<span class="s">    MIME-Version: 1.0</span>
<span class="s">    Content-Type: text/plain; charset=utf-8</span>
<span class="s">    Content-Transfer-Encoding: 8bit</span>
<span class="s">    Generated-By: Babel ...</span>

<span class="s">    :type: `list`</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_plurals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of plurals used by the catalog or locale.</span>

<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;en&#39;).num_plurals</span>
<span class="sd">        2</span>
<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;ga&#39;).num_plurals</span>
<span class="sd">        3</span>

<span class="sd">        :type: `int`&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_plurals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">get_plural</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_plurals</span> <span class="o">=</span> <span class="n">num</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_plurals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plural_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The plural expression used by the catalog or locale.</span>

<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;en&#39;).plural_expr</span>
<span class="sd">        &#39;(n != 1)&#39;</span>
<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;ga&#39;).plural_expr</span>
<span class="sd">        &#39;(n==1 ? 0 : n==2 ? 1 : 2)&#39;</span>

<span class="sd">        :type: `string_types`&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plural_expr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="s">&#39;(n != 1)&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">get_plural</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plural_expr</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plural_expr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plural_forms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the plural forms declaration for the locale.</span>

<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;en&#39;).plural_forms</span>
<span class="sd">        &#39;nplurals=2; plural=(n != 1)&#39;</span>
<span class="sd">        &gt;&gt;&gt; Catalog(locale=&#39;pt_BR&#39;).plural_forms</span>
<span class="sd">        &#39;nplurals=2; plural=(n &gt; 1)&#39;</span>

<span class="sd">        :type: `str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;nplurals=</span><span class="si">%s</span><span class="s">; plural=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_plurals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plural_expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the catalog has a message with the specified ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of messages in the catalog.</span>

<span class="sd">        This does not include the special ``msgid &quot;&quot;`` entry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterates through all the entries in the catalog, in the order they</span>
<span class="sd">        were added, yielding a `Message` object for every entry.</span>

<span class="sd">        :rtype: ``iterator``&quot;&quot;&quot;</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mime_headers</span><span class="p">:</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzy</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;fuzzy&#39;</span><span class="p">])</span>
        <span class="k">yield</span> <span class="n">Message</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">:</span>
            <span class="n">locale</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">locale</span>
        <span class="k">return</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%r%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the message with the specified ID.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the message with the specified ID.</span>

<span class="sd">        :param id: the message ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add or update the message with the specified ID.</span>

<span class="sd">        &gt;&gt;&gt; catalog = Catalog()</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;] = Message(u&#39;foo&#39;)</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;]</span>
<span class="sd">        &lt;Message u&#39;foo&#39; (flags: [])&gt;</span>

<span class="sd">        If a message with that ID is already in the catalog, it is updated</span>
<span class="sd">        to include the locations and flags of the new message.</span>

<span class="sd">        &gt;&gt;&gt; catalog = Catalog()</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;] = Message(u&#39;foo&#39;, locations=[(&#39;main.py&#39;, 1)])</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;].locations</span>
<span class="sd">        [(&#39;main.py&#39;, 1)]</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;] = Message(u&#39;foo&#39;, locations=[(&#39;utils.py&#39;, 5)])</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;].locations</span>
<span class="sd">        [(&#39;main.py&#39;, 1), (&#39;utils.py&#39;, 5)]</span>

<span class="sd">        :param id: the message ID</span>
<span class="sd">        :param message: the `Message` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">Message</span><span class="p">),</span> <span class="s">&#39;expected a Message object&#39;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">pluralizable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">current</span><span class="o">.</span><span class="n">pluralizable</span><span class="p">:</span>
                <span class="c"># The new message adds pluralization</span>
                <span class="n">current</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">id</span>
                <span class="n">current</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">string</span>
            <span class="n">current</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">locations</span> <span class="o">+</span>
                                              <span class="n">message</span><span class="o">.</span><span class="n">locations</span><span class="p">))</span>
            <span class="n">current</span><span class="o">.</span><span class="n">auto_comments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">auto_comments</span> <span class="o">+</span>
                                                  <span class="n">message</span><span class="o">.</span><span class="n">auto_comments</span><span class="p">))</span>
            <span class="n">current</span><span class="o">.</span><span class="n">user_comments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">user_comments</span> <span class="o">+</span>
                                                  <span class="n">message</span><span class="o">.</span><span class="n">user_comments</span><span class="p">))</span>
            <span class="n">current</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">message</span><span class="o">.</span><span class="n">flags</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">current</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="c"># special treatment for the header message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mime_headers</span> <span class="o">=</span> <span class="n">_parse_header</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_comment</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s">&#39;# </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span>
                                             <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">user_comments</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuzzy</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">fuzzy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)),</span> \
                    <span class="s">&#39;Expected sequence but got </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>

<div class="viewcode-block" id="Catalog.add"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="p">(),</span> <span class="n">flags</span><span class="o">=</span><span class="p">(),</span> <span class="n">auto_comments</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">user_comments</span><span class="o">=</span><span class="p">(),</span> <span class="n">previous_id</span><span class="o">=</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add or update the message with the specified ID.</span>

<span class="sd">        &gt;&gt;&gt; catalog = Catalog()</span>
<span class="sd">        &gt;&gt;&gt; catalog.add(u&#39;foo&#39;)</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; catalog[u&#39;foo&#39;]</span>
<span class="sd">        &lt;Message u&#39;foo&#39; (flags: [])&gt;</span>

<span class="sd">        This method simply constructs a `Message` object with the given</span>
<span class="sd">        arguments and invokes `__setitem__` with that object.</span>

<span class="sd">        :param id: the message ID, or a ``(singular, plural)`` tuple for</span>
<span class="sd">                   pluralizable messages</span>
<span class="sd">        :param string: the translated message string, or a</span>
<span class="sd">                       ``(singular, plural)`` tuple for pluralizable messages</span>
<span class="sd">        :param locations: a sequence of ``(filenname, lineno)`` tuples</span>
<span class="sd">        :param flags: a set or sequence of flags</span>
<span class="sd">        :param auto_comments: a sequence of automatic comments</span>
<span class="sd">        :param user_comments: a sequence of user comments</span>
<span class="sd">        :param previous_id: the previous message ID, or a ``(singular, plural)``</span>
<span class="sd">                            tuple for pluralizable messages</span>
<span class="sd">        :param lineno: the line number on which the msgid line was found in the</span>
<span class="sd">                       PO file, if any</span>
<span class="sd">        :param context: the message context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">locations</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">auto_comments</span><span class="p">,</span>
                          <span class="n">user_comments</span><span class="p">,</span> <span class="n">previous_id</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
                          <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">return</span> <span class="n">message</span>
</div>
<div class="viewcode-block" id="Catalog.check"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run various validation checks on the translations in the catalog.</span>

<span class="sd">        For every message which fails validation, this method yield a</span>
<span class="sd">        ``(message, errors)`` tuple, where ``message`` is the `Message` object</span>
<span class="sd">        and ``errors`` is a sequence of `TranslationError` objects.</span>

<span class="sd">        :rtype: ``iterator``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">catalog</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">message</span><span class="p">,</span> <span class="n">errors</span>
</div>
<div class="viewcode-block" id="Catalog.get"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the message with the specified ID and context.</span>

<span class="sd">        :param id: the message ID</span>
<span class="sd">        :param context: the message context, or ``None`` for no context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Catalog.delete"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the message with the specified ID and context.</span>

<span class="sd">        :param id: the message ID</span>
<span class="sd">        :param context: the message context, or ``None`` for no context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Catalog.update"><a class="viewcode-back" href="../../../babel.messages.html#babel.messages.catalog.Catalog.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">no_fuzzy_matching</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the catalog based on the given template catalog.</span>

<span class="sd">        &gt;&gt;&gt; from babel.messages import Catalog</span>
<span class="sd">        &gt;&gt;&gt; template = Catalog()</span>
<span class="sd">        &gt;&gt;&gt; template.add(&#39;green&#39;, locations=[(&#39;main.py&#39;, 99)])</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; template.add(&#39;blue&#39;, locations=[(&#39;main.py&#39;, 100)])</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; template.add((&#39;salad&#39;, &#39;salads&#39;), locations=[(&#39;util.py&#39;, 42)])</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; catalog = Catalog(locale=&#39;de_DE&#39;)</span>
<span class="sd">        &gt;&gt;&gt; catalog.add(&#39;blue&#39;, u&#39;blau&#39;, locations=[(&#39;main.py&#39;, 98)])</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; catalog.add(&#39;head&#39;, u&#39;Kopf&#39;, locations=[(&#39;util.py&#39;, 33)])</span>
<span class="sd">        &lt;Message ...&gt;</span>
<span class="sd">        &gt;&gt;&gt; catalog.add((&#39;salad&#39;, &#39;salads&#39;), (u&#39;Salat&#39;, u&#39;Salate&#39;),</span>
<span class="sd">        ...             locations=[(&#39;util.py&#39;, 38)])</span>
<span class="sd">        &lt;Message ...&gt;</span>

<span class="sd">        &gt;&gt;&gt; catalog.update(template)</span>
<span class="sd">        &gt;&gt;&gt; len(catalog)</span>
<span class="sd">        3</span>

<span class="sd">        &gt;&gt;&gt; msg1 = catalog[&#39;green&#39;]</span>
<span class="sd">        &gt;&gt;&gt; msg1.string</span>
<span class="sd">        &gt;&gt;&gt; msg1.locations</span>
<span class="sd">        [(&#39;main.py&#39;, 99)]</span>

<span class="sd">        &gt;&gt;&gt; msg2 = catalog[&#39;blue&#39;]</span>
<span class="sd">        &gt;&gt;&gt; msg2.string</span>
<span class="sd">        u&#39;blau&#39;</span>
<span class="sd">        &gt;&gt;&gt; msg2.locations</span>
<span class="sd">        [(&#39;main.py&#39;, 100)]</span>

<span class="sd">        &gt;&gt;&gt; msg3 = catalog[&#39;salad&#39;]</span>
<span class="sd">        &gt;&gt;&gt; msg3.string</span>
<span class="sd">        (u&#39;Salat&#39;, u&#39;Salate&#39;)</span>
<span class="sd">        &gt;&gt;&gt; msg3.locations</span>
<span class="sd">        [(&#39;util.py&#39;, 42)]</span>

<span class="sd">        Messages that are in the catalog but not in the template are removed</span>
<span class="sd">        from the main collection, but can still be accessed via the `obsolete`</span>
<span class="sd">        member:</span>

<span class="sd">        &gt;&gt;&gt; &#39;head&#39; in catalog</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; catalog.obsolete.values()</span>
<span class="sd">        [&lt;Message &#39;head&#39; (flags: [])&gt;]</span>

<span class="sd">        :param template: the reference catalog, usually read from a POT file</span>
<span class="sd">        :param no_fuzzy_matching: whether to use fuzzy matching of message IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">=</span> <span class="n">odict</span><span class="p">()</span>

        <span class="c"># Prepare for fuzzy matching</span>
        <span class="n">fuzzy_candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">no_fuzzy_matching</span><span class="p">:</span>
            <span class="n">fuzzy_candidates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="n">msgid</span><span class="p">),</span> <span class="n">messages</span><span class="p">[</span><span class="n">msgid</span><span class="p">]</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">msgid</span> <span class="ow">in</span> <span class="n">messages</span> <span class="k">if</span> <span class="n">msgid</span> <span class="ow">and</span> <span class="n">messages</span><span class="p">[</span><span class="n">msgid</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
            <span class="p">])</span>
        <span class="n">fuzzy_matches</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">fuzzy</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">oldkey</span> <span class="o">!=</span> <span class="n">newkey</span><span class="p">:</span>
                <span class="n">fuzzy</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">fuzzy_matches</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">oldkey</span><span class="p">)</span>
                <span class="n">oldmsg</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">oldkey</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldmsg</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">previous_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldmsg</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">previous_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">oldmsg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oldmsg</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">oldkey</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">message</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">oldmsg</span><span class="o">.</span><span class="n">string</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">fuzzy</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s">u&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_plurals</span><span class="p">:</span>
                    <span class="n">fuzzy</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">oldmsg</span><span class="o">.</span><span class="n">string</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">fuzzy</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">message</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">message</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">oldmsg</span><span class="o">.</span><span class="n">flags</span>
            <span class="k">if</span> <span class="n">fuzzy</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">([</span><span class="s">u&#39;fuzzy&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>

        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">template</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_for</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
                    <span class="n">_merge</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">no_fuzzy_matching</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="c"># do some fuzzy matching with difflib</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="n">matchkey</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># just the msgid, no context</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">matchkey</span> <span class="o">=</span> <span class="n">key</span>
                        <span class="n">matches</span> <span class="o">=</span> <span class="n">get_close_matches</span><span class="p">(</span><span class="n">matchkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                                    <span class="n">fuzzy_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                            <span class="n">newkey</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">newctxt</span> <span class="o">=</span> <span class="n">fuzzy_candidates</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">newctxt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="n">newkey</span> <span class="o">=</span> <span class="n">newkey</span><span class="p">,</span> <span class="n">newctxt</span>
                            <span class="n">_merge</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">newkey</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                            <span class="k">continue</span>

                    <span class="bp">self</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>

        <span class="k">for</span> <span class="n">msgid</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">no_fuzzy_matching</span> <span class="ow">or</span> <span class="n">msgid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fuzzy_matches</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obsolete</span><span class="p">[</span><span class="n">msgid</span><span class="p">]</span> <span class="o">=</span> <span class="n">remaining</span><span class="p">[</span><span class="n">msgid</span><span class="p">]</span>
        <span class="c"># Make updated catalog&#39;s POT-Creation-Date equal to the template</span>
        <span class="c"># used to update the catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">creation_date</span>
</div>
    <span class="k">def</span> <span class="nf">_key_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The key for a message is just the singular ID even for pluralizable</span>
<span class="sd">        messages, but is a ``(msgid, msgctxt)`` tuple for context-specific</span>
<span class="sd">        messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>