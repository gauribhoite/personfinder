<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>babel.numbers &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for babel.numbers</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    babel.numbers</span>
<span class="sd">    ~~~~~~~~~~~~~</span>

<span class="sd">    Locale dependent formatting and parsing of numeric data.</span>

<span class="sd">    The default locale for the functions in this module is determined by the</span>
<span class="sd">    following environment variables, in that order:</span>

<span class="sd">     * ``LC_NUMERIC``,</span>
<span class="sd">     * ``LC_ALL``, and</span>
<span class="sd">     * ``LANG``</span>

<span class="sd">    :copyright: (c) 2013 by the Babel Team.</span>
<span class="sd">    :license: BSD, see LICENSE for more details.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c"># TODO:</span>
<span class="c">#  Padding and rounding increments in pattern:</span>
<span class="c">#  - http://www.unicode.org/reports/tr35/ (Appendix G.6)</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">InvalidOperation</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span> <span class="k">as</span> <span class="n">date_</span><span class="p">,</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">datetime_</span>

<span class="kn">from</span> <span class="nn">babel.core</span> <span class="kn">import</span> <span class="n">default_locale</span><span class="p">,</span> <span class="n">Locale</span><span class="p">,</span> <span class="n">get_global</span>
<span class="kn">from</span> <span class="nn">babel._compat</span> <span class="kn">import</span> <span class="n">range_type</span>


<span class="n">LC_NUMERIC</span> <span class="o">=</span> <span class="n">default_locale</span><span class="p">(</span><span class="s">&#39;LC_NUMERIC&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="get_currency_name"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_currency_name">[docs]</a><span class="k">def</span> <span class="nf">get_currency_name</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the name used by the locale for the specified currency.</span>

<span class="sd">    &gt;&gt;&gt; get_currency_name(&#39;USD&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;US Dollar&#39;</span>
<span class="sd">    </span>
<span class="sd">    .. versionadded:: 0.9.4</span>

<span class="sd">    :param currency: the currency code</span>
<span class="sd">    :param count: the optional count.  If provided the currency name</span>
<span class="sd">                  will be pluralized to that number if possible.</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plural_form</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">plural_form</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="n">plural_names</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s">&#39;currency_names_plural&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">plural_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plural_names</span><span class="p">[</span><span class="n">currency</span><span class="p">][</span><span class="n">plural_form</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">loc</span><span class="o">.</span><span class="n">currencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_currency_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_currency_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_currency_symbol</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the symbol used by the locale for the specified currency.</span>

<span class="sd">    &gt;&gt;&gt; get_currency_symbol(&#39;USD&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;$&#39;</span>

<span class="sd">    :param currency: the currency code</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">currency_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_territory_currencies"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_territory_currencies">[docs]</a><span class="k">def</span> <span class="nf">get_territory_currencies</span><span class="p">(</span><span class="n">territory</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                             <span class="n">tender</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">non_tender</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                             <span class="n">include_details</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the list of currencies for the given territory that are valid for</span>
<span class="sd">    the given date range.  In addition to that the currency database</span>
<span class="sd">    distinguishes between tender and non-tender currencies.  By default only</span>
<span class="sd">    tender currencies are returned.</span>

<span class="sd">    The return value is a list of all currencies roughly ordered by the time</span>
<span class="sd">    of when the currency became active.  The longer the currency is being in</span>
<span class="sd">    use the more to the left of the list it will be.</span>

<span class="sd">    The start date defaults to today.  If no end date is given it will be the</span>
<span class="sd">    same as the start date.  Otherwise a range can be defined.  For instance</span>
<span class="sd">    this can be used to find the currencies in use in Austria between 1995 and</span>
<span class="sd">    2011:</span>

<span class="sd">    &gt;&gt;&gt; from datetime import date</span>
<span class="sd">    &gt;&gt;&gt; get_territory_currencies(&#39;AT&#39;, date(1995, 1, 1), date(2011, 1, 1))</span>
<span class="sd">    [&#39;ATS&#39;, &#39;EUR&#39;]</span>

<span class="sd">    Likewise it&#39;s also possible to find all the currencies in use on a</span>
<span class="sd">    single date:</span>

<span class="sd">    &gt;&gt;&gt; get_territory_currencies(&#39;AT&#39;, date(1995, 1, 1))</span>
<span class="sd">    [&#39;ATS&#39;]</span>
<span class="sd">    &gt;&gt;&gt; get_territory_currencies(&#39;AT&#39;, date(2011, 1, 1))</span>
<span class="sd">    [&#39;EUR&#39;]</span>

<span class="sd">    By default the return value only includes tender currencies.  This</span>
<span class="sd">    however can be changed:</span>

<span class="sd">    &gt;&gt;&gt; get_territory_currencies(&#39;US&#39;)</span>
<span class="sd">    [&#39;USD&#39;]</span>
<span class="sd">    &gt;&gt;&gt; get_territory_currencies(&#39;US&#39;, tender=False, non_tender=True)</span>
<span class="sd">    [&#39;USN&#39;, &#39;USS&#39;]</span>

<span class="sd">    .. versionadded:: 2.0</span>

<span class="sd">    :param territory: the name of the territory to find the currency fo</span>
<span class="sd">    :param start_date: the start date.  If not given today is assumed.</span>
<span class="sd">    :param end_date: the end date.  If not given the start date is assumed.</span>
<span class="sd">    :param tender: controls whether tender currencies should be included.</span>
<span class="sd">    :param non_tender: controls whether non-tender currencies should be</span>
<span class="sd">                       included.</span>
<span class="sd">    :param include_details: if set to `True`, instead of returning currency</span>
<span class="sd">                            codes the return value will be dictionaries</span>
<span class="sd">                            with detail information.  In that case each</span>
<span class="sd">                            dictionary will have the keys ``&#39;currency&#39;``,</span>
<span class="sd">                            ``&#39;from&#39;``, ``&#39;to&#39;``, and ``&#39;tender&#39;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">currencies</span> <span class="o">=</span> <span class="n">get_global</span><span class="p">(</span><span class="s">&#39;territory_currencies&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">date_</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">datetime_</span><span class="p">):</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">datetime_</span><span class="p">):</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="n">curs</span> <span class="o">=</span> <span class="n">currencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">territory</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="p">())</span>
    <span class="c"># TODO: validate that the territory exists</span>

    <span class="k">def</span> <span class="nf">_is_active</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">currency_code</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">is_tender</span> <span class="ow">in</span> <span class="n">curs</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">is_tender</span> <span class="ow">and</span> <span class="n">tender</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="ow">not</span> <span class="n">is_tender</span> <span class="ow">and</span> <span class="n">non_tender</span><span class="p">))</span> <span class="ow">and</span> <span class="n">_is_active</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">include_details</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;currency&#39;</span><span class="p">:</span> <span class="n">currency_code</span><span class="p">,</span>
                    <span class="s">&#39;from&#39;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span>
                    <span class="s">&#39;to&#39;</span><span class="p">:</span> <span class="n">end</span><span class="p">,</span>
                    <span class="s">&#39;tender&#39;</span><span class="p">:</span> <span class="n">is_tender</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currency_code</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="get_decimal_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_decimal_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_decimal_symbol</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the symbol used by the locale to separate decimal fractions.</span>

<span class="sd">    &gt;&gt;&gt; get_decimal_symbol(&#39;en_US&#39;)</span>
<span class="sd">    u&#39;.&#39;</span>

<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">number_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;decimal&#39;</span><span class="p">,</span> <span class="s">u&#39;.&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_plus_sign_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_plus_sign_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_plus_sign_symbol</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the plus sign symbol used by the current locale.</span>

<span class="sd">    &gt;&gt;&gt; get_plus_sign_symbol(&#39;en_US&#39;)</span>
<span class="sd">    u&#39;+&#39;</span>

<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">number_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;plusSign&#39;</span><span class="p">,</span> <span class="s">u&#39;+&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_minus_sign_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_minus_sign_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_minus_sign_symbol</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the plus sign symbol used by the current locale.</span>

<span class="sd">    &gt;&gt;&gt; get_minus_sign_symbol(&#39;en_US&#39;)</span>
<span class="sd">    u&#39;-&#39;</span>

<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">number_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;minusSign&#39;</span><span class="p">,</span> <span class="s">u&#39;-&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_exponential_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_exponential_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_exponential_symbol</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the symbol used by the locale to separate mantissa and exponent.</span>

<span class="sd">    &gt;&gt;&gt; get_exponential_symbol(&#39;en_US&#39;)</span>
<span class="sd">    u&#39;E&#39;</span>

<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">number_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;exponential&#39;</span><span class="p">,</span> <span class="s">u&#39;E&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_group_symbol"><a class="viewcode-back" href="../../babel.html#babel.numbers.get_group_symbol">[docs]</a><span class="k">def</span> <span class="nf">get_group_symbol</span><span class="p">(</span><span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the symbol used by the locale to separate groups of thousands.</span>

<span class="sd">    &gt;&gt;&gt; get_group_symbol(&#39;en_US&#39;)</span>
<span class="sd">    u&#39;,&#39;</span>

<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span><span class="o">.</span><span class="n">number_symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="s">u&#39;,&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_number"><a class="viewcode-back" href="../../babel.html#babel.numbers.format_number">[docs]</a><span class="k">def</span> <span class="nf">format_number</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">u&quot;&quot;&quot;Return the given number formatted for a specific locale.</span>

<span class="sd">    &gt;&gt;&gt; format_number(1099, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1,099&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_number(1099, locale=&#39;de_DE&#39;)</span>
<span class="sd">    u&#39;1.099&#39;</span>


<span class="sd">    :param number: the number to format</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Do we really need this one?</span>
    <span class="k">return</span> <span class="n">format_decimal</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">locale</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_decimal"><a class="viewcode-back" href="../../babel.html#babel.numbers.format_decimal">[docs]</a><span class="k">def</span> <span class="nf">format_decimal</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">u&quot;&quot;&quot;Return the given decimal number formatted for a specific locale.</span>

<span class="sd">    &gt;&gt;&gt; format_decimal(1.2345, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1.234&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_decimal(1.2346, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1.235&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_decimal(-1.2346, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;-1.235&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_decimal(1.2345, locale=&#39;sv_SE&#39;)</span>
<span class="sd">    u&#39;1,234&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_decimal(1.2345, locale=&#39;de&#39;)</span>
<span class="sd">    u&#39;1,234&#39;</span>

<span class="sd">    The appropriate thousands grouping and the decimal separator are used for</span>
<span class="sd">    each locale:</span>

<span class="sd">    &gt;&gt;&gt; format_decimal(12345.5, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;12,345.5&#39;</span>

<span class="sd">    :param number: the number to format</span>
<span class="sd">    :param format:</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">format</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">decimal_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">parse_pattern</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_currency"><a class="viewcode-back" href="../../babel.html#babel.numbers.format_currency">[docs]</a><span class="k">def</span> <span class="nf">format_currency</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">u&quot;&quot;&quot;Return formatted currency value.</span>

<span class="sd">    &gt;&gt;&gt; format_currency(1099.98, &#39;USD&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;$1,099.98&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_currency(1099.98, &#39;USD&#39;, locale=&#39;es_CO&#39;)</span>
<span class="sd">    u&#39;1.099,98\\xa0US$&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_currency(1099.98, &#39;EUR&#39;, locale=&#39;de_DE&#39;)</span>
<span class="sd">    u&#39;1.099,98\\xa0\\u20ac&#39;</span>

<span class="sd">    The pattern can also be specified explicitly.  The currency is</span>
<span class="sd">    placed with the &#39;¤&#39; sign.  As the sign gets repeated the format</span>
<span class="sd">    expands (¤ being the symbol, ¤¤ is the currency abbreviation and</span>
<span class="sd">    ¤¤¤ is the full name of the currency):</span>

<span class="sd">    &gt;&gt;&gt; format_currency(1099.98, &#39;EUR&#39;, u&#39;\xa4\xa4 #,##0.00&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;EUR 1,099.98&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_currency(1099.98, &#39;EUR&#39;, u&#39;#,##0.00 \xa4\xa4\xa4&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1,099.98 euros&#39;</span>

<span class="sd">    :param number: the number to format</span>
<span class="sd">    :param currency: the currency code</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">format</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">currency_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">parse_pattern</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="n">currency</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_percent"><a class="viewcode-back" href="../../babel.html#babel.numbers.format_percent">[docs]</a><span class="k">def</span> <span class="nf">format_percent</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return formatted percent value for a specific locale.</span>

<span class="sd">    &gt;&gt;&gt; format_percent(0.34, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;34%&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_percent(25.1234, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;2,512%&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_percent(25.1234, locale=&#39;sv_SE&#39;)</span>
<span class="sd">    u&#39;2\\xa0512\\xa0%&#39;</span>

<span class="sd">    The format pattern can also be specified explicitly:</span>

<span class="sd">    &gt;&gt;&gt; format_percent(25.1234, u&#39;#,##0\u2030&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;25,123\u2030&#39;</span>

<span class="sd">    :param number: the percent number to format</span>
<span class="sd">    :param format:</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">format</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">percent_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">parse_pattern</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_scientific"><a class="viewcode-back" href="../../babel.html#babel.numbers.format_scientific">[docs]</a><span class="k">def</span> <span class="nf">format_scientific</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return value formatted in scientific notation for a specific locale.</span>

<span class="sd">    &gt;&gt;&gt; format_scientific(10000, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1E4&#39;</span>

<span class="sd">    The format pattern can also be specified explicitly:</span>

<span class="sd">    &gt;&gt;&gt; format_scientific(1234567, u&#39;##0E00&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    u&#39;1.23E06&#39;</span>

<span class="sd">    :param number: the number to format</span>
<span class="sd">    :param format:</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">format</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">scientific_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">parse_pattern</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NumberFormatError"><a class="viewcode-back" href="../../babel.html#babel.numbers.NumberFormatError">[docs]</a><span class="k">class</span> <span class="nc">NumberFormatError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when a string cannot be parsed into a number.&quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="parse_number"><a class="viewcode-back" href="../../babel.html#babel.numbers.parse_number">[docs]</a><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse localized number string into an integer.</span>

<span class="sd">    &gt;&gt;&gt; parse_number(&#39;1,099&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    1099</span>
<span class="sd">    &gt;&gt;&gt; parse_number(&#39;1.099&#39;, locale=&#39;de_DE&#39;)</span>
<span class="sd">    1099</span>

<span class="sd">    When the given string cannot be parsed, an exception is raised:</span>

<span class="sd">    &gt;&gt;&gt; parse_number(&#39;1.099,98&#39;, locale=&#39;de&#39;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    NumberFormatError: &#39;1.099,98&#39; is not a valid number</span>

<span class="sd">    :param string: the string to parse</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    :return: the parsed number</span>
<span class="sd">    :raise `NumberFormatError`: if the string can not be converted to a number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">get_group_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NumberFormatError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not a valid number&#39;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="parse_decimal"><a class="viewcode-back" href="../../babel.html#babel.numbers.parse_decimal">[docs]</a><span class="k">def</span> <span class="nf">parse_decimal</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LC_NUMERIC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse localized decimal string into a decimal.</span>

<span class="sd">    &gt;&gt;&gt; parse_decimal(&#39;1,099.98&#39;, locale=&#39;en_US&#39;)</span>
<span class="sd">    Decimal(&#39;1099.98&#39;)</span>
<span class="sd">    &gt;&gt;&gt; parse_decimal(&#39;1.099,98&#39;, locale=&#39;de&#39;)</span>
<span class="sd">    Decimal(&#39;1099.98&#39;)</span>

<span class="sd">    When the given string cannot be parsed, an exception is raised:</span>

<span class="sd">    &gt;&gt;&gt; parse_decimal(&#39;2,109,998&#39;, locale=&#39;de&#39;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    NumberFormatError: &#39;2,109,998&#39; is not a valid decimal number</span>

<span class="sd">    :param string: the string to parse</span>
<span class="sd">    :param locale: the `Locale` object or locale identifier</span>
<span class="sd">    :raise NumberFormatError: if the string can not be converted to a</span>
<span class="sd">                              decimal number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">get_group_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">get_decimal_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">),</span> <span class="s">&#39;.&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">InvalidOperation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NumberFormatError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not a valid decimal number&#39;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>

</div>
<span class="n">PREFIX_END</span> <span class="o">=</span> <span class="s">r&#39;[^0-9@#.,]&#39;</span>
<span class="n">NUMBER_TOKEN</span> <span class="o">=</span> <span class="s">r&#39;[0-9@#.,E+]&#39;</span>

<span class="n">PREFIX_PATTERN</span> <span class="o">=</span> <span class="s">r&quot;(?P&lt;prefix&gt;(?:&#39;[^&#39;]*&#39;|</span><span class="si">%s</span><span class="s">)*)&quot;</span> <span class="o">%</span> <span class="n">PREFIX_END</span>
<span class="n">NUMBER_PATTERN</span> <span class="o">=</span> <span class="s">r&quot;(?P&lt;number&gt;</span><span class="si">%s</span><span class="s">+)&quot;</span> <span class="o">%</span> <span class="n">NUMBER_TOKEN</span>
<span class="n">SUFFIX_PATTERN</span> <span class="o">=</span> <span class="s">r&quot;(?P&lt;suffix&gt;.*)&quot;</span>

<span class="n">number_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PREFIX_PATTERN</span><span class="p">,</span> <span class="n">NUMBER_PATTERN</span><span class="p">,</span>
                                    <span class="n">SUFFIX_PATTERN</span><span class="p">))</span>

<div class="viewcode-block" id="split_number"><a class="viewcode-back" href="../../babel.html#babel.numbers.split_number">[docs]</a><span class="k">def</span> <span class="nf">split_number</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a number into a (intasstring, fractionasstring) tuple&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="c"># NB can&#39;t just do text = str(value) as str repr of Decimal may be</span>
        <span class="c"># in scientific notation, e.g. for small numbers.</span>

        <span class="n">sign</span><span class="p">,</span> <span class="n">digits</span><span class="p">,</span> <span class="n">exp</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">()</span>
        <span class="c"># build list of digits in reverse order, then reverse+join</span>
        <span class="c"># as per http://docs.python.org/library/decimal.html#recipes</span>
        <span class="n">int_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">frac_part</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">digits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">digits</span><span class="p">))</span>

        <span class="c"># get figures after decimal point</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">):</span>
            <span class="c"># add digit if available, else 0</span>
            <span class="k">if</span> <span class="n">digits</span><span class="p">:</span>
                <span class="n">frac_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frac_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>

        <span class="c"># add in some zeroes...</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">exp</span><span class="p">):</span>
            <span class="n">int_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>

        <span class="c"># and the rest</span>
        <span class="k">while</span> <span class="n">digits</span><span class="p">:</span>
            <span class="n">int_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

        <span class="c"># if &lt; 1, int_part must be set to &#39;0&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_part</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">int_part</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>

        <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">int_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">int_part</span><span class="p">)),</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">frac_part</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%.9f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">text</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

</div>
<div class="viewcode-block" id="bankersround"><a class="viewcode-back" href="../../babel.html#babel.numbers.bankersround">[docs]</a><span class="k">def</span> <span class="nf">bankersround</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Round a number to a given precision.</span>

<span class="sd">    Works like round() except that the round-half-even (banker&#39;s rounding)</span>
<span class="sd">    algorithm is used instead of round-half-up.</span>

<span class="sd">    &gt;&gt;&gt; bankersround(5.5, 0)</span>
<span class="sd">    6.0</span>
<span class="sd">    &gt;&gt;&gt; bankersround(6.5, 0)</span>
<span class="sd">    6.0</span>
<span class="sd">    &gt;&gt;&gt; bankersround(-6.5, 0)</span>
<span class="sd">    -6.0</span>
<span class="sd">    &gt;&gt;&gt; bankersround(1234.0, -2)</span>
<span class="sd">    1200.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="mi">1</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">split_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">ndigits</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">&#39;5&#39;</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;5&#39;</span> <span class="ow">and</span> <span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;13579&#39;</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;5&#39;</span><span class="p">:</span>     <span class="c"># previous digit is even</span>
        <span class="c"># We round up unless all following digits are zero.</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">range_type</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">digits</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">add</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">ndigits</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">+</span> <span class="n">add</span><span class="p">))</span> <span class="o">/</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sign</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">+</span> <span class="n">add</span><span class="p">))</span> <span class="o">/</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sign</span>

</div>
<div class="viewcode-block" id="parse_grouping"><a class="viewcode-back" href="../../babel.html#babel.numbers.parse_grouping">[docs]</a><span class="k">def</span> <span class="nf">parse_grouping</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse primary and secondary digit grouping</span>

<span class="sd">    &gt;&gt;&gt; parse_grouping(&#39;##&#39;)</span>
<span class="sd">    (1000, 1000)</span>
<span class="sd">    &gt;&gt;&gt; parse_grouping(&#39;#,###&#39;)</span>
<span class="sd">    (3, 3)</span>
<span class="sd">    &gt;&gt;&gt; parse_grouping(&#39;#,####,###&#39;)</span>
<span class="sd">    (3, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">g1</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="n">g1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g1</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">g1</span> <span class="o">-</span> <span class="n">g2</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

</div>
<div class="viewcode-block" id="parse_pattern"><a class="viewcode-back" href="../../babel.html#babel.numbers.parse_pattern">[docs]</a><span class="k">def</span> <span class="nf">parse_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse number format patterns&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">NumberPattern</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pattern</span>

    <span class="k">def</span> <span class="nf">_match_number</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">number_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid number pattern </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pattern</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

    <span class="c"># Do we have a negative subpattern?</span>
    <span class="k">if</span> <span class="s">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
        <span class="n">pattern</span><span class="p">,</span> <span class="n">neg_pattern</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pos_prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">pos_suffix</span> <span class="o">=</span> <span class="n">_match_number</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">neg_prefix</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">neg_suffix</span> <span class="o">=</span> <span class="n">_match_number</span><span class="p">(</span><span class="n">neg_pattern</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pos_prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">pos_suffix</span> <span class="o">=</span> <span class="n">_match_number</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">neg_prefix</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">pos_prefix</span>
        <span class="n">neg_suffix</span> <span class="o">=</span> <span class="n">pos_suffix</span>
    <span class="k">if</span> <span class="s">&#39;E&#39;</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">exp</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">&#39;@&#39;</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">number</span> <span class="ow">and</span> <span class="s">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Significant digit patterns can not contain &#39;</span>
                             <span class="s">&#39;&quot;@&quot; or &quot;0&quot;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
        <span class="n">integer</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">integer</span> <span class="o">=</span> <span class="n">number</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">parse_precision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the min and max allowed digits&quot;&quot;&quot;</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&#39;@0&#39;</span><span class="p">:</span>
                <span class="nb">min</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">max</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;#&#39;</span><span class="p">:</span>
                <span class="nb">max</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;,&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span>

    <span class="n">int_prec</span> <span class="o">=</span> <span class="n">parse_precision</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
    <span class="n">frac_prec</span> <span class="o">=</span> <span class="n">parse_precision</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
        <span class="n">frac_prec</span> <span class="o">=</span> <span class="n">parse_precision</span><span class="p">(</span><span class="n">integer</span><span class="o">+</span><span class="n">fraction</span><span class="p">)</span>
        <span class="n">exp_plus</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">exp_prec</span> <span class="o">=</span> <span class="n">parse_precision</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp_plus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">exp_prec</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">grouping</span> <span class="o">=</span> <span class="n">parse_grouping</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">NumberPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_prefix</span><span class="p">,</span> <span class="n">neg_prefix</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">pos_suffix</span><span class="p">,</span> <span class="n">neg_suffix</span><span class="p">),</span> <span class="n">grouping</span><span class="p">,</span>
                         <span class="n">int_prec</span><span class="p">,</span> <span class="n">frac_prec</span><span class="p">,</span>
                         <span class="n">exp_prec</span><span class="p">,</span> <span class="n">exp_plus</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NumberPattern"><a class="viewcode-back" href="../../babel.html#babel.numbers.NumberPattern">[docs]</a><span class="k">class</span> <span class="nc">NumberPattern</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span>
                 <span class="n">int_prec</span><span class="p">,</span> <span class="n">frac_prec</span><span class="p">,</span> <span class="n">exp_prec</span><span class="p">,</span> <span class="n">exp_plus</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grouping</span> <span class="o">=</span> <span class="n">grouping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span> <span class="o">=</span> <span class="n">int_prec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac_prec</span> <span class="o">=</span> <span class="n">frac_prec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_prec</span> <span class="o">=</span> <span class="n">exp_prec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_plus</span> <span class="o">=</span> <span class="n">exp_plus</span>
        <span class="k">if</span> <span class="s">&#39;%&#39;</span> <span class="ow">in</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="s">u&#39;‰&#39;</span> <span class="ow">in</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%r</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>

<div class="viewcode-block" id="NumberPattern.apply"><a class="viewcode-back" href="../../babel.html#babel.numbers.NumberPattern.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">locale</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">value</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">is_negative</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_prec</span><span class="p">:</span> <span class="c"># Scientific notation</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># Minimum number of integer digits</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">exp</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c"># Exponent grouping</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exp</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
            <span class="n">exp_sign</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">exp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exp_sign</span> <span class="o">=</span> <span class="n">get_minus_sign_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_plus</span><span class="p">:</span>
                <span class="n">exp_sign</span> <span class="o">=</span> <span class="n">get_plus_sign_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="si">%s%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_sigdig</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">frac_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                  <span class="n">get_exponential_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">),</span>  <span class="n">exp_sign</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_format_int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">exp_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">locale</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s">&#39;@&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">:</span> <span class="c"># Is it a siginificant digits pattern?</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_sigdig</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_int</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">get_decimal_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_int</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># A normal number pattern</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">split_number</span><span class="p">(</span><span class="n">bankersround</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">frac_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="ow">or</span> <span class="s">&#39;0&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_int</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">int_prec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">locale</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_frac</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[</span><span class="n">is_negative</span><span class="p">],</span> <span class="n">number</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">[</span><span class="n">is_negative</span><span class="p">])</span>
        <span class="k">if</span> <span class="s">u&#39;¤&#39;</span> <span class="ow">in</span> <span class="n">retval</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">u&#39;¤¤¤&#39;</span><span class="p">,</span>
                <span class="n">get_currency_name</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">locale</span><span class="p">))</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">u&#39;¤¤&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">u&#39;¤&#39;</span><span class="p">,</span> <span class="n">get_currency_symbol</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">locale</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">retval</span>
</div>
    <span class="k">def</span> <span class="nf">_format_sigdig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert value to a string.</span>

<span class="sd">        The resulting string will contain between (min, max) number of</span>
<span class="sd">        significant digits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">split_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ndecimals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ndecimals</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">b</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">ndecimals</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">split_number</span><span class="p">(</span><span class="n">bankersround</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">max</span> <span class="o">-</span> <span class="n">ndecimals</span><span class="p">))</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">digits</span><span class="p">:</span>
            <span class="n">digits</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># Figure out if we need to add any trailing &#39;0&#39;:s</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">max</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="k">if</span> <span class="n">digits</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">min</span> <span class="o">-</span> <span class="n">digits</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">_format_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">locale</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">min</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
        <span class="n">gsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">get_group_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">gsize</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="n">gsize</span><span class="p">:]</span> <span class="o">+</span> <span class="n">ret</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="n">gsize</span><span class="p">]</span>
            <span class="n">gsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_format_frac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">locale</span><span class="p">):</span>
        <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_prec</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">min</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">min</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">min</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">get_decimal_symbol</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>