<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xlrd.xlsx &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="xlrd" href="../xlrd.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xlrd.xlsx</h1><div class="highlight"><pre>
<span class="c">##</span>
<span class="c"># Portions copyright (c) 2008-2012 Stephen John Machin, Lingfo Pty Ltd</span>
<span class="c"># This module is part of the xlrd package, which is released under a BSD-style licence.</span>
<span class="c">##</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">.timemachine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.book</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Name</span>
<span class="kn">from</span> <span class="nn">.biffh</span> <span class="kn">import</span> <span class="n">error_text_from_code</span><span class="p">,</span> <span class="n">XLRDError</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">XL_CELL_BOOLEAN</span><span class="p">,</span> <span class="n">XL_CELL_ERROR</span>
<span class="kn">from</span> <span class="nn">.formatting</span> <span class="kn">import</span> <span class="n">is_date_format_string</span><span class="p">,</span> <span class="n">Format</span><span class="p">,</span> <span class="n">XF</span>
<span class="kn">from</span> <span class="nn">.sheet</span> <span class="kn">import</span> <span class="n">Sheet</span>

<span class="n">DLF</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="c"># Default Log File</span>

<span class="n">ET</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">ET_has_iterparse</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="ensure_elementtree_imported"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.ensure_elementtree_imported">[docs]</a><span class="k">def</span> <span class="nf">ensure_elementtree_imported</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">logfile</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">ET</span><span class="p">,</span> <span class="n">ET_has_iterparse</span>
    <span class="k">if</span> <span class="n">ET</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="s">&quot;IronPython&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
        <span class="c">#### 2.7.2.1: fails later with </span>
        <span class="c">#### NotImplementedError: iterparse is not supported on IronPython. (CP #31923)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">cElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">lxml.etree</span> <span class="kn">as</span> <span class="nn">ET</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">elementtree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
                        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Failed to import an ElementTree implementation&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ET</span><span class="p">,</span> <span class="s">&#39;iterparse&#39;</span><span class="p">):</span>
        <span class="n">_dummy_stream</span> <span class="o">=</span> <span class="n">BYTES_IO</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="n">_dummy_stream</span><span class="p">)</span>
            <span class="n">ET_has_iterparse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
        <span class="n">etree_version</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">([</span>
            <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ET</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ET</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;version&#39;</span>
            <span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="n">ET</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">etree_version</span><span class="p">,</span> <span class="n">ET_has_iterparse</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">logfile</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="split_tag"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.split_tag">[docs]</a><span class="k">def</span> <span class="nf">split_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;}&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tag</span><span class="p">[:</span><span class="n">pos</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">tag</span>
</div>
<div class="viewcode-block" id="augment_keys"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.augment_keys">[docs]</a><span class="k">def</span> <span class="nf">augment_keys</span><span class="p">(</span><span class="n">adict</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
    <span class="c"># uri must already be enclosed in {}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">adict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">adict</span><span class="p">[</span><span class="n">uri</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</div>
<span class="n">_UPPERCASE_1_REL_INDEX</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Used in fast conversion of column names (e.g. &quot;XFD&quot;) to indices (16383)</span>
<span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">26</span><span class="p">):</span>
    <span class="n">_UPPERCASE_1_REL_INDEX</span><span class="p">[</span><span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">[</span><span class="n">_x</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="s">&quot;123456789&quot;</span><span class="p">:</span>
    <span class="n">_UPPERCASE_1_REL_INDEX</span><span class="p">[</span><span class="n">_x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">del</span> <span class="n">_x</span>

<div class="viewcode-block" id="cell_name_to_rowx_colx"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.cell_name_to_rowx_colx">[docs]</a><span class="k">def</span> <span class="nf">cell_name_to_rowx_colx</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">letter_value</span><span class="o">=</span><span class="n">_UPPERCASE_1_REL_INDEX</span><span class="p">):</span>
    <span class="c"># Extract column index from cell name</span>
    <span class="c"># A&lt;row number&gt; =&gt; 0, Z =&gt;25, AA =&gt; 26, XFD =&gt; 16383</span>
    <span class="n">colx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">charx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cell_name</span><span class="p">:</span>
            <span class="n">charx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">lv</span> <span class="o">=</span> <span class="n">letter_value</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">lv</span><span class="p">:</span>
                <span class="n">colx</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">*</span> <span class="mi">26</span> <span class="o">+</span> <span class="n">lv</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># start of row number; can&#39;t be &#39;0&#39;</span>
                <span class="n">colx</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">colx</span> <span class="o">&lt;</span> <span class="n">X12_MAX_COLS</span>
                <span class="k">break</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unexpected character </span><span class="si">%r</span><span class="s"> in cell name </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">))</span>
    <span class="n">rowx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cell_name</span><span class="p">[</span><span class="n">charx</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span>
</div>
<span class="n">error_code_from_text</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">_code</span><span class="p">,</span> <span class="n">_text</span> <span class="ow">in</span> <span class="n">error_text_from_code</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">error_code_from_text</span><span class="p">[</span><span class="n">_text</span><span class="p">]</span> <span class="o">=</span> <span class="n">_code</span>

<span class="c"># === X12 === Excel 2007 .xlsx ===============================================</span>

<span class="n">U_SSML12</span> <span class="o">=</span> <span class="s">&quot;{http://schemas.openxmlformats.org/spreadsheetml/2006/main}&quot;</span>
<span class="n">U_ODREL</span> <span class="o">=</span> <span class="s">&quot;{http://schemas.openxmlformats.org/officeDocument/2006/relationships}&quot;</span>
<span class="n">U_PKGREL</span> <span class="o">=</span> <span class="s">&quot;{http://schemas.openxmlformats.org/package/2006/relationships}&quot;</span>
<span class="n">U_CP</span> <span class="o">=</span> <span class="s">&quot;{http://schemas.openxmlformats.org/package/2006/metadata/core-properties}&quot;</span>
<span class="n">U_DC</span> <span class="o">=</span> <span class="s">&quot;{http://purl.org/dc/elements/1.1/}&quot;</span>
<span class="n">U_DCTERMS</span> <span class="o">=</span> <span class="s">&quot;{http://purl.org/dc/terms/}&quot;</span>
<span class="n">XML_SPACE_ATTR</span> <span class="o">=</span> <span class="s">&quot;{http://www.w3.org/XML/1998/namespace}space&quot;</span>
<span class="n">XML_WHITESPACE</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\t\n</span><span class="s"> </span><span class="se">\r</span><span class="s">&quot;</span>
<span class="n">X12_MAX_ROWS</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">20</span>
<span class="n">X12_MAX_COLS</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">14</span>
<span class="n">V_TAG</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;v&#39;</span> <span class="c"># cell child: value</span>
<span class="n">F_TAG</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;f&#39;</span> <span class="c"># cell child: formula</span>
<span class="n">IS_TAG</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;is&#39;</span> <span class="c"># cell child: inline string</span>

<div class="viewcode-block" id="unescape"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.unescape">[docs]</a><span class="k">def</span> <span class="nf">unescape</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
    <span class="n">subber</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;_x[0-9A-Fa-f]{4,4}_&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
    <span class="n">repl</span><span class="o">=</span><span class="k">lambda</span> <span class="n">mobj</span><span class="p">:</span> <span class="nb">unichr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="mi">16</span><span class="p">)),</span>
    <span class="p">):</span>
    <span class="k">if</span> <span class="s">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">subber</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="cooked_text"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.cooked_text">[docs]</a><span class="k">def</span> <span class="nf">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XML_SPACE_ATTR</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;preserve&#39;</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">XML_WHITESPACE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">unescape</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="get_text_from_si_or_is"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.get_text_from_si_or_is">[docs]</a><span class="k">def</span> <span class="nf">get_text_from_si_or_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">r_tag</span><span class="o">=</span><span class="n">U_SSML12</span><span class="o">+</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">t_tag</span><span class="o">=</span><span class="n">U_SSML12</span> <span class="o">+</span><span class="s">&#39;t&#39;</span><span class="p">):</span>
    <span class="s">&quot;Returns unescaped unicode&quot;</span>
    <span class="n">accum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
        <span class="c"># self.dump_elem(child)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">t_tag</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span> <span class="c"># note: .text attribute can be None</span>
                <span class="n">accum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">r_tag</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tnode</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tnode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t_tag</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tnode</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                        <span class="n">accum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">accum</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="map_attributes"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.map_attributes">[docs]</a><span class="k">def</span> <span class="nf">map_attributes</span><span class="p">(</span><span class="n">amap</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">xml_attr</span><span class="p">,</span> <span class="n">obj_attr</span><span class="p">,</span> <span class="n">cnv_func_or_const</span> <span class="ow">in</span> <span class="n">amap</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xml_attr</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj_attr</span><span class="p">,</span> <span class="n">cnv_func_or_const</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_attr</span><span class="p">:</span> <span class="k">continue</span> <span class="c">#### FIX ME ####</span>
        <span class="n">raw_value</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xml_attr</span><span class="p">)</span>
        <span class="n">cooked_value</span> <span class="o">=</span> <span class="n">cnv_func_or_const</span><span class="p">(</span><span class="n">raw_value</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj_attr</span><span class="p">,</span> <span class="n">cooked_value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="cnv_ST_Xstring"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.cnv_ST_Xstring">[docs]</a><span class="k">def</span> <span class="nf">cnv_ST_Xstring</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="cnv_xsd_unsignedInt"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.cnv_xsd_unsignedInt">[docs]</a><span class="k">def</span> <span class="nf">cnv_xsd_unsignedInt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="cnv_xsd_boolean"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.cnv_xsd_boolean">[docs]</a><span class="k">def</span> <span class="nf">cnv_xsd_boolean</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="s">&quot;on&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="s">&quot;off&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unexpected xsd:boolean value: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>

</div>
<span class="n">_defined_name_attribute_map</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span>                <span class="s">&quot;name&quot;</span><span class="p">,</span>         <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;comment&quot;</span><span class="p">,</span>             <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;customMenu&quot;</span><span class="p">,</span>          <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">,</span>         <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">,</span>                <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;statusBar&quot;</span><span class="p">,</span>           <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;localSheetId&quot;</span><span class="p">,</span>        <span class="s">&quot;scope&quot;</span><span class="p">,</span>        <span class="n">cnv_xsd_unsignedInt</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;hidden&quot;</span><span class="p">,</span>              <span class="s">&quot;hidden&quot;</span><span class="p">,</span>       <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span>            <span class="s">&quot;func&quot;</span><span class="p">,</span>         <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;vbProcedure&quot;</span><span class="p">,</span>         <span class="s">&quot;vbasic&quot;</span><span class="p">,</span>       <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;xlm&quot;</span><span class="p">,</span>                 <span class="s">&quot;macro&quot;</span><span class="p">,</span>        <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;functionGroupId&quot;</span><span class="p">,</span>     <span class="s">&quot;funcgroup&quot;</span><span class="p">,</span>    <span class="n">cnv_xsd_unsignedInt</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;shortcutKey&quot;</span><span class="p">,</span>         <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_ST_Xstring</span><span class="p">,</span>  <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;publishToServer&quot;</span><span class="p">,</span>     <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;workbookParameter&quot;</span><span class="p">,</span>   <span class="s">&quot;&quot;</span><span class="p">,</span>             <span class="n">cnv_xsd_boolean</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;any_err&quot;</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;any_external&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;any_rel&quot;</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;basic_formula_len&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>          <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;binary&quot;</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;builtin&quot;</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;complex&quot;</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;evaluated&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;excel_sheet_index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>          <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;excel_sheet_num&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>            <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;option_flags&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>               <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;result&quot;</span><span class="p">,</span>       <span class="bp">None</span><span class="p">,</span>            <span class="p">),</span>
    <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>                    <span class="s">&quot;stack&quot;</span><span class="p">,</span>        <span class="bp">None</span><span class="p">,</span>            <span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="make_name_access_maps"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.make_name_access_maps">[docs]</a><span class="k">def</span> <span class="nf">make_name_access_maps</span><span class="p">(</span><span class="n">bk</span><span class="p">):</span>
    <span class="n">name_and_scope_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># (name.lower(), scope): Name_object</span>
    <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>           <span class="c"># name.lower() : list of Name_objects (sorted in scope order)</span>
    <span class="n">num_names</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">namex</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
        <span class="n">nobj</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">[</span><span class="n">namex</span><span class="p">]</span>
        <span class="n">name_lcase</span> <span class="o">=</span> <span class="n">nobj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">name_lcase</span><span class="p">,</span> <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">name_and_scope_map</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Duplicate entry </span><span class="si">%r</span><span class="s"> in name_and_scope_map&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bk</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">name_and_scope_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobj</span>
        <span class="k">if</span> <span class="n">name_lcase</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
            <span class="n">name_map</span><span class="p">[</span><span class="n">name_lcase</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nobj</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="n">nobj</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_map</span><span class="p">[</span><span class="n">name_lcase</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">nobj</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="n">nobj</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">name_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">alist</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">alist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">name_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">]</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">name_and_scope_map</span> <span class="o">=</span> <span class="n">name_and_scope_map</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">name_map</span> <span class="o">=</span> <span class="n">name_map</span>
</div>
<div class="viewcode-block" id="X12General"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12General">[docs]</a><span class="k">class</span> <span class="nc">X12General</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="X12General.process_stream"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12General.process_stream">[docs]</a>    <span class="k">def</span> <span class="nf">process_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== </span><span class="si">%s</span><span class="s"> ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">getmethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag2meth</span><span class="o">.</span><span class="n">get</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">getiterator</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_elem</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="n">getmethod</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">meth</span><span class="p">:</span>
                <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_off</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="X12General.finish_off"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12General.finish_off">[docs]</a>    <span class="k">def</span> <span class="nf">finish_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="X12General.dump_elem"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12General.dump_elem">[docs]</a>    <span class="k">def</span> <span class="nf">dump_elem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="s">&quot;===</span><span class="se">\n</span><span class="s">tag=</span><span class="si">%r</span><span class="s"> len=</span><span class="si">%d</span><span class="s"> attrib=</span><span class="si">%r</span><span class="s"> text=</span><span class="si">%r</span><span class="s"> tail=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">split_tag</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">),</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12General.dumpout"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12General.dumpout">[docs]</a>    <span class="k">def</span> <span class="nf">dumpout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">vargs</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">fmt</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">vargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="X12Book"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book">[docs]</a><span class="k">class</span> <span class="nc">X12Book</span><span class="p">(</span><span class="n">X12General</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">DLF</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span> <span class="o">=</span> <span class="n">bk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relid2path</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relid2reltype</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_targets</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># indexed by sheetx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheetIds</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># indexed by sheetx</span>

    <span class="n">core_props_menu</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">U_CP</span><span class="o">+</span><span class="s">&quot;lastModifiedBy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;last_modified_by&quot;</span><span class="p">,</span> <span class="n">cnv_ST_Xstring</span><span class="p">),</span>
        <span class="n">U_DC</span><span class="o">+</span><span class="s">&quot;creator&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;creator&quot;</span><span class="p">,</span> <span class="n">cnv_ST_Xstring</span><span class="p">),</span>
        <span class="n">U_DCTERMS</span><span class="o">+</span><span class="s">&quot;modified&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;modified&quot;</span><span class="p">,</span> <span class="n">cnv_ST_Xstring</span><span class="p">),</span>
        <span class="n">U_DCTERMS</span><span class="o">+</span><span class="s">&quot;created&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;created&quot;</span><span class="p">,</span> <span class="n">cnv_ST_Xstring</span><span class="p">),</span>
        <span class="p">}</span>

<div class="viewcode-block" id="X12Book.process_coreprops"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.process_coreprops">[docs]</a>    <span class="k">def</span> <span class="nf">process_coreprops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== coreProps ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">getmenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_props_menu</span><span class="o">.</span><span class="n">get</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">getiterator</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_elem</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">getmenu</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
                <span class="n">attr</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">menu</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">props</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;last_modified_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;creator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;props: </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_off</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="X12Book.process_rels"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.process_rels">[docs]</a>    <span class="k">def</span> <span class="nf">process_rels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== Relationships ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">r_tag</span> <span class="o">=</span> <span class="n">U_PKGREL</span> <span class="o">+</span> <span class="s">&#39;Relationship&#39;</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">r_tag</span><span class="p">):</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Id&#39;</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Target&#39;</span><span class="p">)</span>
            <span class="n">reltype</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;Id=</span><span class="si">%r</span><span class="s"> Type=</span><span class="si">%r</span><span class="s"> Target=</span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">reltype</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relid2reltype</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span> <span class="o">=</span> <span class="n">reltype</span>
            <span class="c"># self.relid2path[rid] = &#39;xl/&#39; + target</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relid2path</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span>  <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># drop the /</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relid2path</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;xl/&#39;</span> <span class="o">+</span> <span class="n">target</span>
</div>
<div class="viewcode-block" id="X12Book.do_defined_name"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.do_defined_name">[docs]</a>    <span class="k">def</span> <span class="nf">do_defined_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="c">#### UNDER CONSTRUCTION ####</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_elem</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="n">nobj</span> <span class="o">=</span> <span class="n">Name</span><span class="p">()</span>
        <span class="n">bk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">bk</span> <span class="o">=</span> <span class="n">bk</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">name_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="p">)</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">name_obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nobj</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">raw_formula</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># compiled bytecode formula -- not in XLSX</span>
        <span class="n">nobj</span><span class="o">.</span><span class="n">formula_text</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
        <span class="n">map_attributes</span><span class="p">(</span><span class="n">_defined_name_attribute_map</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">nobj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nobj</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># global</span>
        <span class="k">if</span> <span class="n">nobj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;_xlnm.&quot;</span><span class="p">):</span>
            <span class="n">nobj</span><span class="o">.</span><span class="n">builtin</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">nobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;=== Name object ===&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12Book.do_defined_names"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.do_defined_names">[docs]</a>    <span class="k">def</span> <span class="nf">do_defined_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_defined_name</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="n">make_name_access_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12Book.do_sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.do_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">do_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">bk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span>
        <span class="n">sheetx</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span>
        <span class="c"># print elem.attrib</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">U_ODREL</span> <span class="o">+</span> <span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">sheetId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sheetId&#39;</span><span class="p">))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">ensure_unicode</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)))</span>
        <span class="n">reltype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relid2reltype</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relid2path</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span>
                <span class="s">&#39;sheetx=</span><span class="si">%d</span><span class="s"> sheetId=</span><span class="si">%r</span><span class="s"> rid=</span><span class="si">%r</span><span class="s"> type=</span><span class="si">%r</span><span class="s"> name=</span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="n">sheetx</span><span class="p">,</span> <span class="n">sheetId</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">reltype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reltype</span> <span class="o">!=</span> <span class="s">&#39;worksheet&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;Ignoring sheet of type </span><span class="si">%r</span><span class="s"> (name=</span><span class="si">%r</span><span class="s">)&#39;</span><span class="p">,</span> <span class="n">reltype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">visibility_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;visible&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;hidden&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;veryHidden&#39;</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">}</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_visibility</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">visibility_map</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">Sheet</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">sheetx</span><span class="p">)</span>
        <span class="n">sheet</span><span class="o">.</span><span class="n">utter_max_rows</span> <span class="o">=</span> <span class="n">X12_MAX_ROWS</span>
        <span class="n">sheet</span><span class="o">.</span><span class="n">utter_max_cols</span> <span class="o">=</span> <span class="n">X12_MAX_COLS</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheetIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sheetId</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="X12Book.do_workbookpr"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Book.do_workbookpr">[docs]</a>    <span class="k">def</span> <span class="nf">do_workbookpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">datemode</span> <span class="o">=</span> <span class="n">cnv_xsd_boolean</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;date1904&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;datemode=</span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">datemode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">datemode</span> <span class="o">=</span> <span class="n">datemode</span>
</div>
    <span class="n">tag2meth</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;definedNames&#39;</span><span class="p">:</span>  <span class="n">do_defined_names</span><span class="p">,</span>
        <span class="s">&#39;workbookPr&#39;</span><span class="p">:</span>   <span class="n">do_workbookpr</span><span class="p">,</span>
        <span class="s">&#39;sheet&#39;</span><span class="p">:</span>        <span class="n">do_sheet</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">augment_keys</span><span class="p">(</span><span class="n">tag2meth</span><span class="p">,</span> <span class="n">U_SSML12</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12SST"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12SST">[docs]</a><span class="k">class</span> <span class="nc">X12SST</span><span class="p">(</span><span class="n">X12General</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">DLF</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span> <span class="o">=</span> <span class="n">bk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="k">if</span> <span class="n">ET_has_iterparse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_iterparse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_findall</span>
            
<div class="viewcode-block" id="X12SST.process_stream_iterparse"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12SST.process_stream_iterparse">[docs]</a>    <span class="k">def</span> <span class="nf">process_stream_iterparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== </span><span class="si">%s</span><span class="s"> ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="n">si_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;si&#39;</span>
        <span class="n">elemno</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">sst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_sharedstrings</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ET</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">si_tag</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">elemno</span> <span class="o">=</span> <span class="n">elemno</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;element #</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">elemno</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_elem</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">get_text_from_si_or_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
            <span class="n">sst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>                
            <span class="n">elem</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c"># destroy all child elements</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;Entries in SST: </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sst</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sst</span><span class="p">):</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;SST x=</span><span class="si">%d</span><span class="s"> s=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12SST.process_stream_findall"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12SST.process_stream_findall">[docs]</a>    <span class="k">def</span> <span class="nf">process_stream_findall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== </span><span class="si">%s</span><span class="s"> ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">si_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;si&#39;</span>
        <span class="n">elemno</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">sst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_sharedstrings</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">si_tag</span><span class="p">):</span>
            <span class="n">elemno</span> <span class="o">=</span> <span class="n">elemno</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;element #</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">elemno</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_elem</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">get_text_from_si_or_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
            <span class="n">sst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;Entries in SST: </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sst</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="X12Styles"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Styles">[docs]</a><span class="k">class</span> <span class="nc">X12Styles</span><span class="p">(</span><span class="n">X12General</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">DLF</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span> <span class="o">=</span> <span class="n">bk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt_is_date</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">48</span><span class="p">)):</span> <span class="c">#### hard-coding FIX ME ####</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmt_is_date</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># dummy entry for XF 0 in case no Styles section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c"># fill_in_standard_formats(bk) #### pre-integration kludge</span>

<div class="viewcode-block" id="X12Styles.do_cellstylexfs"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Styles.do_cellstylexfs">[docs]</a>    <span class="k">def</span> <span class="nf">do_cellstylexfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="X12Styles.do_cellxfs"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Styles.do_cellxfs">[docs]</a>    <span class="k">def</span> <span class="nf">do_cellxfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span> <span class="o">=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="X12Styles.do_numfmt"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Styles.do_numfmt">[docs]</a>    <span class="k">def</span> <span class="nf">do_numfmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">formatCode</span> <span class="o">=</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;formatCode&#39;</span><span class="p">))</span>
        <span class="n">numFmtId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;numFmtId&#39;</span><span class="p">))</span>
        <span class="n">is_date</span> <span class="o">=</span> <span class="n">is_date_format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="p">,</span> <span class="n">formatCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt_is_date</span><span class="p">[</span><span class="n">numFmtId</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_date</span>
        <span class="n">fmt_obj</span> <span class="o">=</span> <span class="n">Format</span><span class="p">(</span><span class="n">numFmtId</span><span class="p">,</span> <span class="n">is_date</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">formatCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">numFmtId</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt_obj</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&#39;numFmtId=</span><span class="si">%d</span><span class="s"> formatCode=</span><span class="si">%r</span><span class="s"> is_date=</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">numFmtId</span><span class="p">,</span> <span class="n">formatCode</span><span class="p">,</span> <span class="n">is_date</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12Styles.do_xf"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Styles.do_xf">[docs]</a>    <span class="k">def</span> <span class="nf">do_xf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c">#### ignoring style XFs for the moment</span>
            <span class="k">return</span>
        <span class="n">xfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xf_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xf_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">xfx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">XF</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">xf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">xfcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">numFmtId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;numFmtId&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="n">numFmtId</span>
        <span class="n">is_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt_is_date</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">numFmtId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xfx</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_date</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span>
                <span class="s">&#39;xfx=</span><span class="si">%d</span><span class="s"> numFmtId=</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="n">xfx</span><span class="p">,</span> <span class="n">numFmtId</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">))</span>
</div>
    <span class="n">tag2meth</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;cellStyleXfs&#39;</span><span class="p">:</span> <span class="n">do_cellstylexfs</span><span class="p">,</span>
        <span class="s">&#39;cellXfs&#39;</span><span class="p">:</span>      <span class="n">do_cellxfs</span><span class="p">,</span>
        <span class="s">&#39;numFmt&#39;</span><span class="p">:</span>       <span class="n">do_numfmt</span><span class="p">,</span>
        <span class="s">&#39;xf&#39;</span><span class="p">:</span>           <span class="n">do_xf</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">augment_keys</span><span class="p">(</span><span class="n">tag2meth</span><span class="p">,</span> <span class="n">U_SSML12</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="X12Sheet"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet">[docs]</a><span class="k">class</span> <span class="nc">X12Sheet</span><span class="p">(</span><span class="n">X12General</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">DLF</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span> <span class="o">=</span> <span class="n">sheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># We may need to count them.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bk</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">book</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">_sharedstrings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">merged_cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_cell_name</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_row_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">ET_has_iterparse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_process_stream</span>

<div class="viewcode-block" id="X12Sheet.own_process_stream"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet.own_process_stream">[docs]</a>    <span class="k">def</span> <span class="nf">own_process_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">=== </span><span class="si">%s</span><span class="s"> ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="n">getmethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag2meth</span><span class="o">.</span><span class="n">get</span>
        <span class="n">row_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&quot;row&quot;</span>
        <span class="n">self_do_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_row</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ET</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">row_tag</span><span class="p">:</span>
                <span class="n">self_do_row</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c"># destroy all child elements (cells)</span>
            <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&quot;dimension&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">do_dimension</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&quot;mergeCell&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">do_merge_cell</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_off</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="X12Sheet.process_comments_stream"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet.process_comments_stream">[docs]</a>    <span class="k">def</span> <span class="nf">process_comments_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="n">author_list</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">author_list</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;authors&#39;</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">author_list</span><span class="p">]</span>
        <span class="n">comment_list</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">comment_list</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;commentList&#39;</span>
        <span class="n">cell_note_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">cell_note_map</span>
        <span class="kn">from</span> <span class="nn">.sheet</span> <span class="kn">import</span> <span class="n">Note</span>
        <span class="n">text_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;text&#39;</span>
        <span class="n">r_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;r&#39;</span>
        <span class="n">t_tag</span> <span class="o">=</span> <span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;t&#39;</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">comment_list</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">U_SSML12</span> <span class="o">+</span> <span class="s">&#39;comment&#39;</span><span class="p">):</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./&#39;</span> <span class="o">+</span> <span class="n">text_tag</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">t_tag</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;./&#39;</span> <span class="o">+</span> <span class="n">text_tag</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">r_tag</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">t_tag</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">()</span>
            <span class="n">note</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">authors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;authorId&#39;</span><span class="p">))]</span>
            <span class="n">note</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">note</span><span class="o">.</span><span class="n">colx</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">cell_name_to_rowx_colx</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="n">note</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">cell_note_map</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span> <span class="o">=</span> <span class="n">note</span>
</div>
<div class="viewcode-block" id="X12Sheet.do_dimension"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet.do_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">do_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span> <span class="c"># example: &quot;A1:Z99&quot; or just &quot;A1&quot;</span>
        <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
            <span class="c"># print &gt;&gt; self.logfile, &quot;dimension: ref=%r&quot; % ref</span>
            <span class="n">last_cell_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># example: &quot;Z99&quot;</span>
            <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span> <span class="o">=</span> <span class="n">cell_name_to_rowx_colx</span><span class="p">(</span><span class="n">last_cell_ref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">_dimnrows</span> <span class="o">=</span> <span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">_dimncols</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="X12Sheet.do_merge_cell"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet.do_merge_cell">[docs]</a>    <span class="k">def</span> <span class="nf">do_merge_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="c"># The ref attribute should be a cell range like &quot;B1:D5&quot;.</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ref&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
            <span class="n">first_cell_ref</span><span class="p">,</span> <span class="n">last_cell_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">first_rowx</span><span class="p">,</span> <span class="n">first_colx</span> <span class="o">=</span> <span class="n">cell_name_to_rowx_colx</span><span class="p">(</span><span class="n">first_cell_ref</span><span class="p">)</span>
            <span class="n">last_rowx</span><span class="p">,</span> <span class="n">last_colx</span> <span class="o">=</span> <span class="n">cell_name_to_rowx_colx</span><span class="p">(</span><span class="n">last_cell_ref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merged_cells</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">first_rowx</span><span class="p">,</span> <span class="n">last_rowx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                      <span class="n">first_colx</span><span class="p">,</span> <span class="n">last_colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="X12Sheet.do_row"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.X12Sheet.do_row">[docs]</a>    <span class="k">def</span> <span class="nf">do_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_elem</span><span class="p">):</span>
    
        <span class="k">def</span> <span class="nf">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;cell type </span><span class="si">%s</span><span class="s"> has unexpected child &lt;</span><span class="si">%s</span><span class="s">&gt; at rowx=</span><span class="si">%r</span><span class="s"> colx=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">child_tag</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
 
        <span class="n">row_number</span> <span class="o">=</span> <span class="n">row_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">row_number</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># Yes, it&#39;s optional.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">explicit_row_number</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_row_num</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&quot;no row number; assuming rowx=</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_row_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">explicit_row_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span> <span class="o">&lt;</span> <span class="n">X12_MAX_ROWS</span>
        <span class="n">rowx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span>
        <span class="n">colx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&quot;&lt;row&gt; row_number=</span><span class="si">%r</span><span class="s"> rowx=</span><span class="si">%d</span><span class="s"> explicit=</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">row_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowx</span><span class="p">,</span> <span class="n">explicit_row_number</span><span class="p">)</span>
        <span class="n">letter_value</span> <span class="o">=</span> <span class="n">_UPPERCASE_1_REL_INDEX</span>
        <span class="k">for</span> <span class="n">cell_elem</span> <span class="ow">in</span> <span class="n">row_elem</span><span class="p">:</span>
            <span class="n">cell_name</span> <span class="o">=</span> <span class="n">cell_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cell_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># Yes, it&#39;s optional.</span>
                <span class="n">colx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_cell_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dumpout</span><span class="p">(</span><span class="s">&quot;no cellname; assuming rowx=</span><span class="si">%d</span><span class="s"> colx=</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warned_no_cell_name</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Extract column index from cell name</span>
                <span class="c"># A&lt;row number&gt; =&gt; 0, Z =&gt;25, AA =&gt; 26, XFD =&gt; 16383</span>
                <span class="n">colx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">charx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cell_name</span><span class="p">:</span>
                        <span class="n">charx</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;$&#39;</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">lv</span> <span class="o">=</span> <span class="n">letter_value</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">lv</span><span class="p">:</span>
                            <span class="n">colx</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">*</span> <span class="mi">26</span> <span class="o">+</span> <span class="n">lv</span>
                        <span class="k">else</span><span class="p">:</span> <span class="c"># start of row number; can&#39;t be &#39;0&#39;</span>
                            <span class="n">colx</span> <span class="o">=</span> <span class="n">colx</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">colx</span> <span class="o">&lt;</span> <span class="n">X12_MAX_COLS</span>
                            <span class="k">break</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unexpected character </span><span class="si">%r</span><span class="s"> in cell name </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">explicit_row_number</span> <span class="ow">and</span> <span class="n">cell_name</span><span class="p">[</span><span class="n">charx</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">row_number</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;cell name </span><span class="si">%r</span><span class="s"> but row number is </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">row_number</span><span class="p">))</span>
            <span class="n">xf_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cell_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">)</span>
            <span class="n">tvalue</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">:</span>
                <span class="c"># n = number. Most frequent type.</span>
                <span class="c"># &lt;v&gt; child contains plain text which can go straight into float()</span>
                <span class="c"># OR there&#39;s no text in which case it&#39;s a BLANK cell</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">V_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">elif</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">F_TAG</span><span class="p">:</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;unexpected tag </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">child_tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tvalue</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">tvalue</span><span class="p">),</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&quot;s&quot;</span><span class="p">:</span>
                <span class="c"># s = index into shared string table. 2nd most frequent type</span>
                <span class="c"># &lt;v&gt; child contains plain text which can go straight into int()</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">V_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">elif</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">F_TAG</span><span class="p">:</span>
                        <span class="c"># formula not expected here, but gnumeric does it.</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tvalue</span><span class="p">:</span>
                    <span class="c"># &lt;c r=&quot;A1&quot; t=&quot;s&quot;/&gt;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bk</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BLANK</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sst</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tvalue</span><span class="p">)]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&quot;str&quot;</span><span class="p">:</span>
                <span class="c"># str = string result from formula.</span>
                <span class="c"># Should have &lt;f&gt; (formula) child; however in one file, all text cells are str with no formula.</span>
                <span class="c"># &lt;v&gt; child can contain escapes</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">V_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">F_TAG</span><span class="p">:</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">)</span>
                <span class="c"># assert tvalue is not None and formula is not None</span>
                <span class="c"># Yuk. Fails with file created by gnumeric -- no tvalue!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">tvalue</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&quot;b&quot;</span><span class="p">:</span>
                <span class="c"># b = boolean</span>
                <span class="c"># &lt;v&gt; child contains &quot;0&quot; or &quot;1&quot;</span>
                <span class="c"># Maybe the data should be converted with cnv_xsd_boolean;</span>
                <span class="c"># ECMA standard is silent; Excel 2007 writes 0 or 1</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">V_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">elif</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">F_TAG</span><span class="p">:</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_BOOLEAN</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tvalue</span><span class="p">),</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&quot;e&quot;</span><span class="p">:</span>
                <span class="c"># e = error</span>
                <span class="c"># &lt;v&gt; child contains e.g. &quot;#REF!&quot;</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">V_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">elif</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">F_TAG</span><span class="p">:</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">cooked_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">error_code_from_text</span><span class="p">[</span><span class="n">tvalue</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_ERROR</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s">&quot;inlineStr&quot;</span><span class="p">:</span>
                <span class="c"># Not expected in files produced by Excel.</span>
                <span class="c"># Only possible child is &lt;is&gt;.</span>
                <span class="c"># It&#39;s a way of allowing 3rd party s/w to write text (including rich text) cells</span>
                <span class="c"># without having to build a shared string table</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cell_elem</span><span class="p">:</span>
                    <span class="n">child_tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span>
                    <span class="k">if</span> <span class="n">child_tag</span> <span class="o">==</span> <span class="n">IS_TAG</span><span class="p">:</span>
                        <span class="n">tvalue</span> <span class="o">=</span> <span class="n">get_text_from_si_or_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bad_child_tag</span><span class="p">(</span><span class="n">child_tag</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">tvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">put_cell</span><span class="p">(</span><span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">,</span> <span class="n">XL_CELL_TEXT</span><span class="p">,</span> <span class="n">tvalue</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Unknown cell type </span><span class="si">%r</span><span class="s"> in rowx=</span><span class="si">%d</span><span class="s"> colx=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">rowx</span><span class="p">,</span> <span class="n">colx</span><span class="p">))</span>
</div>
    <span class="n">tag2meth</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;row&#39;</span><span class="p">:</span>          <span class="n">do_row</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">augment_keys</span><span class="p">(</span><span class="n">tag2meth</span><span class="p">,</span> <span class="n">U_SSML12</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="open_workbook_2007_xml"><a class="viewcode-back" href="../../xlrd.html#xlrd.xlsx.open_workbook_2007_xml">[docs]</a><span class="k">def</span> <span class="nf">open_workbook_2007_xml</span><span class="p">(</span>
    <span class="n">zf</span><span class="p">,</span>
    <span class="n">component_names</span><span class="p">,</span>
    <span class="n">logfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">use_mmap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">formatting_info</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">on_demand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ragged_rows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="n">ensure_elementtree_imported</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">logfile</span><span class="p">)</span>
    <span class="n">bk</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">formatting_info</span> <span class="o">=</span> <span class="n">formatting_info</span>
    <span class="k">if</span> <span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;formatting_info=True not yet implemented&quot;</span><span class="p">)</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">use_mmap</span> <span class="o">=</span> <span class="bp">False</span> <span class="c">#### Not supported initially</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="n">on_demand</span>
    <span class="k">if</span> <span class="n">on_demand</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING *** on_demand=True not yet implemented; falling back to False&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">bk</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">bk</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">bk</span><span class="o">.</span><span class="n">ragged_rows</span> <span class="o">=</span> <span class="n">ragged_rows</span>

    <span class="n">x12book</span> <span class="o">=</span> <span class="n">X12Book</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>
    <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;xl/_rels/workbook.xml.rels&#39;</span><span class="p">)</span>
    <span class="n">x12book</span><span class="o">.</span><span class="n">process_rels</span><span class="p">(</span><span class="n">zflo</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">zflo</span>
    <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;xl/workbook.xml&#39;</span><span class="p">)</span>
    <span class="n">x12book</span><span class="o">.</span><span class="n">process_stream</span><span class="p">(</span><span class="n">zflo</span><span class="p">,</span> <span class="s">&#39;Workbook&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">zflo</span>
    <span class="n">props_name</span> <span class="o">=</span> <span class="s">&#39;docProps/core.xml&#39;</span>
    <span class="k">if</span> <span class="n">props_name</span> <span class="ow">in</span> <span class="n">component_names</span><span class="p">:</span>
        <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">props_name</span><span class="p">)</span>
        <span class="n">x12book</span><span class="o">.</span><span class="n">process_coreprops</span><span class="p">(</span><span class="n">zflo</span><span class="p">)</span>

    <span class="n">x12sty</span> <span class="o">=</span> <span class="n">X12Styles</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;xl/styles.xml&#39;</span> <span class="ow">in</span> <span class="n">component_names</span><span class="p">:</span>
        <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;xl/styles.xml&#39;</span><span class="p">)</span>
        <span class="n">x12sty</span><span class="o">.</span><span class="n">process_stream</span><span class="p">(</span><span class="n">zflo</span><span class="p">,</span> <span class="s">&#39;styles&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">zflo</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># seen in MS sample file MergedCells.xlsx</span>
        <span class="k">pass</span>

    <span class="n">sst_fname</span> <span class="o">=</span> <span class="s">&#39;xl/sharedStrings.xml&#39;</span>
    <span class="n">x12sst</span> <span class="o">=</span> <span class="n">X12SST</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sst_fname</span> <span class="ow">in</span> <span class="n">component_names</span><span class="p">:</span>
        <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sst_fname</span><span class="p">)</span>
        <span class="n">x12sst</span><span class="o">.</span><span class="n">process_stream</span><span class="p">(</span><span class="n">zflo</span><span class="p">,</span> <span class="s">&#39;SST&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">zflo</span>

    <span class="k">for</span> <span class="n">sheetx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">nsheets</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">x12book</span><span class="o">.</span><span class="n">sheet_targets</span><span class="p">[</span><span class="n">sheetx</span><span class="p">]</span>
        <span class="n">zflo</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">_sheet_list</span><span class="p">[</span><span class="n">sheetx</span><span class="p">]</span>
        <span class="n">x12sheet</span> <span class="o">=</span> <span class="n">X12Sheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>
        <span class="n">heading</span> <span class="o">=</span> <span class="s">&quot;Sheet </span><span class="si">%r</span><span class="s"> (sheetx=</span><span class="si">%d</span><span class="s">) from </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sheetx</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">x12sheet</span><span class="o">.</span><span class="n">process_stream</span><span class="p">(</span><span class="n">zflo</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">zflo</span>
        <span class="n">comments_fname</span> <span class="o">=</span> <span class="s">&#39;xl/comments</span><span class="si">%d</span><span class="s">.xml&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sheetx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comments_fname</span> <span class="ow">in</span> <span class="n">component_names</span><span class="p">:</span>
            <span class="n">comments_stream</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">comments_fname</span><span class="p">)</span>
            <span class="n">x12sheet</span><span class="o">.</span><span class="n">process_comments_stream</span><span class="p">(</span><span class="n">comments_stream</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">comments_stream</span>

        <span class="n">sheet</span><span class="o">.</span><span class="n">tidy_dimensions</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">bk</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../xlrd.html">xlrd</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>