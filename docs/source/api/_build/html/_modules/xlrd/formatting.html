<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xlrd.formatting &mdash; app  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="app  documentation" href="../../index.html" />
    <link rel="up" title="xlrd" href="../xlrd.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xlrd.formatting</h1><div class="highlight"><pre>
<span class="c"># -*- coding: cp1252 -*-</span>

<span class="c">##</span>
<span class="c"># Module for formatting information.</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;Copyright Â© 2005-2012 Stephen John Machin, Lingfo Pty Ltd&lt;/p&gt;</span>
<span class="c"># &lt;p&gt;This module is part of the xlrd package, which is released under</span>
<span class="c"># a BSD-style licence.&lt;/p&gt;</span>
<span class="c">##</span>

<span class="c"># No part of the content of this file was derived from the works of David Giffin.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">unpack</span>
<span class="kn">from</span> <span class="nn">.timemachine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.biffh</span> <span class="kn">import</span> <span class="n">BaseObject</span><span class="p">,</span> <span class="n">unpack_unicode</span><span class="p">,</span> <span class="n">unpack_string</span><span class="p">,</span> \
    <span class="n">upkbits</span><span class="p">,</span> <span class="n">upkbitsL</span><span class="p">,</span> <span class="n">fprintf</span><span class="p">,</span> \
    <span class="n">FUN</span><span class="p">,</span> <span class="n">FDT</span><span class="p">,</span> <span class="n">FNU</span><span class="p">,</span> <span class="n">FGE</span><span class="p">,</span> <span class="n">FTX</span><span class="p">,</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span> <span class="n">XL_CELL_DATE</span><span class="p">,</span> \
    <span class="n">XL_FORMAT</span><span class="p">,</span> <span class="n">XL_FORMAT2</span><span class="p">,</span> \
    <span class="n">XLRDError</span>

<span class="n">_cellty_from_fmtty</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">FNU</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FUN</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FGE</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span>
    <span class="n">FDT</span><span class="p">:</span> <span class="n">XL_CELL_DATE</span><span class="p">,</span>
    <span class="n">FTX</span><span class="p">:</span> <span class="n">XL_CELL_NUMBER</span><span class="p">,</span> <span class="c"># Yes, a number can be formatted as text.</span>
    <span class="p">}</span>    
    
<span class="n">excel_default_palette_b5</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">102</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">227</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">227</span><span class="p">),</span>
    <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">153</span><span class="p">),</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">153</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>  <span class="mi">51</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">excel_default_palette_b2</span> <span class="o">=</span> <span class="n">excel_default_palette_b5</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>

<span class="c"># Following table borrowed from Gnumeric 1.4 source.</span>
<span class="c"># Checked against OOo docs and MS docs.</span>
<span class="n">excel_default_palette_b8</span> <span class="o">=</span> <span class="p">(</span> <span class="c"># (red, green, blue)</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="c"># 0</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c"># 4</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="c"># 8</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">192</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="c"># 12</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c"># 16</span>
    <span class="p">(</span><span class="mi">102</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c"># 20</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c"># 24</span>
    <span class="p">(</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c"># 28</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span> <span class="c"># 32</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span> <span class="c"># 36</span>
    <span class="p">(</span> <span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="c"># 40</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="c"># 44</span>
    <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span> <span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="c"># 48</span>
    <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span>  <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span> <span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">),</span> <span class="c"># 52</span>
    <span class="p">)</span>

<span class="n">default_palette</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">80</span><span class="p">:</span> <span class="n">excel_default_palette_b8</span><span class="p">,</span>
    <span class="mi">70</span><span class="p">:</span> <span class="n">excel_default_palette_b5</span><span class="p">,</span>
    <span class="mi">50</span><span class="p">:</span> <span class="n">excel_default_palette_b5</span><span class="p">,</span>
    <span class="mi">45</span><span class="p">:</span> <span class="n">excel_default_palette_b2</span><span class="p">,</span>
    <span class="mi">40</span><span class="p">:</span> <span class="n">excel_default_palette_b2</span><span class="p">,</span>
    <span class="mi">30</span><span class="p">:</span> <span class="n">excel_default_palette_b2</span><span class="p">,</span>
    <span class="mi">21</span><span class="p">:</span> <span class="n">excel_default_palette_b2</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="n">excel_default_palette_b2</span><span class="p">,</span>
    <span class="p">}</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">00H = Normal</span>
<span class="sd">01H = RowLevel_lv (see next field)</span>
<span class="sd">02H = ColLevel_lv (see next field)</span>
<span class="sd">03H = Comma</span>
<span class="sd">04H = Currency</span>
<span class="sd">05H = Percent</span>
<span class="sd">06H = Comma [0] (BIFF4-BIFF8)</span>
<span class="sd">07H = Currency [0] (BIFF4-BIFF8)</span>
<span class="sd">08H = Hyperlink (BIFF8)</span>
<span class="sd">09H = Followed Hyperlink (BIFF8)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">built_in_style_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;Normal&quot;</span><span class="p">,</span>
    <span class="s">&quot;RowLevel_&quot;</span><span class="p">,</span>
    <span class="s">&quot;ColLevel_&quot;</span><span class="p">,</span>
    <span class="s">&quot;Comma&quot;</span><span class="p">,</span>
    <span class="s">&quot;Currency&quot;</span><span class="p">,</span>
    <span class="s">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="s">&quot;Comma [0]&quot;</span><span class="p">,</span>
    <span class="s">&quot;Currency [0]&quot;</span><span class="p">,</span>
    <span class="s">&quot;Hyperlink&quot;</span><span class="p">,</span>
    <span class="s">&quot;Followed Hyperlink&quot;</span><span class="p">,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="initialise_colour_map"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.initialise_colour_map">[docs]</a><span class="k">def</span> <span class="nf">initialise_colour_map</span><span class="p">(</span><span class="n">book</span><span class="p">):</span>
    <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">book</span><span class="o">.</span><span class="n">colour_indexes_used</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c"># Add the 8 invariant colours</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">excel_default_palette_b8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c"># Add the default palette depending on the version</span>
    <span class="n">dpal</span> <span class="o">=</span> <span class="n">default_palette</span><span class="p">[</span><span class="n">book</span><span class="o">.</span><span class="n">biff_version</span><span class="p">]</span>
    <span class="n">ndpal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dpal</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ndpal</span><span class="p">):</span>
        <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c"># Add the specials -- None means the RGB value is not known</span>
    <span class="c"># System window text colour for border lines</span>
    <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="n">ndpal</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># System window background colour for pattern background</span>
    <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="n">ndpal</span><span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#</span>
    <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="mh">0x51</span><span class="p">,</span> <span class="c"># System ToolTip text colour (used in note objects)</span>
        <span class="mh">0x7FFF</span><span class="p">,</span> <span class="c"># 32767, system window text colour for fonts</span>
        <span class="p">):</span>
        <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="nearest_colour_index"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.nearest_colour_index">[docs]</a><span class="k">def</span> <span class="nf">nearest_colour_index</span><span class="p">(</span><span class="n">colour_map</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c"># General purpose function. Uses Euclidean distance.</span>
    <span class="c"># So far used only for pre-BIFF8 WINDOW2 record.</span>
    <span class="c"># Doesn&#39;t have to be fast.</span>
    <span class="c"># Doesn&#39;t have to be fancy.</span>
    <span class="n">best_metric</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">256</span>
    <span class="n">best_colourx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">colourx</span><span class="p">,</span> <span class="n">cand_rgb</span> <span class="ow">in</span> <span class="n">colour_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cand_rgb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">cand_rgb</span><span class="p">):</span>
            <span class="n">metric</span> <span class="o">+=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">&lt;</span> <span class="n">best_metric</span><span class="p">:</span>
            <span class="n">best_metric</span> <span class="o">=</span> <span class="n">metric</span>
            <span class="n">best_colourx</span> <span class="o">=</span> <span class="n">colourx</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;nearest_colour_index for </span><span class="si">%r</span><span class="s"> is </span><span class="si">%r</span><span class="s"> -&gt; </span><span class="si">%r</span><span class="s">; best_metric is </span><span class="si">%d</span><span class="s">&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">best_colourx</span><span class="p">,</span> <span class="n">colour_map</span><span class="p">[</span><span class="n">best_colourx</span><span class="p">],</span> <span class="n">best_metric</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">best_colourx</span>

<span class="c">##</span>
<span class="c"># This mixin class exists solely so that Format, Font, and XF.... objects</span>
<span class="c"># can be compared by value of their attributes.</span></div>
<div class="viewcode-block" id="EqNeAttrs"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.EqNeAttrs">[docs]</a><span class="k">class</span> <span class="nc">EqNeAttrs</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>

<span class="c">##</span>
<span class="c"># An Excel &quot;font&quot; contains the details of not only what is normally</span>
<span class="c"># considered a font, but also several other display attributes.</span>
<span class="c"># Items correspond to those in the Excel UI&#39;s Format/Cells/Font tab.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span></div>
<div class="viewcode-block" id="Font"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.Font">[docs]</a><span class="k">class</span> <span class="nc">Font</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># 1 = Characters are bold. Redundant; see &quot;weight&quot; attribute.</span>
    <span class="n">bold</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Values: 0 = ANSI Latin, 1 = System default, 2 = Symbol,</span>
    <span class="c"># 77 = Apple Roman,</span>
    <span class="c"># 128 = ANSI Japanese Shift-JIS,</span>
    <span class="c"># 129 = ANSI Korean (Hangul),</span>
    <span class="c"># 130 = ANSI Korean (Johab),</span>
    <span class="c"># 134 = ANSI Chinese Simplified GBK,</span>
    <span class="c"># 136 = ANSI Chinese Traditional BIG5,</span>
    <span class="c"># 161 = ANSI Greek,</span>
    <span class="c"># 162 = ANSI Turkish,</span>
    <span class="c"># 163 = ANSI Vietnamese,</span>
    <span class="c"># 177 = ANSI Hebrew,</span>
    <span class="c"># 178 = ANSI Arabic,</span>
    <span class="c"># 186 = ANSI Baltic,</span>
    <span class="c"># 204 = ANSI Cyrillic,</span>
    <span class="c"># 222 = ANSI Thai,</span>
    <span class="c"># 238 = ANSI Latin II (Central European),</span>
    <span class="c"># 255 = OEM Latin I</span>
    <span class="n">character_set</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># An explanation of &quot;colour index&quot; is given in the Formatting</span>
    <span class="c"># section at the start of this document.</span>
    <span class="n">colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = Superscript, 2 = Subscript.</span>
    <span class="n">escapement</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 0 = None (unknown or don&#39;t care)&lt;br /&gt;</span>
    <span class="c"># 1 = Roman (variable width, serifed)&lt;br /&gt;</span>
    <span class="c"># 2 = Swiss (variable width, sans-serifed)&lt;br /&gt;</span>
    <span class="c"># 3 = Modern (fixed width, serifed or sans-serifed)&lt;br /&gt;</span>
    <span class="c"># 4 = Script (cursive)&lt;br /&gt;</span>
    <span class="c"># 5 = Decorative (specialised, for example Old English, Fraktur)</span>
    <span class="n">family</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The 0-based index used to refer to this Font() instance.</span>
    <span class="c"># Note that index 4 is never used; xlrd supplies a dummy place-holder.</span>
    <span class="n">font_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Height of the font (in twips). A twip = 1/20 of a point.</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = Characters are italic.</span>
    <span class="n">italic</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The name of the font. Example: u&quot;Arial&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="c">##</span>
    <span class="c"># 1 = Characters are struck out.</span>
    <span class="n">struck_out</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 0 = None&lt;br /&gt;</span>
    <span class="c"># 1 = Single;  0x21 (33) = Single accounting&lt;br /&gt;</span>
    <span class="c"># 2 = Double;  0x22 (34) = Double accounting</span>
    <span class="n">underline_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = Characters are underlined. Redundant; see &quot;underline_type&quot; attribute.</span>
    <span class="n">underlined</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Font weight (100-1000). Standard values are 400 for normal text</span>
    <span class="c"># and 700 for bold text.</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">400</span>
    <span class="c">##</span>
    <span class="c"># 1 = Font is outline style (Macintosh only)</span>
    <span class="n">outline</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = Font is shadow style (Macintosh only)</span>
    <span class="n">shadow</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># No methods ...</span>
</div>
<div class="viewcode-block" id="handle_efont"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_efont">[docs]</a><span class="k">def</span> <span class="nf">handle_efont</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span> <span class="c"># BIFF2 only</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">book</span><span class="o">.</span><span class="n">font_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">colour_index</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="handle_font"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_font">[docs]</a><span class="k">def</span> <span class="nf">handle_font</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">encoding</span><span class="p">:</span>
        <span class="n">book</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">font_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Font</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;Dummy Font&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">font_index</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">book</span><span class="o">.</span><span class="n">font_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Font</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">font_index</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">book</span><span class="o">.</span><span class="n">font_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">colour_index</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span>
            <span class="n">f</span><span class="o">.</span><span class="n">escapement</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">underline_type</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">family</span><span class="p">,</span>
            <span class="n">f</span><span class="o">.</span><span class="n">character_set</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHHHHBBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">underlined</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="n">f</span><span class="o">.</span><span class="n">struck_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
        <span class="n">f</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span>
        <span class="n">f</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">option_flags</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">colour_index</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">underlined</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="n">f</span><span class="o">.</span><span class="n">struck_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
        <span class="n">f</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span>
        <span class="n">f</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
        <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># Now cook up the remaining attributes ...</span>
        <span class="n">f</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">][</span><span class="n">f</span><span class="o">.</span><span class="n">bold</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">escapement</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># None</span>
        <span class="n">f</span><span class="o">.</span><span class="n">underline_type</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">underlined</span> <span class="c"># None or Single</span>
        <span class="n">f</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Unknown / don&#39;t care</span>
        <span class="n">f</span><span class="o">.</span><span class="n">character_set</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># System default (0 means &quot;ANSI Latin&quot;)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c"># BIFF2</span>
        <span class="n">f</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">option_flags</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">colour_index</span> <span class="o">=</span> <span class="mh">0x7FFF</span> <span class="c"># &quot;system window text colour&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">underlined</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="n">f</span><span class="o">.</span><span class="n">struck_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">option_flags</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
        <span class="n">f</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">f</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># Now cook up the remaining attributes ...</span>
        <span class="n">f</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">][</span><span class="n">f</span><span class="o">.</span><span class="n">bold</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">escapement</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># None</span>
        <span class="n">f</span><span class="o">.</span><span class="n">underline_type</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">underlined</span> <span class="c"># None or Single</span>
        <span class="n">f</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Unknown / don&#39;t care</span>
        <span class="n">f</span><span class="o">.</span><span class="n">character_set</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># System default (0 means &quot;ANSI Latin&quot;)</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- handle_font: font[</span><span class="si">%d</span><span class="s">] ---&quot;</span> <span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="s">&quot;-------------------&quot;</span><span class="p">,</span>
            <span class="p">)</span>

<span class="c"># === &quot;Number formats&quot; ===</span>

<span class="c">##</span>
<span class="c"># &quot;Number format&quot; information from a FORMAT record.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span></div>
<div class="viewcode-block" id="Format"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.Format">[docs]</a><span class="k">class</span> <span class="nc">Format</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>
    <span class="c">##</span>
    <span class="c"># The key into Book.format_map</span>
    <span class="n">format_key</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># A classification that has been inferred from the format string.</span>
    <span class="c"># Currently, this is used only to distinguish between numbers and dates.</span>
    <span class="c"># &lt;br /&gt;Values:</span>
    <span class="c"># &lt;br /&gt;FUN = 0 # unknown</span>
    <span class="c"># &lt;br /&gt;FDT = 1 # date</span>
    <span class="c"># &lt;br /&gt;FNU = 2 # number</span>
    <span class="c"># &lt;br /&gt;FGE = 3 # general</span>
    <span class="c"># &lt;br /&gt;FTX = 4 # text</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">FUN</span>
    <span class="c">##</span>
    <span class="c"># The format string</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_key</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">format_str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="n">format_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_str</span> <span class="o">=</span> <span class="n">format_str</span>
</div>
<span class="n">std_format_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c"># &quot;std&quot; == &quot;standard for US English locale&quot;</span>
    <span class="c"># #### TODO ... a lot of work to tailor these to the user&#39;s locale.</span>
    <span class="c"># See e.g. gnumeric-1.x.y/src/formats.c</span>
    <span class="mh">0x00</span><span class="p">:</span> <span class="s">&quot;General&quot;</span><span class="p">,</span>
    <span class="mh">0x01</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
    <span class="mh">0x02</span><span class="p">:</span> <span class="s">&quot;0.00&quot;</span><span class="p">,</span>
    <span class="mh">0x03</span><span class="p">:</span> <span class="s">&quot;#,##0&quot;</span><span class="p">,</span>
    <span class="mh">0x04</span><span class="p">:</span> <span class="s">&quot;#,##0.00&quot;</span><span class="p">,</span>
    <span class="mh">0x05</span><span class="p">:</span> <span class="s">&quot;$#,##0_);($#,##0)&quot;</span><span class="p">,</span>
    <span class="mh">0x06</span><span class="p">:</span> <span class="s">&quot;$#,##0_);[Red]($#,##0)&quot;</span><span class="p">,</span>
    <span class="mh">0x07</span><span class="p">:</span> <span class="s">&quot;$#,##0.00_);($#,##0.00)&quot;</span><span class="p">,</span>
    <span class="mh">0x08</span><span class="p">:</span> <span class="s">&quot;$#,##0.00_);[Red]($#,##0.00)&quot;</span><span class="p">,</span>
    <span class="mh">0x09</span><span class="p">:</span> <span class="s">&quot;0%&quot;</span><span class="p">,</span>
    <span class="mh">0x0a</span><span class="p">:</span> <span class="s">&quot;0.00%&quot;</span><span class="p">,</span>
    <span class="mh">0x0b</span><span class="p">:</span> <span class="s">&quot;0.00E+00&quot;</span><span class="p">,</span>
    <span class="mh">0x0c</span><span class="p">:</span> <span class="s">&quot;# ?/?&quot;</span><span class="p">,</span>
    <span class="mh">0x0d</span><span class="p">:</span> <span class="s">&quot;# ??/??&quot;</span><span class="p">,</span>
    <span class="mh">0x0e</span><span class="p">:</span> <span class="s">&quot;m/d/yy&quot;</span><span class="p">,</span>
    <span class="mh">0x0f</span><span class="p">:</span> <span class="s">&quot;d-mmm-yy&quot;</span><span class="p">,</span>
    <span class="mh">0x10</span><span class="p">:</span> <span class="s">&quot;d-mmm&quot;</span><span class="p">,</span>
    <span class="mh">0x11</span><span class="p">:</span> <span class="s">&quot;mmm-yy&quot;</span><span class="p">,</span>
    <span class="mh">0x12</span><span class="p">:</span> <span class="s">&quot;h:mm AM/PM&quot;</span><span class="p">,</span>
    <span class="mh">0x13</span><span class="p">:</span> <span class="s">&quot;h:mm:ss AM/PM&quot;</span><span class="p">,</span>
    <span class="mh">0x14</span><span class="p">:</span> <span class="s">&quot;h:mm&quot;</span><span class="p">,</span>
    <span class="mh">0x15</span><span class="p">:</span> <span class="s">&quot;h:mm:ss&quot;</span><span class="p">,</span>
    <span class="mh">0x16</span><span class="p">:</span> <span class="s">&quot;m/d/yy h:mm&quot;</span><span class="p">,</span>
    <span class="mh">0x25</span><span class="p">:</span> <span class="s">&quot;#,##0_);(#,##0)&quot;</span><span class="p">,</span>
    <span class="mh">0x26</span><span class="p">:</span> <span class="s">&quot;#,##0_);[Red](#,##0)&quot;</span><span class="p">,</span>
    <span class="mh">0x27</span><span class="p">:</span> <span class="s">&quot;#,##0.00_);(#,##0.00)&quot;</span><span class="p">,</span>
    <span class="mh">0x28</span><span class="p">:</span> <span class="s">&quot;#,##0.00_);[Red](#,##0.00)&quot;</span><span class="p">,</span>
    <span class="mh">0x29</span><span class="p">:</span> <span class="s">&quot;_(* #,##0_);_(* (#,##0);_(* </span><span class="se">\&quot;</span><span class="s">-</span><span class="se">\&quot;</span><span class="s">_);_(@_)&quot;</span><span class="p">,</span>
    <span class="mh">0x2a</span><span class="p">:</span> <span class="s">&quot;_($* #,##0_);_($* (#,##0);_($* </span><span class="se">\&quot;</span><span class="s">-</span><span class="se">\&quot;</span><span class="s">_);_(@_)&quot;</span><span class="p">,</span>
    <span class="mh">0x2b</span><span class="p">:</span> <span class="s">&quot;_(* #,##0.00_);_(* (#,##0.00);_(* </span><span class="se">\&quot;</span><span class="s">-</span><span class="se">\&quot;</span><span class="s">??_);_(@_)&quot;</span><span class="p">,</span>
    <span class="mh">0x2c</span><span class="p">:</span> <span class="s">&quot;_($* #,##0.00_);_($* (#,##0.00);_($* </span><span class="se">\&quot;</span><span class="s">-</span><span class="se">\&quot;</span><span class="s">??_);_(@_)&quot;</span><span class="p">,</span>
    <span class="mh">0x2d</span><span class="p">:</span> <span class="s">&quot;mm:ss&quot;</span><span class="p">,</span>
    <span class="mh">0x2e</span><span class="p">:</span> <span class="s">&quot;[h]:mm:ss&quot;</span><span class="p">,</span>
    <span class="mh">0x2f</span><span class="p">:</span> <span class="s">&quot;mm:ss.0&quot;</span><span class="p">,</span>
    <span class="mh">0x30</span><span class="p">:</span> <span class="s">&quot;##0.0E+0&quot;</span><span class="p">,</span>
    <span class="mh">0x31</span><span class="p">:</span> <span class="s">&quot;@&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">fmt_code_ranges</span> <span class="o">=</span> <span class="p">[</span> <span class="c"># both-inclusive ranges of &quot;standard&quot; format codes</span>
    <span class="c"># Source: the openoffice.org doc&#39;t</span>
    <span class="c"># and the OOXML spec Part 4, section 3.8.30</span>
    <span class="p">(</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">FGE</span><span class="p">),</span>
    <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">FNU</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">FDT</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="n">FDT</span><span class="p">),</span> <span class="c"># CJK date formats</span>
    <span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="n">FNU</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="n">FDT</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="n">FNU</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="n">FTX</span><span class="p">),</span>
    <span class="c"># Gnumeric assumes (or assumed) that built-in formats finish at 49, not at 163</span>
    <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="n">FDT</span><span class="p">),</span> <span class="c"># CJK date formats</span>
    <span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="n">FNU</span><span class="p">),</span> <span class="c"># Thai number (currency?) formats</span>
    <span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="n">FNU</span><span class="p">),</span> <span class="c"># Thai number (currency?) formats</span>
    <span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="n">FDT</span><span class="p">),</span> <span class="c"># Thai date formats</span>
    <span class="p">]</span>

<span class="n">std_format_code_types</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ty</span> <span class="ow">in</span> <span class="n">fmt_code_ranges</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">std_format_code_types</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">ty</span>
<span class="k">del</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">x</span>

<span class="n">date_chars</span> <span class="o">=</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;ymdhs&#39;</span><span class="p">)</span> <span class="c"># year, month/minute, day, hour, second</span>
<span class="n">date_char_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">date_chars</span> <span class="o">+</span> <span class="n">date_chars</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
    <span class="n">date_char_dict</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">del</span> <span class="n">_c</span><span class="p">,</span> <span class="n">date_chars</span>

<span class="n">skip_char_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;$-+/(): &#39;</span><span class="p">):</span>
    <span class="n">skip_char_dict</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">num_char_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">non_date_formats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;0.00E+00&#39;</span><span class="p">):</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;##0.0E+0&#39;</span><span class="p">):</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;General&#39;</span><span class="p">)</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;GENERAL&#39;</span><span class="p">)</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="c"># OOo Calc 1.1.4 does this.</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;general&#39;</span><span class="p">)</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="c"># pyExcelerator 0.6.3 does this.</span>
    <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)</span>       <span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">fmt_bracketed_sub</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\[[^]]*\]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span>

<span class="c"># Boolean format strings (actual cases)</span>
<span class="c"># u&#39;&quot;Yes&quot;;&quot;Yes&quot;;&quot;No&quot;&#39;</span>
<span class="c"># u&#39;&quot;True&quot;;&quot;True&quot;;&quot;False&quot;&#39;</span>
<span class="c"># u&#39;&quot;On&quot;;&quot;On&quot;;&quot;Off&quot;&#39;</span>

<div class="viewcode-block" id="is_date_format_string"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.is_date_format_string">[docs]</a><span class="k">def</span> <span class="nf">is_date_format_string</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
    <span class="c"># Heuristics:</span>
    <span class="c"># Ignore &quot;text&quot; and [stuff in square brackets (aarrgghh -- see below)].</span>
    <span class="c"># Handle backslashed-escaped chars properly.</span>
    <span class="c"># E.g. hh\hmm\mss\s should produce a display like 23h59m59s</span>
    <span class="c"># Date formats have one or more of ymdhs (caseless) in them.</span>
    <span class="c"># Numeric formats have # and 0.</span>
    <span class="c"># N.B. u&#39;General&quot;.&quot;&#39; hence get rid of &quot;text&quot; first.</span>
    <span class="c"># TODO: Find where formats are interpreted in Gnumeric</span>
    <span class="c"># TODO: u&#39;[h]\\ \\h\\o\\u\\r\\s&#39; ([h] means don&#39;t care about hours &gt; 23)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">r&quot;\_*&quot;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">skip_char_dict</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">UNICODE_LITERAL</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Ignore char after backslash, underscore or asterisk</span>
            <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">state</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;is_date_format_string: reduced format is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">REPR</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">fmt_bracketed_sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">non_date_formats</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">separator</span> <span class="o">=</span> <span class="s">&quot;;&quot;</span>
    <span class="n">got_sep</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">date_count</span> <span class="o">=</span> <span class="n">num_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">date_char_dict</span><span class="p">:</span>
            <span class="n">date_count</span> <span class="o">+=</span> <span class="n">date_char_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">num_char_dict</span><span class="p">:</span>
            <span class="n">num_count</span> <span class="o">+=</span> <span class="n">num_char_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">separator</span><span class="p">:</span>
            <span class="n">got_sep</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># print num_count, date_count, repr(fmt)</span>
    <span class="k">if</span> <span class="n">date_count</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">num_count</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">num_count</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">date_count</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">date_count</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&#39;WARNING *** is_date_format: ambiguous d=</span><span class="si">%d</span><span class="s"> n=</span><span class="si">%d</span><span class="s"> fmt=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="n">date_count</span><span class="p">,</span> <span class="n">num_count</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">got_sep</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;WARNING *** format </span><span class="si">%r</span><span class="s"> produces constant result</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">fmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">date_count</span> <span class="o">&gt;</span> <span class="n">num_count</span>
</div>
<div class="viewcode-block" id="handle_format"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_format">[docs]</a><span class="k">def</span> <span class="nf">handle_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rectype</span><span class="o">=</span><span class="n">XL_FORMAT</span><span class="p">):</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="k">if</span> <span class="n">rectype</span> <span class="o">==</span> <span class="n">XL_FORMAT2</span><span class="p">:</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bv</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derive_encoding</span><span class="p">()</span>
    <span class="n">strpos</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">fmtkey</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmtkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actualfmtcount</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">strpos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actualfmtcount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">unistrg</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unistrg</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="s">&quot;FORMAT: count=</span><span class="si">%d</span><span class="s"> fmtkey=0x</span><span class="si">%04x</span><span class="s"> (</span><span class="si">%d</span><span class="s">) s=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actualfmtcount</span><span class="p">,</span> <span class="n">fmtkey</span><span class="p">,</span> <span class="n">fmtkey</span><span class="p">,</span> <span class="n">unistrg</span><span class="p">)</span>
    <span class="n">is_date_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_date_format_string</span><span class="p">(</span><span class="n">unistrg</span><span class="p">)</span>
    <span class="n">ty</span> <span class="o">=</span> <span class="p">[</span><span class="n">FGE</span><span class="p">,</span> <span class="n">FDT</span><span class="p">][</span><span class="n">is_date_s</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">fmtkey</span> <span class="o">&gt;</span> <span class="mi">163</span> <span class="ow">or</span> <span class="n">bv</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">):</span>
        <span class="c"># user_defined if fmtkey &gt; 163</span>
        <span class="c"># N.B. Gnumeric incorrectly starts these at 50 instead of 164 :-(</span>
        <span class="c"># if earlier than BIFF 5, standard info is useless</span>
        <span class="n">std_ty</span> <span class="o">=</span> <span class="n">std_format_code_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fmtkey</span><span class="p">,</span> <span class="n">FUN</span><span class="p">)</span>
        <span class="c"># print &quot;std ty&quot;, std_ty</span>
        <span class="n">is_date_c</span> <span class="o">=</span> <span class="n">std_ty</span> <span class="o">==</span> <span class="n">FDT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">fmtkey</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_date_c</span> <span class="o">^</span> <span class="n">is_date_s</span><span class="p">):</span>
            <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;WARNING *** Conflict between &quot;</span>
                <span class="s">&quot;std format key </span><span class="si">%d</span><span class="s"> and its format string </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">fmtkey</span><span class="p">,</span> <span class="n">unistrg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="s">&quot;ty: </span><span class="si">%d</span><span class="s">; is_date_c: </span><span class="si">%r</span><span class="s">; is_date_s: </span><span class="si">%r</span><span class="s">; fmt_strg: </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">ty</span><span class="p">,</span> <span class="n">is_date_c</span><span class="p">,</span> <span class="n">is_date_s</span><span class="p">,</span> <span class="n">unistrg</span><span class="p">)</span>
    <span class="n">fmtobj</span> <span class="o">=</span> <span class="n">Format</span><span class="p">(</span><span class="n">fmtkey</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">unistrg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fmtobj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- handle_format [</span><span class="si">%d</span><span class="s">] ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actualfmtcount</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">fmtkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmtobj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">format_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmtobj</span><span class="p">)</span>

<span class="c"># =============================================================================</span>
</div>
<div class="viewcode-block" id="handle_palette"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_palette">[docs]</a><span class="k">def</span> <span class="nf">handle_palette</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="n">n_colours</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">expected_n_colours</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">56</span><span class="p">)[</span><span class="n">book</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">DEBUG</span> <span class="ow">or</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="ow">and</span> <span class="n">n_colours</span> <span class="o">!=</span> <span class="n">expected_n_colours</span><span class="p">):</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="s">&quot;NOTE *** Expected </span><span class="si">%d</span><span class="s"> colours in PALETTE record, found </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">expected_n_colours</span><span class="p">,</span> <span class="n">n_colours</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="s">&quot;PALETTE record with </span><span class="si">%d</span><span class="s"> colours</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n_colours</span><span class="p">)</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;xx</span><span class="si">%d</span><span class="s">i&#39;</span> <span class="o">%</span> <span class="n">n_colours</span> <span class="c"># use i to avoid long integers</span>
    <span class="n">expected_size</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n_colours</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">actual_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_size</span> <span class="o">&lt;=</span> <span class="n">actual_size</span> <span class="o">&lt;=</span> <span class="n">expected_size</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;PALETTE record: expected size </span><span class="si">%d</span><span class="s">, actual size </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expected_size</span><span class="p">,</span> <span class="n">actual_size</span><span class="p">))</span>
    <span class="n">colours</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="n">expected_size</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">palette_record</span> <span class="o">==</span> <span class="p">[]</span> <span class="c"># There should be only 1 PALETTE record</span>
    <span class="c"># a colour will be 0xbbggrr</span>
    <span class="c"># IOW, red is at the little end</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_colours</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">red</span>   <span class="o">=</span>  <span class="n">c</span>        <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;&gt;</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="n">blue</span>  <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="n">old_rgb</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">]</span>
        <span class="n">new_rgb</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span>
        <span class="n">book</span><span class="o">.</span><span class="n">palette_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rgb</span><span class="p">)</span>
        <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_rgb</span>
        <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_rgb</span> <span class="o">!=</span> <span class="n">old_rgb</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%2d</span><span class="s">: </span><span class="si">%r</span><span class="s"> -&gt; </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">old_rgb</span><span class="p">,</span> <span class="n">new_rgb</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="palette_epilogue"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.palette_epilogue">[docs]</a><span class="k">def</span> <span class="nf">palette_epilogue</span><span class="p">(</span><span class="n">book</span><span class="p">):</span>
    <span class="c"># Check colour indexes in fonts etc.</span>
    <span class="c"># This must be done here as FONT records</span>
    <span class="c"># come *before* the PALETTE record :-(</span>
    <span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">font_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">font_index</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c"># the missing font record</span>
            <span class="k">continue</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">colour_index</span>
        <span class="k">if</span> <span class="n">cx</span> <span class="o">==</span> <span class="mh">0x7fff</span><span class="p">:</span> <span class="c"># system window text colour</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">:</span>
            <span class="n">book</span><span class="o">.</span><span class="n">colour_indexes_used</span><span class="p">[</span><span class="n">cx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Size of colour table:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;*** Font #</span><span class="si">%d</span><span class="s"> (</span><span class="si">%r</span><span class="s">): colour index 0x</span><span class="si">%04x</span><span class="s"> is unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">font</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">font</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">colour_indexes_used</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Colour indexes used:</span><span class="se">\n</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">used</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="handle_style"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_style">[docs]</a><span class="k">def</span> <span class="nf">handle_style</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="n">book</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="n">flag_and_xfx</span><span class="p">,</span> <span class="n">built_in_id</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;HBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">xf_index</span> <span class="o">=</span> <span class="n">flag_and_xfx</span> <span class="o">&amp;</span> <span class="mh">0x0fff</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\0\0\0\0</span><span class="s">&quot;</span>
    <span class="ow">and</span> <span class="s">&quot;Normal&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">style_name_map</span><span class="p">):</span>
        <span class="c"># Erroneous record (doesn&#39;t have built-in bit set).</span>
        <span class="c"># Example file supplied by Jeff Bell.</span>
        <span class="n">built_in</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">built_in_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xf_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Normal&quot;</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="k">elif</span> <span class="n">flag_and_xfx</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">:</span>
        <span class="c"># built-in style</span>
        <span class="n">built_in</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">built_in_style_names</span><span class="p">[</span><span class="n">built_in_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">built_in_id</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># user-defined style</span>
        <span class="n">built_in</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">built_in_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">unpack_unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;STYLE: built_in=</span><span class="si">%d</span><span class="s"> xf_index=</span><span class="si">%d</span><span class="s"> built_in_id=</span><span class="si">%d</span><span class="s"> level=</span><span class="si">%d</span><span class="s">&quot;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">built_in</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">built_in_id</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;raw bytes:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">lenlen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blah</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING *** A user-defined style has a zero-length name&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">style_name_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">built_in</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;STYLE: built_in=</span><span class="si">%d</span><span class="s"> xf_index=</span><span class="si">%d</span><span class="s"> built_in_id=</span><span class="si">%d</span><span class="s"> level=</span><span class="si">%d</span><span class="s"> name=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">built_in</span><span class="p">,</span> <span class="n">xf_index</span><span class="p">,</span> <span class="n">built_in_id</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="check_colour_indexes_in_obj"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.check_colour_indexes_in_obj">[docs]</a><span class="k">def</span> <span class="nf">check_colour_indexes_in_obj</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">orig_index</span><span class="p">):</span>
    <span class="n">alist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">nobj</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">nobj</span><span class="p">,</span> <span class="s">&#39;dump&#39;</span><span class="p">):</span>
            <span class="n">check_colour_indexes_in_obj</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">nobj</span><span class="p">,</span> <span class="n">orig_index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;colour_index&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nobj</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">colour_map</span><span class="p">:</span>
                <span class="n">book</span><span class="o">.</span><span class="n">colour_indexes_used</span><span class="p">[</span><span class="n">nobj</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">oname</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** xf #</span><span class="si">%d</span><span class="s"> : </span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> =  0x</span><span class="si">%04x</span><span class="s"> (unknown)&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">orig_index</span><span class="p">,</span> <span class="n">oname</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">nobj</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="fill_in_standard_formats"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.fill_in_standard_formats">[docs]</a><span class="k">def</span> <span class="nf">fill_in_standard_formats</span><span class="p">(</span><span class="n">book</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">std_format_code_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">format_map</span><span class="p">:</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="n">std_format_code_types</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="c"># Note: many standard format codes (mostly CJK date formats) have</span>
            <span class="c"># format strings that vary by locale; xlrd does not (yet)</span>
            <span class="c"># handle those; the type (date or numeric) is recorded but the fmt_str will be None.</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="n">std_format_strings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">fmtobj</span> <span class="o">=</span> <span class="n">Format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">)</span>
            <span class="n">book</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmtobj</span>
</div>
<div class="viewcode-block" id="handle_xf"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.handle_xf">[docs]</a><span class="k">def</span> <span class="nf">handle_xf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c">### self is a Book instance</span>
    <span class="c"># DEBUG = 0</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">XF</span><span class="p">()</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">XFAlignment</span><span class="p">()</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">shrink_to_fit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">text_direction</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">XFBorder</span><span class="p">()</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_up</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_down</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="o">.</span><span class="n">diag_line_style</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># no line</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">XFBackground</span><span class="p">()</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">protection</span> <span class="o">=</span> <span class="n">XFProtection</span><span class="p">()</span>
    <span class="c"># fill in the known standard formats</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xfcount</span><span class="p">:</span>
        <span class="c"># i.e. do this once before we process the first XF record</span>
        <span class="n">fill_in_standard_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">unpack_fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;HHHBBBBIiH&#39;</span>
        <span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span>
        <span class="n">pkd_align1</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">pkd_align2</span><span class="p">,</span>
        <span class="n">pkd_used</span><span class="p">,</span> <span class="n">pkd_brdbkg1</span><span class="p">,</span> <span class="n">pkd_brdbkg2</span><span class="p">,</span> <span class="n">pkd_brdbkg3</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">unpack_fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="s">&#39;is_style&#39;</span><span class="p">),</span>
            <span class="c"># Following is not in OOo docs, but is mentioned</span>
            <span class="c"># in Gnumeric source and also in (deep breath)</span>
            <span class="c"># org.apache.poi.hssf.record.ExtendedFormatRecord.java</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="s">&#39;lotus_123_prefix&#39;</span><span class="p">),</span> <span class="c"># Meaning is not known.</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="s">&#39;parent_style_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">pkd_align1</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="s">&#39;hor_align&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;text_wrapped&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="s">&#39;vert_align&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">pkd_align2</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="s">&#39;indent_level&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="s">&#39;shrink_to_fit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="s">&#39;text_direction&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">pkd_used</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">reg</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brdbkg1</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="mh">0x0000000f</span><span class="p">,</span>  <span class="s">&#39;left_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span>  <span class="mh">0x000000f0</span><span class="p">,</span>  <span class="s">&#39;right_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span>  <span class="mh">0x00000f00</span><span class="p">,</span>  <span class="s">&#39;top_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mh">0x0000f000</span><span class="p">,</span>  <span class="s">&#39;bottom_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mh">0x007f0000</span><span class="p">,</span>  <span class="s">&#39;left_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mh">0x3f800000</span><span class="p">,</span>  <span class="s">&#39;right_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mh">0x40000000</span><span class="p">,</span>  <span class="s">&#39;diag_down&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="s">&#39;diag_up&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brdbkg2</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="mh">0x0000007F</span><span class="p">,</span> <span class="s">&#39;top_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span>  <span class="mh">0x00003F80</span><span class="p">,</span> <span class="s">&#39;bottom_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mh">0x001FC000</span><span class="p">,</span> <span class="s">&#39;diag_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mh">0x01E00000</span><span class="p">,</span> <span class="s">&#39;diag_line_style&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">pkd_brdbkg2</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mh">0xFC000000</span><span class="p">,</span> <span class="s">&#39;fill_pattern&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">pkd_brdbkg3</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x007F</span><span class="p">,</span> <span class="s">&#39;pattern_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mh">0x3F80</span><span class="p">,</span> <span class="s">&#39;background_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
    <span class="k">elif</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">unpack_fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;HHHBBIi&#39;</span>
        <span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span>
        <span class="n">pkd_align1</span><span class="p">,</span> <span class="n">pkd_orient_used</span><span class="p">,</span>
        <span class="n">pkd_brdbkg1</span><span class="p">,</span> <span class="n">pkd_brdbkg2</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">unpack_fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="s">&#39;is_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="s">&#39;lotus_123_prefix&#39;</span><span class="p">),</span> <span class="c"># Meaning is not known.</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="s">&#39;parent_style_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">pkd_align1</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="s">&#39;hor_align&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;text_wrapped&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="s">&#39;vert_align&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="n">pkd_orient_used</span> <span class="o">&amp;</span> <span class="mh">0x03</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">][</span><span class="n">orientation</span><span class="p">]</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">pkd_orient_used</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">reg</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">pkd_brdbkg1</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0000007F</span><span class="p">,</span> <span class="s">&#39;pattern_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="mh">0x00003F80</span><span class="p">,</span> <span class="s">&#39;background_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mh">0x003F0000</span><span class="p">,</span> <span class="s">&#39;fill_pattern&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brdbkg1</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mh">0x01C00000</span><span class="p">,</span>  <span class="s">&#39;bottom_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mh">0xFE000000</span><span class="p">,</span> <span class="s">&#39;bottom_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brdbkg2</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x00000007</span><span class="p">,</span> <span class="s">&#39;top_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x00000038</span><span class="p">,</span> <span class="s">&#39;left_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x000001C0</span><span class="p">,</span> <span class="s">&#39;right_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="mh">0x0000FE00</span><span class="p">,</span> <span class="s">&#39;top_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mh">0x007F0000</span><span class="p">,</span> <span class="s">&#39;left_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mh">0x3F800000</span><span class="p">,</span> <span class="s">&#39;right_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
    <span class="k">elif</span> <span class="n">bv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
        <span class="n">unpack_fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;BBHBBHI&#39;</span>
        <span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span>
        <span class="n">pkd_align_orient</span><span class="p">,</span> <span class="n">pkd_used</span><span class="p">,</span>
        <span class="n">pkd_bkg_34</span><span class="p">,</span> <span class="n">pkd_brd_34</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">unpack_fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">pkd_type_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="s">&#39;is_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="s">&#39;lotus_123_prefix&#39;</span><span class="p">),</span> <span class="c"># Meaning is not known.</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="s">&#39;parent_style_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">pkd_align_orient</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="s">&#39;hor_align&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;text_wrapped&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="s">&#39;vert_align&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="p">(</span><span class="n">pkd_align_orient</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">][</span><span class="n">orientation</span><span class="p">]</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">pkd_used</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">reg</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">pkd_bkg_34</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x003F</span><span class="p">,</span> <span class="s">&#39;fill_pattern&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x07C0</span><span class="p">,</span> <span class="s">&#39;pattern_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mh">0xF800</span><span class="p">,</span> <span class="s">&#39;background_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brd_34</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x00000007</span><span class="p">,</span>  <span class="s">&#39;top_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x000000F8</span><span class="p">,</span>  <span class="s">&#39;top_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x00000700</span><span class="p">,</span>  <span class="s">&#39;left_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mh">0x0000F800</span><span class="p">,</span>  <span class="s">&#39;left_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mh">0x00070000</span><span class="p">,</span>  <span class="s">&#39;bottom_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mh">0x00F80000</span><span class="p">,</span>  <span class="s">&#39;bottom_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mh">0x07000000</span><span class="p">,</span>  <span class="s">&#39;right_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mh">0xF8000000</span><span class="p">,</span> <span class="s">&#39;right_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
    <span class="k">elif</span> <span class="n">bv</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">unpack_fmt</span> <span class="o">=</span> <span class="s">&#39;&lt;BBBBHHI&#39;</span>
        <span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">pkd_type_prot</span><span class="p">,</span>
        <span class="n">pkd_used</span><span class="p">,</span> <span class="n">pkd_align_par</span><span class="p">,</span>
        <span class="n">pkd_bkg_34</span><span class="p">,</span> <span class="n">pkd_brd_34</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">unpack_fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">pkd_type_prot</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">pkd_type_prot</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="s">&#39;is_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="s">&#39;lotus_123_prefix&#39;</span><span class="p">),</span> <span class="c"># Meaning is not known.</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">pkd_align_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="s">&#39;hor_align&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;text_wrapped&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">pkd_align_par</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="s">&#39;parent_style_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">pkd_used</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">reg</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">pkd_bkg_34</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x003F</span><span class="p">,</span> <span class="s">&#39;fill_pattern&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x07C0</span><span class="p">,</span> <span class="s">&#39;pattern_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mh">0xF800</span><span class="p">,</span> <span class="s">&#39;background_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbitsL</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">pkd_brd_34</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x00000007</span><span class="p">,</span>  <span class="s">&#39;top_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x000000F8</span><span class="p">,</span>  <span class="s">&#39;top_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x00000700</span><span class="p">,</span>  <span class="s">&#39;left_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mh">0x0000F800</span><span class="p">,</span>  <span class="s">&#39;left_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mh">0x00070000</span><span class="p">,</span>  <span class="s">&#39;bottom_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mh">0x00F80000</span><span class="p">,</span>  <span class="s">&#39;bottom_colour_index&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mh">0x07000000</span><span class="p">,</span>  <span class="s">&#39;right_line_style&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mh">0xF8000000</span><span class="p">,</span> <span class="s">&#39;right_colour_index&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">vert_align</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># bottom</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">bv</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>
        <span class="c">#### Warning: incomplete treatment; formatting_info not fully supported.</span>
        <span class="c">#### Probably need to offset incoming BIFF2 XF[n] to BIFF8-like XF[n+16],</span>
        <span class="c">#### and create XF[0:16] like the standard ones in BIFF8</span>
        <span class="c">#### *AND* add 16 to all XF references in cell records :-(</span>
        <span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">format_etc</span><span class="p">,</span> <span class="n">halign_etc</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;BxBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="n">format_etc</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">protection</span><span class="p">,</span> <span class="n">format_etc</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="s">&#39;cell_locked&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="s">&#39;formula_hidden&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="n">upkbits</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="p">,</span> <span class="n">halign_etc</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="s">&#39;hor_align&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="k">for</span> <span class="n">mask</span><span class="p">,</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">((</span><span class="mh">0x08</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">halign_etc</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">:</span>
                <span class="n">colour_index</span><span class="p">,</span> <span class="n">line_style</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span> <span class="c"># black, thin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colour_index</span><span class="p">,</span> <span class="n">line_style</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="c"># none, none</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">side</span> <span class="o">+</span> <span class="s">&#39;_colour_index&#39;</span><span class="p">,</span> <span class="n">colour_index</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="o">.</span><span class="n">border</span><span class="p">,</span> <span class="n">side</span> <span class="o">+</span> <span class="s">&#39;_line_style&#39;</span><span class="p">,</span> <span class="n">line_style</span><span class="p">)</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">xf</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="n">halign_etc</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">:</span>
            <span class="n">bg</span><span class="o">.</span><span class="n">fill_pattern</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bg</span><span class="o">.</span><span class="n">fill_pattern</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bg</span><span class="o">.</span><span class="n">background_colour_index</span> <span class="o">=</span> <span class="mi">9</span> <span class="c"># white</span>
        <span class="n">bg</span><span class="o">.</span><span class="n">pattern_colour_index</span> <span class="o">=</span> <span class="mi">8</span> <span class="c"># black</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># ???????????</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">vert_align</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># bottom</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">attr_stem</span> <span class="ow">in</span> \
            <span class="s">&quot;format font alignment border background protection&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_stem</span> <span class="o">+</span> <span class="s">&quot;_flag&quot;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">XLRDError</span><span class="p">(</span><span class="s">&#39;programmer stuff-up: bv=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">bv</span><span class="p">)</span>

    <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xfcount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&quot;--- handle_xf: xf[</span><span class="si">%d</span><span class="s">] ---&quot;</span> <span class="o">%</span> <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span>
        <span class="n">cellty</span> <span class="o">=</span> <span class="n">_cellty_from_fmtty</span><span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cellty</span> <span class="o">=</span> <span class="n">XL_CELL_NUMBER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cellty</span>

    <span class="c"># Now for some assertions ...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">and</span> <span class="n">xf</span><span class="o">.</span><span class="n">is_style</span> <span class="ow">and</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">!=</span> <span class="mh">0x0FFF</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;WARNING *** XF[</span><span class="si">%d</span><span class="s">] is a style XF but parent_style_index is 0x</span><span class="si">%04x</span><span class="s">, not 0x0fff</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">)</span>
        <span class="n">check_colour_indexes_in_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;WARNING *** XF[</span><span class="si">%d</span><span class="s">] unknown (raw) format key (</span><span class="si">%d</span><span class="s">, 0x</span><span class="si">%04x</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">)</span>
        <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="xf_epilogue"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.xf_epilogue">[docs]</a><span class="k">def</span> <span class="nf">xf_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># self is a Book instance.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xf_epilogue_done</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">num_xfs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="p">)</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="n">blah1</span> <span class="o">=</span> <span class="n">DEBUG</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">blah</span><span class="p">:</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;xf_epilogue called ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_same</span><span class="p">(</span><span class="n">book_arg</span><span class="p">,</span> <span class="n">xf_arg</span><span class="p">,</span> <span class="n">parent_arg</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="c"># the _arg caper is to avoid a Warning msg from Python 2.1 :-(</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">xf_arg</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parent_arg</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">book_arg</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">] parent[</span><span class="si">%d</span><span class="s">] </span><span class="si">%s</span><span class="s"> different</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">xf_arg</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">parent_arg</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">xfx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">num_xfs</span><span class="p">):</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="p">[</span><span class="n">xfx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ERROR *** XF[</span><span class="si">%d</span><span class="s">] unknown format key (</span><span class="si">%d</span><span class="s">, 0x</span><span class="si">%04x</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                    <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">)</span>
            <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span>
        <span class="n">cellty</span> <span class="o">=</span> <span class="n">_cellty_from_fmtty</span><span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xf_index_to_xl_type_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cellty</span>
        <span class="c"># Now for some assertions etc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatting_info</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">is_style</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">&lt;</span> <span class="n">num_xfs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;WARNING *** XF[</span><span class="si">%d</span><span class="s">]: is_style=</span><span class="si">%d</span><span class="s"> but parent_style_index=</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">is_style</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">)</span>
            <span class="c"># make it conform</span>
            <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">biff_version</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">==</span> <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">]: parent_style_index is also </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">]</span><span class="o">.</span><span class="n">is_style</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">]: parent_style_index is </span><span class="si">%d</span><span class="s">; style flag not set</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">)</span>                
            <span class="k">if</span> <span class="n">blah1</span> <span class="ow">and</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span> <span class="o">&gt;</span> <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">:</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                    <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">]: parent_style_index is </span><span class="si">%d</span><span class="s">; out of order?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xf_list</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">parent_style_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_alignment_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_alignment_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span> <span class="n">check_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="s">&#39;alignment&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_background_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_background_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span> <span class="n">check_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="s">&#39;background&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_border_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_border_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span> <span class="n">check_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="s">&#39;border&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_protection_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_protection_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span><span class="p">:</span> <span class="n">check_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="s">&#39;protection&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_format_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_format_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span> <span class="ow">and</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span> <span class="o">!=</span> <span class="n">parent</span><span class="o">.</span><span class="n">format_key</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">] fmtk=</span><span class="si">%d</span><span class="s">, parent[</span><span class="si">%d</span><span class="s">] fmtk=</span><span class="si">%r</span><span class="se">\n</span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">format_key</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">xf</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span><span class="o">.</span><span class="n">format_str</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_map</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">format_key</span><span class="p">]</span><span class="o">.</span><span class="n">format_str</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xf</span><span class="o">.</span><span class="n">_font_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">_font_flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blah1</span> <span class="ow">and</span> <span class="n">xf</span><span class="o">.</span><span class="n">font_index</span> <span class="o">!=</span> <span class="n">parent</span><span class="o">.</span><span class="n">font_index</span><span class="p">:</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span>
                        <span class="s">&quot;NOTE !!! XF[</span><span class="si">%d</span><span class="s">] fontx=</span><span class="si">%d</span><span class="s">, parent[</span><span class="si">%d</span><span class="s">] fontx=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">xf</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">font_index</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">xf_index</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">font_index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="initialise_book"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.initialise_book">[docs]</a><span class="k">def</span> <span class="nf">initialise_book</span><span class="p">(</span><span class="n">book</span><span class="p">):</span>
    <span class="n">initialise_colour_map</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">_xf_epilogue_done</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">handle_font</span><span class="p">,</span>
        <span class="n">handle_efont</span><span class="p">,</span>
        <span class="n">handle_format</span><span class="p">,</span>
        <span class="n">is_date_format_string</span><span class="p">,</span>
        <span class="n">handle_palette</span><span class="p">,</span>
        <span class="n">palette_epilogue</span><span class="p">,</span>
        <span class="n">handle_style</span><span class="p">,</span>
        <span class="n">handle_xf</span><span class="p">,</span>
        <span class="n">xf_epilogue</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># &lt;p&gt;A collection of the border-related attributes of an XF record.</span>
<span class="c"># Items correspond to those in the Excel UI&#39;s Format/Cells/Border tab.&lt;/p&gt;</span>
<span class="c"># &lt;p&gt; An explanations of &quot;colour index&quot; is given in the Formatting</span>
<span class="c"># section at the start of this document.</span>
<span class="c"># There are five line style attributes; possible values and the</span>
<span class="c"># associated meanings are:</span>
<span class="c"># 0&amp;nbsp;=&amp;nbsp;No line,</span>
<span class="c"># 1&amp;nbsp;=&amp;nbsp;Thin,</span>
<span class="c"># 2&amp;nbsp;=&amp;nbsp;Medium,</span>
<span class="c"># 3&amp;nbsp;=&amp;nbsp;Dashed,</span>
<span class="c"># 4&amp;nbsp;=&amp;nbsp;Dotted,</span>
<span class="c"># 5&amp;nbsp;=&amp;nbsp;Thick,</span>
<span class="c"># 6&amp;nbsp;=&amp;nbsp;Double,</span>
<span class="c"># 7&amp;nbsp;=&amp;nbsp;Hair,</span>
<span class="c"># 8&amp;nbsp;=&amp;nbsp;Medium dashed,</span>
<span class="c"># 9&amp;nbsp;=&amp;nbsp;Thin dash-dotted,</span>
<span class="c"># 10&amp;nbsp;=&amp;nbsp;Medium dash-dotted,</span>
<span class="c"># 11&amp;nbsp;=&amp;nbsp;Thin dash-dot-dotted,</span>
<span class="c"># 12&amp;nbsp;=&amp;nbsp;Medium dash-dot-dotted,</span>
<span class="c"># 13&amp;nbsp;=&amp;nbsp;Slanted medium dash-dotted.</span>
<span class="c"># The line styles 8 to 13 appear in BIFF8 files (Excel 97 and later) only.</span>
<span class="c"># For pictures of the line styles, refer to OOo docs s3.10 (p22)</span>
<span class="c"># &quot;Line Styles for Cell Borders (BIFF3-BIFF8)&quot;.&lt;/p&gt;</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span></div>
<div class="viewcode-block" id="XFBorder"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.XFBorder">[docs]</a><span class="k">class</span> <span class="nc">XFBorder</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># The colour index for the cell&#39;s top line</span>
    <span class="n">top_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The colour index for the cell&#39;s bottom line</span>
    <span class="n">bottom_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The colour index for the cell&#39;s left line</span>
    <span class="n">left_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The colour index for the cell&#39;s right line</span>
    <span class="n">right_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The colour index for the cell&#39;s diagonal lines, if any</span>
    <span class="n">diag_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The line style for the cell&#39;s top line</span>
    <span class="n">top_line_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The line style for the cell&#39;s bottom line</span>
    <span class="n">bottom_line_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The line style for the cell&#39;s left line</span>
    <span class="n">left_line_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The line style for the cell&#39;s right line</span>
    <span class="n">right_line_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># The line style for the cell&#39;s diagonal lines, if any</span>
    <span class="n">diag_line_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = draw a diagonal from top left to bottom right</span>
    <span class="n">diag_down</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = draw a diagonal from bottom left to top right</span>
    <span class="n">diag_up</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">##</span>
<span class="c"># A collection of the background-related attributes of an XF record.</span>
<span class="c"># Items correspond to those in the Excel UI&#39;s Format/Cells/Patterns tab.</span>
<span class="c"># An explanation of &quot;colour index&quot; is given in the Formatting</span>
<span class="c"># section at the start of this document.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span></div>
<div class="viewcode-block" id="XFBackground"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.XFBackground">[docs]</a><span class="k">class</span> <span class="nc">XFBackground</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># See section 3.11 of the OOo docs.</span>
    <span class="n">fill_pattern</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># See section 3.11 of the OOo docs.</span>
    <span class="n">background_colour_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># See section 3.11 of the OOo docs.</span>
    <span class="n">pattern_colour_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">##</span>
<span class="c"># A collection of the alignment and similar attributes of an XF record.</span>
<span class="c"># Items correspond to those in the Excel UI&#39;s Format/Cells/Alignment tab.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
</div>
<div class="viewcode-block" id="XFAlignment"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.XFAlignment">[docs]</a><span class="k">class</span> <span class="nc">XFAlignment</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># Values: section 6.115 (p 214) of OOo docs</span>
    <span class="n">hor_align</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Values: section 6.115 (p 215) of OOo docs</span>
    <span class="n">vert_align</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Values: section 6.115 (p 215) of OOo docs.&lt;br /&gt;</span>
    <span class="c"># Note: file versions BIFF7 and earlier use the documented</span>
    <span class="c"># &quot;orientation&quot; attribute; this will be mapped (without loss)</span>
    <span class="c"># into &quot;rotation&quot;.</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = text is wrapped at right margin</span>
    <span class="n">text_wrapped</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># A number in range(15).</span>
    <span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = shrink font size to fit text into cell.</span>
    <span class="n">shrink_to_fit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 0 = according to context; 1 = left-to-right; 2 = right-to-left</span>
    <span class="n">text_direction</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">##</span>
<span class="c"># A collection of the protection-related attributes of an XF record.</span>
<span class="c"># Items correspond to those in the Excel UI&#39;s Format/Cells/Protection tab.</span>
<span class="c"># Note the OOo docs include the &quot;cell or style&quot; bit</span>
<span class="c"># in this bundle of attributes.</span>
<span class="c"># This is incorrect; the bit is used in determining which bundles to use.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
</div>
<div class="viewcode-block" id="XFProtection"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.XFProtection">[docs]</a><span class="k">class</span> <span class="nc">XFProtection</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">,</span> <span class="n">EqNeAttrs</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># 1 = Cell is prevented from being changed, moved, resized, or deleted</span>
    <span class="c"># (only if the sheet is protected).</span>
    <span class="n">cell_locked</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># 1 = Hide formula so that it doesn&#39;t appear in the formula bar when</span>
    <span class="c"># the cell is selected (only if the sheet is protected).</span>
    <span class="n">formula_hidden</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">##</span>
<span class="c"># eXtended Formatting information for cells, rows, columns and styles.</span>
<span class="c"># &lt;br /&gt; -- New in version 0.6.1</span>
<span class="c">#</span>
<span class="c"># &lt;p&gt;Each of the 6 flags below describes the validity of</span>
<span class="c"># a specific group of attributes.</span>
<span class="c"># &lt;br /&gt;</span>
<span class="c"># In cell XFs, flag==0 means the attributes of the parent style XF are used,</span>
<span class="c"># (but only if the attributes are valid there); flag==1 means the attributes</span>
<span class="c"># of this XF are used.&lt;br /&gt;</span>
<span class="c"># In style XFs, flag==0 means the attribute setting is valid; flag==1 means</span>
<span class="c"># the attribute should be ignored.&lt;br /&gt;</span>
<span class="c"># Note that the API</span>
<span class="c"># provides both &quot;raw&quot; XFs and &quot;computed&quot; XFs -- in the latter case, cell XFs</span>
<span class="c"># have had the above inheritance mechanism applied.</span>
<span class="c"># &lt;/p&gt;</span>
</div>
<div class="viewcode-block" id="XF"><a class="viewcode-back" href="../../xlrd.html#xlrd.formatting.XF">[docs]</a><span class="k">class</span> <span class="nc">XF</span><span class="p">(</span><span class="n">BaseObject</span><span class="p">):</span>

    <span class="c">##</span>
    <span class="c"># 0 = cell XF, 1 = style XF</span>
    <span class="n">is_style</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># cell XF: Index into Book.xf_list</span>
    <span class="c"># of this XF&#39;s style XF&lt;br /&gt;</span>
    <span class="c"># style XF: 0xFFF</span>
    <span class="n">parent_style_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c">#</span>
    <span class="n">_format_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c">#</span>
    <span class="n">_font_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c">#</span>
    <span class="n">_alignment_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c">#</span>
    <span class="n">_border_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c">#</span>
    <span class="n">_background_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># &amp;nbsp;</span>
    <span class="n">_protection_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Index into Book.xf_list</span>
    <span class="n">xf_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Index into Book.font_list</span>
    <span class="n">font_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># Key into Book.format_map</span>
    <span class="c"># &lt;p&gt;</span>
    <span class="c"># Warning: OOo docs on the XF record call this &quot;Index to FORMAT record&quot;.</span>
    <span class="c"># It is not an index in the Python sense. It is a key to a map.</span>
    <span class="c"># It is true &lt;i&gt;only&lt;/i&gt; for Excel 4.0 and earlier files</span>
    <span class="c"># that the key into format_map from an XF instance</span>
    <span class="c"># is the same as the index into format_list, and &lt;i&gt;only&lt;/i&gt;</span>
    <span class="c"># if the index is less than 164.</span>
    <span class="c"># &lt;/p&gt;</span>
    <span class="n">format_key</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">##</span>
    <span class="c"># An instance of an XFProtection object.</span>
    <span class="n">protection</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># An instance of an XFBackground object.</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># An instance of an XFAlignment object.</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">##</span>
    <span class="c"># An instance of an XFBorder object.</span>
    <span class="n">border</span> <span class="o">=</span> <span class="bp">None</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../xlrd.html">xlrd</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>